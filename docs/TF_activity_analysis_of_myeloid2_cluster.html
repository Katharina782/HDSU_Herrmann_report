<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="kmikulik" />


<title>TF activity in myeloid2 cells</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Report</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Introduction.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Results
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="HIV_CSF_dataset_analysis.html">1. CSF/Blood samples</a>
    </li>
    <li>
      <a href="TF_activity_analysis_of_myeloid2_cluster.html">2. TF activity Myeloid2</a>
    </li>
    <li>
      <a href="Triculture_dataset_analysis_and_integration_Farhadian_dataset.html">3. Integration CSF/Blood &amp; triculture</a>
    </li>
    <li>
      <a href="Triculture_dataset_GRN_with_Scenic.html">4. TF activity iMg</a>
    </li>
  </ul>
</li>
<li>
  <a href="Discussion.html">Discussion</a>
</li>
<li>
  <a href="Methods.html">Methods</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Katharina782/report">
    <span class="fas fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">TF activity in myeloid2 cells</h1>
<h4 class="author">kmikulik</h4>
<h4 class="date">7 12 2021</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#grn-inference-with-scenic">GRN inference with Scenic</a></li>
<li><a href="#bulk-atacseq-footprinting-c20-cell-line">Bulk ATACseq footprinting, C20 cell line</a>
<ul>
<li><a href="#volcano-plot-atac-seq-footprinting">Volcano Plot ATAC-seq footprinting</a></li>
</ul></li>
<li><a href="#compare-tf-activities-between-clusters-and-look-for-patterns">Compare TF activities between clusters and look for patterns</a>
<ul>
<li><a href="#split-heatmap-into-3-separate-heatmaps-according-to-the-different-patients">Split Heatmap into 3 separate heatmaps according to the different patients</a></li>
<li><a href="#heatmap-containing-only-tfs-found-by-atac-seq-data-analysis">Heatmap containing only TFs found by ATAC-seq data analysis</a></li>
</ul></li>
<li><a href="#determine-k-for-k-means-hierarchical-clustering">1. Determine k for k-means hierarchical clustering</a>
<ul>
<li><a href="#k-3-hierarchical-clustering">K = 3 Hierarchical Clustering</a>
<ul>
<li><a href="#heatmap-for-patient-1">Heatmap for patient 1</a></li>
<li><a href="#extract-cells-from-each-cluster">Extract cells from each cluster</a>
<ul>
<li><a href="#number-of-cells-in-each-cluster">number of cells in each cluster</a></li>
<li><a href="#are-there-significant-differences-in-tf-activity-between-the-three-clusters">Are there significant differences in TF activity between the three clusters?</a></li>
</ul></li>
</ul></li>
<li><a href="#k-4-hierarchical-clustering">K = 4 Hierarchical clustering</a>
<ul>
<li><a href="#heatmap-for-patient-1-1">Heatmap for patient 1</a>
<ul>
<li><a href="#are-there-significant-differences-in-tf-activity-between-the-four-clusters">Are there significant differences in TF activity between the four clusters?</a></li>
</ul></li>
</ul></li>
<li><a href="#k-5-hierarchical-clustering">K = 5 Hierarchical Clustering</a>
<ul>
<li><a href="#heatmap-for-patient-1-2">Heatmap for patient 1</a>
<ul>
<li><a href="#are-there-significant-differences-in-tf-activity-between-the-four-clusters-1">Are there significant differences in TF activity between the four clusters?</a></li>
</ul></li>
</ul></li>
<li><a href="#section">#</a></li>
<li><a href="#which-clusters-are-significantly-different-for-different-k">Which Clusters are significantly different for different k?</a>
<ul>
<li><a href="#k-3">k = 3?</a></li>
<li><a href="#k-4">k = 4</a></li>
<li><a href="#k-5">k = 5</a></li>
</ul></li>
</ul></li>
<li><a href="#section-1"></a>
<ul>
<li><a href="#conclusion-on-how-many-ks-to-use-for-hierarchical-clustering">Conclusion on how many k’s to use for hierarchical clustering</a></li>
</ul></li>
<li><a href="#transfer-the-3-cluster-identitites-to-patient2-and-patient3">2. Transfer the 3 cluster identitites to patient2 and patient3</a>
<ul>
<li><a href="#label-transfer">Label Transfer</a></li>
<li><a href="#predicted-cluster-labels">Predicted cluster labels</a></li>
</ul></li>
<li><a href="#hierarchical-clustering-for-all-3-patients-separately">3. Hierarchical clustering for all 3 patients separately</a>
<ul>
<li><a href="#patient2">patient2</a>
<ul>
<li><a href="#draw-heatmap-for-patient-3">1. Draw Heatmap for Patient 3</a></li>
<li><a href="#kruskal_wallis-test-patient2">2. Kruskal_Wallis Test Patient2</a></li>
</ul></li>
<li><a href="#patient-3">patient 3</a>
<ul>
<li><a href="#draw-heatmap-for-patient-3-1">1. Draw Heatmap for Patient 3</a></li>
<li><a href="#kruskal-wallis-test-patient-3">2. Kruskal-Wallis test Patient 3</a></li>
</ul></li>
<li><a href="#comparison-between-all-3-patients">comparison between all 3 patients</a>
<ul>
<li><a href="#heatmaps-of-k-means-clustering-with-k-3-for-all-three-patients">Heatmaps of k-means clustering with k = 3 for all three patients</a></li>
</ul></li>
</ul></li>
<li><a href="#section-2"></a>
<ul>
<li><a href="#which-tfs-show-significantly-different-activity-between-the-clusters-across-patients">Which TFs show significantly different activity between the clusters across patients?</a>
<ul>
<li><a href="#are-tfs-differentiating-the-three-clusters-similar-across-all-three-patients">Are TFs differentiating the three clusters similar across all three patients?</a></li>
</ul></li>
<li><a href="#tfs-show-different-activity-in-one-of-the-three-clusters">11 TFs show different activity in one of the three clusters</a>
<ul>
<li><a href="#patient-1">Patient 1</a></li>
<li><a href="#patient-2">Patient 2</a></li>
<li><a href="#patient-3-1">Patient 3</a></li>
</ul></li>
<li><a href="#section-3"></a>
<ul>
<li><a href="#ctcf-expression-across-patients">CTCF expression across patients</a></li>
</ul></li>
<li><a href="#correlations-between-clusters-across-patients">Correlations between clusters across patients</a>
<ul>
<li><a href="#correlation-between-clusters-based-on-all-125-tfs">Correlation between clusters based on all 125 TFs</a></li>
<li><a href="#correlation-between-clusters-based-on-all-tfs-with-differential-activity-between-clusters">Correlation between clusters based on all TFs with differential activity between clusters</a></li>
<li><a href="#tf-correlation-across-clusters">TF correlation across clusters</a></li>
</ul></li>
</ul></li>
<li><a href="#gene-expression-analysis">Gene expression analysis</a>
<ul>
<li><a href="#tf-gene-expression-of-the-11-tfs-with-different-activity-between-clusters">TF gene expression of the 11 TFs with different activity between clusters</a></li>
<li><a href="#quality-of-the-myeloid-2-clusters">Quality of the Myeloid 2 clusters</a></li>
<li><a href="#housekeeping-genes">Housekeeping genes</a></li>
</ul></li>
<li><a href="#appendix">Appendix</a>
<ul>
<li><a href="#gene-expression-analysis-of-the-two-myeloid2-subclusters">Gene expression analysis of the two Myeloid2 subclusters</a>
<ul>
<li><a href="#tf-from-the-farhadian-et-al.">TF from the Farhadian et al.</a></li>
<li><a href="#differential-gene-expression-analyisis">Differential gene expression analyisis</a></li>
<li><a href="#tf-from-gosselin-et-al.">TF from Gosselin et al.</a></li>
<li><a href="#which-of-the-11-tfs-are-mentioned-by-gosselin-et-al">Which of the 11 TFs are mentioned by Gosselin et al?</a></li>
</ul></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2021-12-20
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>report/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20211203code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20211203)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20211203code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20211203)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomKatharina782reporttreeea7e899746b03ca612d93ad003c875fc101d2329targetblankea7e899a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/Katharina782/report/tree/ea7e899746b03ca612d93ad003c875fc101d2329" target="_blank">ea7e899</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomKatharina782reporttreeea7e899746b03ca612d93ad003c875fc101d2329targetblankea7e899a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/Katharina782/report/tree/ea7e899746b03ca612d93ad003c875fc101d2329" target="_blank">ea7e899</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    analysis/Independent_cell_type_identification_Farhadian_dataset_cache/
    Ignored:    analysis/Triculture_dataset_analysis_and_integration_Farhadian_dataset_cache/

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd</code>) and HTML (<code>docs/TF_activity_analysis_of_myeloid2_cluster.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/ea7e899746b03ca612d93ad003c875fc101d2329/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">ea7e899</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
<td>
wflow_publish(all = TRUE, republish = TRUE, delete_cache = TRUE)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/40651d96647f10219a4aec953c8d618d57bc13f5/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">40651d9</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/f94eb8c2238df11d56188f301f5c0d8bec07a0cb/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">f94eb8c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
<td>
wflow_publish(“analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd”,
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/bb965a8fe71e28af44fba8f3042204001cddaa0c/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">bb965a8</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
<td>
wflow_publish(“analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd”)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/91e34e269b1382b79f47740d549c4f68abc4cd46/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">91e34e2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
<td>
wflow_publish(“analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd”)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/2a95e927f953c093f2e48cb2b6551d152f735267/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/fec6c6e9430260f415f472edf227cbf6434c20ae/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">fec6c6e</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-17
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/e5e16d2fafe64661ad4400d6f14ff63f9bb0efce/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">e5e16d2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-17
</td>
<td>
wflow_publish(files = rmd)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/5bb41240b1a4dff64e2b5fded39e9d88dc15805b/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">5bb4124</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/5d4419ed1127a959edfae38d9632cfbafc52671d/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">5d4419e</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
<td>
wflow_publish(c("analysis/_site.yml“,”analysis/index.Rmd“,”analysis/references.bib",
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/550997780789f62be907ec2095aa2ff2a1fd9087/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">5509977</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
<td>
wflow_publish(“analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd”)
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/analysis/TF_activity_analysis_of_myeloid2_cluster.Rmd" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
<td>
recent updates
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/dde10972b37ffd997474921968223514c8cb1b1f/docs/TF_activity_analysis_of_myeloid2_cluster.html" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
<td>
recent updates
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<style>
body {
text-align: justify}
</style>
<pre class="r"><code>knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, message = FALSE,
                      cache = FALSE, autodep = TRUE)</code></pre>
<pre class="r"><code>library(tidyverse)
library(Seurat)
library(edgeR)
library(Matrix)
library(data.table)
library(ggplot2)
library(dplyr)
library(ggrepel)
#library(harmony)
library(RColorBrewer)
library(pheatmap)
library(ggcorrplot)
library(ComplexHeatmap)
library(circlize)
library(ggpubr)
library(gridExtra)
library(knitr)
library(ggVennDiagram)
library(corrplot)
library(rstatix)
# &quot;Multitasking/Multiprocessing&quot;
library(future)
#plan(&quot;multisession&quot;, workers = 24)</code></pre>
<div id="grn-inference-with-scenic" class="section level1">
<h1>GRN inference with Scenic</h1>
<p>Using Scenic I tried to infer Gene regulatory networks from the gene expression data. The output is a matrix of TF (Transcription Factor) activity per cell. In this case the activity matrix contains activity of 125 different transcription factors.</p>
<p>First, we wanted to see if we can identify patterns in the TF activity in the Myeloid2 cells. We compared the TF activity to TFs shown to have differential binding scores between three infection states (uninfected, latent infection, active infection) in primary microglia (bulk ATACseq). For the comparison with the TF activity in Myeloid2 cells we focused on the TF with differential binding scores between <strong>uninfected</strong> and <strong>latently infected</strong> states.</p>
<p>Can we see patterns of increased/decreased TF activity in the Myeloid2 cells that might correspond to the binding scores between infection states in primary microglia?</p>
<ul>
<li>read in Seurat object</li>
</ul>
<pre class="r"><code>hiv7 &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/total_7_samples_label_transfer.rds&quot;)
hiv4 &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/non_integrated_HIV1_HIV2_4samples_seurat_object.rds&quot;)</code></pre>
<ul>
<li>read in AuCell matrix (output from Scenic)</li>
</ul>
<pre class="r"><code>auc_mtx &lt;- read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/aucell_matrix_10k_hvg.tsv&quot;, sep = &quot;\t&quot;)</code></pre>
<ul>
<li>Combine AuCell Matrix and Seurat object</li>
</ul>
<pre class="r"><code># add auc matrix to metadata of hiv4 seurat object
hiv7_scenic &lt;- AddMetaData(hiv7, 
                    metadata = auc_mtx, 
                    col.name = colnames(auc_mtx))</code></pre>
</div>
<div id="bulk-atacseq-footprinting-c20-cell-line" class="section level1">
<h1>Bulk ATACseq footprinting, C20 cell line</h1>
<p>Using bulk ATACseq data from primary microglia at three different conditions, active infection, latent infection, uninfected, differential binding scores were obtained using TOBIAS. Here, I will use the TFs which were previously shown to have differential binding scores in these primary microglia. Since I expect the CSF Myeloid cells to be latently infected, because they have been obtained from patients receiving ART, I will use the TFs with differential binding scores between latent infection and uninfected. We would like to know if the TF activity inferred from RNAseq data of Myeloid2 cells correlates with these differential binding scores. In other words, we want to know if the patterns of differential TF activity are similar as the patterns of differential TF binding scores. For example, if a TF was shown to be more bound in latently infected primary microglia compared to uninfected primary microglia, we would expect the TF to be more active in a group of Myeloid2 cells which are latently infected compared to a group of Myeloid2 cells which are uninfected.</p>
<p>When you overlap the TF from the TF activity matrix obtained by running SCNEIC on the 10.000 most highly variable genes with the differntially bound TFs, 24 of the TFs overlap.</p>
<p>Using less than 10.000 most highly variable genes as an input matrix for SCENIC results in a lower number of TFs which overlap. Increasing the number of input features for SCENIC increases the number of TFs included in the TF activity matrix</p>
<pre class="r"><code># read in dataframe containing differntial binding scores between conditions
#
# red = latently infected
# gfp = active infected
# uninfected
tfs_ana &lt;- read.table(&quot;/media/ag-cherrmann/projects/06_HIV_Microglia/data/atacseq/data-2020-11-06/tobias/TOBIAS_snakemake/footprint_mglia2_GlassTF_17-03/TFBS/bindetect_results.txt&quot;, sep = &quot;\t&quot;, header = TRUE)

# filter TFs with significant p values between latent infection and uninfected
# I decided to use a threshold of p-value &lt; 1e-50, because due to the large number 
# of data, all p-values will be very high
top_tfs &lt;- tfs_ana %&gt;% filter(uninf_red_pvalue &lt; 1e-50)

# keep only the TFs in the dataframe which overlap between the two datasets.
overlap_atac &lt;- top_tfs %&gt;% filter(name %in% colnames(auc_mtx))

# extract names of TFs more bound in either condition
up_latent &lt;- overlap_atac$name[overlap_atac$uninf_red_change &lt; 0]
up_uninf &lt;- overlap_atac$name[overlap_atac$uninf_red_change &gt; 0]</code></pre>
<div id="volcano-plot-atac-seq-footprinting" class="section level2">
<h2>Volcano Plot ATAC-seq footprinting</h2>
<p>Interestingly, only four TFs found in the TF activity matrix of Myeloid2 cells are more bound in latent infection than in uninfected primary microglia.</p>
<pre class="r"><code>
top_tfs %&gt;% 
  # add a column containing information in which condition the corresponding TF 
  # is upregulated
  mutate(condition = ifelse(uninf_red_change &lt; 0, &quot;up_latent&quot;, &quot;up_uninf&quot;)) %&gt;%
  # add a column conaining the labels for the plot
  # I only want to label cells which are also found by Scenic
  mutate(label = ifelse(name %in% overlap_atac$name, name, NA)) %&gt;% 
  ggplot(aes(x = uninf_red_change,
             y = -log10(uninf_red_pvalue),
             col = condition, 
             label = label)) +
  geom_point() +
  geom_hline(yintercept = -log10(1e-50), col = &quot;red&quot;) +
  geom_text(nudge_x = .05, nudge_y = 2) +
  labs(title = &quot;TFs with differential binding scores&quot;) +
  ylab(&quot;-log10(p_value)&quot;) +
  xlab(&quot;differential binding score&quot;)
Warning: Removed 51 rows containing missing values (geom_text).</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-1">
Past versions of unnamed-chunk-6-1.png
</button>
</p>
<div id="fig-unnamed-chunk-6-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/40651d96647f10219a4aec953c8d618d57bc13f5/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">40651d9</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/5bb41240b1a4dff64e2b5fded39e9d88dc15805b/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">5bb4124</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-6-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="compare-tf-activities-between-clusters-and-look-for-patterns" class="section level1">
<h1>Compare TF activities between clusters and look for patterns</h1>
<p>The idea was to cluster the Myeloid2 cells based on their TF activity using Hierarchical clustering. To do this I perofrmed hierarchical clustering on Myeloid2 cells from patient1 (HIV1_CSF) with k=3/4/5. The idea for using only patient 1 was that the other two patients might be used for validation of the clustering later on. If the clusters are biological, I might be able to transfer the clusters onto the Myeloid2 cells from patient2 (HIV2_CSF) and patient3 (HIV3_CSF). If the clusters also separate the Myeloid2 cells of the other two patients nicely, this would validate that there is a biological meaning behind the clusters.</p>
<p>However, as we will see the label transfer of the cluster identities did not work, probably due to the small sample size. There are only 146 in total in the Myeloid2 cluster of infected patients.</p>
<p>The alternative strategy was to perform independent hierarchical clustering across all patients and compare the TF activity between clusters. Can we find TF activities which differentiate clusters across patients and find correlations between clusters across patients?</p>
<ol style="list-style-type: decimal">
<li>Determine k for k-means hierarchical clustering</li>
<li>Transfer the cluster identities to patient2 and patient3</li>
<li>Hierarchical Clustering for all 3 patients separately</li>
</ol>
<pre class="r"><code>

# TF annotations
la &lt;- rowAnnotation(type_TF = 
                      case_when(colnames(auc_mtx) %in% up_latent ~ &quot;up_latent&quot;,
                                        colnames(auc_mtx) %in% up_uninf  ~ &quot;up_uninf&quot;,
                                        TRUE ~&quot;unknown&quot;),
                     name = &quot;type_TF&quot;,
                     col = list(type_TF = c(&quot;up_latent&quot; =  &quot;red&quot;, 
                                            &quot;up_uninf&quot; =  &quot;pink&quot;,
                                            &quot;unknown&quot; = &quot;forestgreen&quot;)))
  </code></pre>
<div id="split-heatmap-into-3-separate-heatmaps-according-to-the-different-patients" class="section level2">
<h2>Split Heatmap into 3 separate heatmaps according to the different patients</h2>
<pre class="r"><code># 3 heatmaps with all Scenic TFs
ht_list &lt;- map(seq.int(1:3), function(n) {
  patients &lt;- c (&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;) # 3 different patients
  # filter the dataset for only Myeloid2 cells and iteratively one of the patients
  df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == patients[n])
  # select only the cells of the activity matrix which are myeloid2 and the correct patient
  mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df),]
  # heatmap
  ht &lt;- Heatmap(t(mtx), 
               column_title = paste0(&quot;patient: &quot;, patients[n]), 

               column_km = 3,
               #row_km = n, 
               show_column_names = FALSE,
               col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
               show_row_names = TRUE
               ) 
               #top_annotation = column_annotation) 
  list(name = patients[n], heatmap = ht)
})


ht_list[[1]]$heatmap + ht_list[[2]]$heatmap + ht_list[[3]]$heatmap + la</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-8-1.png" width="1248" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-8-1">
Past versions of unnamed-chunk-8-1.png
</button>
</p>
<div id="fig-unnamed-chunk-8-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/40651d96647f10219a4aec953c8d618d57bc13f5/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-8-1.png" target="_blank">40651d9</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-8-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-8-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-8-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-8-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-8-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="heatmap-containing-only-tfs-found-by-atac-seq-data-analysis" class="section level2">
<h2>Heatmap containing only TFs found by ATAC-seq data analysis</h2>
<pre class="r"><code># 3 heatmaps, but only the TFs which overlap with Anas analysis
ht_list &lt;- map(seq.int(1:3), function(n) {
  patients &lt;- c (&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;) # 3 different patients
  # filter the dataset for only Myeloid2 cells and iteratively one of the patients
  df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == patients[n])
  # select only the cells of the activity matrix which are myeloid2 and the correct patient
  # select TFs which overlap with Anas analysis
  mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), overlap_atac$name]
  # heatmap
  ht &lt;- Heatmap(t(mtx), 
               column_title = paste0(&quot;patient: &quot;, patients[n]), 

               column_km = 3,
               #row_km = n, 
               show_column_names = FALSE,
               col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
               right_annotation = rowAnnotation(type_TF = ifelse(colnames(auc_mtx[,overlap_atac$name]) %in% up_latent, &quot;up_latent&quot;, &quot;up_uninf&quot;),
                                                name = &quot;type_TF&quot;,
                                                col = list(type_TF = c(&quot;up_latent&quot; =  &quot;red&quot;,
                                                                       &quot;up_uninf&quot; =  &quot;pink&quot;))))
  list(name = patients[n], heatmap = ht)
})

  
ht_list = ht_list[[1]]$heatmap + ht_list[[2]]$heatmap + ht_list[[3]]$heatmap
draw(ht_list, ht_gap = unit(1, &quot;cm&quot;))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-9-1.png" width="1248" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-9-1">
Past versions of unnamed-chunk-9-1.png
</button>
</p>
<div id="fig-unnamed-chunk-9-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/40651d96647f10219a4aec953c8d618d57bc13f5/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-9-1.png" target="_blank">40651d9</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-9-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-9-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-9-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-9-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-9-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="determine-k-for-k-means-hierarchical-clustering" class="section level1 tabset">
<h1 class="tabset">1. Determine k for k-means hierarchical clustering</h1>
<p>The plot of within-cluster som of squares shows that the sweet spot for the value of k is somewhere between 3 and 5. To determine the best k for k-means clustering k = 3, k = 4 and k = 5 were tried and the different outcomes compared. Since k = 4 and k = 5 does not yield an increased number of TFs which differntiate the different clusters, and therefore do not add any insights we proceeded with k = 3 in the following analysis.</p>
<p>The results of each k can be seen below. Click on the tabs to see heatmaps of the hierarchical clustering, as well as statistical test on different TF acitivity between clusters.</p>
<pre class="r"><code>df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                    orig.ident == &quot;HIV1_CSF&quot;)
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]

# Decide on a k for clustering
wss = sapply(2:15, function(k) {
  kmeans(x = t(mtx), centers = k)$tot.withinss
})

plot(2:15, wss, type = &quot;b&quot;, 
     xlab = &quot;Number of clusters k&quot;, 
     ylab = &quot;Total within-clusters sum of square&quot;)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-10-1">
Past versions of unnamed-chunk-10-1.png
</button>
</p>
<div id="fig-unnamed-chunk-10-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/40651d96647f10219a4aec953c8d618d57bc13f5/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-10-1.png" target="_blank">40651d9</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-10-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-10-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-10-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-10-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-10-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="k-3-hierarchical-clustering" class="section level2">
<h2>K = 3 Hierarchical Clustering</h2>
<div id="heatmap-for-patient-1" class="section level3">
<h3>Heatmap for patient 1</h3>
<pre class="r"><code>#map(seq.int(1:5), function(k){
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV1_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht_pat1 &lt;-draw(Heatmap(t(mtx), 
             column_title = &quot;Myeloid2 cells from patient 1, k = 3&quot;, 

             column_km = 3,
             column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la
             ))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-11-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-11-1">
Past versions of unnamed-chunk-11-1.png
</button>
</p>
<div id="fig-unnamed-chunk-11-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-11-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-11-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-11-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-11-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-11-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>             #top_annotation = column_annotation) </code></pre>
</div>
<div id="extract-cells-from-each-cluster" class="section level3">
<h3>Extract cells from each cluster</h3>
<pre class="r"><code>### Extract cells from each cluster


# if you draw the heatmap, the results of th eclustering will not change anymore
#png(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/analysis/Myeloid2_cluster/Myeloid2_3clusters.png&quot;, width = 15, height = 17, res = 1200)
#ht &lt;- draw(ht_pat1)
# get the columns names of cluster one
c1 &lt;- colnames(t(mtx[column_order(ht_pat1)[[1]],]))
#write.table(c1, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster1.tsv&quot;, sep = &quot;\t&quot;)

# get the column names of cluster two
c2 &lt;- colnames(t(mtx[column_order(ht_pat1)[[2]],]))
#write.table(c2, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster2.tsv&quot;, sep = &quot;\t&quot;)

# get the column names of cluster 3
c3 &lt;- colnames(t(mtx[column_order(ht_pat1)[[3]],]))
#write.table(c3, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster3.tsv&quot;, sep = &quot;\t&quot;)</code></pre>
<div id="number-of-cells-in-each-cluster" class="section level4">
<h4>number of cells in each cluster</h4>
<pre class="r"><code># summary staticstics
hiv7_scenic@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  filter(orig.ident == &quot;HIV1_CSF&quot;,
         cell_type == &quot;Myeloid2&quot;,
         cell %in% c(c1,c2,c3)) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% c1, &quot;c1&quot;, ifelse(cell %in% c2, &quot;c2&quot;, &quot;c3&quot;))) %&gt;% 
  #group_by(ht_cluster) %&gt;% 
  select(ht_cluster, CTCF) %&gt;% 
  group_by(ht_cluster) %&gt;% 
  summarise(
    count = n(),
    mean = mean(CTCF),
    sd = sd(CTCF)) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">ht_cluster</th>
<th align="right">count</th>
<th align="right">mean</th>
<th align="right">sd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">c1</td>
<td align="right">15</td>
<td align="right">0.0417362</td>
<td align="right">0.0163909</td>
</tr>
<tr class="even">
<td align="left">c2</td>
<td align="right">23</td>
<td align="right">0.0156238</td>
<td align="right">0.0128713</td>
</tr>
<tr class="odd">
<td align="left">c3</td>
<td align="right">34</td>
<td align="right">0.0156253</td>
<td align="right">0.0139310</td>
</tr>
</tbody>
</table>
</div>
<div id="are-there-significant-differences-in-tf-activity-between-the-three-clusters" class="section level4">
<h4>Are there significant differences in TF activity between the three clusters?</h4>
<p>ANOVA test is parametric and assumes normally distributed data, while Kruskal-Wallis-Test compares the mean of one or more groups, but is non-parametric. As can be seen in the boxplots above the data is not normally distributed, therefore Kruskal-Wallis-Test is more appropriate in this case. In both cases the Null-Hypothesis is that there is no difference between the groups.</p>
<p>Since I am repeating the test 125 times, I adjust the p-values with the FDR method. This methods is more powerful than more conservative methdos, like bonferroni, Holm or Hochberg.</p>
<p>Performing Kruskal-Wallis-Test to find differences between the three clusters in patient1 yields 54 TFs of all 125 TFs which are differentially active between the three clusters (p-value &lt; 0.05). Of the 24 TFs with differential binding scores in the C20 cell line, sixteen have significantly different activity between the clusters.</p>
<p>Now that we know that there are significant differences between clusters, we want to identify which cluster/s are different from which other cluster/s.</p>
<p>Pairwise-Wilcox-Test is a non-parametric pairwise test. Again, because we repeat the test we will correct for multiple hypothesis testing using the FDR method. The results are shown in boxplots below.</p>
</details>
<details>
<summary>
Kruskal-Wallis-Test, p-value adjustment, posthoc tests
</summary>
<p><strong>Kruskal-Wallis Test and p-value adjustments for all 125 TFs</strong></p>
<pre class="r"><code># non-parametric alternative to ANOVA -&gt; Kruskal_wallis test
k3_df &lt;- hiv7_scenic@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  filter(orig.ident == &quot;HIV1_CSF&quot;,
         cell_type == &quot;Myeloid2&quot;,
         cell %in% c(c1,c2,c3)) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% c1, &quot;c1&quot;, ifelse(cell %in% c2, &quot;c2&quot;, &quot;c3&quot;))) 
# check all TFs 
p_values &lt;- map(seq.int(1:125), function(n){
  tf &lt;- colnames(auc_mtx)[n]
  p_values &lt;- unlist(kruskal.test(pull(k3_df[tf]) ~ ht_cluster, k3_df))[&quot;p.value&quot;]
  #list(tf = tf, p_value = p_values)
})

# plot distribution of p_values
hist(as.numeric(unname(unlist(p_values))), 
     main = &quot;distribution of p_values&quot;,
     xlab = &quot;p_values&quot;,
     breaks = 20)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-14-1">
Past versions of unnamed-chunk-14-1.png
</button>
</p>
<div id="fig-unnamed-chunk-14-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/40651d96647f10219a4aec953c8d618d57bc13f5/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-1.png" target="_blank">40651d9</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>
# adjust for multiple testing with FDR
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)

hist((adj_p_values), 
     main = &quot;distribution of p_values&quot;,
     xlab = &quot;p_values&quot;,
     breaks = 20)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-14-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>

# how many transcription factors are significantly different between the clusters?
sign3 &lt;- adj_p_values[adj_p_values&lt;.05]
length(adj_p_values[adj_p_values&lt;0.05])
[1] 64

# get TFs that are significantly different
hiv1_diff &lt;- colnames(auc_mtx)[adj_p_values &lt; .05]

#write.table(diff3, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/total_TFs_differentially_active_in_HIV1&quot;)</code></pre>
<ul>
<li><strong>Kruskal-Wallis test and p-value adjustment for 24 TFs also identified by ATAC-seq</strong></li>
</ul>
<pre class="r"><code># check 24 TFs with Kruskal Wallis test
p_values &lt;- map(seq.int(1:24), function(n){
  tf &lt;- overlap_atac$name[n]
  p_values &lt;- unlist(kruskal.test(pull(k3_df[tf]) ~ ht_cluster, k3_df))[&quot;p.value&quot;]
})
#sign_p_values &lt;- p_values[p_values &lt; 0.01]

# adjust for multiple hypothesis testing
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)


# how many transcription factors are significantly different between the clusters?
length(adj_p_values[adj_p_values&lt;0.05])
[1] 16

# get TFs that are differentially expressed
hiv1_atac &lt;- overlap_atac$name[adj_p_values &lt; .05]
#write.table(diff3_atac, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/atac_TFs_differentially_active_in_HIV1&quot;)</code></pre>
<ul>
<li><strong>Posthoc tests for k = 3</strong></li>
</ul>
<p>For the 16 TFs with significantly different activity between the 3 clusters:</p>
<pre class="r"><code># We perform a posthoc test
#wilcox_list = list()
wilcox_list &lt;- map(seq.int(1:length(hiv1_atac)), function(i){
  tf &lt;- hiv1_atac[i]
  #print(tf)
  wilcox &lt;- pairwise.wilcox.test(pull(k3_df[tf]), pull(k3_df[&quot;ht_cluster&quot;]), 
                                 p.adjust.method = &quot;fdr&quot;)
  list(TF = tf, wilcox = wilcox)
})
  
#length(wilcox_list)
#wilcox_list</code></pre>
<hr />
</details>
</div>
</div>
</div>
<div id="k-4-hierarchical-clustering" class="section level2">
<h2>K = 4 Hierarchical clustering</h2>
<div id="heatmap-for-patient-1-1" class="section level3">
<h3>Heatmap for patient 1</h3>
<pre class="r"><code>#map(seq.int(1:5), function(k){
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV1_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht &lt;- draw(Heatmap(t(mtx), 
             column_title = &quot;Myeloid2 cells from patient 2, k = 4&quot;, 

             column_km = 4,
             column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la
             )) </code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-17-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>             #top_annotation = column_annotation) 
</code></pre>
<pre class="r"><code>### Extract cells from each cluster of k = 4

# get the columns names of cluster one
cl1 &lt;- colnames(t(mtx[column_order(ht)[[1]],]))

# get the column names of cluster two
cl2 &lt;- colnames(t(mtx[column_order(ht)[[2]],]))


# get the column names of cluster 3
cl3 &lt;- colnames(t(mtx[column_order(ht)[[3]],]))

cl4 &lt;- colnames(t(mtx[column_order(ht)[[4]],]))</code></pre>
<div id="are-there-significant-differences-in-tf-activity-between-the-four-clusters" class="section level4">
<h4>Are there significant differences in TF activity between the four clusters?</h4>
<p>ANOVA test is parametric and assumes normally distributed data, while Kruskal-Wallis-Test compares the mean of one or more groups, but is non-parametric. As can be seen in the boxplots above the data is not normally distributed, therefore Kruskal-Wallis-Test is more appropriate in this case. In both cases the Null-Hypothesis is that there is no difference between the groups.</p>
<p>Since I am repeating the test 125 times, I adjust the p-values with the FDR method. This methods is more powerful than more conservative methdos, like bonferroni, Holm or Hochberg.</p>
<p>Performing Kruskal-Wallis-Test to find differences between the four clusters in patient1 yields 51 TFs of all 125 TFs which are differentially active between the three clusters (p-value &lt; 0.05). Of the 24 TFs with differential binding scores in the C20 cell line, fourteen have significantly different activity between the clusters.</p>
<p>Now that we know that there are significant differences between clusters, we want to identify which cluster/s are different from which other cluster/s.</p>
<p>Pairwise-Wilcox-Test is a non-parametric pairwise test. Again, because we repeat the test we will correct for multiple hypothesis testing using the FDR method. The results are shown in boxplots below.</p>
</details>
<details>
<summary>
Kruskal-Wallis-Test, p-value adjustment, posthoc tests
</summary>
<ul>
<li><strong>Kruskal-Wallis Test and p-value adjustments for all 125 TFs</strong></li>
</ul>
<pre class="r"><code>
k4_df &lt;- hiv7_scenic@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  filter(orig.ident == &quot;HIV1_CSF&quot;,
         cell_type == &quot;Myeloid2&quot;,
         cell %in% c(cl1,cl2,cl3,cl4)) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% cl1, &quot;cl1&quot;, 
                             ifelse(cell %in% cl2, &quot;cl2&quot;, 
                                    ifelse(cell %in% cl3, &quot;cl3&quot;, &quot;cl4&quot;))))

# check all TFs 
p_values &lt;- map(seq.int(1:125), function(n){
  tf &lt;- colnames(auc_mtx)[n]
  p_values &lt;- unlist(kruskal.test(pull(k4_df[tf]) ~ ht_cluster, k4_df))[&quot;p.value&quot;]
  #list(tf = tf, p_value = p_values)
})

# adjust for multiple testing with FDR
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)

# how many transcription factors are significantly different between the clusters?
sign &lt;- adj_p_values[adj_p_values &lt; 0.05]
length(adj_p_values[adj_p_values&lt;0.05])
[1] 55


# get the TFs that are differentially expressed
diff4 &lt;- colnames(auc_mtx)[adj_p_values &lt; 0.05]

#write.table(diff4, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/total_TFs_differentially_active_in_HIV1_k=4&quot;)</code></pre>
<ul>
<li><strong>Kruskal-Wallis Test and p-value adjustments for 14 TFs with differential binding scores</strong></li>
</ul>
<pre class="r"><code># check 24 TFs with Kruskal Wallis test
p_values &lt;- map(seq.int(1:24), function(n){
  tf &lt;- overlap_atac$name[n]
  p_values &lt;- unlist(kruskal.test(pull(k4_df[tf]) ~ ht_cluster, k4_df))[&quot;p.value&quot;]
})
#sign_p_values &lt;- p_values[p_values &lt; 0.01]

# adjust for multiple hypothesis testing
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)


# how many transcription factors are significantly different between the clusters?
length(adj_p_values[adj_p_values&lt;0.05])
[1] 15

# get the TFs that are differentially expressed
diff4_atac &lt;- overlap_atac$name[adj_p_values &lt; .05]

#write.table(diff4_atac, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/atac_TFs_differentially_active_in_HIV1_k=4&quot;)</code></pre>
<ul>
<li><strong>Pairwise-Wilcox_Test for k = 4</strong></li>
</ul>
<p>For the 16 TFs with significantly different activity between the four clusters:</p>
<pre class="r"><code># We perform a posthoc test
#wilcox_list = list()
wilcox_list &lt;- map(seq.int(1:length(diff4_atac)), function(i){
  tf &lt;- diff4_atac[i]
  print(tf)
  wilcox &lt;- pairwise.wilcox.test(pull(k4_df[tf]), pull(k4_df[&quot;ht_cluster&quot;]), 
                                 p.adjust.method = &quot;fdr&quot;)
  list(TF = tf, wilcox = wilcox)
})
[1] &quot;NFIL3&quot;
[1] &quot;MXI1&quot;
[1] &quot;CREB1&quot;
[1] &quot;NFATC2&quot;
[1] &quot;MEF2A&quot;
[1] &quot;REST&quot;
[1] &quot;LEF1&quot;
[1] &quot;YY1&quot;
[1] &quot;MYB&quot;
[1] &quot;ETS1&quot;
[1] &quot;JUNB&quot;
[1] &quot;CEBPB&quot;
[1] &quot;CTCF&quot;
[1] &quot;ETV6&quot;
[1] &quot;MEF2C&quot;
  
#length(wilcox_list)
#wilcox_list</code></pre>
<hr />
</details>
</div>
</div>
</div>
<div id="k-5-hierarchical-clustering" class="section level2">
<h2>K = 5 Hierarchical Clustering</h2>
<div id="heatmap-for-patient-1-2" class="section level3">
<h3>Heatmap for patient 1</h3>
<pre class="r"><code>#map(seq.int(1:5), function(k){
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV1_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht &lt;- draw(Heatmap(t(mtx), 
             column_title = &quot;Myeloid2 cells from patient 1, k = 5&quot;, 

             column_km = 5,
             column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la
             )) </code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-22-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>##### Extract cells from each cluster for k= 5

# get the columns names of cluster one
clu1 &lt;- colnames(t(mtx[column_order(ht)[[1]],]))

# get the column names of cluster two
clu2 &lt;- colnames(t(mtx[column_order(ht)[[2]],]))


# get the column names of cluster 3
clu3 &lt;- colnames(t(mtx[column_order(ht)[[3]],]))

clu4 &lt;- colnames(t(mtx[column_order(ht)[[4]],]))

clu5 &lt;- colnames(t(mtx[column_order(ht)[[5]], ]))</code></pre>
<div id="are-there-significant-differences-in-tf-activity-between-the-four-clusters-1" class="section level4">
<h4>Are there significant differences in TF activity between the four clusters?</h4>
<p>ANOVA test is parametric and assumes normally distributed data, while Kruskal-Wallis-Test compares the mean of one or more groups, but is non-parametric. As can be seen in the boxplots above the data is not normally distributed, therefore Kruskal-Wallis-Test is more appropriate in this case. In both cases the Null-Hypothesis is that there is no difference between the groups.</p>
<p>Since I am repeating the test 125 times, I adjust the p-values with the FDR method. This methods is more powerful than more conservative methdos, like bonferroni, Holm or Hochberg.</p>
<p>Performing Kruskal-Wallis-Test to find differences between the five clusters in patient1 yields 59 TFs of all 125 TFs which are differentially active between the three clusters (p-value &lt; 0.05). Of the 24 TFs with differential binding scores in the C20 cell line, fifteen have significantly different activity between the clusters.</p>
<p>Now that we know that there are significant differences between clusters, we want to identify which cluster/s are different from which other cluster/s.</p>
<p>Pairwise-Wilcox-Test is a non-parametric pairwise test. Again, because we repeat the test we will correct for multiple hypothesis testing using the FDR method. The results are shown in boxplots below.</p>
</details>
<details>
<summary>
Kruskal-Wallis-Test, p-value adjustment, posthoc tests
</summary>
<ul>
<li><strong>Kruskal-Wallis Test and p-value adjustments for all 125 TFs</strong></li>
</ul>
<pre class="r"><code># all TFs
k5_df &lt;- hiv7_scenic@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  filter(orig.ident == &quot;HIV1_CSF&quot;,
         cell_type == &quot;Myeloid2&quot;,
         cell %in% c(clu1,clu2,clu3,clu4, clu5)) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% clu1, &quot;clu1&quot;, 
                             ifelse(cell %in% clu2, &quot;clu2&quot;, 
                                    ifelse(cell %in% clu3, &quot;clu3&quot;,
                                           ifelse(cell %in% clu4, &quot;clu4&quot;, &quot;clu5&quot;)))))
n = 1
# check all TFs 
p_values &lt;- map(seq.int(1:125), function(n){
  tf &lt;- colnames(auc_mtx)[n]
  p_values &lt;- unlist(kruskal.test(pull(k5_df[tf]) ~ ht_cluster, k5_df))[&quot;p.value&quot;]
  #list(tf = tf, p_value = p_values)
})

# adjust for multiple testing with FDR
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)

# how many transcription factors are significantly different between the clusters?
sign &lt;- adj_p_values[adj_p_values &lt; 0.05]
length(adj_p_values[adj_p_values&lt;0.05])
[1] 59


# get the TFs that are differentially expressed
diff5 &lt;- colnames(auc_mtx)[adj_p_values &lt; 0.05]

#write.table(diff5, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/total_TFs_differentially_active_in_HIV1_k=5&quot;)</code></pre>
<ul>
<li><strong>Kruskal-Wallis Test and p-value adjustments for all 125 TFs</strong></li>
</ul>
<pre class="r"><code># check 24 TFs with Kruskal Wallis test
p_values &lt;- map(seq.int(1:24), function(n){
  tf &lt;- overlap_atac$name[n]
  p_values &lt;- unlist(kruskal.test(pull(k5_df[tf]) ~ ht_cluster, k5_df))[&quot;p.value&quot;]
})
#sign_p_values &lt;- p_values[p_values &lt; 0.01]

# adjust for multiple hypothesis testing
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)


# how many transcription factors are significantly different between the clusters?
length(adj_p_values[adj_p_values&lt;0.05])
[1] 15

# get the TFs that are differentially expressed
diff5_atac &lt;- overlap_atac$name[adj_p_values &lt; .05]

#write.table(diff5_atac, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/atac_TFs_differentially_active_in_HIV1_k=5&quot;)</code></pre>
<ul>
<li><strong>Pairwise-Wilcox_Test for k = 5</strong></li>
</ul>
<p>For the 15 TFs with significantly different activity between the four clusters:</p>
<pre class="r"><code># We perform a posthoc test
#wilcox_list = list()
wilcox_list &lt;- map(seq.int(1:length(diff5_atac)), function(i){
  tf &lt;- diff5_atac[i]
  print(tf)
  wilcox &lt;- pairwise.wilcox.test(pull(k5_df[tf]), pull(k5_df[&quot;ht_cluster&quot;]), 
                                 p.adjust.method = &quot;fdr&quot;)
  list(TF = tf, wilcox = wilcox)
})
[1] &quot;NFIL3&quot;
[1] &quot;MXI1&quot;
[1] &quot;CREB1&quot;
[1] &quot;NFATC2&quot;
[1] &quot;MEF2A&quot;
[1] &quot;REST&quot;
[1] &quot;LEF1&quot;
[1] &quot;KLF4&quot;
[1] &quot;YY1&quot;
[1] &quot;ETS1&quot;
[1] &quot;JUNB&quot;
[1] &quot;CEBPB&quot;
[1] &quot;CTCF&quot;
[1] &quot;ETV6&quot;
[1] &quot;MEF2C&quot;
  
#length(wilcox_list)
#wilcox_list</code></pre>
<hr />
</details>
</div>
</div>
</div>
<div id="section" class="section level2 unnumbered">
<h2 class="unnumbered">#</h2>
</div>
<div id="which-clusters-are-significantly-different-for-different-k" class="section level2 tabset">
<h2 class="tabset">Which Clusters are significantly different for different k?</h2>
<p>The results from the statistical tests on difference in TF activity between clusters can be seen in the boxplots below. Sixteen, fourteen and twelve TFs were found to be differentially active between the clusters for k equal three, four and five respectively. The boxplots below also show very nicely, that the data are not normally distributed and, therefore, non-parametric tests, like the Kruskal-Wallis-Test and pairwise Wilcox-Test were used.</p>
<div id="k-3" class="section level3">
<h3>k = 3?</h3>
<pre class="r"><code>
test &lt;- k3_df
#tf.oi &lt;- c(&quot;CTCF&quot;, &quot;REST&quot;, &quot;YY1&quot;)
#names(tf.oi) &lt;- tf.oi
test.list &lt;- map(hiv1_atac, function(tf) {
  ggplot() +
  geom_violin(aes(x = test %&gt;% pull(&quot;ht_cluster&quot;), y = test %&gt;% pull(tf), 
                   fill = test %&gt;% pull(&quot;ht_cluster&quot;), alpha = .6)) +
  geom_boxplot(aes(x = test %&gt;% pull(&quot;ht_cluster&quot;), y = test %&gt;% pull(tf)), 
               alpha = 0) +
  stat_pvalue_manual(test %&gt;% 
    pairwise_wilcox_test(as.formula(paste0(tf, &quot; ~ ht_cluster&quot;))) %&gt;%
      add_xy_position()) +
    xlab(&quot;heatmap cluster&quot;) +
    ylab(paste0(tf)) +
    guides(fill = guide_legend(title = &quot;heatmap cluster&quot;)) })

do.call(gridExtra::grid.arrange, c(test.list, ncol=5, nrow = 4))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-27-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="k-4" class="section level3">
<h3>k = 4</h3>
<pre class="r"><code>
test &lt;- k4_df

test.list &lt;- map(diff4_atac, function(tf) {
  ggplot() +
  geom_violin(aes(x = test %&gt;% pull(&quot;ht_cluster&quot;), y = test %&gt;% pull(tf), 
                   fill = test %&gt;% pull(&quot;ht_cluster&quot;), alpha = .6)) +
  geom_boxplot(aes(x = test %&gt;% pull(&quot;ht_cluster&quot;), y = test %&gt;% pull(tf)), 
               alpha = 0) +
  stat_pvalue_manual(test %&gt;% 
    pairwise_wilcox_test(as.formula(paste0(tf, &quot; ~ ht_cluster&quot;))) %&gt;%
      add_xy_position()) +
    xlab(&quot;heatmap cluster&quot;) +
    ylab(paste0(tf)) +
    guides(fill = guide_legend(title = &quot;heatmap cluster&quot;)) +
    geom_violin(alpha = 0)
})

do.call(gridExtra::grid.arrange, c(test.list, ncol=5, nrow = 3))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-28-1">
Past versions of unnamed-chunk-28-1.png
</button>
</p>
<div id="fig-unnamed-chunk-28-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-28-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="k-5" class="section level3">
<h3>k = 5</h3>
<pre class="r"><code>test &lt;- k5_df

test.list &lt;- map(diff5_atac, function(tf) {
  ggplot() +
  geom_violin(aes(x = test %&gt;% pull(&quot;ht_cluster&quot;), y = test %&gt;% pull(tf), 
                   fill = test %&gt;% pull(&quot;ht_cluster&quot;), alpha = .6)) +
  geom_boxplot(aes(x = test %&gt;% pull(&quot;ht_cluster&quot;), y = test %&gt;% pull(tf)), 
               alpha = 0) +
  stat_pvalue_manual(test %&gt;% 
    pairwise_wilcox_test(as.formula(paste0(tf, &quot; ~ ht_cluster&quot;))) %&gt;%
      add_xy_position()) +
    xlab(&quot;heatmap cluster&quot;) +
    ylab(paste0(tf)) +
    guides(fill = guide_legend(title = &quot;heatmap cluster&quot;))
})

do.call(gridExtra::grid.arrange, c(test.list, ncol=5, nrow = 3))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-29-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-29-1">
Past versions of unnamed-chunk-29-1.png
</button>
</p>
<div id="fig-unnamed-chunk-29-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-29-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-29-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-29-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-29-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-29-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="section-1" class="section level1 unnumbered">
<h1 class="unnumbered"></h1>
<div id="conclusion-on-how-many-ks-to-use-for-hierarchical-clustering" class="section level2">
<h2>Conclusion on how many k’s to use for hierarchical clustering</h2>
<p>As mentioned, k = 3 was used for the subsequent analysis, since more clusters did not add additional insights.</p>
<p>The Venn diagram below shows very nicely, that out of all TFs with different activity between clusters, 68% overlap for all k (k=3/4/5) that I tested (right plot). 75% of the TF with differential binding scores in the C20 cell line overlapped for all k (left plot).</p>
<p>Therefore, I decided to proceed with k = 3 for the following analysis.</p>
<pre class="r"><code>diff5_atac &lt;- as.vector(read.table( &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/atac_TFs_differentially_active_in_HIV1_k=5&quot;))[[&quot;x&quot;]]
diff5 &lt;- as.vector(read.table( &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/total_TFs_differentially_active_in_HIV1_k=5&quot;))[[&quot;x&quot;]]


diff4_atac &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/atac_TFs_differentially_active_in_HIV1_k=4&quot;))[[&quot;x&quot;]]

diff4 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/total_TFs_differentially_active_in_HIV1_k=4&quot;))[[&quot;x&quot;]]
# list of TFs from ATAC-seq differntially active between the 3 heatmap 
#clusters from patient 1
diff3_atac &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/atac_TFs_differentially_active_in_HIV1&quot;))[[&quot;x&quot;]]

# list of TFs differntially active between the 3 heatmap clusters from patient 1
diff3 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/total_TFs_differentially_active_in_HIV1&quot;))[[&quot;x&quot;]]</code></pre>
<pre class="r"><code>p1 &lt;- ggVennDiagram(list(diff3_atac, diff4_atac, diff5_atac),
              label_alpha = 0,
              category.names= c(&quot;k = 3&quot;, &quot;k = 4&quot;, &quot;k = 5&quot;),
              #set.size = 20,
              label = &quot;percent&quot;,
              label_size = 6) +
   scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;TFs with differential binding scores in C20 cell line&quot;)
  #scale_fill_gradient (low = &quot;lightblue&quot;, high = &quot;darkblue&quot;)

p2 &lt;- ggVennDiagram(list(diff3, diff4, diff5),
              label_alpha = 0,
              category.names= c(&quot;k = 3&quot;, &quot;k = 4&quot;, &quot;k = 5&quot;),
              label = &quot;percent&quot;,
              label_size = 6) +
   scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;all TFs with different activity&quot;)

fig &lt;- ggarrange(p1, p2, ncol = 2, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;TFs with significantly different activity  between clusters for different k&quot;, size = 20))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-31-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="transfer-the-3-cluster-identitites-to-patient2-and-patient3" class="section level1 tabset">
<h1 class="tabset">2. Transfer the 3 cluster identitites to patient2 and patient3</h1>
<p>The cluster identities from patient 1 were transferred to patient 2 and patient 3 to assign each cell to one of the 3 clusters.</p>
<div id="label-transfer" class="section level2">
<h2>Label Transfer</h2>
<p><strong>Cluster annotation using an integrated reference</strong></p>
<p>Here we do not integrate the datasets beforehand and we do not modify the query expression data.</p>
<pre class="{"><code>Idents(hiv7) &lt;- &quot;cell_type&quot;
hiv &lt;- subset(hiv7, idents = &quot;Myeloid2&quot;)

# the cell type is replaced by the heatmap cluster
hiv1_my2 &lt;- subset(hiv7, cells = c(c1,c2,c3))

clusters &lt;- (
  hiv1_my2@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% c1, &quot;c1&quot;, ifelse(cell %in% c2, &quot;c2&quot;, &quot;c3&quot;))) %&gt;% 
  column_to_rownames(&quot;cell&quot;))[&quot;ht_cluster&quot;]

hiv &lt;- AddMetaData(hiv, metadata = clusters, col.name = &quot;cell_type&quot;)

# the seurat_cluster number is replaced by the number of the heatmap cluster
seurat_clusters &lt;- (
  hiv1_my2@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% c1, 1, ifelse(cell %in% c2, 2, 3))) %&gt;% 
  column_to_rownames(&quot;cell&quot;))[&quot;ht_cluster&quot;]

hiv &lt;- AddMetaData(hiv, metadata = seurat_clusters, col.name = &quot;seurat_clusters&quot;)


# split the object according to the patients
hiv_list &lt;- SplitObject(hiv, split.by = &quot;orig.ident&quot;)[3:5]
# normalize each object
for (i in names(hiv_list)) {
    hiv_list[[i]] &lt;- SCTransform(hiv_list[[i]], verbose = FALSE)
}


# patient 2 and patient 3 are our query datasets
query &lt;-merge(hiv_list[[1]], hiv_list[[3]])
reference &lt;- hiv_list[[2]]
reference &lt;- RunPCA(reference, 
                    # by default a partial PCA is run, but we compute mostgular values -&gt; run standard SVD instead
                    approx = FALSE, 
                    verbose = FALSE)

hiv_anchors &lt;- FindTransferAnchors(reference = reference,
                                   query = query, 
                                   dims = 1:30, verbose = FALSE,
                                   k.filter = NA, 
                                   reference.reduction = &quot;pca&quot;,
                                   normalization.method = &quot;SCT&quot;,
                                   reduction = &quot;pcaproject&quot;)

predictions &lt;- TransferData(anchorset = hiv_anchors, 
                            refdata = reference$cell_type,
                            k.weight = 34, dims = 1:30, verbose = FALSE)

query &lt;- AddMetaData(query, metadata = predictions)


hiv2 &lt;- subset(query, orig.ident == &quot;HIV2_CSF&quot;)
hiv3 &lt;- subset(query, orig.ident == &quot;HIV3_CSF&quot;)
#saveRDS(hiv2,&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/hiv2_CSF_myleoid2_heatmap_cluster_label_transfer.rds&quot;)
#saveRDS(hiv3, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/hiv3_CSF_myleoid2_heatmap_cluster_label_transfer.rds&quot;)</code></pre>
<p>Now that we have transferred the cluster identitities to patient2 and patient3 and saved the results in two separate Seurat objects, we can add the TF activity score to the metadata of each patient.</p>
<pre class="r"><code>hiv2 &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/hiv2_CSF_myleoid2_heatmap_cluster_label_transfer.rds&quot;)
hiv3 &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/hiv3_CSF_myleoid2_heatmap_cluster_label_transfer.rds&quot;)

hiv2_scenic &lt;- AddMetaData(hiv2, metadata = auc_mtx,
                           col.name = colnames(auc_mtx))
hiv3_scenic &lt;- AddMetaData(hiv3, metadata = auc_mtx,
                           col.name = colnames(auc_mtx))</code></pre>
</div>
<div id="predicted-cluster-labels" class="section level2">
<h2>Predicted cluster labels</h2>
<p>The heatmaps below show the predicted clusters from label transfer for patient 2 and patient 3</p>
<p>The clusters obtained after transferring the cluster identities from patient 1 to patient2 do not seem to be very good at separating cells according to TF activity.</p>
<p>When you transfer the cluster identities from patient1 to patient3 all cells, but one, are assigned to cluster1. This shows that the label transfer did not work very well. This is probably due to the low number of Myeloid2 cells in each sample.</p>
<pre class="r"><code>cluster_anno &lt;- as.data.frame(hiv2$predicted.id)

#map(seq.int(1:5), function(k){
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV2_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht_hiv2_label &lt;- Heatmap(t(mtx), 
             column_title = &quot;Predicted Clusters from Label Transfer for HIV2_CSF&quot;,             
             column_title_gp = gpar(fontsize = 15),
             column_split = paste0(&quot;cluster&quot;, hiv2$predicted.id),#cluster_anno,
             #column_km = 4,
             #column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la,
             top_annotation = HeatmapAnnotation(df = cluster_anno, name = &quot;predicted cluster&quot;)
             ) 
             #top_annotation = column_annotation) </code></pre>
<pre class="r"><code>cluster_anno &lt;- as.data.frame(hiv3$predicted.id)

#map(seq.int(1:5), function(k){
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV3_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht_hiv3_label &lt;- Heatmap(t(mtx), 
             column_title = &quot;Predicted clusters from Label Transfer for HIV3_CSF&quot;, 
             column_title_gp = gpar(fontsize = 15),
             column_split = paste0(&quot;cluster&quot;, hiv3$predicted.id),#cluster_anno,
             #column_km = 4,
             #column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la,
             top_annotation = HeatmapAnnotation(df = cluster_anno, name = &quot;predicted cluster&quot;)
             ) 
             #top_annotation = column_annotation) </code></pre>
<pre class="r"><code>ht_list &lt;- ht_hiv2_label + ht_hiv3_label
draw(ht_list, ht_gap= unit(2, &quot;cm&quot;))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-35-1.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="hierarchical-clustering-for-all-3-patients-separately" class="section level1 tabset">
<h1 class="tabset">3. Hierarchical clustering for all 3 patients separately</h1>
<p>Since the label transfer of the 3 cluster identities from patient1 did not seem to work very well, we next tried to perform hierarchical clustering using k = 3 for all 3 patients separately. This way we might be able to see if the TF activities in the 3 clusters show similar patterns across the different patients.</p>
<p>In the two heatmaps below the clusters look more sensible than the clusters observed after cluster label transfer.</p>
<div id="patient2" class="section level2">
<h2>patient2</h2>
<p><strong>K-means clustering with k = 3 for patient 2</strong></p>
<div id="draw-heatmap-for-patient-3" class="section level4">
<h4>1. Draw Heatmap for Patient 3</h4>
<pre class="r"><code>#map(seq.int(1:5), function(k){
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV2_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht2 &lt;- Heatmap(t(mtx), 
             column_title = &quot;Patient 2, HIV2_CSF&quot;, 
             column_title_gp = gpar(fontsize = 15),
             #column_split = paste0(&quot;cluster&quot;, hiv2$predicted.id),#cluster_anno,
             column_km = 3,
             column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la,
             #top_annotation = HeatmapAnnotation(df = cluster_anno, name = &quot;predicted cluster&quot;)
             ) 
             #top_annotation = column_annotation) 
ht_pat2 &lt;- draw(ht2)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-36-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-36-1">
Past versions of unnamed-chunk-36-1.png
</button>
</p>
<div id="fig-unnamed-chunk-36-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-36-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-36-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-36-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-36-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-36-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="kruskal_wallis-test-patient2" class="section level4">
<h4>2. Kruskal_Wallis Test Patient2</h4>
<pre class="r"><code># extract the cells from the 3 clusters 
# get the cell names of cluster one
c1 &lt;- colnames(t(mtx[column_order(ht_pat2)[[1]],]))
# get the cell names of cluster two
c2 &lt;- colnames(t(mtx[column_order(ht_pat2)[[2]],]))
# get the cell names of cluster 3
c3 &lt;- colnames(t(mtx[column_order(ht_pat2)[[3]],]))


# add cluster identities to Seurat object metadata and return metadata as dataframe
pat2 &lt;- hiv7_scenic@meta.data %&gt;% rownames_to_column(&quot;cell&quot;)
pat2 &lt;- pat2 %&gt;% 
  filter(orig.ident == &quot;HIV2_CSF&quot;,
         cell_type == &quot;Myeloid2&quot;,
         cell %in% c(c1,c2,c3)) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% c1, &quot;c1&quot;, ifelse(cell %in% c2, &quot;c2&quot;, &quot;c3&quot;))) 


# check all 125 TFs
# check all TFs 
p_values &lt;- map(seq.int(1:125), function(n){
  tf &lt;- colnames(auc_mtx)[n]
  p_values &lt;- unlist(kruskal.test(pull(pat2[tf]) ~ ht_cluster, pat2))[&quot;p.value&quot;]
  #list(tf = tf, p_value = p_values)
})


# adjust for multiple testing with FDR
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)
length(adj_p_values[adj_p_values&lt;0.05])
[1] 71
## [1] 66

# get the TFs taht are differntially active
diff_hiv2 &lt;- colnames(auc_mtx)[adj_p_values &lt; 0.05]


# check 24 TFs with Kruskal Wallis test
p_values &lt;- map(seq.int(1:24), function(n){
  tf &lt;- overlap_atac$name[n]
  p_values &lt;- unlist(kruskal.test(pull(pat2[tf]) ~ ht_cluster, pat2))[&quot;p.value&quot;]
})
#sign_p_values &lt;- p_values[p_values &lt; 0.01]

# adjust for multiple hypothesis testing
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)


# how many transcription factors are significantly different between the clusters?
length(adj_p_values[adj_p_values&lt;0.05])
[1] 19
## [1] 18

# get the TFs that are differentially expressed
hiv2_atac &lt;- overlap_atac$name[adj_p_values &lt; .05]</code></pre>
</div>
</div>
<div id="patient-3" class="section level2">
<h2>patient 3</h2>
<p><strong>K-means clustering with k = 3 for patient 3</strong></p>
<div id="draw-heatmap-for-patient-3-1" class="section level4">
<h4>1. Draw Heatmap for Patient 3</h4>
<pre class="r"><code>df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV3_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht3 &lt;- Heatmap(t(mtx), 
             column_title = &quot;Patient 3, HIV3_CSF&quot;, 
             column_title_gp = gpar(fontsize = 15),
             #column_split = paste0(&quot;cluster&quot;, hiv2$predicted.id),#cluster_anno,
             column_km = 3,
             column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la,
             #top_annotation = HeatmapAnnotation(df = cluster_anno, name = &quot;predicted cluster&quot;)
             ) 
             #top_annotation = column_annotation) ich
ht_pat3 &lt;- draw(ht3)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-38-1.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
<div id="kruskal-wallis-test-patient-3" class="section level4">
<h4>2. Kruskal-Wallis test Patient 3</h4>
<pre class="r"><code># extract the cells from the 3 clusters 
# get the cell names of cluster one
c1 &lt;- colnames(t(mtx[column_order(ht_pat3)[[1]],]))
# get the cell names of cluster two
c2 &lt;- colnames(t(mtx[column_order(ht_pat3)[[2]],]))
# get the cell names of cluster 3
c3 &lt;- colnames(t(mtx[column_order(ht_pat3)[[3]],]))


# add cluster identities to Seurat object metadata and return metadata as dataframe
pat3 &lt;- hiv7_scenic@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  filter(orig.ident == &quot;HIV3_CSF&quot;,
         cell_type == &quot;Myeloid2&quot;,
         cell %in% c(c1,c2,c3)) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% c1, &quot;c1&quot;, ifelse(cell %in% c2, &quot;c2&quot;, &quot;c3&quot;))) 


# check all 125 TFs
# check all TFs 
p_values &lt;- map(seq.int(1:125), function(n){
  tf &lt;- colnames(auc_mtx)[n]
  p_values &lt;- unlist(kruskal.test(pull(pat3[tf]) ~ ht_cluster, pat3))[&quot;p.value&quot;]
  #list(tf = tf, p_value = p_values)
})


# adjust for multiple testing with FDR
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)
length(adj_p_values[adj_p_values&lt;0.05])
[1] 66
## [1] 66

# get the TFs taht are differntially active
diff_hiv3 &lt;- colnames(auc_mtx)[adj_p_values &lt; 0.05]


# check 24 TFs with Kruskal Wallis test
p_values &lt;- map(seq.int(1:24), function(n){
  tf &lt;- overlap_atac$name[n]
  p_values &lt;- unlist(kruskal.test(pull(pat3[tf]) ~ ht_cluster, pat3))[&quot;p.value&quot;]
})
#sign_p_values &lt;- p_values[p_values &lt; 0.01]

# adjust for multiple hypothesis testing
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)


# how many transcription factors are significantly different between the clusters?
length(adj_p_values[adj_p_values&lt;0.05])
[1] 18
## [1] 18

# get the TFs that are differentially expressed
hiv3_atac &lt;- overlap_atac$name[adj_p_values &lt; .05]</code></pre>
</div>
</div>
<div id="comparison-between-all-3-patients" class="section level2">
<h2>comparison between all 3 patients</h2>
<div id="heatmaps-of-k-means-clustering-with-k-3-for-all-three-patients" class="section level4">
<h4>Heatmaps of k-means clustering with k = 3 for all three patients</h4>
<pre class="r"><code># patient 1
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == &quot;HIV1_CSF&quot;)
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df), ]
# heatmap
set.seed(123)
ht1 &lt;- Heatmap(t(mtx), 
             column_title = &quot;Patient 1, HIV1_CSF&quot;, 
             column_title_gp = gpar(fontsize = 15),
             column_km = 3,
             column_km_repeats = 100,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             right_annotation = la
             )
             #top_annotation = column_annotation) </code></pre>
<pre class="r"><code>ht_list &lt;- ht1 + ht2 + ht3
draw(ht_list, ht_gap= unit(2, &quot;cm&quot;), 
     column_title = &quot;Independent k-means clustering (k = 3) for all patients&quot;,
     column_title_gp = gpar(fontsize = 20) )</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-41-1.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="section-2" class="section level1 unnumbered">
<h1 class="unnumbered"></h1>
<div id="which-tfs-show-significantly-different-activity-between-the-clusters-across-patients" class="section level2">
<h2>Which TFs show significantly different activity between the clusters across patients?</h2>
<p>Since the independent hierarchical clustering for all three patients yields clusters which look more reasonable, we will compare the three clusters we obtain across the three patients to see if there is a pattern between them.</p>
<p>We already saw that there are a few TFs which show significantly different activity between the clusters in patient1.</p>
<p>Next, we want to see if the same group of TFs characterize the three clusters in all three patients or if they are different. We will test which TFs are significantly different between clusters and then use a pairwise Wilcox test to determine which clusters are different.</p>
<div id="are-tfs-differentiating-the-three-clusters-similar-across-all-three-patients" class="section level3">
<h3>Are TFs differentiating the three clusters similar across all three patients?</h3>
<p>In the Venn diagram below it can be seen that 46 with significantly different activities between clusters overlap across patients.</p>
<p>Additionally, eleven of the TFs found to have differential binding scores between infection conditions in C20 microglia cell line show different activity between the three clusters across all patients. These are the TFs we are most interested in, since we want to see if we can find patterns that correlate with the binding scores in C20 microglia.</p>
<pre class="r"><code>p1 &lt;- ggVennDiagram(list(hiv1_diff, diff_hiv2, diff_hiv3),
              label_alpha = 0,
              category.names= c(&quot;HIV1&quot;, &quot;HIV2&quot;, &quot;HIV3&quot;),
              #set.size = 20,
              label = &quot;count&quot;,
              label_size = 6) +
   scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;TF (ATAC-seq) significantly different between 3 clusters&quot;)</code></pre>
<pre class="r"><code>p2 &lt;- ggVennDiagram(list(hiv1_atac, hiv2_atac, hiv3_atac),
              label_alpha = 0,
              category.names= c(&quot;HIV1&quot;, &quot;HIV2&quot;, &quot;HIV3&quot;),
              #set.size = 20,
              label = &quot;count&quot;,
              label_size = 6) +
   scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;TF (ATAC-seq) significantly different between 3 clusters&quot;)</code></pre>
<pre class="r"><code>ggarrange(p1, p2, ncol = 2, nrow = 1)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-44-1">
Past versions of unnamed-chunk-44-1.png
</button>
</p>
<div id="fig-unnamed-chunk-44-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-44-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-44-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tfs-show-different-activity-in-one-of-the-three-clusters" class="section level2 tabset">
<h2 class="tabset">11 TFs show different activity in one of the three clusters</h2>
<p>In the boxplots below it can be seen that in all three patients there seems to be one cluster which is different from two other clusters.</p>
<pre class="r"><code>intersect &lt;- read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/intersect_TFs_different_across_patients_3_clusters&quot;)[[&quot;x&quot;]]</code></pre>
<div id="patient-1" class="section level3">
<h3>Patient 1</h3>
<pre class="r"><code>df &lt;- k3_df


boxplot_list &lt;- map(intersect, function(tf) {
  ggplot() +
    geom_boxplot(aes(x = df %&gt;% pull(&quot;ht_cluster&quot;), y = df %&gt;% pull(tf),
                     fill = df %&gt;% pull(&quot;ht_cluster&quot;))) +
    stat_pvalue_manual(df %&gt;% 
                        pairwise_wilcox_test(as.formula(paste0(tf, &quot; ~ ht_cluster&quot;))) %&gt;% 
                         add_xy_position()) +
    xlab(&quot;heatmap cluster&quot;) +
    ylab(paste0(tf)) +
    guides(fill = guide_legend(title = &quot;heatmap cluster&quot;))
})

do.call(gridExtra::grid.arrange, c(boxplot_list, ncol = 4, nrow = 3))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-46-1.png" width="2400" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
#annotate_figure(figure, top = text_grob(&quot;Patient 1 - CSF     k = 3 for k-means clustering (TFs from ATAC-seq)&quot;, 
 #              color = &quot;black&quot;, face = &quot;bold&quot;, size = 25))</code></pre>
<pre class="r"><code>ctcf1 &lt;- ggplot(df, aes(x = ht_cluster, y = CTCF)) +
  geom_boxplot(aes(fill = ht_cluster)) +
  stat_pvalue_manual(df %&gt;% 
                       pairwise_wilcox_test(CTCF ~ ht_cluster) %&gt;% 
                       add_xy_position())
ctcf1 &lt;- ctcf1 + labs(title = &quot;CTCF activity in patient 1&quot;)</code></pre>
</div>
<div id="patient-2" class="section level3">
<h3>Patient 2</h3>
<pre class="r"><code>df &lt;- pat2

boxplot_list &lt;- map(intersect, function(tf) {
  ggplot() +
    geom_boxplot(aes(x = df %&gt;% pull(&quot;ht_cluster&quot;), y = df %&gt;% pull(tf),
                     fill = df %&gt;% pull(&quot;ht_cluster&quot;))) +
    stat_pvalue_manual(df %&gt;% 
                        pairwise_wilcox_test(as.formula(paste0(tf, &quot; ~ ht_cluster&quot;))) %&gt;% 
                         add_xy_position()) +
    xlab(&quot;heatmap cluster&quot;) +
    ylab(paste0(tf)) +
    guides(fill = guide_legend(title = &quot;heatmap cluster&quot;))
})

do.call(gridExtra::grid.arrange, c(boxplot_list, ncol = 4, nrow = 3))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-48-1.png" width="2400" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
#annotate_figure(figure, top = text_grob(&quot;Patient 2 - CSF     k = 3 for k-means clustering (TFs from ATAC-seq)&quot;, 
 #              color = &quot;black&quot;, face = &quot;bold&quot;, size = 25))</code></pre>
<pre class="r"><code>ctcf2 &lt;- ggplot(df, aes(x = ht_cluster, y = CTCF)) +
  geom_boxplot(aes(fill = ht_cluster)) +
  stat_pvalue_manual(df %&gt;% 
                       pairwise_wilcox_test(CTCF ~ ht_cluster) %&gt;% 
                       add_xy_position())
ctcf2 &lt;- ctcf2 + labs(title = &quot;CTCF activity in patient 2&quot;)</code></pre>
</div>
<div id="patient-3-1" class="section level3">
<h3>Patient 3</h3>
<pre class="r"><code>df &lt;- pat3

boxplot_list &lt;- map(intersect, function(tf) {
  ggplot() +
    geom_boxplot(aes(x = df %&gt;% pull(&quot;ht_cluster&quot;), y = df %&gt;% pull(tf),
                     fill = df %&gt;% pull(&quot;ht_cluster&quot;))) +
    stat_pvalue_manual(df %&gt;% 
                        pairwise_wilcox_test(as.formula(paste0(tf, &quot; ~ ht_cluster&quot;))) %&gt;% 
                         add_xy_position()) +
    xlab(&quot;heatmap cluster&quot;) +
    ylab(paste0(tf)) +
    guides(fill = guide_legend(title = &quot;heatmap cluster&quot;))
})

do.call(gridExtra::grid.arrange, c(boxplot_list, ncol = 4, nrow = 3))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-50-1.png" width="2400" style="display: block; margin: auto;" /></p>
<pre class="r"><code>

#annotate_figure(figure, top = text_grob(&quot;Patient 3 - CSF     k = 3 for k-means clustering (TFs from ATAC-seq)&quot;, 
 #              color = &quot;black&quot;, face = &quot;bold&quot;, size = 25))</code></pre>
</div>
</div>
<div id="section-3" class="section level2 unnumbered">
<h2 class="unnumbered"></h2>
<div id="ctcf-expression-across-patients" class="section level3">
<h3>CTCF expression across patients</h3>
<p>CTCF has been implicated to regulate HIV latency <span class="citation">[@Jeffereys]</span>. In the boxplots below it can be seen that there is a significant difference between the first cluster and the other two clusters in patient1 and patient2. Similarly in patient3 there is a difference, however the difference is not as significant. This might imply that cluster contains a group of cells which are latently infected and therefore CTCF is more active.</p>
<pre class="r"><code>ctcf3 &lt;- ggplot(df, aes(x = ht_cluster, y = CTCF)) +
  geom_boxplot(aes(fill = ht_cluster)) +
  stat_pvalue_manual(df %&gt;% 
                       pairwise_wilcox_test(CTCF ~ ht_cluster) %&gt;% 
                       add_xy_position())
ctcf3 &lt;- ctcf3 + labs(title = &quot;CTCF activity in patient 3&quot;)</code></pre>
<pre class="r"><code>ggarrange(ctcf1, ctcf2, ctcf3, ncol = 3, nrow = 1)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-52-1.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="correlations-between-clusters-across-patients" class="section level2">
<h2>Correlations between clusters across patients</h2>
<p>Using a correlation matrix we can visualize how clusters are correlated across patients:</p>
<pre class="r"><code># read in 3 Clusters for each of the 3 HIV+ patients

# HIV1_CSF
hiv1_c1 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster1.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv1_c2 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster2.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv1_c3 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster3.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]

# HIV2_CSF
hiv2_c1 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv2_cluster1.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv2_c2 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv2_cluster2.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv2_c3 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv2_cluster3.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]

# HIV3_CSF
hiv3_c1 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv3_cluster1.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv3_c2 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv3_cluster2.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv3_c3 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv3_cluster3.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]

cluster_anno &lt;- c(hiv1_c1, hiv1_c2, hiv1_c3, hiv2_c1, hiv2_c2, hiv2_c3, hiv3_c1, hiv3_c2, hiv3_c3)</code></pre>
<pre class="r"><code># add cluster information to TF activity
auc_df &lt;- as.data.frame(auc_mtx)

auc_df &lt;- auc_df %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  filter(cell %in% cluster_anno) %&gt;% 
  mutate(ht_cluster = case_when(cell %in% hiv1_c1 ~ &quot;hiv1_c1&quot;, 
         cell %in% hiv1_c2 ~ &quot;hiv1_c2&quot;, 
         cell %in% hiv1_c3 ~ &quot;hiv1_c3&quot;,
         cell %in% hiv2_c1 ~ &quot;hiv2_c1&quot;,
         cell %in% hiv2_c2 ~ &quot;hiv2_c2&quot;,
         cell %in% hiv2_c3 ~ &quot;hiv2_c3&quot;,
         cell %in% hiv3_c1 ~ &quot;hiv3_c1&quot;,
         cell %in% hiv3_c2 ~ &quot;hiv3_c2&quot;,
         cell %in% hiv3_c3 ~ &quot;hiv3_c3&quot;))</code></pre>
<div id="correlation-between-clusters-based-on-all-125-tfs" class="section level3">
<h3>Correlation between clusters based on all 125 TFs</h3>
<p>For every cluster the correlation is calculated based on the TF activities of all 125 TFs identified by SCENIC.</p>
<details>
*
<summary>
Correlation computation
</summary>
<ul>
<li></li>
</ul>
<p>Dataframe of average activity value for each TF in each patient and clusters.</p>
<pre class="r"><code># correlation matrix
df &lt;- auc_df %&gt;%
  group_by(ht_cluster) %&gt;%
  summarize_if(is.numeric, mean) %&gt;% 
  #column_to_rownames(&quot;ht_cluster&quot;) %&gt;% 
  #add_rownames() %&gt;% 
  gather(TF, value, -ht_cluster) %&gt;% 
  spread(ht_cluster, value) %&gt;% 
  column_to_rownames(&quot;TF&quot;)

df %&gt;% 
  head %&gt;% 
  kable ()</code></pre>
<table>
<colgroup>
<col width="8%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">hiv1_c1</th>
<th align="right">hiv1_c2</th>
<th align="right">hiv1_c3</th>
<th align="right">hiv2_c1</th>
<th align="right">hiv2_c2</th>
<th align="right">hiv2_c3</th>
<th align="right">hiv3_c1</th>
<th align="right">hiv3_c2</th>
<th align="right">hiv3_c3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AHR</td>
<td align="right">0.0327704</td>
<td align="right">0.0534783</td>
<td align="right">0.0293072</td>
<td align="right">0.0275802</td>
<td align="right">0.0263492</td>
<td align="right">0.0222778</td>
<td align="right">0.0133156</td>
<td align="right">0.0075556</td>
<td align="right">0.0449111</td>
</tr>
<tr class="even">
<td align="left">ATF3</td>
<td align="right">0.0684460</td>
<td align="right">0.0965516</td>
<td align="right">0.0944977</td>
<td align="right">0.0487516</td>
<td align="right">0.0959799</td>
<td align="right">0.0910900</td>
<td align="right">0.0488404</td>
<td align="right">0.0828738</td>
<td align="right">0.1026111</td>
</tr>
<tr class="odd">
<td align="left">BACH1</td>
<td align="right">0.0745916</td>
<td align="right">0.0957086</td>
<td align="right">0.0960815</td>
<td align="right">0.0470817</td>
<td align="right">0.0956613</td>
<td align="right">0.0900737</td>
<td align="right">0.0491457</td>
<td align="right">0.0677356</td>
<td align="right">0.1003448</td>
</tr>
<tr class="even">
<td align="left">BCL11A</td>
<td align="right">0.0453606</td>
<td align="right">0.0580407</td>
<td align="right">0.0544656</td>
<td align="right">0.0336095</td>
<td align="right">0.0582619</td>
<td align="right">0.0503748</td>
<td align="right">0.0308033</td>
<td align="right">0.0406827</td>
<td align="right">0.0519544</td>
</tr>
<tr class="odd">
<td align="left">BCL6</td>
<td align="right">0.0300111</td>
<td align="right">0.0629203</td>
<td align="right">0.0389951</td>
<td align="right">0.0135000</td>
<td align="right">0.0646071</td>
<td align="right">0.0232917</td>
<td align="right">0.0162400</td>
<td align="right">0.0441667</td>
<td align="right">0.0393667</td>
</tr>
<tr class="even">
<td align="left">BHLHE40</td>
<td align="right">0.0453855</td>
<td align="right">0.0353485</td>
<td align="right">0.0268406</td>
<td align="right">0.0459291</td>
<td align="right">0.0220228</td>
<td align="right">0.0297271</td>
<td align="right">0.0300765</td>
<td align="right">0.0320580</td>
<td align="right">0.0355449</td>
</tr>
</tbody>
</table>
<p>Correlation matrix:</p>
<pre class="r"><code>df %&gt;% cor %&gt;% kable()</code></pre>
<table>
<colgroup>
<col width="8%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">hiv1_c1</th>
<th align="right">hiv1_c2</th>
<th align="right">hiv1_c3</th>
<th align="right">hiv2_c1</th>
<th align="right">hiv2_c2</th>
<th align="right">hiv2_c3</th>
<th align="right">hiv3_c1</th>
<th align="right">hiv3_c2</th>
<th align="right">hiv3_c3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hiv1_c1</td>
<td align="right">1.0000000</td>
<td align="right">0.8138023</td>
<td align="right">0.8909121</td>
<td align="right">0.6494445</td>
<td align="right">0.8803939</td>
<td align="right">0.7504363</td>
<td align="right">0.8767961</td>
<td align="right">0.5096081</td>
<td align="right">0.8158899</td>
</tr>
<tr class="even">
<td align="left">hiv1_c2</td>
<td align="right">0.8138023</td>
<td align="right">1.0000000</td>
<td align="right">0.9186181</td>
<td align="right">0.4144831</td>
<td align="right">0.9261440</td>
<td align="right">0.9100636</td>
<td align="right">0.6789498</td>
<td align="right">0.5949834</td>
<td align="right">0.9306527</td>
</tr>
<tr class="odd">
<td align="left">hiv1_c3</td>
<td align="right">0.8909121</td>
<td align="right">0.9186181</td>
<td align="right">1.0000000</td>
<td align="right">0.4368197</td>
<td align="right">0.9762008</td>
<td align="right">0.8686519</td>
<td align="right">0.7846779</td>
<td align="right">0.5038681</td>
<td align="right">0.9582866</td>
</tr>
<tr class="even">
<td align="left">hiv2_c1</td>
<td align="right">0.6494445</td>
<td align="right">0.4144831</td>
<td align="right">0.4368197</td>
<td align="right">1.0000000</td>
<td align="right">0.4586951</td>
<td align="right">0.3353833</td>
<td align="right">0.7518257</td>
<td align="right">0.2760415</td>
<td align="right">0.3718645</td>
</tr>
<tr class="odd">
<td align="left">hiv2_c2</td>
<td align="right">0.8803939</td>
<td align="right">0.9261440</td>
<td align="right">0.9762008</td>
<td align="right">0.4586951</td>
<td align="right">1.0000000</td>
<td align="right">0.8867906</td>
<td align="right">0.7926212</td>
<td align="right">0.5225718</td>
<td align="right">0.9653832</td>
</tr>
<tr class="even">
<td align="left">hiv2_c3</td>
<td align="right">0.7504363</td>
<td align="right">0.9100636</td>
<td align="right">0.8686519</td>
<td align="right">0.3353833</td>
<td align="right">0.8867906</td>
<td align="right">1.0000000</td>
<td align="right">0.6278904</td>
<td align="right">0.6087612</td>
<td align="right">0.9186463</td>
</tr>
<tr class="odd">
<td align="left">hiv3_c1</td>
<td align="right">0.8767961</td>
<td align="right">0.6789498</td>
<td align="right">0.7846779</td>
<td align="right">0.7518257</td>
<td align="right">0.7926212</td>
<td align="right">0.6278904</td>
<td align="right">1.0000000</td>
<td align="right">0.3856985</td>
<td align="right">0.7247967</td>
</tr>
<tr class="even">
<td align="left">hiv3_c2</td>
<td align="right">0.5096081</td>
<td align="right">0.5949834</td>
<td align="right">0.5038681</td>
<td align="right">0.2760415</td>
<td align="right">0.5225718</td>
<td align="right">0.6087612</td>
<td align="right">0.3856985</td>
<td align="right">1.0000000</td>
<td align="right">0.5626530</td>
</tr>
<tr class="odd">
<td align="left">hiv3_c3</td>
<td align="right">0.8158899</td>
<td align="right">0.9306527</td>
<td align="right">0.9582866</td>
<td align="right">0.3718645</td>
<td align="right">0.9653832</td>
<td align="right">0.9186463</td>
<td align="right">0.7247967</td>
<td align="right">0.5626530</td>
<td align="right">1.0000000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>
cor_mtx &lt;- df %&gt;% cor()

# calculate confidence intervals and p_values
# function produces p-values and confidence intervals for each pair of input features
# returns a matrix each
# of p_values, upper confidence interval, lower confidence interval
testCor &lt;- cor.mtest(cor_mtx, conf.level = 0.95)</code></pre>
<hr />
</details>
<pre class="r"><code>GGally::ggpairs(df) + theme_bw() +
  labs(title = &quot;Scatter matrix for all conditions&quot;)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-57-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-57-1">
Past versions of unnamed-chunk-57-1.png
</button>
</p>
<div id="fig-unnamed-chunk-57-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-57-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-57-1.png" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Conclusions:</strong></p>
<ul>
<li>Cluster 3 from patient 3 seems to be very different</li>
<li>Cluster 2 from patient 3 is also only weakly correlated</li>
<li>Cluster 1 of all patients seems correlated, however, the p_values for correlation of cluster1 of patient two with all other clusters are not significant</li>
<li>Clusters 2 and 3 of patient 1 and 2 seem highly correlated</li>
</ul>
<pre class="r"><code># plot correlations
corrplot(cor_mtx,
         #method = &quot;color&quot;,
         order = &quot;hclust&quot;, 
         addrect = 4, # add boxes 
         p.mat = testCor$p, 
         #sig.level = .05,
         insig = &quot;p-value&quot;, 
         tl.col = &quot;black&quot;)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-58-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-58-1">
Past versions of unnamed-chunk-58-1.png
</button>
</p>
<div id="fig-unnamed-chunk-58-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/40651d96647f10219a4aec953c8d618d57bc13f5/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-58-1.png" target="_blank">40651d9</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-58-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-58-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-58-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-58-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-58-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<details>
*
<summary>
Additional correlation plots which do not aid the interpretation much
</summary>
<ul>
<li></li>
</ul>
</div>
<div id="correlation-between-clusters-based-on-all-tfs-with-differential-activity-between-clusters" class="section level3">
<h3>Correlation between clusters based on all TFs with differential activity between clusters</h3>
<pre class="r"><code>intersect_total &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/total_intersect_TFs_different_across_patients_3_clusters&quot;))[[&quot;x&quot;]]</code></pre>
<pre class="r"><code># correlation matrix
cor_mtx &lt;- auc_df %&gt;%
  select(ht_cluster, intersect_total) %&gt;% 
  group_by(ht_cluster) %&gt;%
  summarize_if(is.numeric, mean) %&gt;% 
  #column_to_rownames(&quot;ht_cluster&quot;) %&gt;% 
  #add_rownames() %&gt;% 
  gather(TF, value, -ht_cluster) %&gt;% 
  spread(ht_cluster, value) %&gt;% 
  column_to_rownames(&quot;TF&quot;) %&gt;% cor()

# calculate confidence intervals and p_values
# function produces p-values and confidence intervals for each pair of input features
# returns a matrix each
# of p_values, upper confidence interval, lower confidence interval
testCor &lt;- cor.mtest(cor_mtx, conf.level = 0.95)</code></pre>
<pre class="r"><code>corrplot(cor_mtx,
         #method = &quot;color&quot;, 
         order = &quot;hclust&quot;, 
         addrect = 4, # add boxes 
         p.mat = testCor$p, 
         #sig.level = .05,
         insig = &quot;p-value&quot;, 
         tl.col = &quot;black&quot;)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-61-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-61-1">
Past versions of unnamed-chunk-61-1.png
</button>
</p>
<div id="fig-unnamed-chunk-61-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-61-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-61-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-61-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-61-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr />
</details>
</div>
<div id="tf-correlation-across-clusters" class="section level3">
<h3>TF correlation across clusters</h3>
<p>Eleven TFs which differentiate the clusters seem to correlate between the clusters.</p>
<p>For these eleven TFs with different activity between the clusters the activity correlates between across all three patients. This means, that the three TFs YY1, REST, MXI1 are positively correlated, but negatively correlated with the rest of the TFs.</p>
<p>The fact that these TF activities correlate across all patients indicates that there might be a biological meaning behind the pattern of activity.</p>
<details>
<summary>
<strong>Correlation computation</strong>
</summary>
<p>Dataframe used as input for the correlation:</p>
<pre class="r"><code>intersect_atac &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/atac_intersect_TFs_different_across_patients_3_clusters&quot;))[[&quot;x&quot;]]</code></pre>
<pre class="r"><code>cor_mtx &lt;- auc_df %&gt;%
  select(ht_cluster, intersect_atac) %&gt;% 
  group_by(ht_cluster) %&gt;%
  summarize_if(is.numeric, mean) %&gt;% 
  column_to_rownames(&quot;ht_cluster&quot;) %&gt;% cor()</code></pre>
<pre class="r"><code># correlation matrix
df &lt;- auc_df %&gt;%
  select(ht_cluster,intersect_atac) %&gt;% 
  group_by(ht_cluster) %&gt;%
  summarize_if(is.numeric, mean) %&gt;% 
  column_to_rownames(&quot;ht_cluster&quot;) 

df %&gt;% head %&gt;% kable()</code></pre>
<table>
<colgroup>
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">NFIL3</th>
<th align="right">MXI1</th>
<th align="right">MEF2A</th>
<th align="right">REST</th>
<th align="right">KLF4</th>
<th align="right">YY1</th>
<th align="right">ETS1</th>
<th align="right">JUNB</th>
<th align="right">CEBPB</th>
<th align="right">ETV6</th>
<th align="right">MEF2C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hiv1_c1</td>
<td align="right">0.0625178</td>
<td align="right">0.0482667</td>
<td align="right">0.1120995</td>
<td align="right">0.0485372</td>
<td align="right">0.0631640</td>
<td align="right">0.0483373</td>
<td align="right">0.0390579</td>
<td align="right">0.0580891</td>
<td align="right">0.0715644</td>
<td align="right">0.0858207</td>
<td align="right">0.0733255</td>
</tr>
<tr class="even">
<td align="left">hiv1_c2</td>
<td align="right">0.0801609</td>
<td align="right">0.0506630</td>
<td align="right">0.1879437</td>
<td align="right">0.0178021</td>
<td align="right">0.0813924</td>
<td align="right">0.0381528</td>
<td align="right">0.0136263</td>
<td align="right">0.0722964</td>
<td align="right">0.1003168</td>
<td align="right">0.1155135</td>
<td align="right">0.1158037</td>
</tr>
<tr class="odd">
<td align="left">hiv1_c3</td>
<td align="right">0.0843983</td>
<td align="right">0.1348824</td>
<td align="right">0.1964079</td>
<td align="right">0.0130281</td>
<td align="right">0.0838488</td>
<td align="right">0.0318434</td>
<td align="right">0.0102707</td>
<td align="right">0.0711062</td>
<td align="right">0.1016846</td>
<td align="right">0.1151926</td>
<td align="right">0.1091890</td>
</tr>
<tr class="even">
<td align="left">hiv2_c1</td>
<td align="right">0.0449593</td>
<td align="right">0.0120278</td>
<td align="right">0.0831293</td>
<td align="right">0.0333043</td>
<td align="right">0.0446230</td>
<td align="right">0.0525425</td>
<td align="right">0.0460040</td>
<td align="right">0.0407193</td>
<td align="right">0.0487018</td>
<td align="right">0.0502401</td>
<td align="right">0.0458824</td>
</tr>
<tr class="odd">
<td align="left">hiv2_c2</td>
<td align="right">0.0864439</td>
<td align="right">0.1463214</td>
<td align="right">0.1827775</td>
<td align="right">0.0172008</td>
<td align="right">0.0856196</td>
<td align="right">0.0301513</td>
<td align="right">0.0111471</td>
<td align="right">0.0701432</td>
<td align="right">0.1008118</td>
<td align="right">0.1232207</td>
<td align="right">0.1031197</td>
</tr>
<tr class="even">
<td align="left">hiv2_c3</td>
<td align="right">0.0824798</td>
<td align="right">0.1106875</td>
<td align="right">0.1651352</td>
<td align="right">0.0285193</td>
<td align="right">0.0766626</td>
<td align="right">0.0426642</td>
<td align="right">0.0196091</td>
<td align="right">0.0668367</td>
<td align="right">0.0901176</td>
<td align="right">0.1102263</td>
<td align="right">0.0992255</td>
</tr>
</tbody>
</table>
<p>Correlation matrix for TFs:</p>
<pre class="r"><code>cor_mtx &lt;- df %&gt;% cor()
cor_mtx %&gt;% kable</code></pre>
<table style="width:100%;">
<colgroup>
<col width="4%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">NFIL3</th>
<th align="right">MXI1</th>
<th align="right">MEF2A</th>
<th align="right">REST</th>
<th align="right">KLF4</th>
<th align="right">YY1</th>
<th align="right">ETS1</th>
<th align="right">JUNB</th>
<th align="right">CEBPB</th>
<th align="right">ETV6</th>
<th align="right">MEF2C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">NFIL3</td>
<td align="right">1.0000000</td>
<td align="right">0.8328285</td>
<td align="right">0.9762247</td>
<td align="right">-0.6908219</td>
<td align="right">0.9665777</td>
<td align="right">-0.6257135</td>
<td align="right">-0.9555881</td>
<td align="right">0.9696037</td>
<td align="right">0.9752140</td>
<td align="right">0.9940104</td>
<td align="right">0.9493500</td>
</tr>
<tr class="even">
<td align="left">MXI1</td>
<td align="right">0.8328285</td>
<td align="right">1.0000000</td>
<td align="right">0.7697811</td>
<td align="right">-0.6243427</td>
<td align="right">0.7223375</td>
<td align="right">-0.6270422</td>
<td align="right">-0.7586176</td>
<td align="right">0.7011609</td>
<td align="right">0.7433272</td>
<td align="right">0.8021050</td>
<td align="right">0.6739776</td>
</tr>
<tr class="odd">
<td align="left">MEF2A</td>
<td align="right">0.9762247</td>
<td align="right">0.7697811</td>
<td align="right">1.0000000</td>
<td align="right">-0.7943587</td>
<td align="right">0.9720426</td>
<td align="right">-0.6596786</td>
<td align="right">-0.9870940</td>
<td align="right">0.9711991</td>
<td align="right">0.9852634</td>
<td align="right">0.9735525</td>
<td align="right">0.9772616</td>
</tr>
<tr class="even">
<td align="left">REST</td>
<td align="right">-0.6908219</td>
<td align="right">-0.6243427</td>
<td align="right">-0.7943587</td>
<td align="right">1.0000000</td>
<td align="right">-0.6996961</td>
<td align="right">0.7703564</td>
<td align="right">0.8378606</td>
<td align="right">-0.6470201</td>
<td align="right">-0.7056376</td>
<td align="right">-0.6656230</td>
<td align="right">-0.7328728</td>
</tr>
<tr class="odd">
<td align="left">KLF4</td>
<td align="right">0.9665777</td>
<td align="right">0.7223375</td>
<td align="right">0.9720426</td>
<td align="right">-0.6996961</td>
<td align="right">1.0000000</td>
<td align="right">-0.6458621</td>
<td align="right">-0.9741139</td>
<td align="right">0.9890996</td>
<td align="right">0.9882537</td>
<td align="right">0.9750536</td>
<td align="right">0.9770080</td>
</tr>
<tr class="even">
<td align="left">YY1</td>
<td align="right">-0.6257135</td>
<td align="right">-0.6270422</td>
<td align="right">-0.6596786</td>
<td align="right">0.7703564</td>
<td align="right">-0.6458621</td>
<td align="right">1.0000000</td>
<td align="right">0.7237429</td>
<td align="right">-0.5844677</td>
<td align="right">-0.5846666</td>
<td align="right">-0.6088358</td>
<td align="right">-0.6502978</td>
</tr>
<tr class="odd">
<td align="left">ETS1</td>
<td align="right">-0.9555881</td>
<td align="right">-0.7586176</td>
<td align="right">-0.9870940</td>
<td align="right">0.8378606</td>
<td align="right">-0.9741139</td>
<td align="right">0.7237429</td>
<td align="right">1.0000000</td>
<td align="right">-0.9532630</td>
<td align="right">-0.9703806</td>
<td align="right">-0.9520631</td>
<td align="right">-0.9727509</td>
</tr>
<tr class="even">
<td align="left">JUNB</td>
<td align="right">0.9696037</td>
<td align="right">0.7011609</td>
<td align="right">0.9711991</td>
<td align="right">-0.6470201</td>
<td align="right">0.9890996</td>
<td align="right">-0.5844677</td>
<td align="right">-0.9532630</td>
<td align="right">1.0000000</td>
<td align="right">0.9915545</td>
<td align="right">0.9825523</td>
<td align="right">0.9839199</td>
</tr>
<tr class="odd">
<td align="left">CEBPB</td>
<td align="right">0.9752140</td>
<td align="right">0.7433272</td>
<td align="right">0.9852634</td>
<td align="right">-0.7056376</td>
<td align="right">0.9882537</td>
<td align="right">-0.5846666</td>
<td align="right">-0.9703806</td>
<td align="right">0.9915545</td>
<td align="right">1.0000000</td>
<td align="right">0.9852773</td>
<td align="right">0.9783193</td>
</tr>
<tr class="even">
<td align="left">ETV6</td>
<td align="right">0.9940104</td>
<td align="right">0.8021050</td>
<td align="right">0.9735525</td>
<td align="right">-0.6656230</td>
<td align="right">0.9750536</td>
<td align="right">-0.6088358</td>
<td align="right">-0.9520631</td>
<td align="right">0.9825523</td>
<td align="right">0.9852773</td>
<td align="right">1.0000000</td>
<td align="right">0.9592715</td>
</tr>
<tr class="odd">
<td align="left">MEF2C</td>
<td align="right">0.9493500</td>
<td align="right">0.6739776</td>
<td align="right">0.9772616</td>
<td align="right">-0.7328728</td>
<td align="right">0.9770080</td>
<td align="right">-0.6502978</td>
<td align="right">-0.9727509</td>
<td align="right">0.9839199</td>
<td align="right">0.9783193</td>
<td align="right">0.9592715</td>
<td align="right">1.0000000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>
# calculate confidence intervals and p_values
# function produces p-values and confidence intervals for each pair of input features
# returns a matrix each
# of p_values, upper confidence interval, lower confidence interval
testCor &lt;- cor.mtest(cor_mtx, conf.level = 0.95)</code></pre>
<hr />
</details>
<pre class="r"><code>GGally::ggpairs(df) + theme_bw() +
    labs(title = &quot;Scatter matrix for all TFs with different activity between clusters&quot;)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-66-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-66-1">
Past versions of unnamed-chunk-66-1.png
</button>
</p>
<div id="fig-unnamed-chunk-66-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-66-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-66-1.png" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-66-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-66-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-66-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-66-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># plot correlations
# p.mat = matrix of p_values
p1 &lt;- corrplot(cor_mtx,
               #method = &quot;color&quot;,
               order = &quot;hclust&quot;, 
               addrect = 2, # add boxes 
               p.mat = testCor$p, 
               insig = &quot;p-value&quot;,
               tl.col = &quot;black&quot;)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-67-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-67-1">
Past versions of unnamed-chunk-67-1.png
</button>
</p>
<div id="fig-unnamed-chunk-67-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-67-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="gene-expression-analysis" class="section level1">
<h1>Gene expression analysis</h1>
<p>Using the information of the three clusters from above we will pool the two clusters which are significantly different from the third cluster in all patients. Consequently, in the following analysis we will compare Cluster1 to Cluster2 (pool of two similar clusters). The gene expression might give a hint about the identity of these two Myeloid2 clusters.</p>
<pre class="r"><code># 3 Clusters for each of the 3 HIV+ patients

# HIV1_CSF
hiv1_c1 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster1.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv1_c2 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster2.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv1_c3 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv1_cluster3.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]

# HIV2_CSF
hiv2_c1 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv2_cluster1.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv2_c2 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv2_cluster2.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv2_c3 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv2_cluster3.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]

# HIV3_CSF
hiv3_c1 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv3_cluster1.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv3_c2 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv3_cluster2.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]
hiv3_c3 &lt;- as.vector(read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv3_cluster3.tsv&quot;, sep = &quot;\t&quot;))[[&quot;x&quot;]]

cluster_anno &lt;- c(hiv1_c1, hiv1_c2, hiv1_c3, hiv2_c1, hiv2_c2, hiv2_c3, hiv3_c1, hiv3_c2, hiv3_c3)</code></pre>
<div id="tf-gene-expression-of-the-11-tfs-with-different-activity-between-clusters" class="section level3">
<h3>TF gene expression of the 11 TFs with different activity between clusters</h3>
<pre class="r"><code>hivmy2 &lt;- subset(hiv7, cell_type == &quot;Myeloid2&quot; &amp; orig.ident %in% c(&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;))

# add cluster identity to metadata
ht_cluster &lt;- (
  hivmy2@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  mutate(ht_cluster = ifelse(cell %in% c(hiv1_c1, hiv2_c1, hiv3_c3),
                             &quot;c1&quot;, 
                             &quot;c2&quot;)) %&gt;% 
  column_to_rownames(&quot;cell&quot;))[&quot;ht_cluster&quot;]

hivmy2 &lt;- AddMetaData(hivmy2, metadata = ht_cluster, col.name = &quot;ht_cluster&quot;)
#saveRDS(hivmy2,&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv_myeloid2_subclusters&quot;)</code></pre>
</div>
<div id="quality-of-the-myeloid-2-clusters" class="section level2">
<h2>Quality of the Myeloid 2 clusters</h2>
<p>There is an evident difference in library size and number of features between the two clusters. This could mean that there is a technical difference between the two clusters. Conversely, it could also mean that there is this a biological difference. For example, if cells of cluster1 represent a latently infected group of Myeloid2 cells it could be that gene expression is reduced overall due to the infection compared to healthy uninfected cells from cluster2.</p>
<p>One way to investigate this further would be to have a look at the housekeeping genes in both clusters. If housekeeping genes were more highly expressed in one cluster than in the other this would indicate that the difference is not biological, but a technical artefact.</p>
<p>Since there is one cluster which has lower number of counts and features to start with, further qualitative analysis of gene expression might be skewed as well. For this reason the following analysis on the difference between these two clusters will be mainly qualitative. Due to the low number of cells it is not possible to get significant results for the differential gene expression.</p>
<pre class="r"><code>p1 &lt;- hivmy2@meta.data %&gt;% 
  ggplot() +
  geom_boxplot(aes(x = ht_cluster, y = nFeature_RNA, fill = ht_cluster))

p2 &lt;- hivmy2@meta.data %&gt;% 
  ggplot() +
  geom_violin(aes(x = ht_cluster, y = nFeature_RNA, fill = ht_cluster)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.8, hjust = 1))

fig &lt;- ggarrange(p1, p2, ncol = 2, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;Quality of Clsuters&quot;))</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-70-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-70-1">
Past versions of unnamed-chunk-70-1.png
</button>
</p>
<div id="fig-unnamed-chunk-70-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-70-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-70-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="housekeeping-genes" class="section level2">
<h2>Housekeeping genes</h2>
<p>A list of 3804 houseekping genes were used from <span class="citation">[@Eisenberg]</span>.</p>
<p>A quantitative analysis might be difficult, because due to the small sample size and large feature number, we get very high p_values for all genes in differential gene expression analysis. Visualization of the housekeeping gene expression, unfortunately does not help either with the interpretation.</p>
<details>
*
<summary>
Boxplots of housekeeping gene expression
</summary>
<ul>
<li></li>
</ul>
<pre class="r"><code>hk_genes &lt;- (read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/HK_genes.txt&quot;))[[&quot;V1&quot;]]</code></pre>
<pre class="r"><code># filter only genes present in the scRNAseq count matrix
hk_genes_filt &lt;- hk_genes[hk_genes %in% rownames(hivmy2@assays$RNA@counts)]
length(hk_genes)
[1] 3804
length(hk_genes_filt)
[1] 3711

# Find genes from the housekeeping genes that are differentially expressed 
# between the clusters
hk_diff &lt;- FindAllMarkers(hivmy2, features = hk_genes_filt)
Idents(hivmy2) &lt;- &quot;ht_cluster&quot;
hk_diff &lt;- FindMarkers(hivmy2, features = hk_genes_filt, ident.1 = &quot;c1&quot;, ident.2 = &quot;c2&quot;)
hk_diff %&gt;% head
             p_val  avg_log2FC pct.1 pct.2 p_val_adj
DPP7   0.001063786  -0.9991177 0.000 0.259         1
RPL27  0.001354627 -47.9667965 1.000 0.991         1
RPL10A 0.001632447  -9.5926981 0.941 0.911         1
RPL6   0.001658084  -1.7550766 0.882 0.812         1
RPL30  0.002862495 -38.6641080 0.971 0.946         1
DDX21  0.003060688  -1.0742719 0.088 0.330         1</code></pre>
<pre class="r"><code>test &lt;- hk_genes_filt[1:30]
VlnPlot(hivmy2, features = test, group.by = &quot;ht_cluster&quot;, ncol = 4)
Warning in SingleExIPlot(type = type, data = data[, x, drop = FALSE], idents =
idents, : All cells have the same value of ABHD8.</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-73-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-73-1">
Past versions of unnamed-chunk-73-1.png
</button>
</p>
<div id="fig-unnamed-chunk-73-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-73-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-73-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-73-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-73-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr />
</details>
</div>
</div>
<div id="appendix" class="section level1">
<h1>Appendix</h1>
<div id="gene-expression-analysis-of-the-two-myeloid2-subclusters" class="section level2">
<h2>Gene expression analysis of the two Myeloid2 subclusters</h2>
<div id="tf-from-the-farhadian-et-al." class="section level4">
<h4>TF from the Farhadian et al.</h4>
<p>These TFs were used as marker genes for the microlgia like Myeloid2 cell cluster. Is there a group of cells which has a higher expression of these markers? No clear difference in gene expression can be seen.</p>
<details>
<summary>
Boxplots of microglia marker genes
</summary>
<pre class="r"><code>#import the 60 genes that were upregulated in Myeloid-2 in the paper compared to the four other myeloid subsets
paper &lt;- read.table(file = &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/Myeloid-2_genes_paper.csv&quot;,
                    sep = &quot;\t&quot;, header = FALSE, skipNul = TRUE)#, n_max = 60)
paper[1,] &lt;- &quot;APOC1&quot;
colnames(paper) &lt;- &quot;&quot;
paper &lt;- as.vector(paper[,1])


VlnPlot(hivmy2, features = paper, group.by = &quot;ht_cluster&quot;)
Warning in FetchData(object = object, vars = features, slot = slot): The
following requested variables were not found: SELENOP</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-74-1">
Past versions of unnamed-chunk-74-1.png
</button>
</p>
<div id="fig-unnamed-chunk-74-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/183077b696fa2df6e887d589e7a30c7193ad5e04/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" target="_blank">183077b</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-16
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/dde10972b37ffd997474921968223514c8cb1b1f/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-74-1.png" target="_blank">dde1097</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr />
</details>
</div>
<div id="differential-gene-expression-analyisis" class="section level4">
<h4>Differential gene expression analyisis</h4>
<details>
<summary>
Differential gene expression analysis
</summary>
<pre class="r"><code>hivmy2 &lt;- NormalizeData(hivmy2, verbose = FALSE)
hivmy2 &lt;- ScaleData(hivmy2, verbose = FALSE)
hivmy2 &lt;- FindVariableFeatures(hivmy2, verbose = FALSE)
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : pseudoinverse used at -2.1857
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : neighborhood radius 0.49845
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : reciprocal condition number 7.6527e-16
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : There are other near singularities as well. 0.090619
hivmy2 &lt;- RunPCA(hivmy2, features = VariableFeatures(hivmy2), verbose = FALSE)
ElbowPlot(hivmy2)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-75-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-75-1">
Past versions of unnamed-chunk-75-1.png
</button>
</p>
<div id="fig-unnamed-chunk-75-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-75-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-75-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-75-1.png" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>hivmy2 &lt;- RunTSNE(hivmy2, dims= 1:10, verbose = FALSE)
Idents(hivmy2) &lt;- &quot;ht_cluster&quot;
de_genes &lt;- FindAllMarkers(hivmy2, verbose = FALSE)
top10 &lt;- de_genes %&gt;% 
  group_by(cluster) %&gt;%
  top_n(n = 5, wt = avg_log2FC) 
top10 %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">p_val</th>
<th align="right">avg_log2FC</th>
<th align="right">pct.1</th>
<th align="right">pct.2</th>
<th align="right">p_val_adj</th>
<th align="left">cluster</th>
<th align="left">gene</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0002643</td>
<td align="right">1.4371177</td>
<td align="right">0.206</td>
<td align="right">0.027</td>
<td align="right">1</td>
<td align="left">c1</td>
<td align="left">EPHB6</td>
</tr>
<tr class="even">
<td align="right">0.0011962</td>
<td align="right">1.2486709</td>
<td align="right">0.382</td>
<td align="right">0.143</td>
<td align="right">1</td>
<td align="left">c1</td>
<td align="left">SNRPF</td>
</tr>
<tr class="odd">
<td align="right">0.0015781</td>
<td align="right">1.0213995</td>
<td align="right">0.176</td>
<td align="right">0.027</td>
<td align="right">1</td>
<td align="left">c1</td>
<td align="left">RP11-386I14.4</td>
</tr>
<tr class="even">
<td align="right">0.0022935</td>
<td align="right">0.9050976</td>
<td align="right">0.118</td>
<td align="right">0.009</td>
<td align="right">1</td>
<td align="left">c1</td>
<td align="left">SACS</td>
</tr>
<tr class="odd">
<td align="right">0.0045394</td>
<td align="right">1.0999273</td>
<td align="right">0.294</td>
<td align="right">0.107</td>
<td align="right">1</td>
<td align="left">c1</td>
<td align="left">TBC1D5</td>
</tr>
<tr class="even">
<td align="right">0.0005081</td>
<td align="right">1.3333431</td>
<td align="right">0.286</td>
<td align="right">0.000</td>
<td align="right">1</td>
<td align="left">c2</td>
<td align="left">JAK2</td>
</tr>
<tr class="odd">
<td align="right">0.0006461</td>
<td align="right">1.3600293</td>
<td align="right">0.438</td>
<td align="right">0.118</td>
<td align="right">1</td>
<td align="left">c2</td>
<td align="left">IGSF6</td>
</tr>
<tr class="even">
<td align="right">0.0012653</td>
<td align="right">1.1633609</td>
<td align="right">0.589</td>
<td align="right">0.324</td>
<td align="right">1</td>
<td align="left">c2</td>
<td align="left">CTSH</td>
</tr>
<tr class="odd">
<td align="right">0.0072128</td>
<td align="right">1.1970288</td>
<td align="right">0.429</td>
<td align="right">0.176</td>
<td align="right">1</td>
<td align="left">c2</td>
<td align="left">CD55</td>
</tr>
<tr class="even">
<td align="right">0.0096532</td>
<td align="right">1.1831845</td>
<td align="right">0.286</td>
<td align="right">0.088</td>
<td align="right">1</td>
<td align="left">c2</td>
<td align="left">NAMPTL</td>
</tr>
</tbody>
</table>
<hr />
</details>
</div>
<div id="tf-from-gosselin-et-al." class="section level4">
<h4>TF from Gosselin et al.</h4>
<details>
<summary>
Microglia TF gene expression
</summary>
<pre class="r"><code>Idents(hiv4) &lt;- &quot;cell_type&quot;
# Find Markers that distinguish My2 from the other Myeloid clusters
my2_markers &lt;- FindMarkers(hiv4, ident.1  = &quot;Myeloid2&quot;,
            ident.2  = c(&quot;Myeloid1&quot;, &quot;Myeloid3&quot;, &quot;Myeloid4&quot;, &quot;Myeloid5&quot;))
my2_markers &lt;- my2_markers %&gt;% rownames_to_column(var = &quot;gene&quot;)</code></pre>
<pre class="r"><code>microglia_genes &lt;- read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/Microglia_gene_signatur_found_in_HIV1_HIV2_samples&quot;)
m1 &lt;- my2_markers %&gt;% filter(gene %in% microglia_genes [[&quot;gene_name&quot;]] &amp; avg_log2FC &gt;0)
# remove the genes that were already used by the Farhadian paper
m1 &lt;- m1[[&quot;gene&quot;]][m1[[&quot;gene&quot;]] %in% paper == FALSE]

VlnPlot(hivmy2, features = m1, group.by = &quot;ht_cluster&quot;, ncol = 5)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-77-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-77-1">
Past versions of unnamed-chunk-77-1.png
</button>
</p>
<div id="fig-unnamed-chunk-77-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/fce26d5dd39fcac3f053aaaa3ceb1e2c02e05654/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-77-1.png" target="_blank">fce26d5</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/2a95e927f953c093f2e48cb2b6551d152f735267/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-77-1.png" target="_blank">2a95e92</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-18
</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr />
</details>
</div>
<div id="which-of-the-11-tfs-are-mentioned-by-gosselin-et-al" class="section level4">
<h4>Which of the 11 TFs are mentioned by Gosselin et al?</h4>
<details>
<summary>
TFs also mentioned by Gosselin et al.
</summary>
<pre class="r"><code>tfs_microglia &lt;- (read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/TFs_microglia_Glass_paper.txt&quot;))[[&quot;V1&quot;]]

gosselin &lt;- tfs_microglia[tfs_microglia %in% overlap_atac$name]

VlnPlot(hivmy2, features = gosselin, group.by = &quot;ht_cluster&quot;, ncol = 4)</code></pre>
<p><img src="figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-78-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-78-1">
Past versions of unnamed-chunk-78-1.png
</button>
</p>
<div id="fig-unnamed-chunk-78-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/436b5c2790a0ce492f776915a9e543bf3a84511d/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-78-1.png" target="_blank">436b5c2</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-20
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/7f7db3c2cf840c14d6dbc92fb9fb5bc7d659a826/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-78-1.png" target="_blank">7f7db3c</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
<tr>
<td>
<a href="https://github.com/Katharina782/report/blob/eb137dda9188951b1859c2ac57e84de1ab238fd9/docs/figure/TF_activity_analysis_of_myeloid2_cluster.Rmd/unnamed-chunk-78-1.png" target="_blank">eb137dd</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-19
</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr />
</details>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()
R version 4.0.2 (2020-06-22)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /usr/lib64/libopenblasp-r0.3.3.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] future_1.23.0        rstatix_0.6.0        corrplot_0.92       
 [4] ggVennDiagram_1.2.0  knitr_1.30           gridExtra_2.3       
 [7] ggpubr_0.4.0         circlize_0.4.13      ComplexHeatmap_2.9.4
[10] ggcorrplot_0.1.3     pheatmap_1.0.12      RColorBrewer_1.1-2  
[13] ggrepel_0.9.1        data.table_1.14.2    Matrix_1.3-4        
[16] edgeR_3.32.0         limma_3.46.0         SeuratObject_4.0.3  
[19] Seurat_4.0.5         forcats_0.5.0        stringr_1.4.0       
[22] dplyr_1.0.7          purrr_0.3.4          readr_1.4.0         
[25] tidyr_1.1.2          tibble_3.1.6         ggplot2_3.3.5       
[28] tidyverse_1.3.0      workflowr_1.6.2     

loaded via a namespace (and not attached):
  [1] utf8_1.2.2            reticulate_1.22       tidyselect_1.1.1     
  [4] htmlwidgets_1.5.4     Rtsne_0.15            munsell_0.5.0        
  [7] units_0.6-7           codetools_0.2-18      ica_1.0-2            
 [10] miniUI_0.1.1.1        withr_2.4.3           colorspace_2.0-2     
 [13] highr_0.8             rstudioapi_0.13       stats4_4.0.2         
 [16] ROCR_1.0-11           ggsignif_0.6.0        tensor_1.5           
 [19] listenv_0.8.0         labeling_0.4.2        git2r_0.27.1         
 [22] polyclip_1.10-0       farver_2.1.0          rprojroot_2.0.2      
 [25] parallelly_1.29.0     vctrs_0.3.8           generics_0.1.1       
 [28] xfun_0.29             R6_2.5.1              doParallel_1.0.16    
 [31] clue_0.3-60           locfit_1.5-9.4        RVenn_1.1.0          
 [34] reshape_0.8.8         spatstat.utils_2.2-0  assertthat_0.2.1     
 [37] promises_1.2.0.1      scales_1.1.1          gtable_0.3.0         
 [40] globals_0.14.0        goftest_1.2-3         rlang_0.4.12         
 [43] GlobalOptions_0.1.2   splines_4.0.2         lazyeval_0.2.2       
 [46] spatstat.geom_2.3-0   broom_0.7.2           yaml_2.2.1           
 [49] reshape2_1.4.4        abind_1.4-5           modelr_0.1.8         
 [52] backports_1.2.0       httpuv_1.6.3          tools_4.0.2          
 [55] ellipsis_0.3.2        spatstat.core_2.3-1   BiocGenerics_0.36.1  
 [58] ggridges_0.5.2        Rcpp_1.0.7            plyr_1.8.6           
 [61] classInt_0.4-3        rpart_4.1-15          deldir_1.0-6         
 [64] pbapply_1.5-0         GetoptLong_1.0.5      cowplot_1.1.1        
 [67] S4Vectors_0.28.1      zoo_1.8-9             haven_2.3.1          
 [70] cluster_2.1.0         fs_1.5.1              magrittr_2.0.1       
 [73] magick_2.5.2          scattermore_0.7       openxlsx_4.2.3       
 [76] lmtest_0.9-39         reprex_0.3.0          RANN_2.6.1           
 [79] whisker_0.4           fitdistrplus_1.1-6    matrixStats_0.61.0   
 [82] hms_1.1.1             patchwork_1.1.1       mime_0.12            
 [85] evaluate_0.14         xtable_1.8-4          rio_0.5.16           
 [88] readxl_1.3.1          IRanges_2.24.1        shape_1.4.6          
 [91] compiler_4.0.2        KernSmooth_2.23-18    crayon_1.4.2         
 [94] htmltools_0.5.2       mgcv_1.8-33           later_1.3.0          
 [97] lubridate_1.7.9.2     DBI_1.1.1             dbplyr_2.0.0         
[100] MASS_7.3-53           sf_0.9-6              car_3.0-10           
[103] cli_3.1.0             parallel_4.0.2        igraph_1.2.9         
[106] pkgconfig_2.0.3       foreign_0.8-80        plotly_4.9.2.1       
[109] spatstat.sparse_2.0-0 xml2_1.3.2            foreach_1.5.1        
[112] rvest_0.3.6           digest_0.6.29         sctransform_0.3.2    
[115] RcppAnnoy_0.0.19      spatstat.data_2.1-0   rmarkdown_2.6        
[118] cellranger_1.1.0      leiden_0.3.5          uwot_0.1.10          
[121] curl_4.3.2            shiny_1.7.1           rjson_0.2.20         
[124] lifecycle_1.0.1       nlme_3.1-150          jsonlite_1.7.2       
[127] carData_3.0-4         viridisLite_0.4.0     fansi_0.5.0          
[130] pillar_1.6.4          GGally_2.0.0          lattice_0.20-41      
[133] fastmap_1.1.0         httr_1.4.2            survival_3.2-7       
[136] glue_1.5.1            zip_2.1.1             png_0.1-7            
[139] iterators_1.0.13      class_7.3-17          stringi_1.7.6        
[142] e1071_1.7-4           irlba_2.3.3           future.apply_1.8.1   </code></pre>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiVEYgYWN0aXZpdHkgaW4gbXllbG9pZDIgY2VsbHMiCmF1dGhvcjogImttaWt1bGlrIgpkYXRlOiAiNyAxMiAyMDIxIgpvdXRwdXQ6IGh0bWxfZG9jdW1lbnQKLS0tCjxzdHlsZT4KYm9keSB7CnRleHQtYWxpZ246IGp1c3RpZnl9Cjwvc3R5bGU+CgoKYGBge3Igc2V0dXB9CmtuaXRyOjpvcHRzX2NodW5rJHNldChlY2hvID0gVFJVRSwgY29sbGFwc2UgPSBUUlVFLCBtZXNzYWdlID0gRkFMU0UsCiAgICAgICAgICAgICAgICAgICAgICBjYWNoZSA9IEZBTFNFLCBhdXRvZGVwID0gVFJVRSkKYGBgCgoKYGBge3J9CmxpYnJhcnkodGlkeXZlcnNlKQpsaWJyYXJ5KFNldXJhdCkKbGlicmFyeShlZGdlUikKbGlicmFyeShNYXRyaXgpCmxpYnJhcnkoZGF0YS50YWJsZSkKbGlicmFyeShnZ3Bsb3QyKQpsaWJyYXJ5KGRwbHlyKQpsaWJyYXJ5KGdncmVwZWwpCiNsaWJyYXJ5KGhhcm1vbnkpCmxpYnJhcnkoUkNvbG9yQnJld2VyKQpsaWJyYXJ5KHBoZWF0bWFwKQpsaWJyYXJ5KGdnY29ycnBsb3QpCmxpYnJhcnkoQ29tcGxleEhlYXRtYXApCmxpYnJhcnkoY2lyY2xpemUpCmxpYnJhcnkoZ2dwdWJyKQpsaWJyYXJ5KGdyaWRFeHRyYSkKbGlicmFyeShrbml0cikKbGlicmFyeShnZ1Zlbm5EaWFncmFtKQpsaWJyYXJ5KGNvcnJwbG90KQpsaWJyYXJ5KHJzdGF0aXgpCiMgIk11bHRpdGFza2luZy9NdWx0aXByb2Nlc3NpbmciCmxpYnJhcnkoZnV0dXJlKQojcGxhbigibXVsdGlzZXNzaW9uIiwgd29ya2VycyA9IDI0KQpgYGAKCiMgR1JOIGluZmVyZW5jZSB3aXRoIFNjZW5pYwoKVXNpbmcgU2NlbmljIEkgdHJpZWQgdG8gaW5mZXIgR2VuZSByZWd1bGF0b3J5IG5ldHdvcmtzIGZyb20gdGhlIGdlbmUgZXhwcmVzc2lvbgpkYXRhLiBUaGUgb3V0cHV0IGlzIGEgbWF0cml4IG9mIFRGIChUcmFuc2NyaXB0aW9uIEZhY3RvcikgYWN0aXZpdHkgcGVyIGNlbGwuIEluIHRoaXMgY2FzZSB0aGUgYWN0aXZpdHkKbWF0cml4IGNvbnRhaW5zIGFjdGl2aXR5IG9mIDEyNSBkaWZmZXJlbnQgdHJhbnNjcmlwdGlvbiBmYWN0b3JzLgoKCkZpcnN0LCB3ZSB3YW50ZWQgdG8gc2VlIGlmIHdlIGNhbiBpZGVudGlmeSBwYXR0ZXJucyBpbiB0aGUgVEYgYWN0aXZpdHkgaW4gdGhlCk15ZWxvaWQyIGNlbGxzLiBXZSBjb21wYXJlZCB0aGUgVEYgYWN0aXZpdHkgdG8gVEZzIHNob3duIHRvIGhhdmUgZGlmZmVyZW50aWFsIApiaW5kaW5nIHNjb3JlcyBiZXR3ZWVuIHRocmVlIGluZmVjdGlvbiBzdGF0ZXMgKHVuaW5mZWN0ZWQsIGxhdGVudCBpbmZlY3Rpb24sIAphY3RpdmUgaW5mZWN0aW9uKSBpbiBwcmltYXJ5IG1pY3JvZ2xpYSAoYnVsayBBVEFDc2VxKS4gRm9yIHRoZSBjb21wYXJpc29uCndpdGggdGhlIFRGIGFjdGl2aXR5IGluIE15ZWxvaWQyIGNlbGxzIHdlIGZvY3VzZWQgb24gdGhlIFRGIHdpdGggZGlmZmVyZW50aWFsIApiaW5kaW5nIHNjb3JlcyBiZXR3ZWVuICoqdW5pbmZlY3RlZCoqIGFuZCAqKmxhdGVudGx5IGluZmVjdGVkKiogc3RhdGVzLgoKQ2FuIHdlIHNlZSBwYXR0ZXJucyBvZiBpbmNyZWFzZWQvZGVjcmVhc2VkIFRGIGFjdGl2aXR5IGluIHRoZSBNeWVsb2lkMiBjZWxscyB0aGF0Cm1pZ2h0IGNvcnJlc3BvbmQgdG8gdGhlIGJpbmRpbmcgc2NvcmVzIGJldHdlZW4gaW5mZWN0aW9uIHN0YXRlcyBpbiBwcmltYXJ5Cm1pY3JvZ2xpYT8KCgoqIHJlYWQgaW4gU2V1cmF0IG9iamVjdAoKYGBge3J9CmhpdjcgPC0gcmVhZFJEUygiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL3NyYy9SZXByb2R1Y2VfRmFyaGFkaWFuX1BhcGVyL1NldXJhdF9vYmplY3RzL3RvdGFsXzdfc2FtcGxlc19sYWJlbF90cmFuc2Zlci5yZHMiKQpoaXY0IDwtIHJlYWRSRFMoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9zcmMvUmVwcm9kdWNlX0ZhcmhhZGlhbl9QYXBlci9TZXVyYXRfb2JqZWN0cy9ub25faW50ZWdyYXRlZF9ISVYxX0hJVjJfNHNhbXBsZXNfc2V1cmF0X29iamVjdC5yZHMiKQpgYGAKCiogcmVhZCBpbiBBdUNlbGwgbWF0cml4IChvdXRwdXQgZnJvbSBTY2VuaWMpCgpgYGB7cn0KYXVjX210eCA8LSByZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9hdWNlbGxfbWF0cml4XzEwa19odmcudHN2Iiwgc2VwID0gIlx0IikKYGBgCgoKCiogQ29tYmluZSBBdUNlbGwgTWF0cml4IGFuZCBTZXVyYXQgb2JqZWN0CgpgYGB7cn0KIyBhZGQgYXVjIG1hdHJpeCB0byBtZXRhZGF0YSBvZiBoaXY0IHNldXJhdCBvYmplY3QKaGl2N19zY2VuaWMgPC0gQWRkTWV0YURhdGEoaGl2NywgCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEgPSBhdWNfbXR4LCAKICAgICAgICAgICAgICAgICAgICBjb2wubmFtZSA9IGNvbG5hbWVzKGF1Y19tdHgpKQpgYGAKCgoKIyBCdWxrIEFUQUNzZXEgZm9vdHByaW50aW5nLCBDMjAgY2VsbCBsaW5lCgpVc2luZyBidWxrIEFUQUNzZXEgZGF0YSBmcm9tIHByaW1hcnkgbWljcm9nbGlhIGF0IHRocmVlIGRpZmZlcmVudCBjb25kaXRpb25zLAphY3RpdmUgaW5mZWN0aW9uLCBsYXRlbnQgaW5mZWN0aW9uLCB1bmluZmVjdGVkLCBkaWZmZXJlbnRpYWwgYmluZGluZyBzY29yZXMgd2VyZQpvYnRhaW5lZCB1c2luZyBUT0JJQVMuIEhlcmUsIEkgd2lsbCB1c2UgdGhlIFRGcyB3aGljaCB3ZXJlIHByZXZpb3VzbHkgc2hvd24gdG8gCmhhdmUgZGlmZmVyZW50aWFsIGJpbmRpbmcgc2NvcmVzIGluIHRoZXNlIHByaW1hcnkgbWljcm9nbGlhLiBTaW5jZSBJIGV4cGVjdCB0aGUgCkNTRiBNeWVsb2lkIGNlbGxzIHRvIGJlIGxhdGVudGx5IGluZmVjdGVkLCBiZWNhdXNlIHRoZXkgaGF2ZSBiZWVuIG9idGFpbmVkIGZyb20gCnBhdGllbnRzIHJlY2VpdmluZyBBUlQsIEkgd2lsbCB1c2UgdGhlIFRGcyB3aXRoIGRpZmZlcmVudGlhbCBiaW5kaW5nIHNjb3JlcyAKYmV0d2VlbiBsYXRlbnQgaW5mZWN0aW9uIGFuZCB1bmluZmVjdGVkLiBXZSB3b3VsZCBsaWtlIHRvIGtub3cgaWYgdGhlIFRGIGFjdGl2aXR5CmluZmVycmVkIGZyb20gUk5Bc2VxIGRhdGEgb2YgTXllbG9pZDIgY2VsbHMgY29ycmVsYXRlcyB3aXRoIHRoZXNlIGRpZmZlcmVudGlhbCAKYmluZGluZyBzY29yZXMuIEluIG90aGVyIHdvcmRzLCB3ZSB3YW50IHRvIGtub3cgaWYgdGhlIHBhdHRlcm5zIG9mIGRpZmZlcmVudGlhbCAKVEYgYWN0aXZpdHkgYXJlIHNpbWlsYXIgYXMgdGhlIHBhdHRlcm5zIG9mIGRpZmZlcmVudGlhbCBURiBiaW5kaW5nIHNjb3Jlcy4gCkZvciBleGFtcGxlLCBpZiBhIFRGIHdhcyBzaG93biB0byBiZSBtb3JlIGJvdW5kIGluIGxhdGVudGx5IGluZmVjdGVkIHByaW1hcnkKbWljcm9nbGlhIGNvbXBhcmVkIHRvIHVuaW5mZWN0ZWQgcHJpbWFyeSBtaWNyb2dsaWEsIHdlIHdvdWxkIGV4cGVjdCB0aGUgVEYgdG8gYmUKbW9yZSBhY3RpdmUgaW4gYSBncm91cCBvZiBNeWVsb2lkMiBjZWxscyB3aGljaCBhcmUgbGF0ZW50bHkgaW5mZWN0ZWQgY29tcGFyZWQKdG8gYSBncm91cCBvZiBNeWVsb2lkMiBjZWxscyB3aGljaCBhcmUgdW5pbmZlY3RlZC4gCgpXaGVuIHlvdSBvdmVybGFwIHRoZSBURiBmcm9tIHRoZSBURiBhY3Rpdml0eSBtYXRyaXggb2J0YWluZWQgYnkgcnVubmluZyBTQ05FSUMgCm9uIHRoZSAxMC4wMDAgbW9zdCBoaWdobHkgdmFyaWFibGUgZ2VuZXMgd2l0aCB0aGUgZGlmZmVybnRpYWxseSBib3VuZCBURnMsIDI0IG9mIAp0aGUgVEZzIG92ZXJsYXAuCgpVc2luZyBsZXNzIHRoYW4gMTAuMDAwIG1vc3QgaGlnaGx5IHZhcmlhYmxlIGdlbmVzIGFzIGFuIGlucHV0IG1hdHJpeCBmb3IgU0NFTklDIApyZXN1bHRzIGluIGEgbG93ZXIgbnVtYmVyIG9mIFRGcyB3aGljaCBvdmVybGFwLiBJbmNyZWFzaW5nIHRoZSBudW1iZXIgb2YgaW5wdXQgCmZlYXR1cmVzIGZvciBTQ0VOSUMgaW5jcmVhc2VzIHRoZSBudW1iZXIgb2YgVEZzIGluY2x1ZGVkIGluIHRoZSBURiBhY3Rpdml0eSAKbWF0cml4CgpgYGB7cn0KIyByZWFkIGluIGRhdGFmcmFtZSBjb250YWluaW5nIGRpZmZlcm50aWFsIGJpbmRpbmcgc2NvcmVzIGJldHdlZW4gY29uZGl0aW9ucwojCiMgcmVkID0gbGF0ZW50bHkgaW5mZWN0ZWQKIyBnZnAgPSBhY3RpdmUgaW5mZWN0ZWQKIyB1bmluZmVjdGVkCnRmc19hbmEgPC0gcmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9wcm9qZWN0cy8wNl9ISVZfTWljcm9nbGlhL2RhdGEvYXRhY3NlcS9kYXRhLTIwMjAtMTEtMDYvdG9iaWFzL1RPQklBU19zbmFrZW1ha2UvZm9vdHByaW50X21nbGlhMl9HbGFzc1RGXzE3LTAzL1RGQlMvYmluZGV0ZWN0X3Jlc3VsdHMudHh0Iiwgc2VwID0gIlx0IiwgaGVhZGVyID0gVFJVRSkKCiMgZmlsdGVyIFRGcyB3aXRoIHNpZ25pZmljYW50IHAgdmFsdWVzIGJldHdlZW4gbGF0ZW50IGluZmVjdGlvbiBhbmQgdW5pbmZlY3RlZAojIEkgZGVjaWRlZCB0byB1c2UgYSB0aHJlc2hvbGQgb2YgcC12YWx1ZSA8IDFlLTUwLCBiZWNhdXNlIGR1ZSB0byB0aGUgbGFyZ2UgbnVtYmVyIAojIG9mIGRhdGEsIGFsbCBwLXZhbHVlcyB3aWxsIGJlIHZlcnkgaGlnaAp0b3BfdGZzIDwtIHRmc19hbmEgJT4lIGZpbHRlcih1bmluZl9yZWRfcHZhbHVlIDwgMWUtNTApCgojIGtlZXAgb25seSB0aGUgVEZzIGluIHRoZSBkYXRhZnJhbWUgd2hpY2ggb3ZlcmxhcCBiZXR3ZWVuIHRoZSB0d28gZGF0YXNldHMuCm92ZXJsYXBfYXRhYyA8LSB0b3BfdGZzICU+JSBmaWx0ZXIobmFtZSAlaW4lIGNvbG5hbWVzKGF1Y19tdHgpKQoKIyBleHRyYWN0IG5hbWVzIG9mIFRGcyBtb3JlIGJvdW5kIGluIGVpdGhlciBjb25kaXRpb24KdXBfbGF0ZW50IDwtIG92ZXJsYXBfYXRhYyRuYW1lW292ZXJsYXBfYXRhYyR1bmluZl9yZWRfY2hhbmdlIDwgMF0KdXBfdW5pbmYgPC0gb3ZlcmxhcF9hdGFjJG5hbWVbb3ZlcmxhcF9hdGFjJHVuaW5mX3JlZF9jaGFuZ2UgPiAwXQoKYGBgCgojIyBWb2xjYW5vIFBsb3QgQVRBQy1zZXEgZm9vdHByaW50aW5nCgpJbnRlcmVzdGluZ2x5LCBvbmx5IGZvdXIgVEZzIGZvdW5kIGluIHRoZSBURiBhY3Rpdml0eSBtYXRyaXggb2YgTXllbG9pZDIgY2VsbHMgCmFyZSBtb3JlIGJvdW5kIGluIGxhdGVudCBpbmZlY3Rpb24gdGhhbiBpbiB1bmluZmVjdGVkIHByaW1hcnkgbWljcm9nbGlhLgoKYGBge3IsIGZpZy5oZWlnaHQ9OCwgZmlnLndpZHRoPTEyfQoKdG9wX3RmcyAlPiUgCiAgIyBhZGQgYSBjb2x1bW4gY29udGFpbmluZyBpbmZvcm1hdGlvbiBpbiB3aGljaCBjb25kaXRpb24gdGhlIGNvcnJlc3BvbmRpbmcgVEYgCiAgIyBpcyB1cHJlZ3VsYXRlZAogIG11dGF0ZShjb25kaXRpb24gPSBpZmVsc2UodW5pbmZfcmVkX2NoYW5nZSA8IDAsICJ1cF9sYXRlbnQiLCAidXBfdW5pbmYiKSkgJT4lCiAgIyBhZGQgYSBjb2x1bW4gY29uYWluaW5nIHRoZSBsYWJlbHMgZm9yIHRoZSBwbG90CiAgIyBJIG9ubHkgd2FudCB0byBsYWJlbCBjZWxscyB3aGljaCBhcmUgYWxzbyBmb3VuZCBieSBTY2VuaWMKICBtdXRhdGUobGFiZWwgPSBpZmVsc2UobmFtZSAlaW4lIG92ZXJsYXBfYXRhYyRuYW1lLCBuYW1lLCBOQSkpICU+JSAKICBnZ3Bsb3QoYWVzKHggPSB1bmluZl9yZWRfY2hhbmdlLAogICAgICAgICAgICAgeSA9IC1sb2cxMCh1bmluZl9yZWRfcHZhbHVlKSwKICAgICAgICAgICAgIGNvbCA9IGNvbmRpdGlvbiwgCiAgICAgICAgICAgICBsYWJlbCA9IGxhYmVsKSkgKwogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9obGluZSh5aW50ZXJjZXB0ID0gLWxvZzEwKDFlLTUwKSwgY29sID0gInJlZCIpICsKICBnZW9tX3RleHQobnVkZ2VfeCA9IC4wNSwgbnVkZ2VfeSA9IDIpICsKICBsYWJzKHRpdGxlID0gIlRGcyB3aXRoIGRpZmZlcmVudGlhbCBiaW5kaW5nIHNjb3JlcyIpICsKICB5bGFiKCItbG9nMTAocF92YWx1ZSkiKSArCiAgeGxhYigiZGlmZmVyZW50aWFsIGJpbmRpbmcgc2NvcmUiKQoKYGBgCgoKIyBDb21wYXJlIFRGIGFjdGl2aXRpZXMgYmV0d2VlbiBjbHVzdGVycyBhbmQgbG9vayBmb3IgcGF0dGVybnMKClRoZSBpZGVhIHdhcyB0byBjbHVzdGVyIHRoZSBNeWVsb2lkMiBjZWxscyBiYXNlZCBvbiB0aGVpciBURiBhY3Rpdml0eSB1c2luZwpIaWVyYXJjaGljYWwgY2x1c3RlcmluZy4gVG8gZG8gdGhpcyBJIHBlcm9mcm1lZCBoaWVyYXJjaGljYWwgY2x1c3RlcmluZyBvbiAKTXllbG9pZDIgY2VsbHMgZnJvbSBwYXRpZW50MSAoSElWMV9DU0YpIHdpdGggaz0zLzQvNS4gVGhlIGlkZWEgZm9yIHVzaW5nIG9ubHkgCnBhdGllbnQgMSB3YXMgdGhhdCB0aGUgb3RoZXIgdHdvIHBhdGllbnRzIG1pZ2h0IGJlIHVzZWQgZm9yIHZhbGlkYXRpb24gb2YgdGhlIApjbHVzdGVyaW5nIGxhdGVyIG9uLiBJZiB0aGUgY2x1c3RlcnMgYXJlIGJpb2xvZ2ljYWwsIEkgbWlnaHQgYmUgYWJsZSB0byB0cmFuc2Zlcgp0aGUgY2x1c3RlcnMgb250byB0aGUgTXllbG9pZDIgY2VsbHMgZnJvbSBwYXRpZW50MiAoSElWMl9DU0YpIGFuZCBwYXRpZW50MyAoSElWM19DU0YpLgpJZiB0aGUgY2x1c3RlcnMgYWxzbyBzZXBhcmF0ZSB0aGUgTXllbG9pZDIgY2VsbHMgb2YgdGhlIG90aGVyIHR3byBwYXRpZW50cyBuaWNlbHksIAp0aGlzIHdvdWxkIHZhbGlkYXRlIHRoYXQgdGhlcmUgaXMgYSBiaW9sb2dpY2FsIG1lYW5pbmcgYmVoaW5kIHRoZSBjbHVzdGVycy4KCkhvd2V2ZXIsIGFzIHdlIHdpbGwgc2VlIHRoZSBsYWJlbCB0cmFuc2ZlciBvZiB0aGUgY2x1c3RlciBpZGVudGl0aWVzIGRpZCBub3QgCndvcmssIHByb2JhYmx5IGR1ZSB0byB0aGUgc21hbGwgc2FtcGxlIHNpemUuIFRoZXJlIGFyZSBvbmx5IDE0NiBpbiB0b3RhbCBpbiB0aGUgCk15ZWxvaWQyIGNsdXN0ZXIgb2YgaW5mZWN0ZWQgcGF0aWVudHMuCgpUaGUgYWx0ZXJuYXRpdmUgc3RyYXRlZ3kgd2FzIHRvIHBlcmZvcm0gaW5kZXBlbmRlbnQgaGllcmFyY2hpY2FsIGNsdXN0ZXJpbmcgCmFjcm9zcyBhbGwgcGF0aWVudHMgYW5kIGNvbXBhcmUgdGhlIFRGIGFjdGl2aXR5IGJldHdlZW4gY2x1c3RlcnMuIApDYW4gd2UgZmluZCBURiBhY3Rpdml0aWVzIHdoaWNoIGRpZmZlcmVudGlhdGUgY2x1c3RlcnMgYWNyb3NzIHBhdGllbnRzIGFuZCBmaW5kCmNvcnJlbGF0aW9ucyBiZXR3ZWVuIGNsdXN0ZXJzIGFjcm9zcyBwYXRpZW50cz8KCjEuIERldGVybWluZSBrIGZvciBrLW1lYW5zIGhpZXJhcmNoaWNhbCBjbHVzdGVyaW5nCjIuIFRyYW5zZmVyIHRoZSBjbHVzdGVyIGlkZW50aXRpZXMgdG8gcGF0aWVudDIgYW5kIHBhdGllbnQzCjMuIEhpZXJhcmNoaWNhbCBDbHVzdGVyaW5nIGZvciBhbGwgMyBwYXRpZW50cyBzZXBhcmF0ZWx5CgoKYGBge3J9CgoKIyBURiBhbm5vdGF0aW9ucwpsYSA8LSByb3dBbm5vdGF0aW9uKHR5cGVfVEYgPSAKICAgICAgICAgICAgICAgICAgICAgIGNhc2Vfd2hlbihjb2xuYW1lcyhhdWNfbXR4KSAlaW4lIHVwX2xhdGVudCB+ICJ1cF9sYXRlbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbmFtZXMoYXVjX210eCkgJWluJSB1cF91bmluZiAgfiAidXBfdW5pbmYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFJVRSB+InVua25vd24iKSwKICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJ0eXBlX1RGIiwKICAgICAgICAgICAgICAgICAgICAgY29sID0gbGlzdCh0eXBlX1RGID0gYygidXBfbGF0ZW50IiA9ICAicmVkIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInVwX3VuaW5mIiA9ICAicGluayIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInVua25vd24iID0gImZvcmVzdGdyZWVuIikpKQogIApgYGAKCgoKIyMgU3BsaXQgSGVhdG1hcCBpbnRvIDMgc2VwYXJhdGUgaGVhdG1hcHMgYWNjb3JkaW5nIHRvIHRoZSBkaWZmZXJlbnQgcGF0aWVudHMKCmBgYHtyLCBmaWcud2lkdGg9MTMsIGZpZy5oZWlnaHQ9MTR9CiMgMyBoZWF0bWFwcyB3aXRoIGFsbCBTY2VuaWMgVEZzCmh0X2xpc3QgPC0gbWFwKHNlcS5pbnQoMTozKSwgZnVuY3Rpb24obikgewogIHBhdGllbnRzIDwtIGMgKCJISVYxX0NTRiIsICJISVYyX0NTRiIsICJISVYzX0NTRiIpICMgMyBkaWZmZXJlbnQgcGF0aWVudHMKICAjIGZpbHRlciB0aGUgZGF0YXNldCBmb3Igb25seSBNeWVsb2lkMiBjZWxscyBhbmQgaXRlcmF0aXZlbHkgb25lIG9mIHRoZSBwYXRpZW50cwogIGRmIDwtIGhpdjdAbWV0YS5kYXRhICU+JSBmaWx0ZXIoY2VsbF90eXBlID09ICJNeWVsb2lkMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSBwYXRpZW50c1tuXSkKICAjIHNlbGVjdCBvbmx5IHRoZSBjZWxscyBvZiB0aGUgYWN0aXZpdHkgbWF0cml4IHdoaWNoIGFyZSBteWVsb2lkMiBhbmQgdGhlIGNvcnJlY3QgcGF0aWVudAogIG10eCA8LSBhdWNfbXR4W3Jvd25hbWVzKGF1Y19tdHgpICVpbiUgcm93bmFtZXMoZGYpLF0KICAjIGhlYXRtYXAKICBodCA8LSBIZWF0bWFwKHQobXR4KSwgCiAgICAgICAgICAgICAgIGNvbHVtbl90aXRsZSA9IHBhc3RlMCgicGF0aWVudDogIiwgcGF0aWVudHNbbl0pLCAKCiAgICAgICAgICAgICAgIGNvbHVtbl9rbSA9IDMsCiAgICAgICAgICAgICAgICNyb3dfa20gPSBuLCAKICAgICAgICAgICAgICAgc2hvd19jb2x1bW5fbmFtZXMgPSBGQUxTRSwKICAgICAgICAgICAgICAgY29sID1jb2xvclJhbXBQYWxldHRlKHJldihicmV3ZXIucGFsKG4gPSA3LCBuYW1lID0gIlJkWWxCdSIpKSkoMTAwKSwKICAgICAgICAgICAgICAgc2hvd19yb3dfbmFtZXMgPSBUUlVFCiAgICAgICAgICAgICAgICkgCiAgICAgICAgICAgICAgICN0b3BfYW5ub3RhdGlvbiA9IGNvbHVtbl9hbm5vdGF0aW9uKSAKICBsaXN0KG5hbWUgPSBwYXRpZW50c1tuXSwgaGVhdG1hcCA9IGh0KQp9KQoKCmh0X2xpc3RbWzFdXSRoZWF0bWFwICsgaHRfbGlzdFtbMl1dJGhlYXRtYXAgKyBodF9saXN0W1szXV0kaGVhdG1hcCArIGxhCgoKYGBgCgojIyBIZWF0bWFwIGNvbnRhaW5pbmcgb25seSBURnMgZm91bmQgYnkgQVRBQy1zZXEgZGF0YSBhbmFseXNpcwoKYGBge3IsIGZpZy53aWR0aD0xMywgZmlnLmhlaWdodD04fQojIDMgaGVhdG1hcHMsIGJ1dCBvbmx5IHRoZSBURnMgd2hpY2ggb3ZlcmxhcCB3aXRoIEFuYXMgYW5hbHlzaXMKaHRfbGlzdCA8LSBtYXAoc2VxLmludCgxOjMpLCBmdW5jdGlvbihuKSB7CiAgcGF0aWVudHMgPC0gYyAoIkhJVjFfQ1NGIiwgIkhJVjJfQ1NGIiwgIkhJVjNfQ1NGIikgIyAzIGRpZmZlcmVudCBwYXRpZW50cwogICMgZmlsdGVyIHRoZSBkYXRhc2V0IGZvciBvbmx5IE15ZWxvaWQyIGNlbGxzIGFuZCBpdGVyYXRpdmVseSBvbmUgb2YgdGhlIHBhdGllbnRzCiAgZGYgPC0gaGl2N0BtZXRhLmRhdGEgJT4lIGZpbHRlcihjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ID09IHBhdGllbnRzW25dKQogICMgc2VsZWN0IG9ubHkgdGhlIGNlbGxzIG9mIHRoZSBhY3Rpdml0eSBtYXRyaXggd2hpY2ggYXJlIG15ZWxvaWQyIGFuZCB0aGUgY29ycmVjdCBwYXRpZW50CiAgIyBzZWxlY3QgVEZzIHdoaWNoIG92ZXJsYXAgd2l0aCBBbmFzIGFuYWx5c2lzCiAgbXR4IDwtIGF1Y19tdHhbcm93bmFtZXMoYXVjX210eCkgJWluJSByb3duYW1lcyhkZiksIG92ZXJsYXBfYXRhYyRuYW1lXQogICMgaGVhdG1hcAogIGh0IDwtIEhlYXRtYXAodChtdHgpLCAKICAgICAgICAgICAgICAgY29sdW1uX3RpdGxlID0gcGFzdGUwKCJwYXRpZW50OiAiLCBwYXRpZW50c1tuXSksIAoKICAgICAgICAgICAgICAgY29sdW1uX2ttID0gMywKICAgICAgICAgICAgICAgI3Jvd19rbSA9IG4sIAogICAgICAgICAgICAgICBzaG93X2NvbHVtbl9uYW1lcyA9IEZBTFNFLAogICAgICAgICAgICAgICBjb2wgPWNvbG9yUmFtcFBhbGV0dGUocmV2KGJyZXdlci5wYWwobiA9IDcsIG5hbWUgPSAiUmRZbEJ1IikpKSgxMDApLAogICAgICAgICAgICAgICByaWdodF9hbm5vdGF0aW9uID0gcm93QW5ub3RhdGlvbih0eXBlX1RGID0gaWZlbHNlKGNvbG5hbWVzKGF1Y19tdHhbLG92ZXJsYXBfYXRhYyRuYW1lXSkgJWluJSB1cF9sYXRlbnQsICJ1cF9sYXRlbnQiLCAidXBfdW5pbmYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJ0eXBlX1RGIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gbGlzdCh0eXBlX1RGID0gYygidXBfbGF0ZW50IiA9ICAicmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidXBfdW5pbmYiID0gICJwaW5rIikpKSkKICBsaXN0KG5hbWUgPSBwYXRpZW50c1tuXSwgaGVhdG1hcCA9IGh0KQp9KQoKICAKaHRfbGlzdCA9IGh0X2xpc3RbWzFdXSRoZWF0bWFwICsgaHRfbGlzdFtbMl1dJGhlYXRtYXAgKyBodF9saXN0W1szXV0kaGVhdG1hcApkcmF3KGh0X2xpc3QsIGh0X2dhcCA9IHVuaXQoMSwgImNtIikpCmBgYAoKCgoKCiMgMS4gRGV0ZXJtaW5lIGsgZm9yIGstbWVhbnMgaGllcmFyY2hpY2FsIGNsdXN0ZXJpbmcgey50YWJzZXR9CgpUaGUgcGxvdCBvZiB3aXRoaW4tY2x1c3RlciBzb20gb2Ygc3F1YXJlcyBzaG93cyB0aGF0IHRoZSBzd2VldCBzcG90IGZvciB0aGUgCnZhbHVlIG9mIGsgaXMgc29tZXdoZXJlIGJldHdlZW4gMyBhbmQgNS4gVG8gZGV0ZXJtaW5lIHRoZSBiZXN0IGsgZm9yIGstbWVhbnMKY2x1c3RlcmluZyBrID0gMywgayA9IDQgYW5kIGsgPSA1IHdlcmUgdHJpZWQgYW5kIHRoZSBkaWZmZXJlbnQgb3V0Y29tZXMgY29tcGFyZWQuClNpbmNlIGsgPSA0IGFuZCBrID0gNSBkb2VzIG5vdCB5aWVsZCBhbiBpbmNyZWFzZWQgbnVtYmVyIG9mIFRGcyB3aGljaCBkaWZmZXJudGlhdGUKdGhlIGRpZmZlcmVudCBjbHVzdGVycywgYW5kIHRoZXJlZm9yZSBkbyBub3QgYWRkIGFueSBpbnNpZ2h0cyB3ZSBwcm9jZWVkZWQgd2l0aAprID0gMyBpbiB0aGUgZm9sbG93aW5nIGFuYWx5c2lzLgoKVGhlIHJlc3VsdHMgb2YgZWFjaCBrIGNhbiBiZSBzZWVuIGJlbG93LiBDbGljayBvbiB0aGUgdGFicyB0byBzZWUgaGVhdG1hcHMgb2YgCnRoZSBoaWVyYXJjaGljYWwgY2x1c3RlcmluZywgYXMgd2VsbCBhcyBzdGF0aXN0aWNhbCB0ZXN0IG9uIGRpZmZlcmVudCBURgphY2l0aXZpdHkgYmV0d2VlbiBjbHVzdGVycy4KCmBgYHtyfQpkZiA8LSBoaXY3QG1ldGEuZGF0YSAlPiUgZmlsdGVyKGNlbGxfdHlwZSA9PSAiTXllbG9pZDIiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSAiSElWMV9DU0YiKQptdHggPC0gYXVjX210eFtyb3duYW1lcyhhdWNfbXR4KSAlaW4lIHJvd25hbWVzKGRmKSwgXQoKIyBEZWNpZGUgb24gYSBrIGZvciBjbHVzdGVyaW5nCndzcyA9IHNhcHBseSgyOjE1LCBmdW5jdGlvbihrKSB7CiAga21lYW5zKHggPSB0KG10eCksIGNlbnRlcnMgPSBrKSR0b3Qud2l0aGluc3MKfSkKCnBsb3QoMjoxNSwgd3NzLCB0eXBlID0gImIiLCAKICAgICB4bGFiID0gIk51bWJlciBvZiBjbHVzdGVycyBrIiwgCiAgICAgeWxhYiA9ICJUb3RhbCB3aXRoaW4tY2x1c3RlcnMgc3VtIG9mIHNxdWFyZSIpCmBgYAoKIyMgSyA9IDMgSGllcmFyY2hpY2FsIENsdXN0ZXJpbmcKCiMjIyBIZWF0bWFwIGZvciBwYXRpZW50IDEKCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MTd9CiNtYXAoc2VxLmludCgxOjUpLCBmdW5jdGlvbihrKXsKZGYgPC0gaGl2N0BtZXRhLmRhdGEgJT4lIGZpbHRlcihjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ID09ICJISVYxX0NTRiIpCiMgc2VsZWN0IG9ubHkgdGhlIGNlbGxzIG9mIHRoZSBhY3Rpdml0eSBtYXRyaXggd2hpY2ggYXJlIG15ZWxvaWQyIGFuZCB0aGUgY29ycmVjdCBwYXRpZW50Cm10eCA8LSBhdWNfbXR4W3Jvd25hbWVzKGF1Y19tdHgpICVpbiUgcm93bmFtZXMoZGYpLCBdCiMgaGVhdG1hcApzZXQuc2VlZCgxMjMpCmh0X3BhdDEgPC1kcmF3KEhlYXRtYXAodChtdHgpLCAKICAgICAgICAgICAgIGNvbHVtbl90aXRsZSA9ICJNeWVsb2lkMiBjZWxscyBmcm9tIHBhdGllbnQgMSwgayA9IDMiLCAKCiAgICAgICAgICAgICBjb2x1bW5fa20gPSAzLAogICAgICAgICAgICAgY29sdW1uX2ttX3JlcGVhdHMgPSAxMDAsCiAgICAgICAgICAgICBzaG93X2NvbHVtbl9uYW1lcyA9IEZBTFNFLAogICAgICAgICAgICAgY29sID1jb2xvclJhbXBQYWxldHRlKHJldihicmV3ZXIucGFsKG4gPSA3LCBuYW1lID0gIlJkWWxCdSIpKSkoMTAwKSwKICAgICAgICAgICAgIHJpZ2h0X2Fubm90YXRpb24gPSBsYQogICAgICAgICAgICAgKSkKICAgICAgICAgICAgICN0b3BfYW5ub3RhdGlvbiA9IGNvbHVtbl9hbm5vdGF0aW9uKSAKYGBgCgoKIyMjIEV4dHJhY3QgY2VsbHMgZnJvbSBlYWNoIGNsdXN0ZXIKCmBgYHtyfQojIyMgRXh0cmFjdCBjZWxscyBmcm9tIGVhY2ggY2x1c3RlcgoKCiMgaWYgeW91IGRyYXcgdGhlIGhlYXRtYXAsIHRoZSByZXN1bHRzIG9mIHRoIGVjbHVzdGVyaW5nIHdpbGwgbm90IGNoYW5nZSBhbnltb3JlCiNwbmcoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9hbmFseXNpcy9NeWVsb2lkMl9jbHVzdGVyL015ZWxvaWQyXzNjbHVzdGVycy5wbmciLCB3aWR0aCA9IDE1LCBoZWlnaHQgPSAxNywgcmVzID0gMTIwMCkKI2h0IDwtIGRyYXcoaHRfcGF0MSkKIyBnZXQgdGhlIGNvbHVtbnMgbmFtZXMgb2YgY2x1c3RlciBvbmUKYzEgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0X3BhdDEpW1sxXV0sXSkpCiN3cml0ZS50YWJsZShjMSwgIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjFfY2x1c3RlcjEudHN2Iiwgc2VwID0gIlx0IikKCiMgZ2V0IHRoZSBjb2x1bW4gbmFtZXMgb2YgY2x1c3RlciB0d28KYzIgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0X3BhdDEpW1syXV0sXSkpCiN3cml0ZS50YWJsZShjMiwgIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjFfY2x1c3RlcjIudHN2Iiwgc2VwID0gIlx0IikKCiMgZ2V0IHRoZSBjb2x1bW4gbmFtZXMgb2YgY2x1c3RlciAzCmMzIDwtIGNvbG5hbWVzKHQobXR4W2NvbHVtbl9vcmRlcihodF9wYXQxKVtbM11dLF0pKQojd3JpdGUudGFibGUoYzMsICIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXYxX2NsdXN0ZXIzLnRzdiIsIHNlcCA9ICJcdCIpCmBgYAoKCiMjIyMgbnVtYmVyIG9mIGNlbGxzIGluIGVhY2ggY2x1c3RlciAKCmBgYHtyLCByZXN1bHRzID0gImFzaXMifQojIHN1bW1hcnkgc3RhdGljc3RpY3MKaGl2N19zY2VuaWNAbWV0YS5kYXRhICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgZmlsdGVyKG9yaWcuaWRlbnQgPT0gIkhJVjFfQ1NGIiwKICAgICAgICAgY2VsbF90eXBlID09ICJNeWVsb2lkMiIsCiAgICAgICAgIGNlbGwgJWluJSBjKGMxLGMyLGMzKSkgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gaWZlbHNlKGNlbGwgJWluJSBjMSwgImMxIiwgaWZlbHNlKGNlbGwgJWluJSBjMiwgImMyIiwgImMzIikpKSAlPiUgCiAgI2dyb3VwX2J5KGh0X2NsdXN0ZXIpICU+JSAKICBzZWxlY3QoaHRfY2x1c3RlciwgQ1RDRikgJT4lIAogIGdyb3VwX2J5KGh0X2NsdXN0ZXIpICU+JSAKICBzdW1tYXJpc2UoCiAgICBjb3VudCA9IG4oKSwKICAgIG1lYW4gPSBtZWFuKENUQ0YpLAogICAgc2QgPSBzZChDVENGKSkgJT4lIGthYmxlKCkKCmBgYAoKIyMjIyBBcmUgdGhlcmUgc2lnbmlmaWNhbnQgZGlmZmVyZW5jZXMgaW4gVEYgYWN0aXZpdHkgYmV0d2VlbiB0aGUgdGhyZWUgY2x1c3RlcnM/CgoKQU5PVkEgdGVzdCBpcyBwYXJhbWV0cmljIGFuZCBhc3N1bWVzIG5vcm1hbGx5IGRpc3RyaWJ1dGVkIGRhdGEsIHdoaWxlCktydXNrYWwtV2FsbGlzLVRlc3QgY29tcGFyZXMgdGhlIG1lYW4gb2Ygb25lIG9yIG1vcmUgZ3JvdXBzLCBidXQgaXMgCm5vbi1wYXJhbWV0cmljLiBBcyBjYW4gYmUgc2VlbiBpbiB0aGUgYm94cGxvdHMgYWJvdmUgdGhlIGRhdGEgaXMgbm90IG5vcm1hbGx5IApkaXN0cmlidXRlZCwgdGhlcmVmb3JlIEtydXNrYWwtV2FsbGlzLVRlc3QgaXMgbW9yZSBhcHByb3ByaWF0ZSBpbiB0aGlzIGNhc2UuCkluIGJvdGggY2FzZXMgdGhlIE51bGwtSHlwb3RoZXNpcyBpcyB0aGF0IHRoZXJlIGlzIG5vIGRpZmZlcmVuY2UKYmV0d2VlbiB0aGUgZ3JvdXBzLgoKU2luY2UgSSBhbSByZXBlYXRpbmcgdGhlIHRlc3QgMTI1IHRpbWVzLCBJIGFkanVzdCB0aGUgcC12YWx1ZXMgd2l0aCB0aGUKRkRSIG1ldGhvZC4gVGhpcyBtZXRob2RzIGlzIG1vcmUgcG93ZXJmdWwgdGhhbiBtb3JlIGNvbnNlcnZhdGl2ZSBtZXRoZG9zLCBsaWtlCmJvbmZlcnJvbmksIEhvbG0gb3IgSG9jaGJlcmcuIAoKUGVyZm9ybWluZyBLcnVza2FsLVdhbGxpcy1UZXN0IHRvIGZpbmQgZGlmZmVyZW5jZXMgYmV0d2VlbiB0aGUgdGhyZWUgY2x1c3RlcnMgaW4gcGF0aWVudDEKeWllbGRzIDU0IFRGcyBvZiBhbGwgMTI1IFRGcyB3aGljaCBhcmUgZGlmZmVyZW50aWFsbHkgYWN0aXZlIGJldHdlZW4gdGhlIHRocmVlIGNsdXN0ZXJzCihwLXZhbHVlIDwgMC4wNSkuIE9mIHRoZSAyNCBURnMgd2l0aCBkaWZmZXJlbnRpYWwgYmluZGluZyBzY29yZXMgaW4gdGhlIEMyMCBjZWxsIApsaW5lLCBzaXh0ZWVuIGhhdmUgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiB0aGUgY2x1c3RlcnMuCgpOb3cgdGhhdCB3ZSBrbm93IHRoYXQgdGhlcmUgYXJlIHNpZ25pZmljYW50IGRpZmZlcmVuY2VzIGJldHdlZW4gY2x1c3RlcnMsIHdlIAp3YW50IHRvIGlkZW50aWZ5IHdoaWNoIGNsdXN0ZXIvcyBhcmUgZGlmZmVyZW50IGZyb20gd2hpY2ggb3RoZXIgY2x1c3Rlci9zLgoKUGFpcndpc2UtV2lsY294LVRlc3QgaXMgYSBub24tcGFyYW1ldHJpYyBwYWlyd2lzZSB0ZXN0LiBBZ2FpbiwgYmVjYXVzZSAKd2UgcmVwZWF0IHRoZSB0ZXN0IHdlIHdpbGwgY29ycmVjdCBmb3IgbXVsdGlwbGUgaHlwb3RoZXNpcyB0ZXN0aW5nIHVzaW5nIHRoZSAKRkRSIG1ldGhvZC4gVGhlIHJlc3VsdHMgYXJlIHNob3duIGluIGJveHBsb3RzIGJlbG93LgoKPC9kZXRhaWxzPgoKPGRldGFpbHM+IAo8c3VtbWFyeT5LcnVza2FsLVdhbGxpcy1UZXN0LCBwLXZhbHVlIGFkanVzdG1lbnQsIHBvc3Rob2MgdGVzdHM8L3N1bW1hcnk+CgoqKktydXNrYWwtV2FsbGlzIFRlc3QgYW5kIHAtdmFsdWUgYWRqdXN0bWVudHMgZm9yIGFsbCAxMjUgVEZzKioKCmBgYHtyfQojIG5vbi1wYXJhbWV0cmljIGFsdGVybmF0aXZlIHRvIEFOT1ZBIC0+IEtydXNrYWxfd2FsbGlzIHRlc3QKazNfZGYgPC0gaGl2N19zY2VuaWNAbWV0YS5kYXRhICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgZmlsdGVyKG9yaWcuaWRlbnQgPT0gIkhJVjFfQ1NGIiwKICAgICAgICAgY2VsbF90eXBlID09ICJNeWVsb2lkMiIsCiAgICAgICAgIGNlbGwgJWluJSBjKGMxLGMyLGMzKSkgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gaWZlbHNlKGNlbGwgJWluJSBjMSwgImMxIiwgaWZlbHNlKGNlbGwgJWluJSBjMiwgImMyIiwgImMzIikpKSAKIyBjaGVjayBhbGwgVEZzIApwX3ZhbHVlcyA8LSBtYXAoc2VxLmludCgxOjEyNSksIGZ1bmN0aW9uKG4pewogIHRmIDwtIGNvbG5hbWVzKGF1Y19tdHgpW25dCiAgcF92YWx1ZXMgPC0gdW5saXN0KGtydXNrYWwudGVzdChwdWxsKGszX2RmW3RmXSkgfiBodF9jbHVzdGVyLCBrM19kZikpWyJwLnZhbHVlIl0KICAjbGlzdCh0ZiA9IHRmLCBwX3ZhbHVlID0gcF92YWx1ZXMpCn0pCgojIHBsb3QgZGlzdHJpYnV0aW9uIG9mIHBfdmFsdWVzCmhpc3QoYXMubnVtZXJpYyh1bm5hbWUodW5saXN0KHBfdmFsdWVzKSkpLCAKICAgICBtYWluID0gImRpc3RyaWJ1dGlvbiBvZiBwX3ZhbHVlcyIsCiAgICAgeGxhYiA9ICJwX3ZhbHVlcyIsCiAgICAgYnJlYWtzID0gMjApCgojIGFkanVzdCBmb3IgbXVsdGlwbGUgdGVzdGluZyB3aXRoIEZEUgphZGpfcF92YWx1ZXMgPC0gcC5hZGp1c3QoYXMubnVtZXJpYyh1bm5hbWUodW5saXN0KHBfdmFsdWVzKSkpLCBtZXRob2QgPSAiZmRyIikKCmhpc3QoKGFkal9wX3ZhbHVlcyksIAogICAgIG1haW4gPSAiZGlzdHJpYnV0aW9uIG9mIHBfdmFsdWVzIiwKICAgICB4bGFiID0gInBfdmFsdWVzIiwKICAgICBicmVha3MgPSAyMCkKCgojIGhvdyBtYW55IHRyYW5zY3JpcHRpb24gZmFjdG9ycyBhcmUgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYmV0d2VlbiB0aGUgY2x1c3RlcnM/CnNpZ24zIDwtIGFkal9wX3ZhbHVlc1thZGpfcF92YWx1ZXM8LjA1XQpsZW5ndGgoYWRqX3BfdmFsdWVzW2Fkal9wX3ZhbHVlczwwLjA1XSkKCiMgZ2V0IFRGcyB0aGF0IGFyZSBzaWduaWZpY2FudGx5IGRpZmZlcmVudApoaXYxX2RpZmYgPC0gY29sbmFtZXMoYXVjX210eClbYWRqX3BfdmFsdWVzIDwgLjA1XQoKI3dyaXRlLnRhYmxlKGRpZmYzLCAiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvdG90YWxfVEZzX2RpZmZlcmVudGlhbGx5X2FjdGl2ZV9pbl9ISVYxIikKYGBgCgoqICoqS3J1c2thbC1XYWxsaXMgdGVzdCBhbmQgcC12YWx1ZSBhZGp1c3RtZW50ICBmb3IgMjQgVEZzIGFsc28gaWRlbnRpZmllZCBieSBBVEFDLXNlcSoqCgoKYGBge3J9CiMgY2hlY2sgMjQgVEZzIHdpdGggS3J1c2thbCBXYWxsaXMgdGVzdApwX3ZhbHVlcyA8LSBtYXAoc2VxLmludCgxOjI0KSwgZnVuY3Rpb24obil7CiAgdGYgPC0gb3ZlcmxhcF9hdGFjJG5hbWVbbl0KICBwX3ZhbHVlcyA8LSB1bmxpc3Qoa3J1c2thbC50ZXN0KHB1bGwoazNfZGZbdGZdKSB+IGh0X2NsdXN0ZXIsIGszX2RmKSlbInAudmFsdWUiXQp9KQojc2lnbl9wX3ZhbHVlcyA8LSBwX3ZhbHVlc1twX3ZhbHVlcyA8IDAuMDFdCgojIGFkanVzdCBmb3IgbXVsdGlwbGUgaHlwb3RoZXNpcyB0ZXN0aW5nCmFkal9wX3ZhbHVlcyA8LSBwLmFkanVzdChhcy5udW1lcmljKHVubmFtZSh1bmxpc3QocF92YWx1ZXMpKSksIG1ldGhvZCA9ICJmZHIiKQoKCiMgaG93IG1hbnkgdHJhbnNjcmlwdGlvbiBmYWN0b3JzIGFyZSBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBiZXR3ZWVuIHRoZSBjbHVzdGVycz8KbGVuZ3RoKGFkal9wX3ZhbHVlc1thZGpfcF92YWx1ZXM8MC4wNV0pCgojIGdldCBURnMgdGhhdCBhcmUgZGlmZmVyZW50aWFsbHkgZXhwcmVzc2VkCmhpdjFfYXRhYyA8LSBvdmVybGFwX2F0YWMkbmFtZVthZGpfcF92YWx1ZXMgPCAuMDVdCiN3cml0ZS50YWJsZShkaWZmM19hdGFjLCAiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvYXRhY19URnNfZGlmZmVyZW50aWFsbHlfYWN0aXZlX2luX0hJVjEiKQpgYGAKCiogKipQb3N0aG9jIHRlc3RzIGZvciBrID0gMyoqCgoKRm9yIHRoZSAxNiBURnMgd2l0aCBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBhY3Rpdml0eSBiZXR3ZWVuIHRoZSAzIGNsdXN0ZXJzOgoKYGBge3IsIHdhcm5pbmcgPSBGQUxTRX0KIyBXZSBwZXJmb3JtIGEgcG9zdGhvYyB0ZXN0CiN3aWxjb3hfbGlzdCA9IGxpc3QoKQp3aWxjb3hfbGlzdCA8LSBtYXAoc2VxLmludCgxOmxlbmd0aChoaXYxX2F0YWMpKSwgZnVuY3Rpb24oaSl7CiAgdGYgPC0gaGl2MV9hdGFjW2ldCiAgI3ByaW50KHRmKQogIHdpbGNveCA8LSBwYWlyd2lzZS53aWxjb3gudGVzdChwdWxsKGszX2RmW3RmXSksIHB1bGwoazNfZGZbImh0X2NsdXN0ZXIiXSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmFkanVzdC5tZXRob2QgPSAiZmRyIikKICBsaXN0KFRGID0gdGYsIHdpbGNveCA9IHdpbGNveCkKfSkKICAKI2xlbmd0aCh3aWxjb3hfbGlzdCkKI3dpbGNveF9saXN0CmBgYAoKLS0tCjwvZGV0YWlscz4KCiMjIEsgPSA0IEhpZXJhcmNoaWNhbCBjbHVzdGVyaW5nCgojIyMgSGVhdG1hcCBmb3IgcGF0aWVudCAxCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTE3fQojbWFwKHNlcS5pbnQoMTo1KSwgZnVuY3Rpb24oayl7CmRmIDwtIGhpdjdAbWV0YS5kYXRhICU+JSBmaWx0ZXIoY2VsbF90eXBlID09ICJNeWVsb2lkMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSAiSElWMV9DU0YiKQojIHNlbGVjdCBvbmx5IHRoZSBjZWxscyBvZiB0aGUgYWN0aXZpdHkgbWF0cml4IHdoaWNoIGFyZSBteWVsb2lkMiBhbmQgdGhlIGNvcnJlY3QgcGF0aWVudAptdHggPC0gYXVjX210eFtyb3duYW1lcyhhdWNfbXR4KSAlaW4lIHJvd25hbWVzKGRmKSwgXQojIGhlYXRtYXAKc2V0LnNlZWQoMTIzKQpodCA8LSBkcmF3KEhlYXRtYXAodChtdHgpLCAKICAgICAgICAgICAgIGNvbHVtbl90aXRsZSA9ICJNeWVsb2lkMiBjZWxscyBmcm9tIHBhdGllbnQgMiwgayA9IDQiLCAKCiAgICAgICAgICAgICBjb2x1bW5fa20gPSA0LAogICAgICAgICAgICAgY29sdW1uX2ttX3JlcGVhdHMgPSAxMDAsCiAgICAgICAgICAgICBzaG93X2NvbHVtbl9uYW1lcyA9IEZBTFNFLAogICAgICAgICAgICAgY29sID1jb2xvclJhbXBQYWxldHRlKHJldihicmV3ZXIucGFsKG4gPSA3LCBuYW1lID0gIlJkWWxCdSIpKSkoMTAwKSwKICAgICAgICAgICAgIHJpZ2h0X2Fubm90YXRpb24gPSBsYQogICAgICAgICAgICAgKSkgCiAgICAgICAgICAgICAjdG9wX2Fubm90YXRpb24gPSBjb2x1bW5fYW5ub3RhdGlvbikgCgoKYGBgCgoKYGBge3J9CiMjIyBFeHRyYWN0IGNlbGxzIGZyb20gZWFjaCBjbHVzdGVyIG9mIGsgPSA0CgojIGdldCB0aGUgY29sdW1ucyBuYW1lcyBvZiBjbHVzdGVyIG9uZQpjbDEgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0KVtbMV1dLF0pKQoKIyBnZXQgdGhlIGNvbHVtbiBuYW1lcyBvZiBjbHVzdGVyIHR3bwpjbDIgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0KVtbMl1dLF0pKQoKCiMgZ2V0IHRoZSBjb2x1bW4gbmFtZXMgb2YgY2x1c3RlciAzCmNsMyA8LSBjb2xuYW1lcyh0KG10eFtjb2x1bW5fb3JkZXIoaHQpW1szXV0sXSkpCgpjbDQgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0KVtbNF1dLF0pKQpgYGAKCgoKIyMjIyBBcmUgdGhlcmUgc2lnbmlmaWNhbnQgZGlmZmVyZW5jZXMgaW4gVEYgYWN0aXZpdHkgYmV0d2VlbiB0aGUgZm91ciBjbHVzdGVycz8KCgpBTk9WQSB0ZXN0IGlzIHBhcmFtZXRyaWMgYW5kIGFzc3VtZXMgbm9ybWFsbHkgZGlzdHJpYnV0ZWQgZGF0YSwgd2hpbGUKS3J1c2thbC1XYWxsaXMtVGVzdCBjb21wYXJlcyB0aGUgbWVhbiBvZiBvbmUgb3IgbW9yZSBncm91cHMsIGJ1dCBpcyAKbm9uLXBhcmFtZXRyaWMuIEFzIGNhbiBiZSBzZWVuIGluIHRoZSBib3hwbG90cyBhYm92ZSB0aGUgZGF0YSBpcyBub3Qgbm9ybWFsbHkgCmRpc3RyaWJ1dGVkLCB0aGVyZWZvcmUgS3J1c2thbC1XYWxsaXMtVGVzdCBpcyBtb3JlIGFwcHJvcHJpYXRlIGluIHRoaXMgY2FzZS4KSW4gYm90aCBjYXNlcyB0aGUgTnVsbC1IeXBvdGhlc2lzIGlzIHRoYXQgdGhlcmUgaXMgbm8gZGlmZmVyZW5jZQpiZXR3ZWVuIHRoZSBncm91cHMuCgpTaW5jZSBJIGFtIHJlcGVhdGluZyB0aGUgdGVzdCAxMjUgdGltZXMsIEkgYWRqdXN0IHRoZSBwLXZhbHVlcyB3aXRoIHRoZQpGRFIgbWV0aG9kLiBUaGlzIG1ldGhvZHMgaXMgbW9yZSBwb3dlcmZ1bCB0aGFuIG1vcmUgY29uc2VydmF0aXZlIG1ldGhkb3MsIGxpa2UKYm9uZmVycm9uaSwgSG9sbSBvciBIb2NoYmVyZy4gCgpQZXJmb3JtaW5nIEtydXNrYWwtV2FsbGlzLVRlc3QgdG8gZmluZCBkaWZmZXJlbmNlcyBiZXR3ZWVuIHRoZSBmb3VyIGNsdXN0ZXJzIGluIHBhdGllbnQxCnlpZWxkcyA1MSBURnMgb2YgYWxsIDEyNSBURnMgd2hpY2ggYXJlIGRpZmZlcmVudGlhbGx5IGFjdGl2ZSBiZXR3ZWVuIHRoZSB0aHJlZSBjbHVzdGVycwoocC12YWx1ZSA8IDAuMDUpLiBPZiB0aGUgMjQgVEZzIHdpdGggZGlmZmVyZW50aWFsIGJpbmRpbmcgc2NvcmVzIGluIHRoZSBDMjAgY2VsbCAKbGluZSwgZm91cnRlZW4gaGF2ZSBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBhY3Rpdml0eSBiZXR3ZWVuIHRoZSBjbHVzdGVycy4KCk5vdyB0aGF0IHdlIGtub3cgdGhhdCB0aGVyZSBhcmUgc2lnbmlmaWNhbnQgZGlmZmVyZW5jZXMgYmV0d2VlbiBjbHVzdGVycywgd2UgCndhbnQgdG8gaWRlbnRpZnkgd2hpY2ggY2x1c3Rlci9zIGFyZSBkaWZmZXJlbnQgZnJvbSB3aGljaCBvdGhlciBjbHVzdGVyL3MuCgpQYWlyd2lzZS1XaWxjb3gtVGVzdCBpcyBhIG5vbi1wYXJhbWV0cmljIHBhaXJ3aXNlIHRlc3QuIEFnYWluLCBiZWNhdXNlIAp3ZSByZXBlYXQgdGhlIHRlc3Qgd2Ugd2lsbCBjb3JyZWN0IGZvciBtdWx0aXBsZSBoeXBvdGhlc2lzIHRlc3RpbmcgdXNpbmcgdGhlIApGRFIgbWV0aG9kLiBUaGUgcmVzdWx0cyBhcmUgc2hvd24gaW4gYm94cGxvdHMgYmVsb3cuCgoKPC9kZXRhaWxzPgoKPGRldGFpbHM+IAo8c3VtbWFyeT5LcnVza2FsLVdhbGxpcy1UZXN0LCBwLXZhbHVlIGFkanVzdG1lbnQsIHBvc3Rob2MgdGVzdHM8L3N1bW1hcnk+CgoqICoqS3J1c2thbC1XYWxsaXMgVGVzdCBhbmQgcC12YWx1ZSBhZGp1c3RtZW50cyBmb3IgYWxsIDEyNSBURnMqKgoKYGBge3J9CgprNF9kZiA8LSBoaXY3X3NjZW5pY0BtZXRhLmRhdGEgJT4lIAogIHJvd25hbWVzX3RvX2NvbHVtbigiY2VsbCIpICU+JSAKICBmaWx0ZXIob3JpZy5pZGVudCA9PSAiSElWMV9DU0YiLAogICAgICAgICBjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiwKICAgICAgICAgY2VsbCAlaW4lIGMoY2wxLGNsMixjbDMsY2w0KSkgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gaWZlbHNlKGNlbGwgJWluJSBjbDEsICJjbDEiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoY2VsbCAlaW4lIGNsMiwgImNsMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoY2VsbCAlaW4lIGNsMywgImNsMyIsICJjbDQiKSkpKQoKIyBjaGVjayBhbGwgVEZzIApwX3ZhbHVlcyA8LSBtYXAoc2VxLmludCgxOjEyNSksIGZ1bmN0aW9uKG4pewogIHRmIDwtIGNvbG5hbWVzKGF1Y19tdHgpW25dCiAgcF92YWx1ZXMgPC0gdW5saXN0KGtydXNrYWwudGVzdChwdWxsKGs0X2RmW3RmXSkgfiBodF9jbHVzdGVyLCBrNF9kZikpWyJwLnZhbHVlIl0KICAjbGlzdCh0ZiA9IHRmLCBwX3ZhbHVlID0gcF92YWx1ZXMpCn0pCgojIGFkanVzdCBmb3IgbXVsdGlwbGUgdGVzdGluZyB3aXRoIEZEUgphZGpfcF92YWx1ZXMgPC0gcC5hZGp1c3QoYXMubnVtZXJpYyh1bm5hbWUodW5saXN0KHBfdmFsdWVzKSkpLCBtZXRob2QgPSAiZmRyIikKCiMgaG93IG1hbnkgdHJhbnNjcmlwdGlvbiBmYWN0b3JzIGFyZSBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBiZXR3ZWVuIHRoZSBjbHVzdGVycz8Kc2lnbiA8LSBhZGpfcF92YWx1ZXNbYWRqX3BfdmFsdWVzIDwgMC4wNV0KbGVuZ3RoKGFkal9wX3ZhbHVlc1thZGpfcF92YWx1ZXM8MC4wNV0pCgoKIyBnZXQgdGhlIFRGcyB0aGF0IGFyZSBkaWZmZXJlbnRpYWxseSBleHByZXNzZWQKZGlmZjQgPC0gY29sbmFtZXMoYXVjX210eClbYWRqX3BfdmFsdWVzIDwgMC4wNV0KCiN3cml0ZS50YWJsZShkaWZmNCwgIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL3RvdGFsX1RGc19kaWZmZXJlbnRpYWxseV9hY3RpdmVfaW5fSElWMV9rPTQiKQoKYGBgCgoqICoqS3J1c2thbC1XYWxsaXMgVGVzdCBhbmQgcC12YWx1ZSBhZGp1c3RtZW50cyBmb3IgMTQgVEZzIHdpdGggZGlmZmVyZW50aWFsIGJpbmRpbmcgc2NvcmVzKioKCgpgYGB7cn0KIyBjaGVjayAyNCBURnMgd2l0aCBLcnVza2FsIFdhbGxpcyB0ZXN0CnBfdmFsdWVzIDwtIG1hcChzZXEuaW50KDE6MjQpLCBmdW5jdGlvbihuKXsKICB0ZiA8LSBvdmVybGFwX2F0YWMkbmFtZVtuXQogIHBfdmFsdWVzIDwtIHVubGlzdChrcnVza2FsLnRlc3QocHVsbChrNF9kZlt0Zl0pIH4gaHRfY2x1c3RlciwgazRfZGYpKVsicC52YWx1ZSJdCn0pCiNzaWduX3BfdmFsdWVzIDwtIHBfdmFsdWVzW3BfdmFsdWVzIDwgMC4wMV0KCiMgYWRqdXN0IGZvciBtdWx0aXBsZSBoeXBvdGhlc2lzIHRlc3RpbmcKYWRqX3BfdmFsdWVzIDwtIHAuYWRqdXN0KGFzLm51bWVyaWModW5uYW1lKHVubGlzdChwX3ZhbHVlcykpKSwgbWV0aG9kID0gImZkciIpCgoKIyBob3cgbWFueSB0cmFuc2NyaXB0aW9uIGZhY3RvcnMgYXJlIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGJldHdlZW4gdGhlIGNsdXN0ZXJzPwpsZW5ndGgoYWRqX3BfdmFsdWVzW2Fkal9wX3ZhbHVlczwwLjA1XSkKCiMgZ2V0IHRoZSBURnMgdGhhdCBhcmUgZGlmZmVyZW50aWFsbHkgZXhwcmVzc2VkCmRpZmY0X2F0YWMgPC0gb3ZlcmxhcF9hdGFjJG5hbWVbYWRqX3BfdmFsdWVzIDwgLjA1XQoKI3dyaXRlLnRhYmxlKGRpZmY0X2F0YWMsICIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9hdGFjX1RGc19kaWZmZXJlbnRpYWxseV9hY3RpdmVfaW5fSElWMV9rPTQiKQoKYGBgCgoqICoqUGFpcndpc2UtV2lsY294X1Rlc3QgZm9yIGsgPSA0KioKCkZvciB0aGUgMTYgVEZzIHdpdGggc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiB0aGUgZm91ciBjbHVzdGVyczoKCmBgYHtyLCB3YXJuaW5nID0gRkFMU0V9CiMgV2UgcGVyZm9ybSBhIHBvc3Rob2MgdGVzdAojd2lsY294X2xpc3QgPSBsaXN0KCkKd2lsY294X2xpc3QgPC0gbWFwKHNlcS5pbnQoMTpsZW5ndGgoZGlmZjRfYXRhYykpLCBmdW5jdGlvbihpKXsKICB0ZiA8LSBkaWZmNF9hdGFjW2ldCiAgcHJpbnQodGYpCiAgd2lsY294IDwtIHBhaXJ3aXNlLndpbGNveC50ZXN0KHB1bGwoazRfZGZbdGZdKSwgcHVsbChrNF9kZlsiaHRfY2x1c3RlciJdKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuYWRqdXN0Lm1ldGhvZCA9ICJmZHIiKQogIGxpc3QoVEYgPSB0Ziwgd2lsY294ID0gd2lsY294KQp9KQogIAojbGVuZ3RoKHdpbGNveF9saXN0KQojd2lsY294X2xpc3QKYGBgCi0tLQo8L2RldGFpbHM+CgoKIyMgSyA9IDUgSGllcmFyY2hpY2FsIENsdXN0ZXJpbmcKCiMjIyBIZWF0bWFwIGZvciBwYXRpZW50IDEKCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MTd9CiNtYXAoc2VxLmludCgxOjUpLCBmdW5jdGlvbihrKXsKZGYgPC0gaGl2N0BtZXRhLmRhdGEgJT4lIGZpbHRlcihjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ID09ICJISVYxX0NTRiIpCiMgc2VsZWN0IG9ubHkgdGhlIGNlbGxzIG9mIHRoZSBhY3Rpdml0eSBtYXRyaXggd2hpY2ggYXJlIG15ZWxvaWQyIGFuZCB0aGUgY29ycmVjdCBwYXRpZW50Cm10eCA8LSBhdWNfbXR4W3Jvd25hbWVzKGF1Y19tdHgpICVpbiUgcm93bmFtZXMoZGYpLCBdCiMgaGVhdG1hcApzZXQuc2VlZCgxMjMpCmh0IDwtIGRyYXcoSGVhdG1hcCh0KG10eCksIAogICAgICAgICAgICAgY29sdW1uX3RpdGxlID0gIk15ZWxvaWQyIGNlbGxzIGZyb20gcGF0aWVudCAxLCBrID0gNSIsIAoKICAgICAgICAgICAgIGNvbHVtbl9rbSA9IDUsCiAgICAgICAgICAgICBjb2x1bW5fa21fcmVwZWF0cyA9IDEwMCwKICAgICAgICAgICAgIHNob3dfY29sdW1uX25hbWVzID0gRkFMU0UsCiAgICAgICAgICAgICBjb2wgPWNvbG9yUmFtcFBhbGV0dGUocmV2KGJyZXdlci5wYWwobiA9IDcsIG5hbWUgPSAiUmRZbEJ1IikpKSgxMDApLAogICAgICAgICAgICAgcmlnaHRfYW5ub3RhdGlvbiA9IGxhCiAgICAgICAgICAgICApKSAKCmBgYAoKCmBgYHtyfQojIyMjIyBFeHRyYWN0IGNlbGxzIGZyb20gZWFjaCBjbHVzdGVyIGZvciBrPSA1CgojIGdldCB0aGUgY29sdW1ucyBuYW1lcyBvZiBjbHVzdGVyIG9uZQpjbHUxIDwtIGNvbG5hbWVzKHQobXR4W2NvbHVtbl9vcmRlcihodClbWzFdXSxdKSkKCiMgZ2V0IHRoZSBjb2x1bW4gbmFtZXMgb2YgY2x1c3RlciB0d28KY2x1MiA8LSBjb2xuYW1lcyh0KG10eFtjb2x1bW5fb3JkZXIoaHQpW1syXV0sXSkpCgoKIyBnZXQgdGhlIGNvbHVtbiBuYW1lcyBvZiBjbHVzdGVyIDMKY2x1MyA8LSBjb2xuYW1lcyh0KG10eFtjb2x1bW5fb3JkZXIoaHQpW1szXV0sXSkpCgpjbHU0IDwtIGNvbG5hbWVzKHQobXR4W2NvbHVtbl9vcmRlcihodClbWzRdXSxdKSkKCmNsdTUgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0KVtbNV1dLCBdKSkKCmBgYAoKCgojIyMjIEFyZSB0aGVyZSBzaWduaWZpY2FudCBkaWZmZXJlbmNlcyBpbiBURiBhY3Rpdml0eSBiZXR3ZWVuIHRoZSBmb3VyIGNsdXN0ZXJzPwoKCkFOT1ZBIHRlc3QgaXMgcGFyYW1ldHJpYyBhbmQgYXNzdW1lcyBub3JtYWxseSBkaXN0cmlidXRlZCBkYXRhLCB3aGlsZQpLcnVza2FsLVdhbGxpcy1UZXN0IGNvbXBhcmVzIHRoZSBtZWFuIG9mIG9uZSBvciBtb3JlIGdyb3VwcywgYnV0IGlzIApub24tcGFyYW1ldHJpYy4gQXMgY2FuIGJlIHNlZW4gaW4gdGhlIGJveHBsb3RzIGFib3ZlIHRoZSBkYXRhIGlzIG5vdCBub3JtYWxseSAKZGlzdHJpYnV0ZWQsIHRoZXJlZm9yZSBLcnVza2FsLVdhbGxpcy1UZXN0IGlzIG1vcmUgYXBwcm9wcmlhdGUgaW4gdGhpcyBjYXNlLgpJbiBib3RoIGNhc2VzIHRoZSBOdWxsLUh5cG90aGVzaXMgaXMgdGhhdCB0aGVyZSBpcyBubyBkaWZmZXJlbmNlCmJldHdlZW4gdGhlIGdyb3Vwcy4KClNpbmNlIEkgYW0gcmVwZWF0aW5nIHRoZSB0ZXN0IDEyNSB0aW1lcywgSSBhZGp1c3QgdGhlIHAtdmFsdWVzIHdpdGggdGhlCkZEUiBtZXRob2QuIFRoaXMgbWV0aG9kcyBpcyBtb3JlIHBvd2VyZnVsIHRoYW4gbW9yZSBjb25zZXJ2YXRpdmUgbWV0aGRvcywgbGlrZQpib25mZXJyb25pLCBIb2xtIG9yIEhvY2hiZXJnLiAKClBlcmZvcm1pbmcgS3J1c2thbC1XYWxsaXMtVGVzdCB0byBmaW5kIGRpZmZlcmVuY2VzIGJldHdlZW4gdGhlIGZpdmUgY2x1c3RlcnMgaW4gcGF0aWVudDEKeWllbGRzIDU5IFRGcyBvZiBhbGwgMTI1IFRGcyB3aGljaCBhcmUgZGlmZmVyZW50aWFsbHkgYWN0aXZlIGJldHdlZW4gdGhlIHRocmVlIGNsdXN0ZXJzCihwLXZhbHVlIDwgMC4wNSkuIE9mIHRoZSAyNCBURnMgd2l0aCBkaWZmZXJlbnRpYWwgYmluZGluZyBzY29yZXMgaW4gdGhlIEMyMCBjZWxsIApsaW5lLCBmaWZ0ZWVuIGhhdmUgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiB0aGUgY2x1c3RlcnMuCgpOb3cgdGhhdCB3ZSBrbm93IHRoYXQgdGhlcmUgYXJlIHNpZ25pZmljYW50IGRpZmZlcmVuY2VzIGJldHdlZW4gY2x1c3RlcnMsIHdlIAp3YW50IHRvIGlkZW50aWZ5IHdoaWNoIGNsdXN0ZXIvcyBhcmUgZGlmZmVyZW50IGZyb20gd2hpY2ggb3RoZXIgY2x1c3Rlci9zLgoKUGFpcndpc2UtV2lsY294LVRlc3QgaXMgYSBub24tcGFyYW1ldHJpYyBwYWlyd2lzZSB0ZXN0LiBBZ2FpbiwgYmVjYXVzZSAKd2UgcmVwZWF0IHRoZSB0ZXN0IHdlIHdpbGwgY29ycmVjdCBmb3IgbXVsdGlwbGUgaHlwb3RoZXNpcyB0ZXN0aW5nIHVzaW5nIHRoZSAKRkRSIG1ldGhvZC4gVGhlIHJlc3VsdHMgYXJlIHNob3duIGluIGJveHBsb3RzIGJlbG93LgoKCjwvZGV0YWlscz4KCjxkZXRhaWxzPiAKPHN1bW1hcnk+S3J1c2thbC1XYWxsaXMtVGVzdCwgcC12YWx1ZSBhZGp1c3RtZW50LCBwb3N0aG9jIHRlc3RzPC9zdW1tYXJ5PgoKKiAqKktydXNrYWwtV2FsbGlzIFRlc3QgYW5kIHAtdmFsdWUgYWRqdXN0bWVudHMgZm9yIGFsbCAxMjUgVEZzKioKCmBgYHtyfQojIGFsbCBURnMKazVfZGYgPC0gaGl2N19zY2VuaWNAbWV0YS5kYXRhICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgZmlsdGVyKG9yaWcuaWRlbnQgPT0gIkhJVjFfQ1NGIiwKICAgICAgICAgY2VsbF90eXBlID09ICJNeWVsb2lkMiIsCiAgICAgICAgIGNlbGwgJWluJSBjKGNsdTEsY2x1MixjbHUzLGNsdTQsIGNsdTUpKSAlPiUgCiAgbXV0YXRlKGh0X2NsdXN0ZXIgPSBpZmVsc2UoY2VsbCAlaW4lIGNsdTEsICJjbHUxIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZlbHNlKGNlbGwgJWluJSBjbHUyLCAiY2x1MiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoY2VsbCAlaW4lIGNsdTMsICJjbHUzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmZWxzZShjZWxsICVpbiUgY2x1NCwgImNsdTQiLCAiY2x1NSIpKSkpKQpuID0gMQojIGNoZWNrIGFsbCBURnMgCnBfdmFsdWVzIDwtIG1hcChzZXEuaW50KDE6MTI1KSwgZnVuY3Rpb24obil7CiAgdGYgPC0gY29sbmFtZXMoYXVjX210eClbbl0KICBwX3ZhbHVlcyA8LSB1bmxpc3Qoa3J1c2thbC50ZXN0KHB1bGwoazVfZGZbdGZdKSB+IGh0X2NsdXN0ZXIsIGs1X2RmKSlbInAudmFsdWUiXQogICNsaXN0KHRmID0gdGYsIHBfdmFsdWUgPSBwX3ZhbHVlcykKfSkKCiMgYWRqdXN0IGZvciBtdWx0aXBsZSB0ZXN0aW5nIHdpdGggRkRSCmFkal9wX3ZhbHVlcyA8LSBwLmFkanVzdChhcy5udW1lcmljKHVubmFtZSh1bmxpc3QocF92YWx1ZXMpKSksIG1ldGhvZCA9ICJmZHIiKQoKIyBob3cgbWFueSB0cmFuc2NyaXB0aW9uIGZhY3RvcnMgYXJlIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGJldHdlZW4gdGhlIGNsdXN0ZXJzPwpzaWduIDwtIGFkal9wX3ZhbHVlc1thZGpfcF92YWx1ZXMgPCAwLjA1XQpsZW5ndGgoYWRqX3BfdmFsdWVzW2Fkal9wX3ZhbHVlczwwLjA1XSkKCgojIGdldCB0aGUgVEZzIHRoYXQgYXJlIGRpZmZlcmVudGlhbGx5IGV4cHJlc3NlZApkaWZmNSA8LSBjb2xuYW1lcyhhdWNfbXR4KVthZGpfcF92YWx1ZXMgPCAwLjA1XQoKI3dyaXRlLnRhYmxlKGRpZmY1LCAiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvdG90YWxfVEZzX2RpZmZlcmVudGlhbGx5X2FjdGl2ZV9pbl9ISVYxX2s9NSIpCmBgYAoKKiAqKktydXNrYWwtV2FsbGlzIFRlc3QgYW5kIHAtdmFsdWUgYWRqdXN0bWVudHMgZm9yIGFsbCAxMjUgVEZzKioKCmBgYHtyfQojIGNoZWNrIDI0IFRGcyB3aXRoIEtydXNrYWwgV2FsbGlzIHRlc3QKcF92YWx1ZXMgPC0gbWFwKHNlcS5pbnQoMToyNCksIGZ1bmN0aW9uKG4pewogIHRmIDwtIG92ZXJsYXBfYXRhYyRuYW1lW25dCiAgcF92YWx1ZXMgPC0gdW5saXN0KGtydXNrYWwudGVzdChwdWxsKGs1X2RmW3RmXSkgfiBodF9jbHVzdGVyLCBrNV9kZikpWyJwLnZhbHVlIl0KfSkKI3NpZ25fcF92YWx1ZXMgPC0gcF92YWx1ZXNbcF92YWx1ZXMgPCAwLjAxXQoKIyBhZGp1c3QgZm9yIG11bHRpcGxlIGh5cG90aGVzaXMgdGVzdGluZwphZGpfcF92YWx1ZXMgPC0gcC5hZGp1c3QoYXMubnVtZXJpYyh1bm5hbWUodW5saXN0KHBfdmFsdWVzKSkpLCBtZXRob2QgPSAiZmRyIikKCgojIGhvdyBtYW55IHRyYW5zY3JpcHRpb24gZmFjdG9ycyBhcmUgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYmV0d2VlbiB0aGUgY2x1c3RlcnM/Cmxlbmd0aChhZGpfcF92YWx1ZXNbYWRqX3BfdmFsdWVzPDAuMDVdKQoKIyBnZXQgdGhlIFRGcyB0aGF0IGFyZSBkaWZmZXJlbnRpYWxseSBleHByZXNzZWQKZGlmZjVfYXRhYyA8LSBvdmVybGFwX2F0YWMkbmFtZVthZGpfcF92YWx1ZXMgPCAuMDVdCgojd3JpdGUudGFibGUoZGlmZjVfYXRhYywgIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2F0YWNfVEZzX2RpZmZlcmVudGlhbGx5X2FjdGl2ZV9pbl9ISVYxX2s9NSIpCmBgYAoKKiAqKlBhaXJ3aXNlLVdpbGNveF9UZXN0IGZvciBrID0gNSoqCgpGb3IgdGhlIDE1IFRGcyB3aXRoIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGFjdGl2aXR5IGJldHdlZW4gdGhlIGZvdXIgY2x1c3RlcnM6CgpgYGB7ciwgd2FybmluZyA9IEZBTFNFfQojIFdlIHBlcmZvcm0gYSBwb3N0aG9jIHRlc3QKI3dpbGNveF9saXN0ID0gbGlzdCgpCndpbGNveF9saXN0IDwtIG1hcChzZXEuaW50KDE6bGVuZ3RoKGRpZmY1X2F0YWMpKSwgZnVuY3Rpb24oaSl7CiAgdGYgPC0gZGlmZjVfYXRhY1tpXQogIHByaW50KHRmKQogIHdpbGNveCA8LSBwYWlyd2lzZS53aWxjb3gudGVzdChwdWxsKGs1X2RmW3RmXSksIHB1bGwoazVfZGZbImh0X2NsdXN0ZXIiXSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmFkanVzdC5tZXRob2QgPSAiZmRyIikKICBsaXN0KFRGID0gdGYsIHdpbGNveCA9IHdpbGNveCkKfSkKICAKI2xlbmd0aCh3aWxjb3hfbGlzdCkKI3dpbGNveF9saXN0CmBgYAoKLS0tCjwvZGV0YWlscz4KCiMgey19Ci0tLQoKCiMjIFdoaWNoIENsdXN0ZXJzIGFyZSBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBmb3IgZGlmZmVyZW50IGs/IHsudGFic2V0fQoKVGhlIHJlc3VsdHMgZnJvbSB0aGUgc3RhdGlzdGljYWwgdGVzdHMgb24gZGlmZmVyZW5jZSBpbiBURiBhY3Rpdml0eSBiZXR3ZWVuCmNsdXN0ZXJzIGNhbiBiZSBzZWVuIGluIHRoZSBib3hwbG90cyBiZWxvdy4gU2l4dGVlbiwgZm91cnRlZW4gYW5kIHR3ZWx2ZSBURnMKd2VyZSBmb3VuZCB0byBiZSBkaWZmZXJlbnRpYWxseSBhY3RpdmUgYmV0d2VlbiB0aGUgY2x1c3RlcnMgZm9yIGsgZXF1YWwgdGhyZWUsIApmb3VyIGFuZCBmaXZlIHJlc3BlY3RpdmVseS4gVGhlIGJveHBsb3RzIGJlbG93IGFsc28gc2hvdyB2ZXJ5IG5pY2VseSwgdGhhdCAKdGhlIGRhdGEgYXJlIG5vdCBub3JtYWxseSBkaXN0cmlidXRlZCBhbmQsIHRoZXJlZm9yZSwgbm9uLXBhcmFtZXRyaWMgdGVzdHMsIApsaWtlIHRoZSBLcnVza2FsLVdhbGxpcy1UZXN0IGFuZCBwYWlyd2lzZSBXaWxjb3gtVGVzdCB3ZXJlIHVzZWQuCgoKIyMjIGsgPSAzPwoKYGBge3IsIGZpZy5oZWlnaHQ9MjAsIGZpZy53aWR0aD0yNX0KCnRlc3QgPC0gazNfZGYKI3RmLm9pIDwtIGMoIkNUQ0YiLCAiUkVTVCIsICJZWTEiKQojbmFtZXModGYub2kpIDwtIHRmLm9pCnRlc3QubGlzdCA8LSBtYXAoaGl2MV9hdGFjLCBmdW5jdGlvbih0ZikgewogIGdncGxvdCgpICsKICBnZW9tX3Zpb2xpbihhZXMoeCA9IHRlc3QgJT4lIHB1bGwoImh0X2NsdXN0ZXIiKSwgeSA9IHRlc3QgJT4lIHB1bGwodGYpLCAKICAgICAgICAgICAgICAgICAgIGZpbGwgPSB0ZXN0ICU+JSBwdWxsKCJodF9jbHVzdGVyIiksIGFscGhhID0gLjYpKSArCiAgZ2VvbV9ib3hwbG90KGFlcyh4ID0gdGVzdCAlPiUgcHVsbCgiaHRfY2x1c3RlciIpLCB5ID0gdGVzdCAlPiUgcHVsbCh0ZikpLCAKICAgICAgICAgICAgICAgYWxwaGEgPSAwKSArCiAgc3RhdF9wdmFsdWVfbWFudWFsKHRlc3QgJT4lIAogICAgcGFpcndpc2Vfd2lsY294X3Rlc3QoYXMuZm9ybXVsYShwYXN0ZTAodGYsICIgfiBodF9jbHVzdGVyIikpKSAlPiUKICAgICAgYWRkX3h5X3Bvc2l0aW9uKCkpICsKICAgIHhsYWIoImhlYXRtYXAgY2x1c3RlciIpICsKICAgIHlsYWIocGFzdGUwKHRmKSkgKwogICAgZ3VpZGVzKGZpbGwgPSBndWlkZV9sZWdlbmQodGl0bGUgPSAiaGVhdG1hcCBjbHVzdGVyIikpIH0pCgpkby5jYWxsKGdyaWRFeHRyYTo6Z3JpZC5hcnJhbmdlLCBjKHRlc3QubGlzdCwgbmNvbD01LCBucm93ID0gNCkpCmBgYAoKIyMjIGsgPSA0CgpgYGB7ciwgZmlnLndpZHRoPTI1LCBmaWcuaGVpZ2h0PTE1fQoKdGVzdCA8LSBrNF9kZgoKdGVzdC5saXN0IDwtIG1hcChkaWZmNF9hdGFjLCBmdW5jdGlvbih0ZikgewogIGdncGxvdCgpICsKICBnZW9tX3Zpb2xpbihhZXMoeCA9IHRlc3QgJT4lIHB1bGwoImh0X2NsdXN0ZXIiKSwgeSA9IHRlc3QgJT4lIHB1bGwodGYpLCAKICAgICAgICAgICAgICAgICAgIGZpbGwgPSB0ZXN0ICU+JSBwdWxsKCJodF9jbHVzdGVyIiksIGFscGhhID0gLjYpKSArCiAgZ2VvbV9ib3hwbG90KGFlcyh4ID0gdGVzdCAlPiUgcHVsbCgiaHRfY2x1c3RlciIpLCB5ID0gdGVzdCAlPiUgcHVsbCh0ZikpLCAKICAgICAgICAgICAgICAgYWxwaGEgPSAwKSArCiAgc3RhdF9wdmFsdWVfbWFudWFsKHRlc3QgJT4lIAogICAgcGFpcndpc2Vfd2lsY294X3Rlc3QoYXMuZm9ybXVsYShwYXN0ZTAodGYsICIgfiBodF9jbHVzdGVyIikpKSAlPiUKICAgICAgYWRkX3h5X3Bvc2l0aW9uKCkpICsKICAgIHhsYWIoImhlYXRtYXAgY2x1c3RlciIpICsKICAgIHlsYWIocGFzdGUwKHRmKSkgKwogICAgZ3VpZGVzKGZpbGwgPSBndWlkZV9sZWdlbmQodGl0bGUgPSAiaGVhdG1hcCBjbHVzdGVyIikpICsKICAgIGdlb21fdmlvbGluKGFscGhhID0gMCkKfSkKCmRvLmNhbGwoZ3JpZEV4dHJhOjpncmlkLmFycmFuZ2UsIGModGVzdC5saXN0LCBuY29sPTUsIG5yb3cgPSAzKSkKCgpgYGAKCgojIyMgayA9IDUKYGBge3IsIGZpZy53aWR0aD0yNSwgZmlnLmhlaWdodD0xNX0KdGVzdCA8LSBrNV9kZgoKdGVzdC5saXN0IDwtIG1hcChkaWZmNV9hdGFjLCBmdW5jdGlvbih0ZikgewogIGdncGxvdCgpICsKICBnZW9tX3Zpb2xpbihhZXMoeCA9IHRlc3QgJT4lIHB1bGwoImh0X2NsdXN0ZXIiKSwgeSA9IHRlc3QgJT4lIHB1bGwodGYpLCAKICAgICAgICAgICAgICAgICAgIGZpbGwgPSB0ZXN0ICU+JSBwdWxsKCJodF9jbHVzdGVyIiksIGFscGhhID0gLjYpKSArCiAgZ2VvbV9ib3hwbG90KGFlcyh4ID0gdGVzdCAlPiUgcHVsbCgiaHRfY2x1c3RlciIpLCB5ID0gdGVzdCAlPiUgcHVsbCh0ZikpLCAKICAgICAgICAgICAgICAgYWxwaGEgPSAwKSArCiAgc3RhdF9wdmFsdWVfbWFudWFsKHRlc3QgJT4lIAogICAgcGFpcndpc2Vfd2lsY294X3Rlc3QoYXMuZm9ybXVsYShwYXN0ZTAodGYsICIgfiBodF9jbHVzdGVyIikpKSAlPiUKICAgICAgYWRkX3h5X3Bvc2l0aW9uKCkpICsKICAgIHhsYWIoImhlYXRtYXAgY2x1c3RlciIpICsKICAgIHlsYWIocGFzdGUwKHRmKSkgKwogICAgZ3VpZGVzKGZpbGwgPSBndWlkZV9sZWdlbmQodGl0bGUgPSAiaGVhdG1hcCBjbHVzdGVyIikpCn0pCgpkby5jYWxsKGdyaWRFeHRyYTo6Z3JpZC5hcnJhbmdlLCBjKHRlc3QubGlzdCwgbmNvbD01LCBucm93ID0gMykpCmBgYAoKIyB7LX0KCiMjIENvbmNsdXNpb24gb24gaG93IG1hbnkgaydzIHRvIHVzZSBmb3IgaGllcmFyY2hpY2FsIGNsdXN0ZXJpbmcKCkFzIG1lbnRpb25lZCwgayA9IDMgd2FzIHVzZWQgZm9yIHRoZSBzdWJzZXF1ZW50IGFuYWx5c2lzLCBzaW5jZSBtb3JlIGNsdXN0ZXJzIApkaWQgbm90IGFkZCBhZGRpdGlvbmFsIGluc2lnaHRzLgoKVGhlIFZlbm4gZGlhZ3JhbSBiZWxvdyBzaG93cyB2ZXJ5IG5pY2VseSwgdGhhdCBvdXQgb2YgYWxsIFRGcyB3aXRoIGRpZmZlcmVudAphY3Rpdml0eSBiZXR3ZWVuIGNsdXN0ZXJzLCA2OCUgb3ZlcmxhcCBmb3IgYWxsIGsgKGs9My80LzUpIHRoYXQgSSB0ZXN0ZWQgKHJpZ2h0IHBsb3QpLiAKNzUlIG9mIHRoZSBURiB3aXRoIGRpZmZlcmVudGlhbCBiaW5kaW5nIHNjb3JlcyBpbiB0aGUgQzIwIGNlbGwgbGluZSBvdmVybGFwcGVkCmZvciBhbGwgayAobGVmdCBwbG90KS4gCgpUaGVyZWZvcmUsIEkgZGVjaWRlZCB0byBwcm9jZWVkIHdpdGggCmsgPSAzIGZvciB0aGUgZm9sbG93aW5nIGFuYWx5c2lzLiAKCmBgYHtyfQpkaWZmNV9hdGFjIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCAiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvYXRhY19URnNfZGlmZmVyZW50aWFsbHlfYWN0aXZlX2luX0hJVjFfaz01IikpW1sieCJdXQpkaWZmNSA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSggIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL3RvdGFsX1RGc19kaWZmZXJlbnRpYWxseV9hY3RpdmVfaW5fSElWMV9rPTUiKSlbWyJ4Il1dCgoKZGlmZjRfYXRhYyA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvYXRhY19URnNfZGlmZmVyZW50aWFsbHlfYWN0aXZlX2luX0hJVjFfaz00IikpW1sieCJdXQoKZGlmZjQgPC0gYXMudmVjdG9yKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL3RvdGFsX1RGc19kaWZmZXJlbnRpYWxseV9hY3RpdmVfaW5fSElWMV9rPTQiKSlbWyJ4Il1dCiMgbGlzdCBvZiBURnMgZnJvbSBBVEFDLXNlcSBkaWZmZXJudGlhbGx5IGFjdGl2ZSBiZXR3ZWVuIHRoZSAzIGhlYXRtYXAgCiNjbHVzdGVycyBmcm9tIHBhdGllbnQgMQpkaWZmM19hdGFjIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9hdGFjX1RGc19kaWZmZXJlbnRpYWxseV9hY3RpdmVfaW5fSElWMSIpKVtbIngiXV0KCiMgbGlzdCBvZiBURnMgZGlmZmVybnRpYWxseSBhY3RpdmUgYmV0d2VlbiB0aGUgMyBoZWF0bWFwIGNsdXN0ZXJzIGZyb20gcGF0aWVudCAxCmRpZmYzIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS90b3RhbF9URnNfZGlmZmVyZW50aWFsbHlfYWN0aXZlX2luX0hJVjEiKSlbWyJ4Il1dCmBgYAoKCmBgYHtyLCBmaWcud2lkdGggPSAxMn0KcDEgPC0gZ2dWZW5uRGlhZ3JhbShsaXN0KGRpZmYzX2F0YWMsIGRpZmY0X2F0YWMsIGRpZmY1X2F0YWMpLAogICAgICAgICAgICAgIGxhYmVsX2FscGhhID0gMCwKICAgICAgICAgICAgICBjYXRlZ29yeS5uYW1lcz0gYygiayA9IDMiLCAiayA9IDQiLCAiayA9IDUiKSwKICAgICAgICAgICAgICAjc2V0LnNpemUgPSAyMCwKICAgICAgICAgICAgICBsYWJlbCA9ICJwZXJjZW50IiwKICAgICAgICAgICAgICBsYWJlbF9zaXplID0gNikgKwogICBzY2FsZV9maWxsX2Rpc3RpbGxlcihwYWxldHRlID0gIlJkQnUiKSArCiAgbGFicyh0aXRsZSA9ICJURnMgd2l0aCBkaWZmZXJlbnRpYWwgYmluZGluZyBzY29yZXMgaW4gQzIwIGNlbGwgbGluZSIpCiAgI3NjYWxlX2ZpbGxfZ3JhZGllbnQgKGxvdyA9ICJsaWdodGJsdWUiLCBoaWdoID0gImRhcmtibHVlIikKCnAyIDwtIGdnVmVubkRpYWdyYW0obGlzdChkaWZmMywgZGlmZjQsIGRpZmY1KSwKICAgICAgICAgICAgICBsYWJlbF9hbHBoYSA9IDAsCiAgICAgICAgICAgICAgY2F0ZWdvcnkubmFtZXM9IGMoImsgPSAzIiwgImsgPSA0IiwgImsgPSA1IiksCiAgICAgICAgICAgICAgbGFiZWwgPSAicGVyY2VudCIsCiAgICAgICAgICAgICAgbGFiZWxfc2l6ZSA9IDYpICsKICAgc2NhbGVfZmlsbF9kaXN0aWxsZXIocGFsZXR0ZSA9ICJSZEJ1IikgKwogIGxhYnModGl0bGUgPSAiYWxsIFRGcyB3aXRoIGRpZmZlcmVudCBhY3Rpdml0eSIpCgpmaWcgPC0gZ2dhcnJhbmdlKHAxLCBwMiwgbmNvbCA9IDIsIG5yb3cgPSAxKQphbm5vdGF0ZV9maWd1cmUoZmlnLCB0b3AgPSB0ZXh0X2dyb2IoIlRGcyB3aXRoIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGFjdGl2aXR5ICBiZXR3ZWVuIGNsdXN0ZXJzIGZvciBkaWZmZXJlbnQgayIsIHNpemUgPSAyMCkpCmBgYAoKCgojIDIuIFRyYW5zZmVyIHRoZSAzIGNsdXN0ZXIgaWRlbnRpdGl0ZXMgdG8gcGF0aWVudDIgYW5kIHBhdGllbnQzIHsudGFic2V0fQoKVGhlIGNsdXN0ZXIgaWRlbnRpdGllcyBmcm9tIHBhdGllbnQgMSB3ZXJlIHRyYW5zZmVycmVkIHRvIHBhdGllbnQgMiBhbmQgcGF0aWVudCAzCnRvIGFzc2lnbiBlYWNoIGNlbGwgdG8gb25lIG9mIHRoZSAzIGNsdXN0ZXJzLiAKCiMjIExhYmVsIFRyYW5zZmVyCgoqKkNsdXN0ZXIgYW5ub3RhdGlvbiB1c2luZyBhbiBpbnRlZ3JhdGVkIHJlZmVyZW5jZSoqCgpIZXJlIHdlIGRvIG5vdCBpbnRlZ3JhdGUgdGhlIGRhdGFzZXRzIGJlZm9yZWhhbmQgYW5kIHdlIGRvIG5vdCBtb2RpZnkgdGhlIHF1ZXJ5CmV4cHJlc3Npb24gZGF0YS4KCmBgYHsKSWRlbnRzKGhpdjcpIDwtICJjZWxsX3R5cGUiCmhpdiA8LSBzdWJzZXQoaGl2NywgaWRlbnRzID0gIk15ZWxvaWQyIikKCiMgdGhlIGNlbGwgdHlwZSBpcyByZXBsYWNlZCBieSB0aGUgaGVhdG1hcCBjbHVzdGVyCmhpdjFfbXkyIDwtIHN1YnNldChoaXY3LCBjZWxscyA9IGMoYzEsYzIsYzMpKQoKY2x1c3RlcnMgPC0gKAogIGhpdjFfbXkyQG1ldGEuZGF0YSAlPiUgCiAgcm93bmFtZXNfdG9fY29sdW1uKCJjZWxsIikgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gaWZlbHNlKGNlbGwgJWluJSBjMSwgImMxIiwgaWZlbHNlKGNlbGwgJWluJSBjMiwgImMyIiwgImMzIikpKSAlPiUgCiAgY29sdW1uX3RvX3Jvd25hbWVzKCJjZWxsIikpWyJodF9jbHVzdGVyIl0KCmhpdiA8LSBBZGRNZXRhRGF0YShoaXYsIG1ldGFkYXRhID0gY2x1c3RlcnMsIGNvbC5uYW1lID0gImNlbGxfdHlwZSIpCgojIHRoZSBzZXVyYXRfY2x1c3RlciBudW1iZXIgaXMgcmVwbGFjZWQgYnkgdGhlIG51bWJlciBvZiB0aGUgaGVhdG1hcCBjbHVzdGVyCnNldXJhdF9jbHVzdGVycyA8LSAoCiAgaGl2MV9teTJAbWV0YS5kYXRhICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgbXV0YXRlKGh0X2NsdXN0ZXIgPSBpZmVsc2UoY2VsbCAlaW4lIGMxLCAxLCBpZmVsc2UoY2VsbCAlaW4lIGMyLCAyLCAzKSkpICU+JSAKICBjb2x1bW5fdG9fcm93bmFtZXMoImNlbGwiKSlbImh0X2NsdXN0ZXIiXQoKaGl2IDwtIEFkZE1ldGFEYXRhKGhpdiwgbWV0YWRhdGEgPSBzZXVyYXRfY2x1c3RlcnMsIGNvbC5uYW1lID0gInNldXJhdF9jbHVzdGVycyIpCgoKIyBzcGxpdCB0aGUgb2JqZWN0IGFjY29yZGluZyB0byB0aGUgcGF0aWVudHMKaGl2X2xpc3QgPC0gU3BsaXRPYmplY3QoaGl2LCBzcGxpdC5ieSA9ICJvcmlnLmlkZW50IilbMzo1XQojIG5vcm1hbGl6ZSBlYWNoIG9iamVjdApmb3IgKGkgaW4gbmFtZXMoaGl2X2xpc3QpKSB7CiAgICBoaXZfbGlzdFtbaV1dIDwtIFNDVHJhbnNmb3JtKGhpdl9saXN0W1tpXV0sIHZlcmJvc2UgPSBGQUxTRSkKfQoKCiMgcGF0aWVudCAyIGFuZCBwYXRpZW50IDMgYXJlIG91ciBxdWVyeSBkYXRhc2V0cwpxdWVyeSA8LW1lcmdlKGhpdl9saXN0W1sxXV0sIGhpdl9saXN0W1szXV0pCnJlZmVyZW5jZSA8LSBoaXZfbGlzdFtbMl1dCnJlZmVyZW5jZSA8LSBSdW5QQ0EocmVmZXJlbmNlLCAKICAgICAgICAgICAgICAgICAgICAjIGJ5IGRlZmF1bHQgYSBwYXJ0aWFsIFBDQSBpcyBydW4sIGJ1dCB3ZSBjb21wdXRlIG1vc3RndWxhciB2YWx1ZXMgLT4gcnVuIHN0YW5kYXJkIFNWRCBpbnN0ZWFkCiAgICAgICAgICAgICAgICAgICAgYXBwcm94ID0gRkFMU0UsIAogICAgICAgICAgICAgICAgICAgIHZlcmJvc2UgPSBGQUxTRSkKCmhpdl9hbmNob3JzIDwtIEZpbmRUcmFuc2ZlckFuY2hvcnMocmVmZXJlbmNlID0gcmVmZXJlbmNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gcXVlcnksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpbXMgPSAxOjMwLCB2ZXJib3NlID0gRkFMU0UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgay5maWx0ZXIgPSBOQSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlLnJlZHVjdGlvbiA9ICJwY2EiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6YXRpb24ubWV0aG9kID0gIlNDVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkdWN0aW9uID0gInBjYXByb2plY3QiKQoKcHJlZGljdGlvbnMgPC0gVHJhbnNmZXJEYXRhKGFuY2hvcnNldCA9IGhpdl9hbmNob3JzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmRhdGEgPSByZWZlcmVuY2UkY2VsbF90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgay53ZWlnaHQgPSAzNCwgZGltcyA9IDE6MzAsIHZlcmJvc2UgPSBGQUxTRSkKCnF1ZXJ5IDwtIEFkZE1ldGFEYXRhKHF1ZXJ5LCBtZXRhZGF0YSA9IHByZWRpY3Rpb25zKQoKCmhpdjIgPC0gc3Vic2V0KHF1ZXJ5LCBvcmlnLmlkZW50ID09ICJISVYyX0NTRiIpCmhpdjMgPC0gc3Vic2V0KHF1ZXJ5LCBvcmlnLmlkZW50ID09ICJISVYzX0NTRiIpCiNzYXZlUkRTKGhpdjIsIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9zcmMvUmVwcm9kdWNlX0ZhcmhhZGlhbl9QYXBlci9TZXVyYXRfb2JqZWN0cy9oaXYyX0NTRl9teWxlb2lkMl9oZWF0bWFwX2NsdXN0ZXJfbGFiZWxfdHJhbnNmZXIucmRzIikKI3NhdmVSRFMoaGl2MywgIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9zcmMvUmVwcm9kdWNlX0ZhcmhhZGlhbl9QYXBlci9TZXVyYXRfb2JqZWN0cy9oaXYzX0NTRl9teWxlb2lkMl9oZWF0bWFwX2NsdXN0ZXJfbGFiZWxfdHJhbnNmZXIucmRzIikKYGBgCk5vdyB0aGF0IHdlIGhhdmUgdHJhbnNmZXJyZWQgdGhlIGNsdXN0ZXIgaWRlbnRpdGl0aWVzIHRvIHBhdGllbnQyIGFuZCBwYXRpZW50MwphbmQgc2F2ZWQgdGhlIHJlc3VsdHMgaW4gdHdvIHNlcGFyYXRlIFNldXJhdCBvYmplY3RzLCB3ZSBjYW4gYWRkIHRoZSBURiBhY3Rpdml0eSAKc2NvcmUgdG8gdGhlIG1ldGFkYXRhIG9mIGVhY2ggcGF0aWVudC4KCmBgYHtyfQpoaXYyIDwtIHJlYWRSRFMoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9zcmMvUmVwcm9kdWNlX0ZhcmhhZGlhbl9QYXBlci9TZXVyYXRfb2JqZWN0cy9oaXYyX0NTRl9teWxlb2lkMl9oZWF0bWFwX2NsdXN0ZXJfbGFiZWxfdHJhbnNmZXIucmRzIikKaGl2MyA8LSByZWFkUkRTKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvc3JjL1JlcHJvZHVjZV9GYXJoYWRpYW5fUGFwZXIvU2V1cmF0X29iamVjdHMvaGl2M19DU0ZfbXlsZW9pZDJfaGVhdG1hcF9jbHVzdGVyX2xhYmVsX3RyYW5zZmVyLnJkcyIpCgpoaXYyX3NjZW5pYyA8LSBBZGRNZXRhRGF0YShoaXYyLCBtZXRhZGF0YSA9IGF1Y19tdHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5uYW1lID0gY29sbmFtZXMoYXVjX210eCkpCmhpdjNfc2NlbmljIDwtIEFkZE1ldGFEYXRhKGhpdjMsIG1ldGFkYXRhID0gYXVjX210eCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLm5hbWUgPSBjb2xuYW1lcyhhdWNfbXR4KSkKYGBgCgojIyBQcmVkaWN0ZWQgY2x1c3RlciBsYWJlbHMKClRoZSBoZWF0bWFwcyBiZWxvdyBzaG93IHRoZSBwcmVkaWN0ZWQgY2x1c3RlcnMgZnJvbSBsYWJlbCB0cmFuc2ZlciBmb3IKcGF0aWVudCAyIGFuZCBwYXRpZW50IDMKClRoZSBjbHVzdGVycyBvYnRhaW5lZCBhZnRlciB0cmFuc2ZlcnJpbmcgdGhlIGNsdXN0ZXIgaWRlbnRpdGllcyBmcm9tIHBhdGllbnQgMSB0bwpwYXRpZW50MiBkbyBub3Qgc2VlbSB0byBiZSB2ZXJ5IGdvb2QgYXQgc2VwYXJhdGluZyBjZWxscyBhY2NvcmRpbmcgdG8gVEYgYWN0aXZpdHkuCgpXaGVuIHlvdSB0cmFuc2ZlciB0aGUgY2x1c3RlciBpZGVudGl0aWVzIGZyb20gcGF0aWVudDEgdG8gcGF0aWVudDMgYWxsIGNlbGxzLCBidXQKb25lLCBhcmUgYXNzaWduZWQgdG8gY2x1c3RlcjEuIFRoaXMgc2hvd3MgdGhhdCB0aGUgbGFiZWwgdHJhbnNmZXIgZGlkIG5vdCB3b3JrIAp2ZXJ5IHdlbGwuIFRoaXMgaXMgcHJvYmFibHkgZHVlIHRvIHRoZSBsb3cgbnVtYmVyIG9mIE15ZWxvaWQyIGNlbGxzIGluIGVhY2ggc2FtcGxlLgoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD0xN30KY2x1c3Rlcl9hbm5vIDwtIGFzLmRhdGEuZnJhbWUoaGl2MiRwcmVkaWN0ZWQuaWQpCgojbWFwKHNlcS5pbnQoMTo1KSwgZnVuY3Rpb24oayl7CmRmIDwtIGhpdjdAbWV0YS5kYXRhICU+JSBmaWx0ZXIoY2VsbF90eXBlID09ICJNeWVsb2lkMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSAiSElWMl9DU0YiKQojIHNlbGVjdCBvbmx5IHRoZSBjZWxscyBvZiB0aGUgYWN0aXZpdHkgbWF0cml4IHdoaWNoIGFyZSBteWVsb2lkMiBhbmQgdGhlIGNvcnJlY3QgcGF0aWVudAptdHggPC0gYXVjX210eFtyb3duYW1lcyhhdWNfbXR4KSAlaW4lIHJvd25hbWVzKGRmKSwgXQojIGhlYXRtYXAKc2V0LnNlZWQoMTIzKQpodF9oaXYyX2xhYmVsIDwtIEhlYXRtYXAodChtdHgpLCAKICAgICAgICAgICAgIGNvbHVtbl90aXRsZSA9ICJQcmVkaWN0ZWQgQ2x1c3RlcnMgZnJvbSBMYWJlbCBUcmFuc2ZlciBmb3IgSElWMl9DU0YiLCAgICAgICAgICAgICAKICAgICAgICAgICAgIGNvbHVtbl90aXRsZV9ncCA9IGdwYXIoZm9udHNpemUgPSAxNSksCiAgICAgICAgICAgICBjb2x1bW5fc3BsaXQgPSBwYXN0ZTAoImNsdXN0ZXIiLCBoaXYyJHByZWRpY3RlZC5pZCksI2NsdXN0ZXJfYW5ubywKICAgICAgICAgICAgICNjb2x1bW5fa20gPSA0LAogICAgICAgICAgICAgI2NvbHVtbl9rbV9yZXBlYXRzID0gMTAwLAogICAgICAgICAgICAgc2hvd19jb2x1bW5fbmFtZXMgPSBGQUxTRSwKICAgICAgICAgICAgIGNvbCA9Y29sb3JSYW1wUGFsZXR0ZShyZXYoYnJld2VyLnBhbChuID0gNywgbmFtZSA9ICJSZFlsQnUiKSkpKDEwMCksCiAgICAgICAgICAgICByaWdodF9hbm5vdGF0aW9uID0gbGEsCiAgICAgICAgICAgICB0b3BfYW5ub3RhdGlvbiA9IEhlYXRtYXBBbm5vdGF0aW9uKGRmID0gY2x1c3Rlcl9hbm5vLCBuYW1lID0gInByZWRpY3RlZCBjbHVzdGVyIikKICAgICAgICAgICAgICkgCiAgICAgICAgICAgICAjdG9wX2Fubm90YXRpb24gPSBjb2x1bW5fYW5ub3RhdGlvbikgCmBgYAoKCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MTd9CmNsdXN0ZXJfYW5ubyA8LSBhcy5kYXRhLmZyYW1lKGhpdjMkcHJlZGljdGVkLmlkKQoKI21hcChzZXEuaW50KDE6NSksIGZ1bmN0aW9uKGspewpkZiA8LSBoaXY3QG1ldGEuZGF0YSAlPiUgZmlsdGVyKGNlbGxfdHlwZSA9PSAiTXllbG9pZDIiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWcuaWRlbnQgPT0gIkhJVjNfQ1NGIikKIyBzZWxlY3Qgb25seSB0aGUgY2VsbHMgb2YgdGhlIGFjdGl2aXR5IG1hdHJpeCB3aGljaCBhcmUgbXllbG9pZDIgYW5kIHRoZSBjb3JyZWN0IHBhdGllbnQKbXR4IDwtIGF1Y19tdHhbcm93bmFtZXMoYXVjX210eCkgJWluJSByb3duYW1lcyhkZiksIF0KIyBoZWF0bWFwCnNldC5zZWVkKDEyMykKaHRfaGl2M19sYWJlbCA8LSBIZWF0bWFwKHQobXR4KSwgCiAgICAgICAgICAgICBjb2x1bW5fdGl0bGUgPSAiUHJlZGljdGVkIGNsdXN0ZXJzIGZyb20gTGFiZWwgVHJhbnNmZXIgZm9yIEhJVjNfQ1NGIiwgCiAgICAgICAgICAgICBjb2x1bW5fdGl0bGVfZ3AgPSBncGFyKGZvbnRzaXplID0gMTUpLAogICAgICAgICAgICAgY29sdW1uX3NwbGl0ID0gcGFzdGUwKCJjbHVzdGVyIiwgaGl2MyRwcmVkaWN0ZWQuaWQpLCNjbHVzdGVyX2Fubm8sCiAgICAgICAgICAgICAjY29sdW1uX2ttID0gNCwKICAgICAgICAgICAgICNjb2x1bW5fa21fcmVwZWF0cyA9IDEwMCwKICAgICAgICAgICAgIHNob3dfY29sdW1uX25hbWVzID0gRkFMU0UsCiAgICAgICAgICAgICBjb2wgPWNvbG9yUmFtcFBhbGV0dGUocmV2KGJyZXdlci5wYWwobiA9IDcsIG5hbWUgPSAiUmRZbEJ1IikpKSgxMDApLAogICAgICAgICAgICAgcmlnaHRfYW5ub3RhdGlvbiA9IGxhLAogICAgICAgICAgICAgdG9wX2Fubm90YXRpb24gPSBIZWF0bWFwQW5ub3RhdGlvbihkZiA9IGNsdXN0ZXJfYW5ubywgbmFtZSA9ICJwcmVkaWN0ZWQgY2x1c3RlciIpCiAgICAgICAgICAgICApIAogICAgICAgICAgICAgI3RvcF9hbm5vdGF0aW9uID0gY29sdW1uX2Fubm90YXRpb24pIAoKYGBgCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTIwfQpodF9saXN0IDwtIGh0X2hpdjJfbGFiZWwgKyBodF9oaXYzX2xhYmVsCmRyYXcoaHRfbGlzdCwgaHRfZ2FwPSB1bml0KDIsICJjbSIpKQpgYGAKCiMgMy4gSGllcmFyY2hpY2FsIGNsdXN0ZXJpbmcgZm9yIGFsbCAzIHBhdGllbnRzIHNlcGFyYXRlbHkgey50YWJzZXR9CgpTaW5jZSB0aGUgbGFiZWwgdHJhbnNmZXIgb2YgdGhlIDMgY2x1c3RlciBpZGVudGl0aWVzIGZyb20gcGF0aWVudDEgZGlkIG5vdCBzZWVtCnRvIHdvcmsgdmVyeSB3ZWxsLCB3ZSBuZXh0IHRyaWVkIHRvIHBlcmZvcm0gaGllcmFyY2hpY2FsIGNsdXN0ZXJpbmcgdXNpbmcgayA9IDMKZm9yIGFsbCAzIHBhdGllbnRzIHNlcGFyYXRlbHkuIFRoaXMgd2F5IHdlIG1pZ2h0IGJlIGFibGUgdG8gc2VlIGlmIHRoZSBURgphY3Rpdml0aWVzIGluIHRoZSAzIGNsdXN0ZXJzIHNob3cgc2ltaWxhciBwYXR0ZXJucyBhY3Jvc3MgdGhlIGRpZmZlcmVudCBwYXRpZW50cy4KCkluIHRoZSB0d28gaGVhdG1hcHMgYmVsb3cgdGhlIGNsdXN0ZXJzIGxvb2sgbW9yZSBzZW5zaWJsZSB0aGFuIHRoZSBjbHVzdGVycwpvYnNlcnZlZCBhZnRlciBjbHVzdGVyIGxhYmVsIHRyYW5zZmVyLgoKIyMgcGF0aWVudDIKKipLLW1lYW5zIGNsdXN0ZXJpbmcgd2l0aCBrID0gMyBmb3IgcGF0aWVudCAyKioKCiMjIyMgMS4gRHJhdyBIZWF0bWFwIGZvciBQYXRpZW50IDMKCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTIwfQojbWFwKHNlcS5pbnQoMTo1KSwgZnVuY3Rpb24oayl7CmRmIDwtIGhpdjdAbWV0YS5kYXRhICU+JSBmaWx0ZXIoY2VsbF90eXBlID09ICJNeWVsb2lkMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSAiSElWMl9DU0YiKQojIHNlbGVjdCBvbmx5IHRoZSBjZWxscyBvZiB0aGUgYWN0aXZpdHkgbWF0cml4IHdoaWNoIGFyZSBteWVsb2lkMiBhbmQgdGhlIGNvcnJlY3QgcGF0aWVudAptdHggPC0gYXVjX210eFtyb3duYW1lcyhhdWNfbXR4KSAlaW4lIHJvd25hbWVzKGRmKSwgXQojIGhlYXRtYXAKc2V0LnNlZWQoMTIzKQpodDIgPC0gSGVhdG1hcCh0KG10eCksIAogICAgICAgICAgICAgY29sdW1uX3RpdGxlID0gIlBhdGllbnQgMiwgSElWMl9DU0YiLCAKICAgICAgICAgICAgIGNvbHVtbl90aXRsZV9ncCA9IGdwYXIoZm9udHNpemUgPSAxNSksCiAgICAgICAgICAgICAjY29sdW1uX3NwbGl0ID0gcGFzdGUwKCJjbHVzdGVyIiwgaGl2MiRwcmVkaWN0ZWQuaWQpLCNjbHVzdGVyX2Fubm8sCiAgICAgICAgICAgICBjb2x1bW5fa20gPSAzLAogICAgICAgICAgICAgY29sdW1uX2ttX3JlcGVhdHMgPSAxMDAsCiAgICAgICAgICAgICBzaG93X2NvbHVtbl9uYW1lcyA9IEZBTFNFLAogICAgICAgICAgICAgY29sID1jb2xvclJhbXBQYWxldHRlKHJldihicmV3ZXIucGFsKG4gPSA3LCBuYW1lID0gIlJkWWxCdSIpKSkoMTAwKSwKICAgICAgICAgICAgIHJpZ2h0X2Fubm90YXRpb24gPSBsYSwKICAgICAgICAgICAgICN0b3BfYW5ub3RhdGlvbiA9IEhlYXRtYXBBbm5vdGF0aW9uKGRmID0gY2x1c3Rlcl9hbm5vLCBuYW1lID0gInByZWRpY3RlZCBjbHVzdGVyIikKICAgICAgICAgICAgICkgCiAgICAgICAgICAgICAjdG9wX2Fubm90YXRpb24gPSBjb2x1bW5fYW5ub3RhdGlvbikgCmh0X3BhdDIgPC0gZHJhdyhodDIpCgpgYGAKCgoKIyMjIyAyLiBLcnVza2FsX1dhbGxpcyBUZXN0IFBhdGllbnQyIAoKYGBge3J9CiMgZXh0cmFjdCB0aGUgY2VsbHMgZnJvbSB0aGUgMyBjbHVzdGVycyAKIyBnZXQgdGhlIGNlbGwgbmFtZXMgb2YgY2x1c3RlciBvbmUKYzEgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0X3BhdDIpW1sxXV0sXSkpCiMgZ2V0IHRoZSBjZWxsIG5hbWVzIG9mIGNsdXN0ZXIgdHdvCmMyIDwtIGNvbG5hbWVzKHQobXR4W2NvbHVtbl9vcmRlcihodF9wYXQyKVtbMl1dLF0pKQojIGdldCB0aGUgY2VsbCBuYW1lcyBvZiBjbHVzdGVyIDMKYzMgPC0gY29sbmFtZXModChtdHhbY29sdW1uX29yZGVyKGh0X3BhdDIpW1szXV0sXSkpCgoKIyBhZGQgY2x1c3RlciBpZGVudGl0aWVzIHRvIFNldXJhdCBvYmplY3QgbWV0YWRhdGEgYW5kIHJldHVybiBtZXRhZGF0YSBhcyBkYXRhZnJhbWUKcGF0MiA8LSBoaXY3X3NjZW5pY0BtZXRhLmRhdGEgJT4lIHJvd25hbWVzX3RvX2NvbHVtbigiY2VsbCIpCnBhdDIgPC0gcGF0MiAlPiUgCiAgZmlsdGVyKG9yaWcuaWRlbnQgPT0gIkhJVjJfQ1NGIiwKICAgICAgICAgY2VsbF90eXBlID09ICJNeWVsb2lkMiIsCiAgICAgICAgIGNlbGwgJWluJSBjKGMxLGMyLGMzKSkgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gaWZlbHNlKGNlbGwgJWluJSBjMSwgImMxIiwgaWZlbHNlKGNlbGwgJWluJSBjMiwgImMyIiwgImMzIikpKSAKCgojIGNoZWNrIGFsbCAxMjUgVEZzCiMgY2hlY2sgYWxsIFRGcyAKcF92YWx1ZXMgPC0gbWFwKHNlcS5pbnQoMToxMjUpLCBmdW5jdGlvbihuKXsKICB0ZiA8LSBjb2xuYW1lcyhhdWNfbXR4KVtuXQogIHBfdmFsdWVzIDwtIHVubGlzdChrcnVza2FsLnRlc3QocHVsbChwYXQyW3RmXSkgfiBodF9jbHVzdGVyLCBwYXQyKSlbInAudmFsdWUiXQogICNsaXN0KHRmID0gdGYsIHBfdmFsdWUgPSBwX3ZhbHVlcykKfSkKCgojIGFkanVzdCBmb3IgbXVsdGlwbGUgdGVzdGluZyB3aXRoIEZEUgphZGpfcF92YWx1ZXMgPC0gcC5hZGp1c3QoYXMubnVtZXJpYyh1bm5hbWUodW5saXN0KHBfdmFsdWVzKSkpLCBtZXRob2QgPSAiZmRyIikKbGVuZ3RoKGFkal9wX3ZhbHVlc1thZGpfcF92YWx1ZXM8MC4wNV0pCiMjIFsxXSA2NgoKIyBnZXQgdGhlIFRGcyB0YWh0IGFyZSBkaWZmZXJudGlhbGx5IGFjdGl2ZQpkaWZmX2hpdjIgPC0gY29sbmFtZXMoYXVjX210eClbYWRqX3BfdmFsdWVzIDwgMC4wNV0KCgojIGNoZWNrIDI0IFRGcyB3aXRoIEtydXNrYWwgV2FsbGlzIHRlc3QKcF92YWx1ZXMgPC0gbWFwKHNlcS5pbnQoMToyNCksIGZ1bmN0aW9uKG4pewogIHRmIDwtIG92ZXJsYXBfYXRhYyRuYW1lW25dCiAgcF92YWx1ZXMgPC0gdW5saXN0KGtydXNrYWwudGVzdChwdWxsKHBhdDJbdGZdKSB+IGh0X2NsdXN0ZXIsIHBhdDIpKVsicC52YWx1ZSJdCn0pCiNzaWduX3BfdmFsdWVzIDwtIHBfdmFsdWVzW3BfdmFsdWVzIDwgMC4wMV0KCiMgYWRqdXN0IGZvciBtdWx0aXBsZSBoeXBvdGhlc2lzIHRlc3RpbmcKYWRqX3BfdmFsdWVzIDwtIHAuYWRqdXN0KGFzLm51bWVyaWModW5uYW1lKHVubGlzdChwX3ZhbHVlcykpKSwgbWV0aG9kID0gImZkciIpCgoKIyBob3cgbWFueSB0cmFuc2NyaXB0aW9uIGZhY3RvcnMgYXJlIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGJldHdlZW4gdGhlIGNsdXN0ZXJzPwpsZW5ndGgoYWRqX3BfdmFsdWVzW2Fkal9wX3ZhbHVlczwwLjA1XSkKIyMgWzFdIDE4CgojIGdldCB0aGUgVEZzIHRoYXQgYXJlIGRpZmZlcmVudGlhbGx5IGV4cHJlc3NlZApoaXYyX2F0YWMgPC0gb3ZlcmxhcF9hdGFjJG5hbWVbYWRqX3BfdmFsdWVzIDwgLjA1XQpgYGAKCiMjIHBhdGllbnQgMwoKKipLLW1lYW5zIGNsdXN0ZXJpbmcgd2l0aCBrID0gMyBmb3IgcGF0aWVudCAzKioKCiMjIyMgMS4gRHJhdyBIZWF0bWFwIGZvciBQYXRpZW50IDMKCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MjB9CmRmIDwtIGhpdjdAbWV0YS5kYXRhICU+JSBmaWx0ZXIoY2VsbF90eXBlID09ICJNeWVsb2lkMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSAiSElWM19DU0YiKQojIHNlbGVjdCBvbmx5IHRoZSBjZWxscyBvZiB0aGUgYWN0aXZpdHkgbWF0cml4IHdoaWNoIGFyZSBteWVsb2lkMiBhbmQgdGhlIGNvcnJlY3QgcGF0aWVudAptdHggPC0gYXVjX210eFtyb3duYW1lcyhhdWNfbXR4KSAlaW4lIHJvd25hbWVzKGRmKSwgXQojIGhlYXRtYXAKc2V0LnNlZWQoMTIzKQpodDMgPC0gSGVhdG1hcCh0KG10eCksIAogICAgICAgICAgICAgY29sdW1uX3RpdGxlID0gIlBhdGllbnQgMywgSElWM19DU0YiLCAKICAgICAgICAgICAgIGNvbHVtbl90aXRsZV9ncCA9IGdwYXIoZm9udHNpemUgPSAxNSksCiAgICAgICAgICAgICAjY29sdW1uX3NwbGl0ID0gcGFzdGUwKCJjbHVzdGVyIiwgaGl2MiRwcmVkaWN0ZWQuaWQpLCNjbHVzdGVyX2Fubm8sCiAgICAgICAgICAgICBjb2x1bW5fa20gPSAzLAogICAgICAgICAgICAgY29sdW1uX2ttX3JlcGVhdHMgPSAxMDAsCiAgICAgICAgICAgICBzaG93X2NvbHVtbl9uYW1lcyA9IEZBTFNFLAogICAgICAgICAgICAgY29sID1jb2xvclJhbXBQYWxldHRlKHJldihicmV3ZXIucGFsKG4gPSA3LCBuYW1lID0gIlJkWWxCdSIpKSkoMTAwKSwKICAgICAgICAgICAgIHJpZ2h0X2Fubm90YXRpb24gPSBsYSwKICAgICAgICAgICAgICN0b3BfYW5ub3RhdGlvbiA9IEhlYXRtYXBBbm5vdGF0aW9uKGRmID0gY2x1c3Rlcl9hbm5vLCBuYW1lID0gInByZWRpY3RlZCBjbHVzdGVyIikKICAgICAgICAgICAgICkgCiAgICAgICAgICAgICAjdG9wX2Fubm90YXRpb24gPSBjb2x1bW5fYW5ub3RhdGlvbikgaWNoCmh0X3BhdDMgPC0gZHJhdyhodDMpCmBgYAoKCiMjIyMgMi4gS3J1c2thbC1XYWxsaXMgdGVzdCBQYXRpZW50IDMKCmBgYHtyfQojIGV4dHJhY3QgdGhlIGNlbGxzIGZyb20gdGhlIDMgY2x1c3RlcnMgCiMgZ2V0IHRoZSBjZWxsIG5hbWVzIG9mIGNsdXN0ZXIgb25lCmMxIDwtIGNvbG5hbWVzKHQobXR4W2NvbHVtbl9vcmRlcihodF9wYXQzKVtbMV1dLF0pKQojIGdldCB0aGUgY2VsbCBuYW1lcyBvZiBjbHVzdGVyIHR3bwpjMiA8LSBjb2xuYW1lcyh0KG10eFtjb2x1bW5fb3JkZXIoaHRfcGF0MylbWzJdXSxdKSkKIyBnZXQgdGhlIGNlbGwgbmFtZXMgb2YgY2x1c3RlciAzCmMzIDwtIGNvbG5hbWVzKHQobXR4W2NvbHVtbl9vcmRlcihodF9wYXQzKVtbM11dLF0pKQoKCiMgYWRkIGNsdXN0ZXIgaWRlbnRpdGllcyB0byBTZXVyYXQgb2JqZWN0IG1ldGFkYXRhIGFuZCByZXR1cm4gbWV0YWRhdGEgYXMgZGF0YWZyYW1lCnBhdDMgPC0gaGl2N19zY2VuaWNAbWV0YS5kYXRhICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgZmlsdGVyKG9yaWcuaWRlbnQgPT0gIkhJVjNfQ1NGIiwKICAgICAgICAgY2VsbF90eXBlID09ICJNeWVsb2lkMiIsCiAgICAgICAgIGNlbGwgJWluJSBjKGMxLGMyLGMzKSkgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gaWZlbHNlKGNlbGwgJWluJSBjMSwgImMxIiwgaWZlbHNlKGNlbGwgJWluJSBjMiwgImMyIiwgImMzIikpKSAKCgojIGNoZWNrIGFsbCAxMjUgVEZzCiMgY2hlY2sgYWxsIFRGcyAKcF92YWx1ZXMgPC0gbWFwKHNlcS5pbnQoMToxMjUpLCBmdW5jdGlvbihuKXsKICB0ZiA8LSBjb2xuYW1lcyhhdWNfbXR4KVtuXQogIHBfdmFsdWVzIDwtIHVubGlzdChrcnVza2FsLnRlc3QocHVsbChwYXQzW3RmXSkgfiBodF9jbHVzdGVyLCBwYXQzKSlbInAudmFsdWUiXQogICNsaXN0KHRmID0gdGYsIHBfdmFsdWUgPSBwX3ZhbHVlcykKfSkKCgojIGFkanVzdCBmb3IgbXVsdGlwbGUgdGVzdGluZyB3aXRoIEZEUgphZGpfcF92YWx1ZXMgPC0gcC5hZGp1c3QoYXMubnVtZXJpYyh1bm5hbWUodW5saXN0KHBfdmFsdWVzKSkpLCBtZXRob2QgPSAiZmRyIikKbGVuZ3RoKGFkal9wX3ZhbHVlc1thZGpfcF92YWx1ZXM8MC4wNV0pCiMjIFsxXSA2NgoKIyBnZXQgdGhlIFRGcyB0YWh0IGFyZSBkaWZmZXJudGlhbGx5IGFjdGl2ZQpkaWZmX2hpdjMgPC0gY29sbmFtZXMoYXVjX210eClbYWRqX3BfdmFsdWVzIDwgMC4wNV0KCgojIGNoZWNrIDI0IFRGcyB3aXRoIEtydXNrYWwgV2FsbGlzIHRlc3QKcF92YWx1ZXMgPC0gbWFwKHNlcS5pbnQoMToyNCksIGZ1bmN0aW9uKG4pewogIHRmIDwtIG92ZXJsYXBfYXRhYyRuYW1lW25dCiAgcF92YWx1ZXMgPC0gdW5saXN0KGtydXNrYWwudGVzdChwdWxsKHBhdDNbdGZdKSB+IGh0X2NsdXN0ZXIsIHBhdDMpKVsicC52YWx1ZSJdCn0pCiNzaWduX3BfdmFsdWVzIDwtIHBfdmFsdWVzW3BfdmFsdWVzIDwgMC4wMV0KCiMgYWRqdXN0IGZvciBtdWx0aXBsZSBoeXBvdGhlc2lzIHRlc3RpbmcKYWRqX3BfdmFsdWVzIDwtIHAuYWRqdXN0KGFzLm51bWVyaWModW5uYW1lKHVubGlzdChwX3ZhbHVlcykpKSwgbWV0aG9kID0gImZkciIpCgoKIyBob3cgbWFueSB0cmFuc2NyaXB0aW9uIGZhY3RvcnMgYXJlIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGJldHdlZW4gdGhlIGNsdXN0ZXJzPwpsZW5ndGgoYWRqX3BfdmFsdWVzW2Fkal9wX3ZhbHVlczwwLjA1XSkKIyMgWzFdIDE4CgojIGdldCB0aGUgVEZzIHRoYXQgYXJlIGRpZmZlcmVudGlhbGx5IGV4cHJlc3NlZApoaXYzX2F0YWMgPC0gb3ZlcmxhcF9hdGFjJG5hbWVbYWRqX3BfdmFsdWVzIDwgLjA1XQpgYGAKCgojIyBjb21wYXJpc29uIGJldHdlZW4gYWxsIDMgcGF0aWVudHMKCiMjIyMgSGVhdG1hcHMgb2Ygay1tZWFucyBjbHVzdGVyaW5nIHdpdGggayA9IDMgZm9yIGFsbCB0aHJlZSBwYXRpZW50cwoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD0xN30KIyBwYXRpZW50IDEKZGYgPC0gaGl2N0BtZXRhLmRhdGEgJT4lIGZpbHRlcihjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ID09ICJISVYxX0NTRiIpCiMgc2VsZWN0IG9ubHkgdGhlIGNlbGxzIG9mIHRoZSBhY3Rpdml0eSBtYXRyaXggd2hpY2ggYXJlIG15ZWxvaWQyIGFuZCB0aGUgY29ycmVjdCBwYXRpZW50Cm10eCA8LSBhdWNfbXR4W3Jvd25hbWVzKGF1Y19tdHgpICVpbiUgcm93bmFtZXMoZGYpLCBdCiMgaGVhdG1hcApzZXQuc2VlZCgxMjMpCmh0MSA8LSBIZWF0bWFwKHQobXR4KSwgCiAgICAgICAgICAgICBjb2x1bW5fdGl0bGUgPSAiUGF0aWVudCAxLCBISVYxX0NTRiIsIAogICAgICAgICAgICAgY29sdW1uX3RpdGxlX2dwID0gZ3Bhcihmb250c2l6ZSA9IDE1KSwKICAgICAgICAgICAgIGNvbHVtbl9rbSA9IDMsCiAgICAgICAgICAgICBjb2x1bW5fa21fcmVwZWF0cyA9IDEwMCwKICAgICAgICAgICAgIHNob3dfY29sdW1uX25hbWVzID0gRkFMU0UsCiAgICAgICAgICAgICBjb2wgPWNvbG9yUmFtcFBhbGV0dGUocmV2KGJyZXdlci5wYWwobiA9IDcsIG5hbWUgPSAiUmRZbEJ1IikpKSgxMDApLAogICAgICAgICAgICAgcmlnaHRfYW5ub3RhdGlvbiA9IGxhCiAgICAgICAgICAgICApCiAgICAgICAgICAgICAjdG9wX2Fubm90YXRpb24gPSBjb2x1bW5fYW5ub3RhdGlvbikgCmBgYAoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD0yMH0KaHRfbGlzdCA8LSBodDEgKyBodDIgKyBodDMKZHJhdyhodF9saXN0LCBodF9nYXA9IHVuaXQoMiwgImNtIiksIAogICAgIGNvbHVtbl90aXRsZSA9ICJJbmRlcGVuZGVudCBrLW1lYW5zIGNsdXN0ZXJpbmcgKGsgPSAzKSBmb3IgYWxsIHBhdGllbnRzIiwKICAgICBjb2x1bW5fdGl0bGVfZ3AgPSBncGFyKGZvbnRzaXplID0gMjApICkKYGBgCgojIHstfQoKIyMgV2hpY2ggVEZzIHNob3cgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiB0aGUgY2x1c3RlcnMgYWNyb3NzIHBhdGllbnRzPwoKU2luY2UgdGhlIGluZGVwZW5kZW50IGhpZXJhcmNoaWNhbCBjbHVzdGVyaW5nIGZvciBhbGwgdGhyZWUgcGF0aWVudHMgeWllbGRzIApjbHVzdGVycyB3aGljaCBsb29rIG1vcmUgcmVhc29uYWJsZSwgd2Ugd2lsbCBjb21wYXJlIHRoZSB0aHJlZSBjbHVzdGVycyB3ZSBvYnRhaW4gCmFjcm9zcyB0aGUgdGhyZWUgcGF0aWVudHMgdG8gc2VlIGlmIHRoZXJlIGlzIGEgcGF0dGVybiBiZXR3ZWVuIHRoZW0uIAoKV2UgYWxyZWFkeSBzYXcgdGhhdCB0aGVyZSBhcmUgYSBmZXcgVEZzIHdoaWNoIHNob3cgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQKYWN0aXZpdHkgYmV0d2VlbiB0aGUgY2x1c3RlcnMgaW4gcGF0aWVudDEuCgpOZXh0LCB3ZSB3YW50IHRvIHNlZSBpZiB0aGUgc2FtZSBncm91cCBvZiBURnMgY2hhcmFjdGVyaXplIHRoZSB0aHJlZSAKY2x1c3RlcnMgaW4gYWxsIHRocmVlIHBhdGllbnRzIG9yIGlmIHRoZXkgYXJlIGRpZmZlcmVudC4gCldlIHdpbGwgdGVzdCB3aGljaCBURnMgYXJlIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGJldHdlZW4gY2x1c3RlcnMgYW5kIHRoZW4KdXNlIGEgcGFpcndpc2UgV2lsY294IHRlc3QgdG8gZGV0ZXJtaW5lIHdoaWNoIGNsdXN0ZXJzIGFyZSBkaWZmZXJlbnQuCgoKIyMjIEFyZSBURnMgZGlmZmVyZW50aWF0aW5nIHRoZSB0aHJlZSBjbHVzdGVycyBzaW1pbGFyIGFjcm9zcyBhbGwgdGhyZWUgcGF0aWVudHM/CgpJbiB0aGUgVmVubiBkaWFncmFtIGJlbG93IGl0IGNhbiBiZSBzZWVuIHRoYXQgNDYgd2l0aCBzaWduaWZpY2FudGx5IGRpZmZlcmVudAphY3Rpdml0aWVzIGJldHdlZW4gY2x1c3RlcnMgb3ZlcmxhcCBhY3Jvc3MgcGF0aWVudHMuCgpBZGRpdGlvbmFsbHksIGVsZXZlbiBvZiB0aGUgVEZzIGZvdW5kIHRvIGhhdmUgZGlmZmVyZW50aWFsIGJpbmRpbmcgc2NvcmVzIGJldHdlZW4KaW5mZWN0aW9uIGNvbmRpdGlvbnMgaW4gQzIwIG1pY3JvZ2xpYSBjZWxsIGxpbmUgc2hvdyBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiB0aGUgCnRocmVlIGNsdXN0ZXJzIGFjcm9zcyBhbGwgcGF0aWVudHMuIFRoZXNlIGFyZSB0aGUgVEZzIHdlIGFyZSBtb3N0IGludGVyZXN0ZWQgaW4sCnNpbmNlIHdlIHdhbnQgdG8gc2VlIGlmIHdlIGNhbiBmaW5kIHBhdHRlcm5zIHRoYXQgY29ycmVsYXRlIHdpdGggdGhlIGJpbmRpbmcgCnNjb3JlcyBpbiBDMjAgbWljcm9nbGlhLgoKYGBge3J9CnAxIDwtIGdnVmVubkRpYWdyYW0obGlzdChoaXYxX2RpZmYsIGRpZmZfaGl2MiwgZGlmZl9oaXYzKSwKICAgICAgICAgICAgICBsYWJlbF9hbHBoYSA9IDAsCiAgICAgICAgICAgICAgY2F0ZWdvcnkubmFtZXM9IGMoIkhJVjEiLCAiSElWMiIsICJISVYzIiksCiAgICAgICAgICAgICAgI3NldC5zaXplID0gMjAsCiAgICAgICAgICAgICAgbGFiZWwgPSAiY291bnQiLAogICAgICAgICAgICAgIGxhYmVsX3NpemUgPSA2KSArCiAgIHNjYWxlX2ZpbGxfZGlzdGlsbGVyKHBhbGV0dGUgPSAiUmRCdSIpICsKICBsYWJzKHRpdGxlID0gIlRGIChBVEFDLXNlcSkgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYmV0d2VlbiAzIGNsdXN0ZXJzIikKYGBgCgpgYGB7cn0KcDIgPC0gZ2dWZW5uRGlhZ3JhbShsaXN0KGhpdjFfYXRhYywgaGl2Ml9hdGFjLCBoaXYzX2F0YWMpLAogICAgICAgICAgICAgIGxhYmVsX2FscGhhID0gMCwKICAgICAgICAgICAgICBjYXRlZ29yeS5uYW1lcz0gYygiSElWMSIsICJISVYyIiwgIkhJVjMiKSwKICAgICAgICAgICAgICAjc2V0LnNpemUgPSAyMCwKICAgICAgICAgICAgICBsYWJlbCA9ICJjb3VudCIsCiAgICAgICAgICAgICAgbGFiZWxfc2l6ZSA9IDYpICsKICAgc2NhbGVfZmlsbF9kaXN0aWxsZXIocGFsZXR0ZSA9ICJSZEJ1IikgKwogIGxhYnModGl0bGUgPSAiVEYgKEFUQUMtc2VxKSBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBiZXR3ZWVuIDMgY2x1c3RlcnMiKQpgYGAKCmBgYHtyfQpnZ2FycmFuZ2UocDEsIHAyLCBuY29sID0gMiwgbnJvdyA9IDEpCmBgYAoKCiMjIDExIFRGcyBzaG93IGRpZmZlcmVudCBhY3Rpdml0eSBpbiBvbmUgb2YgdGhlIHRocmVlIGNsdXN0ZXJzIHsudGFic2V0fQoKSW4gdGhlIGJveHBsb3RzIGJlbG93IGl0IGNhbiBiZSBzZWVuIHRoYXQgaW4gYWxsIHRocmVlIHBhdGllbnRzIHRoZXJlIHNlZW1zIHRvCmJlIG9uZSBjbHVzdGVyIHdoaWNoIGlzIGRpZmZlcmVudCBmcm9tIHR3byBvdGhlciBjbHVzdGVycy4gCgpgYGB7cn0KaW50ZXJzZWN0IDwtIHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2ludGVyc2VjdF9URnNfZGlmZmVyZW50X2Fjcm9zc19wYXRpZW50c18zX2NsdXN0ZXJzIilbWyJ4Il1dCmBgYAoKCiMjIyBQYXRpZW50IDEKCmBgYHtyLCBmaWcud2lkdGg9MjUsIGZpZy5oZWlnaHQ9MTB9CmRmIDwtIGszX2RmCgoKYm94cGxvdF9saXN0IDwtIG1hcChpbnRlcnNlY3QsIGZ1bmN0aW9uKHRmKSB7CiAgZ2dwbG90KCkgKwogICAgZ2VvbV9ib3hwbG90KGFlcyh4ID0gZGYgJT4lIHB1bGwoImh0X2NsdXN0ZXIiKSwgeSA9IGRmICU+JSBwdWxsKHRmKSwKICAgICAgICAgICAgICAgICAgICAgZmlsbCA9IGRmICU+JSBwdWxsKCJodF9jbHVzdGVyIikpKSArCiAgICBzdGF0X3B2YWx1ZV9tYW51YWwoZGYgJT4lIAogICAgICAgICAgICAgICAgICAgICAgICBwYWlyd2lzZV93aWxjb3hfdGVzdChhcy5mb3JtdWxhKHBhc3RlMCh0ZiwgIiB+IGh0X2NsdXN0ZXIiKSkpICU+JSAKICAgICAgICAgICAgICAgICAgICAgICAgIGFkZF94eV9wb3NpdGlvbigpKSArCiAgICB4bGFiKCJoZWF0bWFwIGNsdXN0ZXIiKSArCiAgICB5bGFiKHBhc3RlMCh0ZikpICsKICAgIGd1aWRlcyhmaWxsID0gZ3VpZGVfbGVnZW5kKHRpdGxlID0gImhlYXRtYXAgY2x1c3RlciIpKQp9KQoKZG8uY2FsbChncmlkRXh0cmE6OmdyaWQuYXJyYW5nZSwgYyhib3hwbG90X2xpc3QsIG5jb2wgPSA0LCBucm93ID0gMykpCgojYW5ub3RhdGVfZmlndXJlKGZpZ3VyZSwgdG9wID0gdGV4dF9ncm9iKCJQYXRpZW50IDEgLSBDU0YgICAgIGsgPSAzIGZvciBrLW1lYW5zIGNsdXN0ZXJpbmcgKFRGcyBmcm9tIEFUQUMtc2VxKSIsIAogIyAgICAgICAgICAgICAgY29sb3IgPSAiYmxhY2siLCBmYWNlID0gImJvbGQiLCBzaXplID0gMjUpKQpgYGAKCmBgYHtyfQpjdGNmMSA8LSBnZ3Bsb3QoZGYsIGFlcyh4ID0gaHRfY2x1c3RlciwgeSA9IENUQ0YpKSArCiAgZ2VvbV9ib3hwbG90KGFlcyhmaWxsID0gaHRfY2x1c3RlcikpICsKICBzdGF0X3B2YWx1ZV9tYW51YWwoZGYgJT4lIAogICAgICAgICAgICAgICAgICAgICAgIHBhaXJ3aXNlX3dpbGNveF90ZXN0KENUQ0YgfiBodF9jbHVzdGVyKSAlPiUgCiAgICAgICAgICAgICAgICAgICAgICAgYWRkX3h5X3Bvc2l0aW9uKCkpCmN0Y2YxIDwtIGN0Y2YxICsgbGFicyh0aXRsZSA9ICJDVENGIGFjdGl2aXR5IGluIHBhdGllbnQgMSIpCmBgYAoKIyMjIFBhdGllbnQgMgoKYGBge3IsIGZpZy53aWR0aD0yNSwgZmlnLmhlaWdodD0xMH0KZGYgPC0gcGF0MgoKYm94cGxvdF9saXN0IDwtIG1hcChpbnRlcnNlY3QsIGZ1bmN0aW9uKHRmKSB7CiAgZ2dwbG90KCkgKwogICAgZ2VvbV9ib3hwbG90KGFlcyh4ID0gZGYgJT4lIHB1bGwoImh0X2NsdXN0ZXIiKSwgeSA9IGRmICU+JSBwdWxsKHRmKSwKICAgICAgICAgICAgICAgICAgICAgZmlsbCA9IGRmICU+JSBwdWxsKCJodF9jbHVzdGVyIikpKSArCiAgICBzdGF0X3B2YWx1ZV9tYW51YWwoZGYgJT4lIAogICAgICAgICAgICAgICAgICAgICAgICBwYWlyd2lzZV93aWxjb3hfdGVzdChhcy5mb3JtdWxhKHBhc3RlMCh0ZiwgIiB+IGh0X2NsdXN0ZXIiKSkpICU+JSAKICAgICAgICAgICAgICAgICAgICAgICAgIGFkZF94eV9wb3NpdGlvbigpKSArCiAgICB4bGFiKCJoZWF0bWFwIGNsdXN0ZXIiKSArCiAgICB5bGFiKHBhc3RlMCh0ZikpICsKICAgIGd1aWRlcyhmaWxsID0gZ3VpZGVfbGVnZW5kKHRpdGxlID0gImhlYXRtYXAgY2x1c3RlciIpKQp9KQoKZG8uY2FsbChncmlkRXh0cmE6OmdyaWQuYXJyYW5nZSwgYyhib3hwbG90X2xpc3QsIG5jb2wgPSA0LCBucm93ID0gMykpCgojYW5ub3RhdGVfZmlndXJlKGZpZ3VyZSwgdG9wID0gdGV4dF9ncm9iKCJQYXRpZW50IDIgLSBDU0YgICAgIGsgPSAzIGZvciBrLW1lYW5zIGNsdXN0ZXJpbmcgKFRGcyBmcm9tIEFUQUMtc2VxKSIsIAogIyAgICAgICAgICAgICAgY29sb3IgPSAiYmxhY2siLCBmYWNlID0gImJvbGQiLCBzaXplID0gMjUpKQpgYGAKCmBgYHtyfQpjdGNmMiA8LSBnZ3Bsb3QoZGYsIGFlcyh4ID0gaHRfY2x1c3RlciwgeSA9IENUQ0YpKSArCiAgZ2VvbV9ib3hwbG90KGFlcyhmaWxsID0gaHRfY2x1c3RlcikpICsKICBzdGF0X3B2YWx1ZV9tYW51YWwoZGYgJT4lIAogICAgICAgICAgICAgICAgICAgICAgIHBhaXJ3aXNlX3dpbGNveF90ZXN0KENUQ0YgfiBodF9jbHVzdGVyKSAlPiUgCiAgICAgICAgICAgICAgICAgICAgICAgYWRkX3h5X3Bvc2l0aW9uKCkpCmN0Y2YyIDwtIGN0Y2YyICsgbGFicyh0aXRsZSA9ICJDVENGIGFjdGl2aXR5IGluIHBhdGllbnQgMiIpCmBgYAoKIyMjIFBhdGllbnQgMwoKYGBge3IsIGZpZy53aWR0aD0yNSwgZmlnLmhlaWdodD0xMH0KZGYgPC0gcGF0MwoKYm94cGxvdF9saXN0IDwtIG1hcChpbnRlcnNlY3QsIGZ1bmN0aW9uKHRmKSB7CiAgZ2dwbG90KCkgKwogICAgZ2VvbV9ib3hwbG90KGFlcyh4ID0gZGYgJT4lIHB1bGwoImh0X2NsdXN0ZXIiKSwgeSA9IGRmICU+JSBwdWxsKHRmKSwKICAgICAgICAgICAgICAgICAgICAgZmlsbCA9IGRmICU+JSBwdWxsKCJodF9jbHVzdGVyIikpKSArCiAgICBzdGF0X3B2YWx1ZV9tYW51YWwoZGYgJT4lIAogICAgICAgICAgICAgICAgICAgICAgICBwYWlyd2lzZV93aWxjb3hfdGVzdChhcy5mb3JtdWxhKHBhc3RlMCh0ZiwgIiB+IGh0X2NsdXN0ZXIiKSkpICU+JSAKICAgICAgICAgICAgICAgICAgICAgICAgIGFkZF94eV9wb3NpdGlvbigpKSArCiAgICB4bGFiKCJoZWF0bWFwIGNsdXN0ZXIiKSArCiAgICB5bGFiKHBhc3RlMCh0ZikpICsKICAgIGd1aWRlcyhmaWxsID0gZ3VpZGVfbGVnZW5kKHRpdGxlID0gImhlYXRtYXAgY2x1c3RlciIpKQp9KQoKZG8uY2FsbChncmlkRXh0cmE6OmdyaWQuYXJyYW5nZSwgYyhib3hwbG90X2xpc3QsIG5jb2wgPSA0LCBucm93ID0gMykpCgoKI2Fubm90YXRlX2ZpZ3VyZShmaWd1cmUsIHRvcCA9IHRleHRfZ3JvYigiUGF0aWVudCAzIC0gQ1NGICAgICBrID0gMyBmb3Igay1tZWFucyBjbHVzdGVyaW5nIChURnMgZnJvbSBBVEFDLXNlcSkiLCAKICMgICAgICAgICAgICAgIGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIiwgc2l6ZSA9IDI1KSkKYGBgCgojIyB7LX0KCgojIyMgQ1RDRiBleHByZXNzaW9uIGFjcm9zcyBwYXRpZW50cwoKQ1RDRiBoYXMgYmVlbiBpbXBsaWNhdGVkIHRvIHJlZ3VsYXRlIEhJViBsYXRlbmN5IFtASmVmZmVyZXlzXS4gSW4gdGhlIGJveHBsb3RzIApiZWxvdyBpdCBjYW4gYmUgc2VlbiB0aGF0IHRoZXJlIGlzIGEgc2lnbmlmaWNhbnQgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBmaXJzdCAKY2x1c3RlciBhbmQgdGhlIG90aGVyIHR3byBjbHVzdGVycyBpbiBwYXRpZW50MSBhbmQgcGF0aWVudDIuIFNpbWlsYXJseSBpbiAKcGF0aWVudDMgdGhlcmUgaXMgYSBkaWZmZXJlbmNlLCBob3dldmVyIHRoZSBkaWZmZXJlbmNlIGlzIG5vdCBhcyBzaWduaWZpY2FudC4KVGhpcyBtaWdodCBpbXBseSB0aGF0IGNsdXN0ZXIgY29udGFpbnMgYSBncm91cCBvZiBjZWxscyB3aGljaCBhcmUgbGF0ZW50bHkgCmluZmVjdGVkIGFuZCB0aGVyZWZvcmUgQ1RDRiBpcyBtb3JlIGFjdGl2ZS4KCmBgYHtyfQpjdGNmMyA8LSBnZ3Bsb3QoZGYsIGFlcyh4ID0gaHRfY2x1c3RlciwgeSA9IENUQ0YpKSArCiAgZ2VvbV9ib3hwbG90KGFlcyhmaWxsID0gaHRfY2x1c3RlcikpICsKICBzdGF0X3B2YWx1ZV9tYW51YWwoZGYgJT4lIAogICAgICAgICAgICAgICAgICAgICAgIHBhaXJ3aXNlX3dpbGNveF90ZXN0KENUQ0YgfiBodF9jbHVzdGVyKSAlPiUgCiAgICAgICAgICAgICAgICAgICAgICAgYWRkX3h5X3Bvc2l0aW9uKCkpCmN0Y2YzIDwtIGN0Y2YzICsgbGFicyh0aXRsZSA9ICJDVENGIGFjdGl2aXR5IGluIHBhdGllbnQgMyIpCmBgYAoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD01fQpnZ2FycmFuZ2UoY3RjZjEsIGN0Y2YyLCBjdGNmMywgbmNvbCA9IDMsIG5yb3cgPSAxKQpgYGAKCgojIyBDb3JyZWxhdGlvbnMgYmV0d2VlbiBjbHVzdGVycyBhY3Jvc3MgcGF0aWVudHMKClVzaW5nIGEgY29ycmVsYXRpb24gbWF0cml4IHdlIGNhbiB2aXN1YWxpemUgaG93IGNsdXN0ZXJzIGFyZSBjb3JyZWxhdGVkIGFjcm9zcwpwYXRpZW50czoKCgpgYGB7cn0KIyByZWFkIGluIDMgQ2x1c3RlcnMgZm9yIGVhY2ggb2YgdGhlIDMgSElWKyBwYXRpZW50cwoKIyBISVYxX0NTRgpoaXYxX2MxIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXYxX2NsdXN0ZXIxLnRzdiIsIHNlcCA9ICJcdCIpKVtbIngiXV0KaGl2MV9jMiA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvaGl2MV9jbHVzdGVyMi50c3YiLCBzZXAgPSAiXHQiKSlbWyJ4Il1dCmhpdjFfYzMgPC0gYXMudmVjdG9yKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjFfY2x1c3RlcjMudHN2Iiwgc2VwID0gIlx0IikpW1sieCJdXQoKIyBISVYyX0NTRgpoaXYyX2MxIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXYyX2NsdXN0ZXIxLnRzdiIsIHNlcCA9ICJcdCIpKVtbIngiXV0KaGl2Ml9jMiA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvaGl2Ml9jbHVzdGVyMi50c3YiLCBzZXAgPSAiXHQiKSlbWyJ4Il1dCmhpdjJfYzMgPC0gYXMudmVjdG9yKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjJfY2x1c3RlcjMudHN2Iiwgc2VwID0gIlx0IikpW1sieCJdXQoKIyBISVYzX0NTRgpoaXYzX2MxIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXYzX2NsdXN0ZXIxLnRzdiIsIHNlcCA9ICJcdCIpKVtbIngiXV0KaGl2M19jMiA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvaGl2M19jbHVzdGVyMi50c3YiLCBzZXAgPSAiXHQiKSlbWyJ4Il1dCmhpdjNfYzMgPC0gYXMudmVjdG9yKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjNfY2x1c3RlcjMudHN2Iiwgc2VwID0gIlx0IikpW1sieCJdXQoKY2x1c3Rlcl9hbm5vIDwtIGMoaGl2MV9jMSwgaGl2MV9jMiwgaGl2MV9jMywgaGl2Ml9jMSwgaGl2Ml9jMiwgaGl2Ml9jMywgaGl2M19jMSwgaGl2M19jMiwgaGl2M19jMykKYGBgCgoKYGBge3J9CiMgYWRkIGNsdXN0ZXIgaW5mb3JtYXRpb24gdG8gVEYgYWN0aXZpdHkKYXVjX2RmIDwtIGFzLmRhdGEuZnJhbWUoYXVjX210eCkKCmF1Y19kZiA8LSBhdWNfZGYgJT4lIAogIHJvd25hbWVzX3RvX2NvbHVtbigiY2VsbCIpICU+JSAKICBmaWx0ZXIoY2VsbCAlaW4lIGNsdXN0ZXJfYW5ubykgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gY2FzZV93aGVuKGNlbGwgJWluJSBoaXYxX2MxIH4gImhpdjFfYzEiLCAKICAgICAgICAgY2VsbCAlaW4lIGhpdjFfYzIgfiAiaGl2MV9jMiIsIAogICAgICAgICBjZWxsICVpbiUgaGl2MV9jMyB+ICJoaXYxX2MzIiwKICAgICAgICAgY2VsbCAlaW4lIGhpdjJfYzEgfiAiaGl2Ml9jMSIsCiAgICAgICAgIGNlbGwgJWluJSBoaXYyX2MyIH4gImhpdjJfYzIiLAogICAgICAgICBjZWxsICVpbiUgaGl2Ml9jMyB+ICJoaXYyX2MzIiwKICAgICAgICAgY2VsbCAlaW4lIGhpdjNfYzEgfiAiaGl2M19jMSIsCiAgICAgICAgIGNlbGwgJWluJSBoaXYzX2MyIH4gImhpdjNfYzIiLAogICAgICAgICBjZWxsICVpbiUgaGl2M19jMyB+ICJoaXYzX2MzIikpCmBgYAoKIyMjIENvcnJlbGF0aW9uIGJldHdlZW4gY2x1c3RlcnMgYmFzZWQgb24gYWxsIDEyNSBURnMgCgpGb3IgZXZlcnkgY2x1c3RlciB0aGUgY29ycmVsYXRpb24gaXMgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgVEYgYWN0aXZpdGllcyBvZgphbGwgMTI1IFRGcyAgaWRlbnRpZmllZCBieSBTQ0VOSUMuCgoKPGRldGFpbHM+Cio8c3VtbWFyeT5Db3JyZWxhdGlvbiBjb21wdXRhdGlvbjwvc3VtbWFyeT4qCiAgCkRhdGFmcmFtZSBvZiBhdmVyYWdlIGFjdGl2aXR5IHZhbHVlIGZvciBlYWNoIFRGIGluIGVhY2ggcGF0aWVudCBhbmQgY2x1c3RlcnMuCgoKYGBge3IsIHJlc3VsdHMgPSAiYXNpcyJ9CiMgY29ycmVsYXRpb24gbWF0cml4CmRmIDwtIGF1Y19kZiAlPiUKICBncm91cF9ieShodF9jbHVzdGVyKSAlPiUKICBzdW1tYXJpemVfaWYoaXMubnVtZXJpYywgbWVhbikgJT4lIAogICNjb2x1bW5fdG9fcm93bmFtZXMoImh0X2NsdXN0ZXIiKSAlPiUgCiAgI2FkZF9yb3duYW1lcygpICU+JSAKICBnYXRoZXIoVEYsIHZhbHVlLCAtaHRfY2x1c3RlcikgJT4lIAogIHNwcmVhZChodF9jbHVzdGVyLCB2YWx1ZSkgJT4lIAogIGNvbHVtbl90b19yb3duYW1lcygiVEYiKQoKZGYgJT4lIAogIGhlYWQgJT4lIAogIGthYmxlICgpCmBgYApDb3JyZWxhdGlvbiBtYXRyaXg6IAoKYGBge3IsIHJlc3VsdHMgPSAiYXNpcyJ9CmRmICU+JSBjb3IgJT4lIGthYmxlKCkKCmNvcl9tdHggPC0gZGYgJT4lIGNvcigpCgojIGNhbGN1bGF0ZSBjb25maWRlbmNlIGludGVydmFscyBhbmQgcF92YWx1ZXMKIyBmdW5jdGlvbiBwcm9kdWNlcyBwLXZhbHVlcyBhbmQgY29uZmlkZW5jZSBpbnRlcnZhbHMgZm9yIGVhY2ggcGFpciBvZiBpbnB1dCBmZWF0dXJlcwojIHJldHVybnMgYSBtYXRyaXggZWFjaAojIG9mIHBfdmFsdWVzLCB1cHBlciBjb25maWRlbmNlIGludGVydmFsLCBsb3dlciBjb25maWRlbmNlIGludGVydmFsCnRlc3RDb3IgPC0gY29yLm10ZXN0KGNvcl9tdHgsIGNvbmYubGV2ZWwgPSAwLjk1KQpgYGAKCi0tLQo8L2RldGFpbHM+CgoKYGBge3IsIGZpZy53aWR0aCA9IDE1LCBmaWcuaGVpZ2h0PTE1fQpHR2FsbHk6OmdncGFpcnMoZGYpICsgdGhlbWVfYncoKSArCiAgbGFicyh0aXRsZSA9ICJTY2F0dGVyIG1hdHJpeCBmb3IgYWxsIGNvbmRpdGlvbnMiKQpgYGAKCgoKKipDb25jbHVzaW9uczoqKgoKKiBDbHVzdGVyIDMgZnJvbSBwYXRpZW50IDMgc2VlbXMgdG8gYmUgdmVyeSBkaWZmZXJlbnQKKiBDbHVzdGVyIDIgZnJvbSBwYXRpZW50IDMgaXMgYWxzbyBvbmx5IHdlYWtseSBjb3JyZWxhdGVkCiogQ2x1c3RlciAxIG9mIGFsbCBwYXRpZW50cyBzZWVtcyBjb3JyZWxhdGVkLCBob3dldmVyLCB0aGUgcF92YWx1ZXMgZm9yIApjb3JyZWxhdGlvbiBvZiBjbHVzdGVyMSBvZiBwYXRpZW50IHR3byB3aXRoIGFsbCBvdGhlciBjbHVzdGVycyBhcmUgbm90IHNpZ25pZmljYW50CiogQ2x1c3RlcnMgMiBhbmQgMyBvZiBwYXRpZW50IDEgYW5kIDIgc2VlbSBoaWdobHkgY29ycmVsYXRlZAoKCmBgYHtyfQojIHBsb3QgY29ycmVsYXRpb25zCmNvcnJwbG90KGNvcl9tdHgsCiAgICAgICAgICNtZXRob2QgPSAiY29sb3IiLAogICAgICAgICBvcmRlciA9ICJoY2x1c3QiLCAKICAgICAgICAgYWRkcmVjdCA9IDQsICMgYWRkIGJveGVzIAogICAgICAgICBwLm1hdCA9IHRlc3RDb3IkcCwgCiAgICAgICAgICNzaWcubGV2ZWwgPSAuMDUsCiAgICAgICAgIGluc2lnID0gInAtdmFsdWUiLCAKICAgICAgICAgdGwuY29sID0gImJsYWNrIikKYGBgCgoKCjxkZXRhaWxzPgoqPHN1bW1hcnk+QWRkaXRpb25hbCBjb3JyZWxhdGlvbiBwbG90cyB3aGljaCBkbyBub3QgYWlkIHRoZSBpbnRlcnByZXRhdGlvbiBtdWNoPC9zdW1tYXJ5PioKICAKCiMjIyBDb3JyZWxhdGlvbiBiZXR3ZWVuIGNsdXN0ZXJzIGJhc2VkIG9uIGFsbCBURnMgd2l0aCBkaWZmZXJlbnRpYWwgYWN0aXZpdHkgYmV0d2VlbiBjbHVzdGVycwoKYGBge3J9CmludGVyc2VjdF90b3RhbCA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvdG90YWxfaW50ZXJzZWN0X1RGc19kaWZmZXJlbnRfYWNyb3NzX3BhdGllbnRzXzNfY2x1c3RlcnMiKSlbWyJ4Il1dCmBgYAoKYGBge3J9CiMgY29ycmVsYXRpb24gbWF0cml4CmNvcl9tdHggPC0gYXVjX2RmICU+JQogIHNlbGVjdChodF9jbHVzdGVyLCBpbnRlcnNlY3RfdG90YWwpICU+JSAKICBncm91cF9ieShodF9jbHVzdGVyKSAlPiUKICBzdW1tYXJpemVfaWYoaXMubnVtZXJpYywgbWVhbikgJT4lIAogICNjb2x1bW5fdG9fcm93bmFtZXMoImh0X2NsdXN0ZXIiKSAlPiUgCiAgI2FkZF9yb3duYW1lcygpICU+JSAKICBnYXRoZXIoVEYsIHZhbHVlLCAtaHRfY2x1c3RlcikgJT4lIAogIHNwcmVhZChodF9jbHVzdGVyLCB2YWx1ZSkgJT4lIAogIGNvbHVtbl90b19yb3duYW1lcygiVEYiKSAlPiUgY29yKCkKCiMgY2FsY3VsYXRlIGNvbmZpZGVuY2UgaW50ZXJ2YWxzIGFuZCBwX3ZhbHVlcwojIGZ1bmN0aW9uIHByb2R1Y2VzIHAtdmFsdWVzIGFuZCBjb25maWRlbmNlIGludGVydmFscyBmb3IgZWFjaCBwYWlyIG9mIGlucHV0IGZlYXR1cmVzCiMgcmV0dXJucyBhIG1hdHJpeCBlYWNoCiMgb2YgcF92YWx1ZXMsIHVwcGVyIGNvbmZpZGVuY2UgaW50ZXJ2YWwsIGxvd2VyIGNvbmZpZGVuY2UgaW50ZXJ2YWwKdGVzdENvciA8LSBjb3IubXRlc3QoY29yX210eCwgY29uZi5sZXZlbCA9IDAuOTUpCmBgYAoKCmBgYHtyfQpjb3JycGxvdChjb3JfbXR4LAogICAgICAgICAjbWV0aG9kID0gImNvbG9yIiwgCiAgICAgICAgIG9yZGVyID0gImhjbHVzdCIsIAogICAgICAgICBhZGRyZWN0ID0gNCwgIyBhZGQgYm94ZXMgCiAgICAgICAgIHAubWF0ID0gdGVzdENvciRwLCAKICAgICAgICAgI3NpZy5sZXZlbCA9IC4wNSwKICAgICAgICAgaW5zaWcgPSAicC12YWx1ZSIsIAogICAgICAgICB0bC5jb2wgPSAiYmxhY2siKQpgYGAKCgotLS0KPC9kZXRhaWxzPgoKIyMjIFRGIGNvcnJlbGF0aW9uIGFjcm9zcyBjbHVzdGVycwoKRWxldmVuIFRGcyB3aGljaCBkaWZmZXJlbnRpYXRlIHRoZSBjbHVzdGVycyBzZWVtIHRvIGNvcnJlbGF0ZSBiZXR3ZWVuIHRoZSBjbHVzdGVycy4KCkZvciB0aGVzZSBlbGV2ZW4gVEZzIHdpdGggZGlmZmVyZW50IGFjdGl2aXR5IGJldHdlZW4gdGhlIGNsdXN0ZXJzIHRoZSBhY3Rpdml0eSAKY29ycmVsYXRlcyBiZXR3ZWVuIGFjcm9zcyBhbGwgdGhyZWUgcGF0aWVudHMuIFRoaXMgbWVhbnMsIHRoYXQgdGhlIHRocmVlIFRGcwpZWTEsIFJFU1QsIE1YSTEgYXJlIHBvc2l0aXZlbHkgY29ycmVsYXRlZCwgYnV0IG5lZ2F0aXZlbHkgY29ycmVsYXRlZCB3aXRoIHRoZSAKcmVzdCBvZiB0aGUgVEZzLgoKVGhlIGZhY3QgdGhhdCB0aGVzZSBURiBhY3Rpdml0aWVzIGNvcnJlbGF0ZSBhY3Jvc3MgYWxsIHBhdGllbnRzIGluZGljYXRlcyB0aGF0IAp0aGVyZSBtaWdodCBiZSBhIGJpb2xvZ2ljYWwgbWVhbmluZyBiZWhpbmQgdGhlIHBhdHRlcm4gb2YgYWN0aXZpdHkuIAoKCjxkZXRhaWxzPgo8c3VtbWFyeT4qKkNvcnJlbGF0aW9uIGNvbXB1dGF0aW9uKio8L3N1bW1hcnk+CgpEYXRhZnJhbWUgdXNlZCBhcyBpbnB1dCBmb3IgdGhlIGNvcnJlbGF0aW9uOgoKYGBge3J9CmludGVyc2VjdF9hdGFjIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9hdGFjX2ludGVyc2VjdF9URnNfZGlmZmVyZW50X2Fjcm9zc19wYXRpZW50c18zX2NsdXN0ZXJzIikpW1sieCJdXQpgYGAKCgpgYGB7cn0KY29yX210eCA8LSBhdWNfZGYgJT4lCiAgc2VsZWN0KGh0X2NsdXN0ZXIsIGludGVyc2VjdF9hdGFjKSAlPiUgCiAgZ3JvdXBfYnkoaHRfY2x1c3RlcikgJT4lCiAgc3VtbWFyaXplX2lmKGlzLm51bWVyaWMsIG1lYW4pICU+JSAKICBjb2x1bW5fdG9fcm93bmFtZXMoImh0X2NsdXN0ZXIiKSAlPiUgY29yKCkKYGBgCgoKYGBge3IsIHJlc3VsdHMgPSAiYXNpcyJ9CiMgY29ycmVsYXRpb24gbWF0cml4CmRmIDwtIGF1Y19kZiAlPiUKICBzZWxlY3QoaHRfY2x1c3RlcixpbnRlcnNlY3RfYXRhYykgJT4lIAogIGdyb3VwX2J5KGh0X2NsdXN0ZXIpICU+JQogIHN1bW1hcml6ZV9pZihpcy5udW1lcmljLCBtZWFuKSAlPiUgCiAgY29sdW1uX3RvX3Jvd25hbWVzKCJodF9jbHVzdGVyIikgCgpkZiAlPiUgaGVhZCAlPiUga2FibGUoKQoKYGBgCgpDb3JyZWxhdGlvbiBtYXRyaXggZm9yIFRGczoKCmBgYHtyLCByZXN1bHRzID0gImFzaXMifQpjb3JfbXR4IDwtIGRmICU+JSBjb3IoKQpjb3JfbXR4ICU+JSBrYWJsZQoKIyBjYWxjdWxhdGUgY29uZmlkZW5jZSBpbnRlcnZhbHMgYW5kIHBfdmFsdWVzCiMgZnVuY3Rpb24gcHJvZHVjZXMgcC12YWx1ZXMgYW5kIGNvbmZpZGVuY2UgaW50ZXJ2YWxzIGZvciBlYWNoIHBhaXIgb2YgaW5wdXQgZmVhdHVyZXMKIyByZXR1cm5zIGEgbWF0cml4IGVhY2gKIyBvZiBwX3ZhbHVlcywgdXBwZXIgY29uZmlkZW5jZSBpbnRlcnZhbCwgbG93ZXIgY29uZmlkZW5jZSBpbnRlcnZhbAp0ZXN0Q29yIDwtIGNvci5tdGVzdChjb3JfbXR4LCBjb25mLmxldmVsID0gMC45NSkKYGBgCgotLS0KPC9kZXRhaWxzPgoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD0xNX0KR0dhbGx5OjpnZ3BhaXJzKGRmKSArIHRoZW1lX2J3KCkgKwogICAgbGFicyh0aXRsZSA9ICJTY2F0dGVyIG1hdHJpeCBmb3IgYWxsIFRGcyB3aXRoIGRpZmZlcmVudCBhY3Rpdml0eSBiZXR3ZWVuIGNsdXN0ZXJzIikKCiAgCgpgYGAKCmBgYHtyfQojIHBsb3QgY29ycmVsYXRpb25zCiMgcC5tYXQgPSBtYXRyaXggb2YgcF92YWx1ZXMKcDEgPC0gY29ycnBsb3QoY29yX210eCwKICAgICAgICAgICAgICAgI21ldGhvZCA9ICJjb2xvciIsCiAgICAgICAgICAgICAgIG9yZGVyID0gImhjbHVzdCIsIAogICAgICAgICAgICAgICBhZGRyZWN0ID0gMiwgIyBhZGQgYm94ZXMgCiAgICAgICAgICAgICAgIHAubWF0ID0gdGVzdENvciRwLCAKICAgICAgICAgICAgICAgaW5zaWcgPSAicC12YWx1ZSIsCiAgICAgICAgICAgICAgIHRsLmNvbCA9ICJibGFjayIpCgpgYGAKCgojIEdlbmUgZXhwcmVzc2lvbiBhbmFseXNpcwoKVXNpbmcgdGhlIGluZm9ybWF0aW9uIG9mIHRoZSB0aHJlZSBjbHVzdGVycyBmcm9tIGFib3ZlIHdlIHdpbGwgcG9vbCB0aGUgdHdvIGNsdXN0ZXJzCndoaWNoIGFyZSBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBmcm9tIHRoZSB0aGlyZCBjbHVzdGVyIGluIGFsbCBwYXRpZW50cy4KQ29uc2VxdWVudGx5LCBpbiB0aGUgZm9sbG93aW5nIGFuYWx5c2lzIHdlIHdpbGwgY29tcGFyZSBDbHVzdGVyMSB0byBDbHVzdGVyMiAocG9vbCBvZiB0d28gc2ltaWxhciAKY2x1c3RlcnMpLiBUaGUgZ2VuZSBleHByZXNzaW9uIG1pZ2h0IGdpdmUgYSBoaW50IGFib3V0IHRoZSBpZGVudGl0eSBvZiB0aGVzZSAKdHdvIE15ZWxvaWQyIGNsdXN0ZXJzLiAKCgpgYGB7cn0KIyAzIENsdXN0ZXJzIGZvciBlYWNoIG9mIHRoZSAzIEhJVisgcGF0aWVudHMKCiMgSElWMV9DU0YKaGl2MV9jMSA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvaGl2MV9jbHVzdGVyMS50c3YiLCBzZXAgPSAiXHQiKSlbWyJ4Il1dCmhpdjFfYzIgPC0gYXMudmVjdG9yKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjFfY2x1c3RlcjIudHN2Iiwgc2VwID0gIlx0IikpW1sieCJdXQpoaXYxX2MzIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXYxX2NsdXN0ZXIzLnRzdiIsIHNlcCA9ICJcdCIpKVtbIngiXV0KCiMgSElWMl9DU0YKaGl2Ml9jMSA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvaGl2Ml9jbHVzdGVyMS50c3YiLCBzZXAgPSAiXHQiKSlbWyJ4Il1dCmhpdjJfYzIgPC0gYXMudmVjdG9yKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjJfY2x1c3RlcjIudHN2Iiwgc2VwID0gIlx0IikpW1sieCJdXQpoaXYyX2MzIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXYyX2NsdXN0ZXIzLnRzdiIsIHNlcCA9ICJcdCIpKVtbIngiXV0KCiMgSElWM19DU0YKaGl2M19jMSA8LSBhcy52ZWN0b3IocmVhZC50YWJsZSgiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvaGl2M19jbHVzdGVyMS50c3YiLCBzZXAgPSAiXHQiKSlbWyJ4Il1dCmhpdjNfYzIgPC0gYXMudmVjdG9yKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL2hpdjNfY2x1c3RlcjIudHN2Iiwgc2VwID0gIlx0IikpW1sieCJdXQpoaXYzX2MzIDwtIGFzLnZlY3RvcihyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXYzX2NsdXN0ZXIzLnRzdiIsIHNlcCA9ICJcdCIpKVtbIngiXV0KCmNsdXN0ZXJfYW5ubyA8LSBjKGhpdjFfYzEsIGhpdjFfYzIsIGhpdjFfYzMsIGhpdjJfYzEsIGhpdjJfYzIsIGhpdjJfYzMsIGhpdjNfYzEsIGhpdjNfYzIsIGhpdjNfYzMpCmBgYAoKCgojIyMgVEYgZ2VuZSBleHByZXNzaW9uIG9mIHRoZSAxMSBURnMgd2l0aCBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiBjbHVzdGVycwoKYGBge3J9Cmhpdm15MiA8LSBzdWJzZXQoaGl2NywgY2VsbF90eXBlID09ICJNeWVsb2lkMiIgJiBvcmlnLmlkZW50ICVpbiUgYygiSElWMV9DU0YiLCAiSElWMl9DU0YiLCAiSElWM19DU0YiKSkKCiMgYWRkIGNsdXN0ZXIgaWRlbnRpdHkgdG8gbWV0YWRhdGEKaHRfY2x1c3RlciA8LSAoCiAgaGl2bXkyQG1ldGEuZGF0YSAlPiUgCiAgcm93bmFtZXNfdG9fY29sdW1uKCJjZWxsIikgJT4lIAogIG11dGF0ZShodF9jbHVzdGVyID0gaWZlbHNlKGNlbGwgJWluJSBjKGhpdjFfYzEsIGhpdjJfYzEsIGhpdjNfYzMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjMSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjMiIpKSAlPiUgCiAgY29sdW1uX3RvX3Jvd25hbWVzKCJjZWxsIikpWyJodF9jbHVzdGVyIl0KCmhpdm15MiA8LSBBZGRNZXRhRGF0YShoaXZteTIsIG1ldGFkYXRhID0gaHRfY2x1c3RlciwgY29sLm5hbWUgPSAiaHRfY2x1c3RlciIpCiNzYXZlUkRTKGhpdm15MiwiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvaGl2X215ZWxvaWQyX3N1YmNsdXN0ZXJzIikKYGBgCgojIyBRdWFsaXR5IG9mIHRoZSBNeWVsb2lkIDIgY2x1c3RlcnMKClRoZXJlIGlzIGFuIGV2aWRlbnQgZGlmZmVyZW5jZSBpbiBsaWJyYXJ5IHNpemUgYW5kIG51bWJlciBvZiBmZWF0dXJlcyBiZXR3ZWVuCnRoZSB0d28gY2x1c3RlcnMuIFRoaXMgY291bGQgbWVhbiB0aGF0IHRoZXJlIGlzIGEgdGVjaG5pY2FsIGRpZmZlcmVuY2UgYmV0d2Vlbgp0aGUgdHdvIGNsdXN0ZXJzLiBDb252ZXJzZWx5LCBpdCBjb3VsZCBhbHNvIG1lYW4gdGhhdCB0aGVyZSBpcyB0aGlzIGEgYmlvbG9naWNhbApkaWZmZXJlbmNlLiBGb3IgZXhhbXBsZSwgaWYgY2VsbHMgb2YgY2x1c3RlcjEgcmVwcmVzZW50IGEgbGF0ZW50bHkgaW5mZWN0ZWQgZ3JvdXAgCm9mIE15ZWxvaWQyIGNlbGxzIGl0IGNvdWxkIGJlIHRoYXQgZ2VuZSBleHByZXNzaW9uIGlzIHJlZHVjZWQgb3ZlcmFsbCBkdWUgdG8gdGhlCmluZmVjdGlvbiBjb21wYXJlZCB0byBoZWFsdGh5IHVuaW5mZWN0ZWQgY2VsbHMgZnJvbSBjbHVzdGVyMi4KCk9uZSB3YXkgdG8gaW52ZXN0aWdhdGUgdGhpcyBmdXJ0aGVyIHdvdWxkIGJlIHRvIGhhdmUgYSBsb29rIGF0IHRoZSBob3VzZWtlZXBpbmcgCmdlbmVzIGluIGJvdGggY2x1c3RlcnMuIElmIGhvdXNla2VlcGluZyBnZW5lcyB3ZXJlIG1vcmUgaGlnaGx5IGV4cHJlc3NlZCBpbiAKb25lIGNsdXN0ZXIgdGhhbiBpbiB0aGUgb3RoZXIgdGhpcyB3b3VsZCBpbmRpY2F0ZSB0aGF0IHRoZSBkaWZmZXJlbmNlIGlzIG5vdCAKYmlvbG9naWNhbCwgYnV0IGEgdGVjaG5pY2FsIGFydGVmYWN0LgoKU2luY2UgdGhlcmUgaXMgb25lIGNsdXN0ZXIgd2hpY2ggaGFzIGxvd2VyIG51bWJlciBvZiBjb3VudHMgYW5kIGZlYXR1cmVzIAp0byBzdGFydCB3aXRoLCBmdXJ0aGVyIHF1YWxpdGF0aXZlIGFuYWx5c2lzIG9mIGdlbmUgZXhwcmVzc2lvbiBtaWdodCBiZSBza2V3ZWQgCmFzIHdlbGwuIEZvciB0aGlzIHJlYXNvbiB0aGUgZm9sbG93aW5nIGFuYWx5c2lzIG9uIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gdGhlc2UKdHdvIGNsdXN0ZXJzIHdpbGwgYmUgbWFpbmx5IHF1YWxpdGF0aXZlLiBEdWUgdG8gdGhlIGxvdyBudW1iZXIgb2YgY2VsbHMgaXQgCmlzIG5vdCBwb3NzaWJsZSB0byBnZXQgc2lnbmlmaWNhbnQgcmVzdWx0cyBmb3IgdGhlIGRpZmZlcmVudGlhbCBnZW5lIGV4cHJlc3Npb24uCgoKYGBge3J9CnAxIDwtIGhpdm15MkBtZXRhLmRhdGEgJT4lIAogIGdncGxvdCgpICsKICBnZW9tX2JveHBsb3QoYWVzKHggPSBodF9jbHVzdGVyLCB5ID0gbkZlYXR1cmVfUk5BLCBmaWxsID0gaHRfY2x1c3RlcikpCgpwMiA8LSBoaXZteTJAbWV0YS5kYXRhICU+JSAKICBnZ3Bsb3QoKSArCiAgZ2VvbV92aW9saW4oYWVzKHggPSBodF9jbHVzdGVyLCB5ID0gbkZlYXR1cmVfUk5BLCBmaWxsID0gaHRfY2x1c3RlcikpICsKICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCB2anVzdCA9IDAuOCwgaGp1c3QgPSAxKSkKCmZpZyA8LSBnZ2FycmFuZ2UocDEsIHAyLCBuY29sID0gMiwgbnJvdyA9IDEpCmFubm90YXRlX2ZpZ3VyZShmaWcsIHRvcCA9IHRleHRfZ3JvYigiUXVhbGl0eSBvZiBDbHN1dGVycyIpKQpgYGAKCiMjIEhvdXNla2VlcGluZyBnZW5lcwoKQSBsaXN0IG9mIDM4MDQgaG91c2Vla3BpbmcgZ2VuZXMgd2VyZSB1c2VkIGZyb20gW0BFaXNlbmJlcmddLgoKQSBxdWFudGl0YXRpdmUgYW5hbHlzaXMgbWlnaHQgYmUgZGlmZmljdWx0LCBiZWNhdXNlIGR1ZSB0byB0aGUgc21hbGwgc2FtcGxlCnNpemUgYW5kIGxhcmdlIGZlYXR1cmUgbnVtYmVyLCB3ZSBnZXQgdmVyeSBoaWdoIHBfdmFsdWVzIGZvciBhbGwgZ2VuZXMgaW4gCmRpZmZlcmVudGlhbCBnZW5lIGV4cHJlc3Npb24gYW5hbHlzaXMuIFZpc3VhbGl6YXRpb24gb2YgdGhlCmhvdXNla2VlcGluZyBnZW5lIGV4cHJlc3Npb24sIHVuZm9ydHVuYXRlbHkgZG9lcyBub3QgaGVscCBlaXRoZXIgd2l0aCB0aGUgCmludGVycHJldGF0aW9uLgoKCjxkZXRhaWxzPgoqPHN1bW1hcnk+Qm94cGxvdHMgb2YgaG91c2VrZWVwaW5nIGdlbmUgZXhwcmVzc2lvbjwvc3VtbWFyeT4qCgpgYGB7cn0KaGtfZ2VuZXMgPC0gKHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL0hLX2dlbmVzLnR4dCIpKVtbIlYxIl1dCmBgYAoKYGBge3J9CiMgZmlsdGVyIG9ubHkgZ2VuZXMgcHJlc2VudCBpbiB0aGUgc2NSTkFzZXEgY291bnQgbWF0cml4CmhrX2dlbmVzX2ZpbHQgPC0gaGtfZ2VuZXNbaGtfZ2VuZXMgJWluJSByb3duYW1lcyhoaXZteTJAYXNzYXlzJFJOQUBjb3VudHMpXQpsZW5ndGgoaGtfZ2VuZXMpCmxlbmd0aChoa19nZW5lc19maWx0KQoKIyBGaW5kIGdlbmVzIGZyb20gdGhlIGhvdXNla2VlcGluZyBnZW5lcyB0aGF0IGFyZSBkaWZmZXJlbnRpYWxseSBleHByZXNzZWQgCiMgYmV0d2VlbiB0aGUgY2x1c3RlcnMKaGtfZGlmZiA8LSBGaW5kQWxsTWFya2VycyhoaXZteTIsIGZlYXR1cmVzID0gaGtfZ2VuZXNfZmlsdCkKSWRlbnRzKGhpdm15MikgPC0gImh0X2NsdXN0ZXIiCmhrX2RpZmYgPC0gRmluZE1hcmtlcnMoaGl2bXkyLCBmZWF0dXJlcyA9IGhrX2dlbmVzX2ZpbHQsIGlkZW50LjEgPSAiYzEiLCBpZGVudC4yID0gImMyIikKaGtfZGlmZiAlPiUgaGVhZAoKYGBgCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTMwfQp0ZXN0IDwtIGhrX2dlbmVzX2ZpbHRbMTozMF0KVmxuUGxvdChoaXZteTIsIGZlYXR1cmVzID0gdGVzdCwgZ3JvdXAuYnkgPSAiaHRfY2x1c3RlciIsIG5jb2wgPSA0KQpgYGAKCi0tLQo8L2RldGFpbHM+CgojIEFwcGVuZGl4CgojIyBHZW5lIGV4cHJlc3Npb24gYW5hbHlzaXMgb2YgdGhlIHR3byBNeWVsb2lkMiBzdWJjbHVzdGVycwoKIyMjIyBURiBmcm9tIHRoZSBGYXJoYWRpYW4gZXQgYWwuCgpUaGVzZSBURnMgd2VyZSB1c2VkIGFzIG1hcmtlciBnZW5lcyBmb3IgdGhlIG1pY3JvbGdpYSBsaWtlIE15ZWxvaWQyIGNlbGwgY2x1c3Rlci4KSXMgdGhlcmUgYSBncm91cCBvZiBjZWxscyB3aGljaCBoYXMgYSBoaWdoZXIgZXhwcmVzc2lvbiBvZiB0aGVzZSBtYXJrZXJzPwpObyBjbGVhciBkaWZmZXJlbmNlIGluIGdlbmUgZXhwcmVzc2lvbiBjYW4gYmUgc2Vlbi4KCgo8ZGV0YWlscz4KPHN1bW1hcnk+Qm94cGxvdHMgb2YgbWljcm9nbGlhIG1hcmtlciBnZW5lczwvc3VtbWFyeT4KCgpgYGB7ciwgZmlnLndpZHRoID0gMTUsIGZpZy5oZWlnaHQ9NDB9CiNpbXBvcnQgdGhlIDYwIGdlbmVzIHRoYXQgd2VyZSB1cHJlZ3VsYXRlZCBpbiBNeWVsb2lkLTIgaW4gdGhlIHBhcGVyIGNvbXBhcmVkIHRvIHRoZSBmb3VyIG90aGVyIG15ZWxvaWQgc3Vic2V0cwpwYXBlciA8LSByZWFkLnRhYmxlKGZpbGUgPSAiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL2RhdGEvTXllbG9pZC0yX2dlbmVzX3BhcGVyLmNzdiIsCiAgICAgICAgICAgICAgICAgICAgc2VwID0gIlx0IiwgaGVhZGVyID0gRkFMU0UsIHNraXBOdWwgPSBUUlVFKSMsIG5fbWF4ID0gNjApCnBhcGVyWzEsXSA8LSAiQVBPQzEiCmNvbG5hbWVzKHBhcGVyKSA8LSAiIgpwYXBlciA8LSBhcy52ZWN0b3IocGFwZXJbLDFdKQoKClZsblBsb3QoaGl2bXkyLCBmZWF0dXJlcyA9IHBhcGVyLCBncm91cC5ieSA9ICJodF9jbHVzdGVyIikKYGBgCgotLS0KPC9kZXRhaWxzPgoKCiMjIyMgRGlmZmVyZW50aWFsIGdlbmUgZXhwcmVzc2lvbiBhbmFseWlzaXMKCjxkZXRhaWxzPgo8c3VtbWFyeT5EaWZmZXJlbnRpYWwgZ2VuZSBleHByZXNzaW9uIGFuYWx5c2lzPC9zdW1tYXJ5PgoKCmBgYHtyLCByZXN1bHRzPSJhc2lzIn0KaGl2bXkyIDwtIE5vcm1hbGl6ZURhdGEoaGl2bXkyLCB2ZXJib3NlID0gRkFMU0UpCmhpdm15MiA8LSBTY2FsZURhdGEoaGl2bXkyLCB2ZXJib3NlID0gRkFMU0UpCmhpdm15MiA8LSBGaW5kVmFyaWFibGVGZWF0dXJlcyhoaXZteTIsIHZlcmJvc2UgPSBGQUxTRSkKaGl2bXkyIDwtIFJ1blBDQShoaXZteTIsIGZlYXR1cmVzID0gVmFyaWFibGVGZWF0dXJlcyhoaXZteTIpLCB2ZXJib3NlID0gRkFMU0UpCkVsYm93UGxvdChoaXZteTIpCmhpdm15MiA8LSBSdW5UU05FKGhpdm15MiwgZGltcz0gMToxMCwgdmVyYm9zZSA9IEZBTFNFKQpJZGVudHMoaGl2bXkyKSA8LSAiaHRfY2x1c3RlciIKZGVfZ2VuZXMgPC0gRmluZEFsbE1hcmtlcnMoaGl2bXkyLCB2ZXJib3NlID0gRkFMU0UpCnRvcDEwIDwtIGRlX2dlbmVzICU+JSAKICBncm91cF9ieShjbHVzdGVyKSAlPiUKICB0b3BfbihuID0gNSwgd3QgPSBhdmdfbG9nMkZDKSAKdG9wMTAgJT4lIAogIGthYmxlKCkKYGBgCgotLS0KPC9kZXRhaWxzPgoKCiMjIyMgVEYgZnJvbSBHb3NzZWxpbiBldCBhbC4KCjxkZXRhaWxzPgo8c3VtbWFyeT5NaWNyb2dsaWEgVEYgZ2VuZSBleHByZXNzaW9uPC9zdW1tYXJ5PgoKCmBgYHtyfQpJZGVudHMoaGl2NCkgPC0gImNlbGxfdHlwZSIKIyBGaW5kIE1hcmtlcnMgdGhhdCBkaXN0aW5ndWlzaCBNeTIgZnJvbSB0aGUgb3RoZXIgTXllbG9pZCBjbHVzdGVycwpteTJfbWFya2VycyA8LSBGaW5kTWFya2VycyhoaXY0LCBpZGVudC4xICA9ICJNeWVsb2lkMiIsCiAgICAgICAgICAgIGlkZW50LjIgID0gYygiTXllbG9pZDEiLCAiTXllbG9pZDMiLCAiTXllbG9pZDQiLCAiTXllbG9pZDUiKSkKbXkyX21hcmtlcnMgPC0gbXkyX21hcmtlcnMgJT4lIHJvd25hbWVzX3RvX2NvbHVtbih2YXIgPSAiZ2VuZSIpCmBgYAoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD00MH0KbWljcm9nbGlhX2dlbmVzIDwtIHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL01pY3JvZ2xpYV9nZW5lX3NpZ25hdHVyX2ZvdW5kX2luX0hJVjFfSElWMl9zYW1wbGVzIikKbTEgPC0gbXkyX21hcmtlcnMgJT4lIGZpbHRlcihnZW5lICVpbiUgbWljcm9nbGlhX2dlbmVzIFtbImdlbmVfbmFtZSJdXSAmIGF2Z19sb2cyRkMgPjApCiMgcmVtb3ZlIHRoZSBnZW5lcyB0aGF0IHdlcmUgYWxyZWFkeSB1c2VkIGJ5IHRoZSBGYXJoYWRpYW4gcGFwZXIKbTEgPC0gbTFbWyJnZW5lIl1dW20xW1siZ2VuZSJdXSAlaW4lIHBhcGVyID09IEZBTFNFXQoKVmxuUGxvdChoaXZteTIsIGZlYXR1cmVzID0gbTEsIGdyb3VwLmJ5ID0gImh0X2NsdXN0ZXIiLCBuY29sID0gNSkKCmBgYAoKLS0tCjwvZGV0YWlscz4KCiMjIyMgV2hpY2ggb2YgdGhlIDExIFRGcyBhcmUgbWVudGlvbmVkIGJ5IEdvc3NlbGluIGV0IGFsPwoKPGRldGFpbHM+CjxzdW1tYXJ5PlRGcyBhbHNvIG1lbnRpb25lZCBieSBHb3NzZWxpbiBldCBhbC48L3N1bW1hcnk+CgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTEyfQp0ZnNfbWljcm9nbGlhIDwtIChyZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9URnNfbWljcm9nbGlhX0dsYXNzX3BhcGVyLnR4dCIpKVtbIlYxIl1dCgpnb3NzZWxpbiA8LSB0ZnNfbWljcm9nbGlhW3Rmc19taWNyb2dsaWEgJWluJSBvdmVybGFwX2F0YWMkbmFtZV0KClZsblBsb3QoaGl2bXkyLCBmZWF0dXJlcyA9IGdvc3NlbGluLCBncm91cC5ieSA9ICJodF9jbHVzdGVyIiwgbmNvbCA9IDQpCmBgYAoKLS0tCjwvZGV0YWlscz4KCgojIFJlZmVyZW5jZXMKCgoKCg==</div>

<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>





</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("TF_activity_analysis_of_myeloid2_cluster.Rmd");
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
