<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="kmikulik" />


<title>Analysis of Triculture dataset and integration with CSF/Blood dataset</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Report</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Abstract</a>
</li>
<li>
  <a href="Introduction.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Results
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="HIV_CSF_dataset_analysis.html">1. CSF/Blood samples</a>
    </li>
    <li>
      <a href="TF_activity_analysis_of_myeloid2_cluster.html">2. TF activity Myeloid2</a>
    </li>
    <li>
      <a href="Triculture_csf_integration.html">3. Integration CSF/Blood &amp; triculture</a>
    </li>
    <li>
      <a href="Triculture_dataset_GRN_with_Scenic.html">4. TF activity iMg</a>
    </li>
  </ul>
</li>
<li>
  <a href="Discussion.html">Discussion</a>
</li>
<li>
  <a href="Methods.html">Methods</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Katharina782/report">
    <span class="fas fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Analysis of Triculture dataset and integration with CSF/Blood dataset</h1>
<h4 class="author">kmikulik</h4>
<h4 class="date">28 12 2021</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2021-12-31
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>report/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20211203code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20211203)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20211203code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20211203)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomKatharina782reporttreedfcd540d3a574f3ad19196570abd4c6c51bd0aa3targetblankdfcd540a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/Katharina782/report/tree/dfcd540d3a574f3ad19196570abd4c6c51bd0aa3" target="_blank">dfcd540</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomKatharina782reporttreedfcd540d3a574f3ad19196570abd4c6c51bd0aa3targetblankdfcd540a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/Katharina782/report/tree/dfcd540d3a574f3ad19196570abd4c6c51bd0aa3" target="_blank">dfcd540</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    analysis/Independent_cell_type_identification_Farhadian_dataset_cache/

Untracked files:
    Untracked:  README.html
    Untracked:  analysis/Triculture_csf_integration/
    Untracked:  data/triculture_seurat_object
    Untracked:  rebuild file.Rmd
    Untracked:  rebuild-file.Rmd
    Untracked:  rebuild-file.html
    Untracked:  rebuild-file_cache/
    Untracked:  rebuild-file_files/

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/Triculture_csf_integration.Rmd</code>) and HTML (<code>docs/Triculture_csf_integration.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/dfcd540d3a574f3ad19196570abd4c6c51bd0aa3/analysis/Triculture_csf_integration.Rmd" target="_blank">dfcd540</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-31
</td>
<td>
wflow_publish(all = TRUE, republish = TRUE, delete_cache = TRUE)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/Katharina782/report/3d3c73318704913e8bd8fd6101547ea25899045f/docs/Triculture_csf_integration.html" target="_blank">3d3c733</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-31
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/Katharina782/report/blob/552f3e790fdab3c4f5386c882cd6d94f4d50d84f/analysis/Triculture_csf_integration.Rmd" target="_blank">552f3e7</a>
</td>
<td>
Katharina782
</td>
<td>
2021-12-31
</td>
<td>
wflow_publish(c(“analysis/Triculture_csf_integration.Rmd”, “analysis/Discussion.Rmd”,
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<style>
body {
text-align: justify}
</style>
<pre class="r"><code>knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, message = FALSE,
                      cache = TRUE, cache.lazy = FALSE, autodep = TRUE)
set.seed(42) # TODO: check with default seed</code></pre>
<pre class="r"><code>library(tidyverse)
library(Seurat)
library(edgeR)
library(Matrix)
library(data.table)
library(ggrepel)
#library(harmony)
library(RColorBrewer)
library(pheatmap)
library(ggcorrplot)
library(ComplexHeatmap)
library(circlize)
library(ggpubr)
library(gridExtra)
library(corrplot)
library(rstatix)
library(knitr)
library(metap)
library(multtest)
library(readxl)</code></pre>
<div id="triculture-dataset" class="section level1">
<h1>Triculture Dataset</h1>
<p>The triculture dataset used in the following analysis was published by <span class="citation">[@Ryan]</span>. They used a Triculture system with induced neurons, induced astrocytes and induced microglia. Induced microglia express marker genes CX3CR1, IBA1, TMEM119 and P2RY12. CCR5 which is a co-receptor necessary for HIV infection is also expressed by these cells, but they lack expression of myeloid-progenitor markers <span class="citation">[@Ryan]</span>.</p>
<p>iMg were infected with HIV for 15 days, resulting in 94% of cells infected<br />
(positive for HIV capsid protein p24 and exhibiting multinucleation). Some cells were treated with the antiretroviral therapy EFZ, which blocks HIV reverse transcriptase. This way, it was possible to study non-productively infected cells. EFZ reduced infection by two thirds <span class="citation">[@Ryan]</span>.</p>
<p>In the infected, but not treated iMg (Inf) inflammatory pathways were significantly uperegulated compared to the uninfected condition(Uninf), including IL-8, NFkB and EIF2. There was decreased expression of pro-imflammatory genes IL1b, Il8 and TNFalpha in the infected and treated (Inf+EFZ) vs Inf condition. This suggests a reduced inflammatory reaction <span class="citation">[@Ryan]</span>. Nevertheless, there were two distinct pathways which were upregulated in Inf+EFZ iMg, namely RhoGDI signaling and CD40 signaling pathway. This will be discussed in more detail later on <span class="citation">[@Ryan]</span>.</p>
<p>There was a change in signaling pathways caused by EFZ treatment even in the uninfected and treated (Uninf+EFZ) versus the uninfected, but not treated (Uninf) condition. The EFZ treatment alone was very different from the EFZ treatment with infection <span class="citation">[@Ryan]</span>.</p>
<details>
<summary>
<strong>Files and data structure</strong>
</summary>
<p><strong>Read in Files:</strong></p>
<p>Abbreviations:</p>
<ul>
<li>ia/2 = infected with HIV + treated with ART</li>
<li>ca = uninfected + ART</li>
<li>ctl = uninfected</li>
<li>inf = infected</li>
</ul>
<p>File structure:</p>
<ul>
<li>the “.mtx” files contains a sparse matrix of class dgTMatrix</li>
<li>the “barcodes.tsv” files contain the cell barcodes</li>
<li>the “features.tsv” files contain the feature names as well as ensemble gene ids and “gene expression” strings in a third column</li>
</ul>
<p>There are duplicated features in the data, probably, because there are multiple ensemble gene IDs mapping to the same gene symbol. Therefore, the same gene symbol has multiple expression values. How do you deal with this problem?</p>
<ul>
<li>You could make them unique with the function <code>make.unique()</code></li>
<li>You could remove the duplicated features. <strong>This is what I did</strong></li>
</ul>
<pre><code>path &lt;- &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/GSE143686_RAW/&quot; #&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/GSE143686_RAW/&quot;
all_files &lt;- list.files(path)

all_cond_list &lt;- map(seq.int(3,7), function(n){
  file &lt;- all_files[grepl(paste0(&quot;GSM427258&quot;, n), all_files)]
  name &lt;- str_extract(file[[1]],&quot;ca|ctl|ia2|ia|inf&quot;)
  barcodes &lt;- read.table(paste0(path,file[[1]]), sep = &quot;\t&quot;) 
  features &lt;- read.table(paste0(path, file[[2]]), sep = &quot;\t&quot;)
  matrix &lt;- readMM(paste0(path, file[[3]]))
  colnames(matrix) &lt;- barcodes$V1
  rownames(matrix) &lt;- features$V2
  matrix &lt;- matrix[!duplicated(rownames(matrix)),]
  seurat_ob &lt;- CreateSeuratObject(matrix, project = name,
                                  assay = &quot;RNA&quot;, min.cells = 1, min.features = 1)
  seurat_ob[[&quot;percent_mt&quot;]] &lt;- PercentageFeatureSet(seurat_ob, pattern = &quot;^MT-&quot;)
  list(name = name, count = matrix, seurat_ob = seurat_ob)
})

#saveRDS(all_cond_list, &quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Triculture_dataset_Ryan_paper/seurat_list&quot;)</code></pre>
<hr />
</details>
</div>
<div id="data-processing" class="section level1 tabset">
<h1 class="tabset">Data processing</h1>
<div id="before-quality-control" class="section level2">
<h2>Before Quality Control:</h2>
<pre class="r"><code>all_cond_list &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Triculture_dataset_Ryan_paper/seurat_list&quot;)

before_qc &lt;- merge(all_cond_list[[1]]$seurat_ob,
                    c(all_cond_list[[2]]$seurat_ob,
                      all_cond_list[[3]]$seurat_ob,
                      all_cond_list[[4]]$seurat_ob,
                      all_cond_list[[5]]$seurat_ob),
                    project = &quot;triculture_all_conditions&quot;,
                    add.cell.ids = c(paste0(all_cond_list[[1]]$name),
                                     paste0(all_cond_list[[2]]$name),
                                     paste0(all_cond_list[[3]]$name),
                                     paste0(all_cond_list[[4]]$name),
                                     paste0(all_cond_list[[5]]$name)))</code></pre>
<pre class="r"><code>qual_metric &lt;- c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent_mt&quot;)

plots &lt;- map(qual_metric, function(metric){
  ggplot() +
    geom_violin(aes(x = before_qc@meta.data %&gt;% pull(&quot;orig.ident&quot;),
                 y = before_qc@meta.data %&gt;% pull(metric), 
                 fill = before_qc@meta.data %&gt;% pull(&quot;orig.ident&quot;)), 
                alpha = .5) +
    geom_boxplot(aes(x = before_qc@meta.data %&gt;% pull(&quot;orig.ident&quot;),
                     y = before_qc@meta.data %&gt;% pull(metric)),
                 alpha = 0) +
    xlab(&quot;sample origin&quot;) +
    ylab(paste0(metric)) +
    NoLegend() 
})

do.call(grid.arrange, c(plots, ncol = 3, nrow = 1))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-3-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="after-quality-control" class="section level2">
<h2>After quality control</h2>
<p>For each sample separately</p>
<ul>
<li>remove genes expressing less than 200 genes or more than 5000</li>
<li>remove cells expressing more than 20% mitochondrial genes</li>
<li>merge Seurat objects after Quality Control</li>
</ul>
<pre class="r"><code># add percentage of mitochondiral genes to metadata
all_cond &lt;- map(seq.int(1,5), function(n){
  seurat_ob &lt;- all_cond_list[[n]]$seurat_ob
  #seurat_ob[[&quot;percent_mt&quot;]] &lt;- PercentageFeatureSet(seurat_ob, pattern = &quot;^MT-&quot;)
  #plot &lt;- VlnPlot(seurat_ob,
   #               features = c(&quot;nFeature_RNA&quot;, &quot;percent_mt&quot;, &quot;nCount_RNA&quot;),
    #              ncol = 3) +
    #labs(title = paste0(&quot;condition &quot;, all_cond_list[[n]]$name))
  seurat_ob &lt;- subset(seurat_ob, nFeature_RNA &gt; 200 &amp; nFeature_RNA &lt; 5000 &amp; percent_mt &lt; 20)
  list(name = all_cond_list[[n]]$name, seurat_ob = seurat_ob)#, plot = plot)
})</code></pre>
<pre class="r"><code>triculture &lt;- merge(all_cond[[1]]$seurat_ob,
                    c(all_cond[[2]]$seurat_ob,
                      all_cond[[3]]$seurat_ob,
                      all_cond[[4]]$seurat_ob,
                      all_cond[[5]]$seurat_ob),
                    project = &quot;triculture_all_conditions&quot;,
                    add.cell.ids = c(paste0(all_cond[[1]]$name),
                                     paste0(all_cond[[2]]$name),
                                     paste0(all_cond[[3]]$name),
                                     paste0(all_cond[[4]]$name),
                                     paste0(all_cond[[5]]$name)))</code></pre>
<pre class="r"><code>qual_metric &lt;- c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent_mt&quot;)

plots &lt;- map(qual_metric, function(metric){
  ggplot() +
    geom_violin(aes(x = triculture@meta.data %&gt;% pull(&quot;orig.ident&quot;),
                 y = triculture@meta.data %&gt;% pull(metric), 
                 fill = triculture@meta.data %&gt;% pull(&quot;orig.ident&quot;)), 
                alpha = .5) +
    geom_boxplot(aes(x = triculture@meta.data %&gt;% pull(&quot;orig.ident&quot;),
                     y = triculture@meta.data %&gt;% pull(metric)),
                 alpha = 0) +
    xlab(&quot;sample origin&quot;) +
    ylab(paste0(metric)) +
    NoLegend() 
})

do.call(grid.arrange, c(plots, ncol = 3, nrow = 1))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-6-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="normalization-scaling-find-variable-features" class="section level2">
<h2>Normalization, Scaling, Find Variable Features</h2>
<ul>
<li>log normalization</li>
<li>scale data so that we have mean = 0 and variance = 1</li>
<li>Find the 2000 most highly variable features</li>
</ul>
<pre><code>triculture &lt;- NormalizeData(triculture, verbose = FALSE)
triculture &lt;- ScaleData(triculture, verbose = FALSE)
triculture &lt;- FindVariableFeatures(triculture, verbose = FALSE)</code></pre>
<hr />
</div>
<div id="dimensionality-reduction" class="section level2">
<h2>Dimensionality reduction</h2>
<ul>
<li>compute PCA</li>
<li>use elbow plot to determine dimensions that contribute to variability</li>
<li>find the k-nearest neighbors</li>
<li>find Clusters based on KNN-graph</li>
<li>calculate TSNE embedding</li>
</ul>
<pre><code>triculture &lt;- RunPCA(triculture, features = VariableFeatures(triculture), verbose = FALSE)
ElbowPlot(triculture)

triculture &lt;- FindNeighbors(triculture, verbose = FALSE)
triculture &lt;- FindClusters(triculture, verbose = FALSE)

triculture &lt;- RunTSNE(triculture, dims = 1:10, verbose = FALSE)</code></pre>
<pre class="r"><code>triculture &lt;- readRDS(&quot;seurat_objects/triculture_seurat_object&quot;)

#triculture &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Triculture_dataset_Ryan_paper/triculture_seurat_object&quot;)

DimPlot(triculture, reduction = &quot;tsne&quot;, pt.size = .01,label = TRUE,
        group.by = &quot;seurat_clusters&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="cell-type-annotation" class="section level2">
<h2>Cell type annotation</h2>
<p>For annotating the different clusters the same markers as in <span class="citation">[@Ryan]</span> were used:</p>
<ul>
<li><em>Microglia:</em> AIF1, SPI1, CD4</li>
<li><em>Astrocytes:</em> SOX9, THBS1</li>
<li><em>Neurons:</em> SYN1, MAP2</li>
</ul>
<pre class="r"><code>#markers &lt;- FindAllMarkers(triculture)
#triculture &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Triculture_dataset_Ryan_paper/triculture_seurat_object&quot;)
markers &lt;- read.table(&quot;data_files/marker_genes_triculture_dataset&quot;)
#markers &lt;- read.table(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/marker_genes_triculture_dataset&quot;)

top_2 &lt;- markers %&gt;% group_by(&quot;seurat_cluster&quot;) %&gt;% top_n(n = 2, wt = avg_log2FC)

marker_genes &lt;- c(&quot;AIF1&quot;, &quot;SPI1&quot;, &quot;CD4&quot;, &quot;MAP2&quot;, &quot;SYN1&quot;, &quot;THBS1&quot;, &quot;SOX9&quot;)
p1 &lt;- FeaturePlot(triculture, features = &quot;AIF1&quot;)
p2 &lt;- FeaturePlot(triculture, features = &quot;SPI1&quot;)
p3 &lt;- FeaturePlot(triculture, features = &quot;CD4&quot;)
p4 &lt;- FeaturePlot(triculture, features = &quot;MAP2&quot;)
p5 &lt;- FeaturePlot(triculture, features = &quot;SYN1&quot;)
p6 &lt;- FeaturePlot(triculture, features = &quot;THBS1&quot;)
p7 &lt;- FeaturePlot(triculture, features = &quot;SOX9&quot;)

ggarrange(p1,p2,p3,p4,p5,p6,p7, ncol = 2, nrow =4 )</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<details>
<summary>
<strong>Details on cell type annotation</strong>
</summary>
<p><strong>Gene expression</strong></p>
<p>Different clusters were annotated according to the gene expression of marker genes mentioned above.</p>
<pre class="r"><code>
VlnPlot(triculture, features = c(&quot;CD4&quot;, &quot;SPI1&quot;, &quot;AIF1&quot;), group.by = &quot;seurat_clusters&quot;)#, group.by = seurat_cluster)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-9-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>VlnPlot(triculture, features = c(&quot;MAP2&quot;, &quot;SYN1&quot;), group.by = &quot;seurat_clusters&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-9-2.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>VlnPlot(triculture, features = c(&quot;THBS1&quot;, &quot;SOX9&quot;), group.by = &quot;seurat_clusters&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-9-3.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code># 4, 9, 11, 18 = Microglia
# 0, 1, 2, 3,8, 10, 13, 15, 18, 19 = Neurons 
# 6, 7, 12, 14, 16 = Astrocytes
# 5, 17 are undesginated
cell_types &lt;- (triculture@meta.data %&gt;% 
  mutate(cell_type = case_when(
    seurat_clusters %in% c(4,9,11) ~ &quot;iMg&quot;, 
    seurat_clusters %in% c(6,7,12,14,16) ~ &quot;iAst&quot;, 
    seurat_clusters %in% c(0,1,2,3,8,10,13,15,18,19) ~ &quot;iNeurons&quot;,
    TRUE  ~ &quot;Undesignated&quot;)))[[&quot;cell_type&quot;]]
  
triculture &lt;- AddMetaData(triculture, cell_types, col.name = &quot;cell_type&quot;)</code></pre>
<hr />
</details>
<hr />
</div>
</div>
<div id="exploring-the-dataset" class="section level1">
<h1>Exploring the dataset</h1>
<div id="remove-undesignated-cells" class="section level3">
<h3>Remove undesignated cells</h3>
<p>There is one group of cells where it is not clear which cell state they represent (Undesignated), we will exclude them from further analysis as <span class="citation">[@Ryan]</span> did.</p>
<pre class="r"><code>p1 &lt;- DimPlot(triculture, reduction = &quot;tsne&quot;, pt.size = .01, label = TRUE,
        group.by = &quot;cell_type&quot;) +
  labs(title = &quot;cell types&quot;)</code></pre>
<pre class="r"><code>triculture_clean &lt;- subset(triculture, cell_type %in% c(&quot;iMg&quot;, &quot;iNeurons&quot;, &quot;iAst&quot;)) </code></pre>
<pre class="r"><code>p2 &lt;- DimPlot(triculture_clean, reduction = &quot;tsne&quot;, pt.size = .01, label = TRUE,
        group.by = &quot;cell_type&quot;) + 
  labs(title = &quot;cell types&quot;)</code></pre>
<pre class="r"><code>p1+p2</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-14-1.png" width="1440" style="display: block; margin: auto;" /></p>
<details>
<summary>
<strong>Heatmap of top 20 marker genes for each cell type</strong>
</summary>
<p>Top20 marker genes for each cell cell type:</p>
<pre class="r"><code>Idents(triculture_clean) &lt;- &quot;cell_type&quot;
top_n &lt;- markers %&gt;% group_by (cluster) %&gt;% top_n(n = 20, wt = avg_log2FC)
DoHeatmap(triculture_clean, features = top_n$gene)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-15-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</details>
<details>
<summary>
<strong>Number of cells per condition and cell type</strong>
</summary>
<p>How many cells of each cell type and condition are present in the dataset?</p>
<pre class="r"><code>triculture_clean@meta.data %&gt;% group_by(cell_type, orig.ident) %&gt;% 
  summarize(n = n()) %&gt;% 
  mutate(orig.ident = case_when(
                      orig.ident %in% c(&quot;ia&quot;, &quot;ia2&quot;) ~ &quot;Inf+EFZ&quot;, 
                      orig.ident == &quot;ca&quot; ~ &quot;Uninf&quot;,
                      orig.ident == &quot;ctl&quot; ~ &quot;Uninf+EFZ&quot;,
                      orig.ident == &quot;inf&quot; ~ &quot;Inf&quot;)) %&gt;% 
  pivot_wider(names_from = orig.ident, values_from = n) %&gt;% 
  kable(caption = &quot;Number of cells per condition and cell type&quot;) # to make table look nice in Rmarkdown
Warning: Values are not uniquely identified; output will contain list-cols.
* Use `values_fn = list` to suppress this warning.
* Use `values_fn = length` to identify where the duplicates arise
* Use `values_fn = {summary_fun}` to summarise duplicates</code></pre>
<table>
<caption>Number of cells per condition and cell type</caption>
<thead>
<tr class="header">
<th align="left">cell_type</th>
<th align="left">Uninf</th>
<th align="left">Uninf+EFZ</th>
<th align="left">Inf+EFZ</th>
<th align="left">Inf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">iAst</td>
<td align="left">1481</td>
<td align="left">686</td>
<td align="left">878, 944</td>
<td align="left">1269</td>
</tr>
<tr class="even">
<td align="left">iMg</td>
<td align="left">1163</td>
<td align="left">722</td>
<td align="left">632, 750</td>
<td align="left">1166</td>
</tr>
<tr class="odd">
<td align="left">iNeurons</td>
<td align="left">6733</td>
<td align="left">4899</td>
<td align="left">747, 2250</td>
<td align="left">3964</td>
</tr>
</tbody>
</table>
<hr />
</details>
</div>
<div id="infection-and-treatment-conditions" class="section level3">
<h3>Infection and treatment conditions</h3>
<p>Interestingly, the infected cells treated with EFZ (Inf+EFZ) clearly separate from the infected, but untreated cells (Inf) and the uninfected cells (Uninf, Uninf+EFZ) in the microglia cluster as can be seen in the figure below.</p>
<pre class="r"><code># rename origin of ident for easier interpretation
origin_vector &lt;- (triculture_clean@meta.data %&gt;% 
                    mutate(orig.ident = case_when(
                      orig.ident %in% c(&quot;ia&quot;, &quot;ia2&quot;) ~ &quot;Inf+EFZ&quot;, 
                      orig.ident == &quot;ca&quot; ~ &quot;Uninf&quot;,
                      orig.ident == &quot;ctl&quot; ~ &quot;Uninf+EFZ&quot;,
                      orig.ident == &quot;inf&quot; ~ &quot;Inf&quot;)))[[&quot;orig.ident&quot;]]

triculture_clean &lt;- AddMetaData(triculture_clean, origin_vector, col.name = &quot;orig.ident&quot;)</code></pre>
<pre class="r"><code>p1 &lt;- DimPlot(triculture_clean, reduction = &quot;tsne&quot;, pt.size = .01, label = TRUE,
        group.by = &quot;cell_type&quot;) + 
  labs(title = &quot;cell types&quot;)
p2 &lt;- DimPlot(triculture_clean, reduction = &quot;tsne&quot;, 
              group.by = &quot;orig.ident&quot;, pt.size = .01, ) + 
  labs(title = &quot;Infection &amp; treatment condition&quot;)

p1 + p2</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-18-1.png" width="1440" style="display: block; margin: auto;" /></p>
<details>
<summary>
<strong>Inflammatory gene expression in iMg</strong>
</summary>
<p>The largest change in gene expression related to inflammation was found in iMg among the 3 cell types <span class="citation">[@Ryan]</span>. Shown are only inflammatory genes.</p>
<pre class="r"><code>inflamm_genes &lt;- c(&quot;TNF&quot;, &quot;ACSL1&quot;, &quot;MGST3&quot;, &quot;B2M&quot;, &quot;IFNGR2&quot;, &quot;GRINA&quot;, &quot;TLR2&quot;, 
                   &quot;SOD2&quot;, &quot;GLUL&quot;, &quot;CFLAR&quot;, &quot;CTNNB1&quot;, &quot;CXCL8&quot;, &quot;CCL4&quot;, &quot;IL1B&quot;,
                   &quot;ATF4&quot;, &quot;CXCL8&quot;, &quot;CCL4&quot;, &quot;CCL2&quot;, &quot;IL1B&quot;, &quot;ATF4&quot;, &quot;CXCL1&quot;, 
                   &quot;NFKB1&quot;, &quot;TANK&quot;, &quot;APOE&quot;, &quot;TREM2&quot;, &quot;LY96&quot;, &quot;SRC&quot;, &quot;NCF1&quot;, 
                   &quot;HCK&quot;, &quot;LYN&quot;, &quot;VASP&quot;, &quot;C3&quot;, &quot;C5&quot;, &quot;RAP1B&quot;, &quot;RAP2B&quot;, &quot;MAF&quot;,
                   &quot;JUND&quot;, &quot;SQSTM1&quot;, &quot;FTH1&quot;, &quot;RHOQ&quot;, &quot;CD36&quot;, &quot;FOS&quot;, &quot;NFKBIA&quot;,
                   &quot;ICAM1&quot;, &quot;TNFAIP3&quot;, &quot;LYZ&quot;, &quot;PPP1R12A&quot;, &quot;RND3&quot;, &quot;CYBA&quot;, &quot;IRF8&quot;,
                   &quot;SLC25A6&quot;)

DoHeatmap(triculture_clean, features = inflamm_genes)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<hr />
</details>
<details>
<summary>
<strong>Differences of inflammatory gene expression between conditions</strong>
</summary>
<p>The gene expression of inflammatory genes in microglia was not very different between the conditions. The Inf+EFZ cells show a slightly different pattern of gene expression.</p>
<pre class="r"><code>DoHeatmap(subset(triculture_clean, cell_type == &quot;iMg&quot;), 
          features = inflamm_genes, group.by = &quot;orig.ident&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" /></p>
<hr />
</details>
</div>
</div>
<div id="integration-triculture-csfblood" class="section level1">
<h1>Integration Triculture &amp; CSF/Blood</h1>
<p>The HIV Blood &amp; CSF dataset <span class="citation">[@Farhadian]</span> used in the previous analysis was integrated with the triculture dataset <span class="citation">[@Ryan]</span>.</p>
<p>Integration of the two datasets is based on the Seurat package <span class="citation">[@Stuart]</span>. It first identifies anchors between datasets, calculates scores for all anchors and then calculates an integrated expression matrix which can be used for downstream analysis.</p>
<ol style="list-style-type: decimal">
<li>Identify features which are variable across datasets</li>
<li>Identify anchors between the two datasets and create an integrated data assay</li>
<li>Run a single integrated analysis on all cells</li>
</ol>
<details>
<summary>
<strong>Details on integration</strong>
</summary>
<p>For more details see: <span class="citation">[@Stuart]</span> and Discussion</p>
<ol style="list-style-type: decimal">
<li>Identify features which are variable across datasets</li>
<li>Identify anchors between the two datasets and create an integrated data assay</li>
<li>Run a single integrated analysis on all cells</li>
</ol>
<pre><code>hiv7 &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/total_7_samples_label_transfer.rds&quot;)
hiv7 &lt;- NormalizeData(hiv7, verbose = FALSE)
hiv7 &lt;- FindVariableFeatures(hiv7, verbose = FALSE)

# add both datasets to a lits
data_list &lt;- list(hiv = hiv7, triculture = triculture_clean)

# select features that are repeatedly variable across datasets for integration
features &lt;- SelectIntegrationFeatures(object.list = data_list, verbose = FALSE)

# identify integration anchors and perform integration
anchors &lt;- FindIntegrationAnchors(object.list = data_list, 
                                  anchor.features = features, verbose = FALSE) 
combined &lt;- IntegrateData(anchorset = anchors, verbose = FALSE)

# run analysis on integrated dataset
combined &lt;- ScaleData(combined, verbose = FALSE)
combined &lt;- RunPCA(combined, verbose = FALSE)
#ElbowPlot(combined)
combined &lt;- RunTSNE(combined, reduction = &quot;pca&quot;, dims = 1:10, verbose = FALSE)
combined &lt;- FindNeighbors(combined, reduction = &quot;pca&quot;, dims = 1:10, verbose = FALSE)
combined &lt;- FindClusters(combined, resolution = .3, verbose = FALSE)

# add annotations from which dataset the sample came from
dataset_vector &lt;- (combined@meta.data %&gt;% mutate(dataset = ifelse(orig.ident %in%
                                                 c(&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;,
                                                   &quot;HIV3_CSF&quot;, &quot;HIV1_Bld&quot;, 
                                                   &quot;HIV2_Bld&quot;, &quot;Uninfected1_CSF&quot;,
                                                   &quot;Uninfected2_CSF&quot;),
                                               &quot;csf&quot;, &quot;triculture&quot;)))[[&quot;dataset&quot;]]

combined &lt;- AddMetaData(combined, dataset_vector, col.name = &quot;dataset&quot;)

# add information on the cell groups in the combined datasets
combined_clusters &lt;- (combined@meta.data %&gt;% 
  mutate(combined_clusters = ifelse(seurat_clusters %in% c(2,10), &quot;Microglia&quot;, 
                            ifelse(seurat_clusters %in% c(3,9), &quot;iAst&quot;, 
                                   ifelse(seurat_clusters %in% c(0,1,7,11),
                                          &quot;iNeurons&quot;, 
                                          ifelse(seurat_clusters %in% c(8,5,6), &quot;Immune Cells&quot;, &quot;Undesignated&quot;))))))[[&quot;combined_clusters&quot;]]
  
combined &lt;- AddMetaData(combined, combined_clusters, col.name = &quot;combined_clusters&quot;)

#saveRDS(combined,&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Triculture_dataset_Ryan_paper/triculture_hiv_combined_seurat_object&quot;)
</code></pre>
<hr />
</details>
<div id="integrated-clusters" class="section level2">
<h2>Integrated clusters</h2>
<p>When integrating the CSF dataset and the Triculture dataset the iMg cells cluster together with the Myeloid cells from the CSF and Blood samples from the HIV infected/uninfected patients (see figure below). This is as expected, since they are both myeloid-lineage cells. However, it also makes it more difficult to draw conclusions on which of the five Myeloid clusters is the most microglia-like. Therefore, we had a closer look at this myeloid-lineage cluster consisting of iMg from triculture and Myeloid cells from CSF and Blood samples.</p>
<div id="visualization-of-the-integrated-dataset" class="section level4">
<h4>Visualization of the integrated dataset</h4>
<pre class="r"><code>combined = readRDS(&quot;seurat_objects/triculture_hiv_combined_seurat_object_2&quot;)

p1 &lt;- DimPlot(combined, reduction = &quot;tsne&quot;, group.by  = &quot;dataset&quot;,
              label = TRUE) + NoLegend() +
  labs(title = &quot;Dataset&quot;)
p2 &lt;- DimPlot(combined, reduction = &quot;tsne&quot;, group.by = &quot;cell_type&quot;,
              label = TRUE, repel = TRUE) + NoLegend() +
  labs(title = &quot;Cell types&quot;)
p3 &lt;- DimPlot(combined, reduction = &quot;tsne&quot;, group.by = &quot;cell_type&quot;,
              split.by = &quot;dataset&quot;, label = TRUE, repel = TRUE) + NoLegend() +
  labs(title = &quot;Cell types split into datasets&quot;)
p4 &lt;- DimPlot(combined, reduction = &quot;tsne&quot;, group.by = &quot;seurat_clusters&quot;,
              label = TRUE) + NoLegend() +
  labs(title = &quot;Clusters&quot;)

a1 &lt;- DimPlot(combined, reduction = &quot;tsne&quot;, split.by = &quot;dataset&quot;, 
        group.by = &quot;seurat_clusters&quot;, label = TRUE, repel =TRUE) +
  NoLegend() +
  labs(title = &quot;Clusters split into datasets&quot;)

a2 &lt;- DimPlot(combined, reduction = &quot;tsne&quot;, split.by = &quot;dataset&quot;, 
              group.by = &quot;orig.ident&quot;) +
  labs(title = &quot;Sample origin split into datasets&quot;)

ggarrange(p1, p2, p3,p4, a1, a2, ncol = 2, nrow = 3)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-21-1.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="myeloid-lineage-cluster" class="section level2">
<h2>Myeloid lineage cluster</h2>
<div id="visualization-of-myeloid-lineage-cluster-img-myeloid12345" class="section level4">
<h4>Visualization of Myeloid lineage cluster (iMg, Myeloid1/2/3/4/5)</h4>
<p>The plot below visualizes that iMg and CSF/Blood Myeloid cells cluster together, independent of their infection status.</p>
<pre class="r"><code>subset_monocytes &lt;- subset(combined, cell_type %in% c(&quot;Myeloid1&quot;, 
                                                            &quot;Myeloid2&quot;, 
                                                            &quot;Myeloid3&quot;, 
                                                            &quot;Myeloid4&quot;, 
                                                            &quot;Myeloid5&quot;, 
                                                            &quot;iMg&quot;))

p1 &lt;- DimPlot(subset_monocytes, group.by = &quot;cell_type&quot;) +
  labs(title = &quot;Cell type&quot;)
p2 &lt;- DimPlot(subset_monocytes, group.by = &quot;orig.ident&quot;) +
  labs(title = &quot;Sample origin&quot;)
p3 &lt;- DimPlot(subset_monocytes, group.by = &quot;seurat_clusters&quot;) +
  labs(title = &quot;Cluster&quot;)
fig &lt;- ggarrange(p1, p2, p3, ncol = 3, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;Myeloid-lineage cells&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-22-1.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
<div id="visualization-of-infected-efz-img-infected-myeloid12345" class="section level4">
<h4>Visualization of infected + EFZ iMg &amp; infected Myeloid1/2/3/4/5</h4>
<p>As expected the CSF/Blood Myeloid cells from infected patients cluster together with infected + EFZ iMg and mainly contribute to the same subcluster, as can be seen in the plot below, which shows only infected CSF/Blood Myeloid cells and the infected + EFZ iMg. Myeloid4 is an exception and belongs to a different subcluster.</p>
<pre class="r"><code>
subset_infected &lt;- subset(combined, orig.ident %in% c(&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;,
                                             &quot;HIV1_Bld&quot;, &quot;HIV2_Bld&quot;,&quot;Inf+EFZ&quot;) &amp;
                            cell_type %in% c(&quot;Myeloid1&quot;, 
                                                            &quot;Myeloid2&quot;, 
                                                            &quot;Myeloid3&quot;, 
                                                            &quot;Myeloid4&quot;, 
                                                            &quot;Myeloid5&quot;, 
                                                            &quot;iMg&quot;))


p1 &lt;- DimPlot(subset_infected, group.by = &quot;cell_type&quot;) +
  labs(title = &quot;Cell Type&quot;)
p2 &lt;- DimPlot(subset_infected, group.by = &quot;orig.ident&quot;) +
  labs(title = &quot;Sample origin&quot;)
p3 &lt;- DimPlot(subset_infected, group.by = &quot;seurat_clusters&quot;) +
  labs(title = &quot;Clusters&quot;)
fig &lt;- ggarrange(p1, p2, p3, ncol = 3, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;Infected CSF/Blood Myeloid cells &amp; Inf+EFZ iMg&quot;))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-23-1.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
<div id="cell-types-and-conditions-partially-separate-according-to-the-two-img-clusters" class="section level4">
<h4>Cell types and conditions partially separate according to the two iMg clusters</h4>
<p>The myeloid-lineage cluster separated into two distinct subclusters. Interestingly, the infected + EFZ iMg separated clearly from the infected iMg. The separation was not so clear for the uninfected +/- EFZ cells, which contributed to both subclusters. Another observations is that the infected Myeloid1/2/3/5 cells belong to the same subcluster as the infected + EFZ iMg. Conversely, the Myeloid4 cells cluster with the infected iMg. Since the infected CSF/Blood Myeloid cells originate from HIV infected and treated patients we would expect them to cluster togehter with the infected + EFZ iMg. However, there might also be infected CSF/Blood Myeloid cells which are not affected by the treatment. The Myeloid4 cells which are from Blood samples might consitute an infected cell population unaffected by the ART treatment.</p>
<pre class="r"><code>
DimPlot(subset_monocytes, group.by = &quot;seurat_clusters&quot;, 
        split.by = &quot;orig.ident&quot;, ncol = 4) +
  labs(title = &quot;Contribution of different samples to different subclusters&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-24-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>DimPlot(subset_monocytes, group.by = &quot;seurat_clusters&quot;, 
        split.by = &quot;cell_type&quot;, ncol = 3) +
  labs(title = &quot;Contribution of different cell types to different subclusters&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-24-2.png" width="1440" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="de-nove-clustering" class="section level2">
<h2>De-nove clustering</h2>
<p>Next, de-novo clustering of the myeloid-lineage cluster of the integrated dataset was performed. Isolating the iMg and all Myeloid cell clusters from the integrated dataset and normalizing, scaling and re-clustering these isolated cells might<br />
give us additional insights.</p>
<details>
<summary>
Details on de-novo clustering
</summary>
<pre><code>
microglia &lt;- subset(combined, cell_type %in% c(&quot;iMg&quot;,
                                                &quot;Myeloid1&quot;,
                                                &quot;Myeloid2&quot;,
                                                &quot;Myeloid3&quot;,
                                                &quot;Myeloid4&quot;,
                                                &quot;Myeloid5&quot;))
microglia_recluster &lt;- SCTransform(microglia, verbose = FALSE)
microglia_recluster &lt;- ScaleData(microglia_recluster, verbose = FALSE)
microglia_recluster &lt;- RunPCA(microglia_recluster, verbose = FALSE)
ElbowPlot(microglia_recluster)
microglia_recluster &lt;- RunTSNE(microglia_recluster, reduction = &quot;pca&quot;, dims = 1:10)
microglia_recluster &lt;- FindNeighbors(microglia_recluster)
microglia_recluster &lt;- FindClusters(microglia_recluster, resolution = 0.5)</code></pre>
<hr />
</details>
<p>It is no surprise that cells from the triculture dataset separate from the CSF/Blood-derived cells which can be seen in the plot below. When reclustering the myeloid lineage derived cells,five subclusters for the iMg and three subclusters for the five CSF/Blood Myeloid clusters are obtained. It can also be observed that the Myeloid2 and Myeloid5 separate from Myeloid1/2/3 which is expected, since Myeloid2/5 originate from CSF samples and Myeloid1/3/4 originate from blood samples.</p>
<pre class="r"><code>microglia_recluster &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Triculture_dataset_Ryan_paper/microglia_myeloid_seurat_object_reclustering&quot;)
a1 &lt;- DimPlot(microglia_recluster, reduction = &quot;tsne&quot;,
              group.by = &quot;seurat_clusters&quot;, pt.size = .4) +
  labs(title = &quot;Clustering&quot;)
a2 &lt;- DimPlot(microglia_recluster, reduction =&quot;tsne&quot;, 
              group.by = &quot;cell_type&quot;, pt.size = .4) +
  labs(title = &quot;Cell type&quot;)
a3 &lt;- DimPlot(microglia_recluster, reduction =&quot;tsne&quot;,
              group.by = &quot;dataset&quot;, pt.size = .4) +
    labs(title = &quot;Dataset&quot;)
a4 &lt;- DimPlot(microglia_recluster, reduction = &quot;tsne&quot;,
              group.by = &quot;orig.ident&quot;, pt.size = .4) +
  labs(title = &quot;Sample origin&quot;)

fig &lt;- ggarrange(a1, a2, a3, a4, ncol = 2, nrow = 2)
annotate_figure(fig, 
                top = text_grob(&quot;De-novo clustering of myeloid-lineage clusters&quot;, 
               color = &quot;black&quot;, face = &quot;bold&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-25-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>Interestingly, both the Myeloid5 cells and the Myeloid2 cells are split between the cluster six (blue) and seven (purple) in the figure below. In the following we will have a closer look at this segregation. When performing GRN inference with Scenic we also identified two potentially biologically relevant subclusters of the Myeloid2 cells. It could be that these independently found clusters correlate.</p>
<pre class="r"><code>a5 &lt;- DimPlot(microglia_recluster, reduction =&quot;tsne&quot;, 
              split.by = &quot;cell_type&quot;, pt.size = .4, ncol=3) +
  labs(title = &quot;Contribution of different cell types to different myeloid clusters&quot;)
a5</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-26-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>It looks like the two clusters identified this way correspond to different sample origins. CSF cells from patient1 (HIV1_CSF) and patient2 (HIV2_CSF) belong to cluster six, while CSF cells from patient3 (HIV3_CSF) and the two uninfected patients (Uninfected1_CSF, Uninfected2_CSF) belong to cluster seven. The separation of patient3 (HIV3_CSF) from patient1 (HIV1_CSF) and patient2 (HIV2_CSF) might correspond to a batch effect, or it might be a biological effect, for example, the infection might have affected the cells differently.</p>
<pre class="r"><code>#a1 &lt;- DimPlot(subset(microglia_recluster, cell_type == &quot;iMg&quot;), reduction = &quot;tsne&quot;,
           #   group.by = &quot;orig.ident&quot;, pt.size = .4)
a2 &lt;- DimPlot(subset(microglia_recluster, cell_type != &quot;iMg&quot;), reduction = &quot;tsne&quot;,
              group.by = &quot;orig.ident&quot;, pt.size = .4) +
  labs(title = &quot;Sample origin&quot;)
#a3 &lt;- DimPlot(subset(microglia_recluster, cell_type == &quot;iMg&quot;), reduction = &quot;tsne&quot;,
              #group.by = &quot;seurat_clusters&quot;, pt.size = .4)
a4 &lt;- DimPlot(subset(microglia_recluster, cell_type != &quot;iMg&quot;), reduction = &quot;tsne&quot;,
              group.by = &quot;seurat_clusters&quot;, pt.size = .4) +
  labs(title = &quot;Cluster&quot;)
fig &lt;- ggarrange(a2, a4, ncol = 2, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;CSF/Blood Myeloid cells&quot;, 
                                     face = &quot;bold&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-27-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>Since the segregation into two clusters seems to be related to the sample origin rather than to the infection status, we would not expect the clusters to overlap with the clusters identified after GRN inference with SCENIC. In the figure below it can be seen that the clusters do not overlap (only the Myeloid2 cells from infected CSF samples (HIV1_CSF, HIV2_CSF, HIV3_CSF) are shown). For this reason the reclustering did not lead to any useful insights and will not be analyzed further.</p>
<pre class="r"><code># read in Myeloid2 cells
hivmy2 &lt;- readRDS(&quot;data_files/hiv_myeloid2_subclusters&quot;)

my2 &lt;- subset(microglia_recluster, cell_type == &quot;Myeloid2&quot; &amp; 
                orig.ident %in% c(&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;))

my2 &lt;- AddMetaData(my2, hivmy2@meta.data[&quot;ht_cluster&quot;], 
                   col.name = &quot;TF_activity_clusters&quot;)
p1 &lt;- DimPlot(my2, group.by = &quot;seurat_clusters&quot;) +
  labs(title=&quot;Clusters&quot;)
p2 &lt;- DimPlot(my2, group.by = &quot;TF_activity_clusters&quot;) +
  labs(title = &quot;TF activity&quot;)
p3 &lt;- DimPlot(my2, group.by = &quot;orig.ident&quot;) +
  labs(title = &quot;Sample origin&quot;)
figure &lt;- ggarrange(p1, p2, p3, ncol = 3, nrow = 1)
annotate_figure(figure, 
                top = text_grob(&quot;Comparison with clusters of different TF acitivty&quot;, 
               color = &quot;black&quot;, face = &quot;bold&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-28-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>#my25 &lt;- subset(microglia, seurat_clusters %in% c(6,7) &amp;cell_type %in% c(&quot;Myeloid2&quot;, &quot;Myeloid5&quot;))</code></pre>
</div>
</div>
<div id="differential-gene-expression" class="section level1">
<h1>Differential gene expression</h1>
<div id="between-infection-conditions" class="section level3">
<h3>Between infection conditions</h3>
<p>In the following I will compare gene expression between infected cells and uninfected cells, both treated with EFZ and not treated. I will use the uninfected cells as a baseline to find genes which are upregulated or downregulated in infected cells compared to uninfected cells. Since we have both cells treated with EFZ and cells not treated with EFZ, we can define a signature for both treatment conditions separately and then see if there is an overlap between the gene signatures of infected cells +/- EFZ. Finding genes which overlap independently of treamtent condition increases the confidence in the results</p>
<details>
<summary>
<strong>List if top up- or downregulated genes in Inf+EFZ vs Uninf+EFZ</strong>
</summary>
<pre class="r"><code># isolate iMg cells
microglia &lt;- subset(combined, cell_type == &quot;iMg&quot;)

# only iMg cells to identify potential signatures between infected vs uninfected
Idents(microglia) =  &quot;orig.ident&quot;

# find marker genes between Uninf+EFZ and Inf+EFZ
inf_uninf_art_marker &lt;- FindMarkers(microglia, ident.1 = &quot;Inf+EFZ&quot;, 
                                    ident.2 = &quot;Uninf+EFZ&quot;, verbose = FALSE)
#upregulated genes
up_inf_art &lt;- inf_uninf_art_marker %&gt;% 
  arrange(desc(avg_log2FC)) %&gt;%
  head(20) %&gt;% 
  rownames_to_column(&quot;gene&quot;)
up_inf_art  %&gt;% head %&gt;%  kable(caption = &quot;Genes upregulated in Inf+EFZ vs. Uninf+EFZ&quot;)</code></pre>
<table>
<caption>Genes upregulated in Inf+EFZ vs. Uninf+EFZ</caption>
<thead>
<tr class="header">
<th align="left">gene</th>
<th align="right">p_val</th>
<th align="right">avg_log2FC</th>
<th align="right">pct.1</th>
<th align="right">pct.2</th>
<th align="right">p_val_adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">RAB32</td>
<td align="right">0</td>
<td align="right">1.2840817</td>
<td align="right">0.656</td>
<td align="right">0.291</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NUPR1</td>
<td align="right">0</td>
<td align="right">1.0569999</td>
<td align="right">0.680</td>
<td align="right">0.460</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">HMOX1</td>
<td align="right">0</td>
<td align="right">0.9031207</td>
<td align="right">0.597</td>
<td align="right">0.309</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">PDK4</td>
<td align="right">0</td>
<td align="right">0.8673561</td>
<td align="right">0.204</td>
<td align="right">0.019</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">SLC38A2</td>
<td align="right">0</td>
<td align="right">0.8452040</td>
<td align="right">0.288</td>
<td align="right">0.079</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">LPAR6</td>
<td align="right">0</td>
<td align="right">0.8045929</td>
<td align="right">0.579</td>
<td align="right">0.289</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code># downregulated genes
down_inf_art &lt;- inf_uninf_art_marker %&gt;% 
  arrange(avg_log2FC) %&gt;% 
  head(20) %&gt;%
  rownames_to_column(&quot;gene&quot;)
down_inf_art %&gt;% head %&gt;% kable(caption = &quot;Genes downregulated in Inf+EFZ vs. Uninf+EFZ&quot;)</code></pre>
<table>
<caption>Genes downregulated in Inf+EFZ vs. Uninf+EFZ</caption>
<thead>
<tr class="header">
<th align="left">gene</th>
<th align="right">p_val</th>
<th align="right">avg_log2FC</th>
<th align="right">pct.1</th>
<th align="right">pct.2</th>
<th align="right">p_val_adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">MT1X</td>
<td align="right">0</td>
<td align="right">-3.413896</td>
<td align="right">0.147</td>
<td align="right">0.735</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">MT2A</td>
<td align="right">0</td>
<td align="right">-3.113559</td>
<td align="right">0.167</td>
<td align="right">0.695</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">CCL4</td>
<td align="right">0</td>
<td align="right">-3.102918</td>
<td align="right">0.321</td>
<td align="right">0.910</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">CCL4L2</td>
<td align="right">0</td>
<td align="right">-2.676517</td>
<td align="right">0.235</td>
<td align="right">0.816</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">CCL3L1</td>
<td align="right">0</td>
<td align="right">-2.579091</td>
<td align="right">0.290</td>
<td align="right">0.807</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">CCL3</td>
<td align="right">0</td>
<td align="right">-2.560332</td>
<td align="right">0.611</td>
<td align="right">0.982</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<hr />
</details>
<pre class="r"><code># find marker genes between Inf and Uninf
inf_uninf_marker &lt;- FindMarkers(microglia, ident.1 = &quot;Inf&quot;, 
                                ident.2 = &quot;Uninf&quot;, verbose = FALSE)

# upregulated in Inf vs Uninf, no treatment
up_inf_no &lt;- inf_uninf_marker %&gt;% 
  arrange(desc(avg_log2FC)) %&gt;%
  head(20) %&gt;% 
  rownames_to_column(&quot;gene&quot;)
#up_inf_no  %&gt;% kable()


down_inf_no &lt;- inf_uninf_marker %&gt;% 
  arrange(avg_log2FC) %&gt;% 
  head(20) %&gt;%
  rownames_to_column(&quot;gene&quot;)
#down_inf_no%&gt;% kable()</code></pre>
<p>Only 3% of genes which are upregulated and only 14% of genes which are downregulated in infected vs. uninfected cells overlap between the treatment conditions. This means, that the gene expression response defining the infection might differ between cells with and without treatment. This reflects the findings of <span class="citation">[@Ryan]</span> that the EFZ treatment leads to a distinct immune response of iMg and distinct activation of two inflammatory pathways, RhoGDI and CD40 pathways as will be described later on. Since there is hardly any overlap we will use the genes upregulated in Inf+EFZ compared to Uninf+EFZ in the following analysis steps, because they probably resemble the CSF/Blood samples, which originate from patients treated with ART, best.</p>
<pre class="r"><code>up_inf &lt;- intersect(up_inf_art$gene, up_inf_no$gene)
down_inf &lt;- intersect(down_inf_art$gene, down_inf_no$gene)
print(c(up_inf, down_inf))
[1] &quot;HMOX1&quot;  &quot;MT1X&quot;   &quot;MT2A&quot;   &quot;CCL4L2&quot; &quot;RND3&quot;   &quot;H1F0&quot;  </code></pre>
<pre class="r"><code>p1 &lt;- ggVennDiagram::ggVennDiagram(list(up_inf_art$gene, up_inf_no$gene),
              label_alpha = 0,
              category.names= c(&quot;Inf+EFZ&quot;, &quot;Inf&quot;),
              #set.size = 20,
              label = &quot;percent&quot;,
              label_size = 6) +
   scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;Genes upregulated in infected cells&quot;)

p2 &lt;- ggVennDiagram::ggVennDiagram(list(down_inf_art$gene, down_inf_no$gene),
              label_alpha = 0,
              category.names= c(&quot;Inf+EFZ&quot;, &quot;Inf&quot;),
              #set.size = 20,
              label = &quot;percent&quot;,
              label_size = 6) +
  scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;Genes downregulated in infected cells&quot;)

ggarrange(p1, p2, ncol = 2)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-33-1.png" width="1440" style="display: block; margin: auto;" /></p>
<details>
<summary>
<strong>Volcano Plot of Infection (+ EFZ) signature</strong>
</summary>
<p>Interestingly, the genes downregulatd in Inf+EFZ vs. Uninfected cells show a higher average log fold change with higher significance (p-values).</p>
<pre class="r"><code>inf_uninf_art_marker %&gt;% 
  rownames_to_column(&quot;gene&quot;) %&gt;%
  filter(gene %in% c(up_inf_art$gene, down_inf_art$gene)) %&gt;% 
  # add a column containing information in which condition the corresponding TF 
  # is upregulated
  mutate(condition = case_when(gene %in% up_inf_art$gene ~ &quot;upregulated&quot;,
                               gene %in% down_inf_art$gene ~ &quot;downregulated&quot;,
                               TRUE ~ &quot;NA&quot;)) %&gt;%
  # add a column conaining the labels for the plot
  # I only want to label cells which are also found by Scenic
  mutate(label = ifelse(gene %in% c(up_inf_art$gene, down_inf_art$gene), gene, NA)) %&gt;% 
  ggplot(aes(x = avg_log2FC,
             y = -log10(p_val_adj),
             col = condition, 
             label = label)) +
  geom_point() +
  geom_hline(yintercept = -log10(1e-50), col = &quot;red&quot;) +
  geom_text(nudge_x = .05, nudge_y = 2) +
  labs(title = &quot;Genes which are up- or downregulated in Inf+EFZ vs Uninf+EFZ&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-34-1.png" width="1152" style="display: block; margin: auto;" /></p>
<hr />
</details>
</div>
<div id="between-treatment-conditions" class="section level3">
<h3>Between treatment conditions</h3>
<p>Comparing uninfected + EFZ with uninfected and infected + EFZ with infected iMg it might be possible to identify genes which are different after treatment of cells with EFZ. Finding overlapping genes between the two infection states increases the confidence in the results, because the identified genes are associated with treatment independently of infection status.</p>
<p>The diagram below shows, that 36% of genes are upregulated both in infected and infected + EFZ iMg compared to uninfected and uninfected + EFZ iMg. These genes are probably associated with the EFZ treatment. The same is true for 44% of the downregulated genes. The drug affects the iMg and changes their gene expression. This signature might be used to identify Myeloid2 CSF cells which are affected by the treatment. Since ART drugs are found at lower concentrations in CSF than in blood, probably only a subgroup of Myeloid2 are affected by the ART drugs. It would be interesting to know which are affected by treatment and which are not. However, this comparison might be farfetched, since the patients from which the CSF samples have been derived have not been treated with EFZ, but with a combination of other ART drugs which probably have a slightly different effect on cells.</p>
<pre class="r"><code>treatment_marker_uninf &lt;- FindMarkers(microglia, ident.1 = &quot;Uninf+EFZ&quot;, 
                                ident.2 = &quot;Uninf&quot;, verbose = FALSE)

# find marker genes between Inf+EFZ and Inf
treatment_marker_inf &lt;- FindMarkers(microglia, ident.1 = &quot;Inf+EFZ&quot;, ident.2 = &quot;Inf&quot;)

# overlap between upregulated genes
treatment_up &lt;- intersect((treatment_marker_inf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &gt; 0))$gene, 
           (treatment_marker_uninf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &gt; 0))$gene)

treatment_down &lt;- intersect((treatment_marker_inf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &lt; 0))$gene, 
           (treatment_marker_uninf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &lt; 0))$gene)
treatment_marker &lt;- c(treatment_up, treatment_down)</code></pre>
<pre class="r"><code>p1 &lt;- ggVennDiagram::ggVennDiagram(list((treatment_marker_inf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &gt; 0))$gene, 
             (treatment_marker_uninf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &gt; 0))$gene),
              label_alpha = 0,
              category.names= c(&quot;Inf+EFZ&quot;, &quot;Uninf+EFZ&quot;),
              #set.size = 20,
              label = &quot;percent&quot;,
              label_size = 6) +
   scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;Genes upregulated in cells treated with EFZ&quot;)

p2 &lt;- ggVennDiagram::ggVennDiagram(list((treatment_marker_inf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &lt; 0))$gene, 
             (treatment_marker_uninf %&gt;% 
             rownames_to_column(&quot;gene&quot;) %&gt;% 
             filter(avg_log2FC &lt; 0))$gene),
              label_alpha = 0,
              category.names= c(&quot;Inf+EFZ&quot;, &quot;Uninf+EFZ&quot;),
              #set.size = 20,
              label = &quot;percent&quot;,
              label_size = 6,
              set_color = c(&quot;red&quot;, &quot;blue&quot;)) +
  scale_fill_distiller(palette = &quot;RdBu&quot;) +
  labs(title = &quot;Genes downregulated in cells treated with EFZ&quot;)

ggarrange(p1, p2, ncol = 2)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-36-1.png" width="1440" style="display: block; margin: auto;" /></p>
<details>
<summary>
<strong>Volcano Plot of Treatment signature</strong>
</summary>
<pre class="r"><code>treatment_marker_uninf %&gt;% 
  rownames_to_column(&quot;gene&quot;) %&gt;%
  filter(gene %in% treatment_marker) %&gt;% 
  # add a column containing information in which condition the corresponding TF 
  # is upregulated
  mutate(condition = case_when(gene %in% treatment_up ~ &quot;upregulated&quot;,
                               gene %in% treatment_down ~ &quot;downregulated&quot;,
                               TRUE ~ &quot;NA&quot;)) %&gt;%
  # add a column conaining the labels for the plot
  # I only want to label cells which are also found by Scenic
  #mutate(label = ifelse(gene %in% c(up_inf$gene, down_inf$gene), gene, NA)) %&gt;% 
  ggplot(aes(x = avg_log2FC,
             y = -log10(p_val_adj),
             col = condition, 
             label = gene)) +
  geom_point() +
  geom_hline(yintercept = -log10(1e-10), col = &quot;red&quot;) +
  geom_text(nudge_x = .05, nudge_y = 2) +
  labs(title = &quot;Top 20 Genes which are up/downregulated in treatment vs. no treatment, Uninf cells&quot;)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-37-1.png" width="1152" style="display: block; margin: auto;" /></p>
<hr />
</details>
</div>
</div>
<div id="infection-treatment-gene-signature" class="section level1">
<h1>Infection &amp; treatment gene signature</h1>
<p>Checking the differentially expressed genes and trying to identify an infection signature through literature search turned out to be very difficult. Therefore, a different approach was used. The top twenty up- and downregulated genes in Inf+EFZ vs Uninf+EFZ were computed. Using these genes as an “infection signature” it will be investigated whether some of the Myeloid2 cells from the CSF samples show a similar signature.</p>
<pre class="r"><code># select only genes which are also found in the sc-RNAseq dataset
up_inf_filt &lt;- up_inf_art$gene[up_inf_art$gene %in% rownames(hivmy2@assays$RNA@counts)]
down_inf_filt &lt;- down_inf_art$gene[down_inf_art$gene %in% rownames(hivmy2@assays$RNA@counts)]</code></pre>
<div id="gene-signature-scoring-in-myeloid2-cells" class="section level2">
<h2>Gene signature scoring in Myeloid2 cells</h2>
<p>Using the signature genes from differential gene expression analysis between Inf+EFZ and Uninf+EFZ we can compute a score of activity of these gene sets in the Myeloid2 cluster of CSF samples. We can plot these scores in a t-SNE representation, but we can also get the scores from the metadata and use them for other visualizations. If the Inf+EFZ signature can be found in some of the Myeloid2 cells from the CSF samples this might provide additional insights about the infection status of these microglia-like cells.</p>
<div id="scores-of-gene-signature-upregulated-in-infefz-img-in-myeloid2-cells" class="section level4">
<h4>Scores of gene signature upregulated in Inf+EFZ iMg in Myeloid2 cells</h4>
<p>In the plot below there are some cells visible which have a high score for the signature composed of genes upregulated in Inf+EFZ iMg To be precise, 63% percent of the Myeloid2 cells have a positive score (92 out of 145 cells). These high scoring cells do, however, not correspond to the two clusters (c1, c2) obtained from analysis of TF activity (SCENIC).</p>
<pre class="r"><code>up_sign &lt;- AddModuleScore(hivmy2,
                           features = list(up_inf_filt),
                          name = &quot;upregulated&quot;)

p1 &lt;- FeaturePlot(subset(up_sign, ht_cluster == &quot;c1&quot;),
                  features = &quot;upregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c1&quot;)

p2 &lt;- FeaturePlot(subset(up_sign, ht_cluster == &quot;c2&quot;),
                  features = &quot;upregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c2&quot;)

figure &lt;- ggarrange(p1, p2, ncol = 2)
annotate_figure(figure, top = text_grob(&quot;Signature score of genes upregulated in Inf+EFZ iMg applied to CSF Myeloid2 cells&quot;, 
               color = &quot;black&quot;, face = &quot;bold&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-39-1.png" width="1440" style="display: block; margin: auto;" /></p>
<details>
<summary>
<strong>Exact scores for each cell</strong>
</summary>
<pre class="r"><code># divide the number of rows(cells) with positive ccores by the number of total 
# rows(cells) to get the percentage of cells with positive scores.
percentage_inf &lt;- dim(up_sign@meta.data %&gt;% filter(upregulated1 &gt; 0))[1] / 
  dim(up_sign@meta.data[&quot;upregulated1&quot;])[1]

# show the positive scores.
up_sign@meta.data[&quot;upregulated1&quot;] %&gt;% 
  filter(upregulated1 &gt; 0) %&gt;% 
  rename(&quot;Score&quot; = &quot;upregulated1&quot;) %&gt;% head %&gt;% 
  kable(caption = &quot;upregulated scores&quot;)</code></pre>
<table>
<caption>upregulated scores</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">3C_AGCCTACTTTGC</td>
<td align="right">0.1589238</td>
</tr>
<tr class="even">
<td align="left">3C_ACATGCACGTAC</td>
<td align="right">0.3738196</td>
</tr>
<tr class="odd">
<td align="left">3C_AGATCAAGTGGA</td>
<td align="right">0.2420711</td>
</tr>
<tr class="even">
<td align="left">3C_AGCAATTTAAGG</td>
<td align="right">0.0845383</td>
</tr>
<tr class="odd">
<td align="left">3C_GTAGTTGACTCA</td>
<td align="right">0.2795329</td>
</tr>
<tr class="even">
<td align="left">3C_ATCTATTATGTG</td>
<td align="right">0.1296210</td>
</tr>
</tbody>
</table>
<hr />
</details>
</div>
<div id="scores-of-gene-signature-downregulated-in-infefz-img-in-myeloid2-cells" class="section level4">
<h4>Scores of gene signature downregulated in Inf+EFZ iMg in Myeloid2 cells</h4>
<p>As can be seen in the plot below there are some cells with a neagative score for the gene signature. To be precise, 58% of of all cells (85 out of 146) have a negative score. Next, it would be interesting to know if some of this cells are the same as those with a high score for the upregulated genes. Identifying cells in which both the upregulated gene signature and the downregulated gene signature have a positive or negative score respectively increases the confidence in the results. 51 cells have both a positive score for the upregulated genes and a negative score for the downregulated genes. Cells exhibiting this specific pattern of gene expression are likely infected cells. Since the infection status of the cells in the CSF sample is unknown this provides valuable new insights.</p>
<pre class="r"><code>
down_sign &lt;- AddModuleScore(hivmy2,
                           features = list(down_inf_filt), name = &quot;downregulated&quot;)

p1 &lt;- FeaturePlot(subset(down_sign, ht_cluster == &quot;c1&quot;),
                  features = &quot;downregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c1&quot;)

p2 &lt;- FeaturePlot(subset(down_sign, ht_cluster == &quot;c2&quot;),
                  features = &quot;downregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c2&quot;)

figure &lt;- ggarrange(p1, p2, ncol = 2)
annotate_figure(figure, top = text_grob(&quot;Signature score of genes downregulated in Inf+EFZ iMg applied to CSF Myeloid2 cells&quot;, 
               color = &quot;black&quot;, face = &quot;bold&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-41-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code># divide the number of rows(cells) with negative scores by the number of total 
# rows(cells) to get the percentage of cells with negative scores.
percentage_inf &lt;- dim(down_sign@meta.data %&gt;% filter(downregulated1 &lt; 0))[1] / 
  dim(down_sign@meta.data[&quot;downregulated1&quot;])[1]

# extract list of cells with positive/negative scores and find the overlap
cells_down &lt;- rownames(down_sign@meta.data %&gt;% filter(downregulated1 &lt; 0))
cells_up &lt;- rownames(up_sign@meta.data %&gt;% filter(upregulated1 &gt; 0))
inf_efz_cells &lt;- intersect(cells_up, cells_down)</code></pre>
<details>
<summary>
<strong>Defining a signature composed of downregulated genes</strong>
</summary>
<p>Defining a gene signature composed of both up- and downregulated genes turned out to be more difficult than expected. The idea was to separately investigate upregulated versus downregulated genes. Above the upregulated and downregulated gene signature scores in Myeloid2 cells were shown.</p>
<p>We will now have a closer look at the problems that arise when investigating downregulated genes. Assuming that our Myeloid2 cells are composed of two distinct populations, one infected and one uninfected, we would expect a bimodal distribution of gene expression for genes upregulated in the infected condition. There should be one peak with base level gene expression corresponding to uninfected cells and a second peak with higher levels of gene expression corresponding to infected cells.</p>
<p>In the histograms below the distribution of the sum of log-normalized feature counts of genes upregulated or downregulated respectively can be seen. For the upregulated genes (green) a bimodal distribution is not evident from the histogram below. No clear conclusions can be drawn, since the number of cells is probably too low.</p>
<p>For the downregulated genes (red) there seem to be a large number of cells which do not express these genes at all. This group of cells could include infected cells, however this is a dangerous assumption, since in general there might be cells with low or none expression of these genes. There is no way to know if these cells are actually infected cells.</p>
<pre class="r"><code>#normalize counts of upregulated genes
counts_up &lt;- (hivmy2@assays$RNA@data)
counts_up &lt;- t(t(counts_up)) / colSums(counts_up)
counts_up &lt;- log1p(counts_up)
counts_up &lt;- counts_up[up_inf_filt, ]

# compute average expression of the 20 signature genes
p1 &lt;- as.data.frame(rowSums(t(counts_up))) %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  rename(&quot;count&quot; = &quot;rowSums(t(counts_up))&quot;) %&gt;% 
  arrange(desc(count)) %&gt;% 
  ggplot(aes(x  = count)) +
  geom_histogram(bins = 70, color = &quot;olivedrab4&quot;, fill = &quot;olivedrab4&quot;) +
  xlab(&quot;normalized feature counts&quot;) +
  ylab(&quot;number of cells&quot;) +
  ylim(0,100) +
  labs(title = &quot;Sum of feature counts of genes upregulated in Inf+EFZ vs. Uninf+EFZ&quot;)

#normalize counts of downregulated genes
counts_down &lt;- (hivmy2@assays$RNA@data)
counts_down &lt;- t(t(counts_down)) / colSums(counts_down)
counts_down &lt;- log1p(counts_down)
counts_down &lt;- counts_down[down_inf_filt, ]

# compute average expression of the 20 signature genes
p2 &lt;- as.data.frame(rowSums(t(counts_down))) %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  rename(&quot;count&quot; = &quot;rowSums(t(counts_down))&quot;) %&gt;% 
  arrange(desc(count)) %&gt;% 
  ggplot(aes(x  = count)) +
  geom_histogram(bins = 70, color = &quot;red4&quot;, fill = &quot;red4&quot;) +
  xlab(&quot;normalized feature counts&quot;) +
  ylab(&quot;number of cells&quot;) +
  labs(title = &quot;Sum of feature count of genes downregulated in Inf+EFZ vs. Uninf+EFZ&quot;)</code></pre>
<pre class="r"><code>p1 + p2</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-44-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</details>
</div>
<div id="scores-of-gene-signature-up--or-downregulated-in-cells-treated-with-efz-independently-of-infection-condition." class="section level4">
<h4>Scores of gene signature up- or downregulated in cells treated with EFZ independently of infection condition.</h4>
<p>Of the Myeloid2 cells 70% (103 out of 146 cells) have a score above 0.2 for the upregulated gene signature. Only 26% of cells have a negative score (below 0) for the downregulated gene signature. Again, to increase the confidence in the results, the overlap between the cells with up/downregulated gene signatures was identified. Only 15 cells have both a positive and negative score for the up- and downregulated signature respectively.</p>
<pre class="r"><code>up_treat &lt;- AddModuleScore(hivmy2,
                           features = list(treatment_up),
                           name = &quot;upregulated&quot;)

p1 &lt;- FeaturePlot(subset(up_treat, ht_cluster == &quot;c1&quot;),
                  features = &quot;upregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c1&quot;)

p2 &lt;- FeaturePlot(subset(up_treat, ht_cluster == &quot;c2&quot;),
                  features = &quot;upregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c2&quot;)

figure &lt;- ggarrange(p1, p2, ncol = 2)
annotate_figure(figure, top = text_grob(&quot;Signature score of genes upregulated in EFZ treatment&quot;, 
               color = &quot;black&quot;, face = &quot;bold&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-45-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>down_treat &lt;- AddModuleScore(hivmy2,
                           features = list(treatment_down),
                           name = &quot;downregulated&quot;)

p1 &lt;- FeaturePlot(subset(down_treat, ht_cluster == &quot;c1&quot;),
                  features = &quot;downregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c1&quot;)

p2 &lt;- FeaturePlot(subset(down_treat, ht_cluster == &quot;c2&quot;),
                  features = &quot;downregulated1&quot;, pt.size = 1) +
  scale_colour_gradientn(colours = rev(brewer.pal(n = 11, name = &quot;RdBu&quot;))) +
  labs(title = &quot;Myeloid2 Cluster c2&quot;)

figure &lt;- ggarrange(p1, p2, ncol = 2)
annotate_figure(figure, top = text_grob(&quot;Signature score of genes downregulated in EFZ treatment&quot;, 
               color = &quot;black&quot;, face = &quot;bold&quot;, size = 20))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-46-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>percentage_up &lt;- dim(up_treat@meta.data %&gt;% filter(upregulated1 &gt; 0.2))[1] /
  dim(up_treat@meta.data)[1]

percentage_down &lt;- dim(down_treat@meta.data %&gt;% filter(downregulated1 &lt; 0))[1] /
  dim(down_treat@meta.data)[1]

cells_down &lt;- rownames(down_treat@meta.data %&gt;% filter(downregulated1 &lt; 0))
cells_up &lt;- rownames(up_treat@meta.data %&gt;% filter(upregulated1 &gt; 0.2))
treat_cells &lt;- intersect(cells_down, cells_up)</code></pre>
</div>
</div>
<div id="overlay-infefz-signature-with-the-tf-activity-heatmap-of-myeloid2-cells" class="section level2 tabset">
<h2 class="tabset">Overlay Inf+EFZ signature with the TF activity heatmap of Myeloid2 cells</h2>
<p>There are a some cells which express the Inf+EFZ signature and they are highlighted with an orange colour in the heatmap below. However, they are spread across all clusters and patients. The first of three clusters in each patient was hypothesized to be a latently infected group of cells. In the heatmap below the cells with an Inf+EFZ signature do not seem to accumulate in the first cluster of each patient, but rather are more frequent in the other two clusters.</p>
<div id="k-3-hierarchical-clustering" class="section level3">
<h3>k = 3 hierarchical clustering</h3>
<pre class="#{r}"><code># calculate scores for genes upregualted in Inf+EFZ iMg
up_sign &lt;- AddModuleScore(hivmy2,
                           features = up_inf_filt)

# extract the Myeloid2 cells which have a positive score for the Inf+EFZ signature
inf_efz_cells &lt;- rownames(up_sign@meta.data %&gt;% filter(Cluster1 &gt; 0))
#uninf_efz_cells &lt;- rownames(hivmy2_uninf_efz_sign@meta.data %&gt;% filter(Cluster1 &gt; 0))
#uninf_cells &lt;- rownames(hivmy2_uninf_sign@meta.data %&gt;% filter(Cluster1 &gt; 0))</code></pre>
<pre class="r"><code># read in Seurat object contianing alls samples and conditions
hiv7 &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/src/Reproduce_Farhadian_Paper/Seurat_objects/total_7_samples_label_transfer.rds&quot;)
# import TF activity matrix of  Myeloid2 cells
auc_mtx &lt;- read.table(&quot;data_files/aucell_matrix_10k_hvg.tsv&quot;, sep = &quot;\t&quot;)


# 3 heatmaps with all Scenic TFs
ht_list &lt;- map(seq.int(1:3), function(n) {
  patients &lt;- c (&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;) # 3 different patients
  # filter the dataset for only Myeloid2 cells and iteratively one of the patients
  df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == patients[n])
  # select only the cells of the activity matrix which are myeloid2 and the correct patient
  mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df),]
  # heatmap
  ht &lt;- Heatmap(t(mtx), 
               column_title = paste0(&quot;patient: &quot;, patients[n]), 
               top_annotation = HeatmapAnnotation(signature = case_when(
                 rownames(mtx) %in% inf_efz_cells ~ &quot;Inf_EFZ_signature&quot;,
                 #rownames(mtx) %in% uninf_efz_cells ~ &quot;Uninf_EFZ_signature&quot;,
                 #rownames(mtx) %in% uninf_cells ~ &quot;Uninf_signature&quot;,
                 TRUE ~ &quot;no_signature&quot;),
                 name = &quot;signature&quot;,
                 col = list(signature = c(&quot;Inf_EFZ_signature&quot; = &quot;orange2&quot;,
                                          #&quot;Uninf_EFZ_signature&quot; = &quot;lightblue&quot;,
                                          #&quot;Uninf_signature&quot; = &quot;orange&quot;,
                                          &quot;no_signature&quot; = &quot;navy&quot;))),
               column_km = 3,
               #row_km = n, 
               show_column_names = FALSE,
               col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
               show_row_names = TRUE
               ) 
               #top_annotation = column_annotation) 
  list(name = patients[n], heatmap = ht)
})

ht_list[[1]]$heatmap + ht_list[[2]]$heatmap + ht_list[[3]]$heatmap </code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-48-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="group-according-to-infection-condition" class="section level3">
<h3>group according to infection condition</h3>
<p>When you group the cells according to their different gene signatures as in the heatmap below, you do not see a difference between the two groups. Testing for TFs with different activity between the two groups might provide more insights.</p>
<pre class="r"><code># filter the dataset for only Myeloid2 cells 
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                orig.ident %in% c (&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;))
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df),]

# add signature column to dataframe
signature &lt;- df %&gt;%
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  mutate(signature = case_when(cell %in% inf_efz_cells ~ &quot;Inf_signature&quot;,
                                #cell %in% uninf_efz_cells ~&quot;Uninf_EFZ_signature&quot;,
                                #cell %in% uninf_cells ~ &quot;Uninf_signature&quot;,
                               TRUE ~ &quot;no_signature&quot;))


ht &lt;- draw(Heatmap(t(mtx), 
             column_title = &quot;All patients split according to gene signature scores&quot;, 
             top_annotation = HeatmapAnnotation(signature = case_when(
               rownames(mtx) %in% inf_efz_cells ~ &quot;Inf_signature&quot;,
               #rownames(mtx) %in% uninf_efz_cells ~ &quot;Uninf_EFZ_signature&quot;,
               #rownames(mtx) %in% uninf_cells ~ &quot;Uninf_signature&quot;,
               TRUE ~ &quot;no_signature&quot;),
               name = &quot;signature&quot;,
               col = list(signature = c(&quot;Inf_signature&quot; = &quot;orange2&quot;,
                                        #&quot;Uninf_EFZ_signature&quot; = &quot;lightblue&quot;,
                                        #&quot;Uninf_signature&quot; = &quot;orange&quot;,
                                        &quot;no_signature&quot; = &quot;navy&quot;))),       
             column_split = signature$signature,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             show_row_names = TRUE
             ))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-49-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</div>
</div>
<div id="overlay-efz-treatment-signature-with-the-tf-activity-heatmap-of-myeloid2-cells" class="section level2 tabset">
<h2 class="tabset">Overlay EFZ treatment signature with the TF activity heatmap of Myeloid2 cells</h2>
<p>There are very few cells with both a positive and negative score for up- and downregulated signatures respectively. This might be, because the comparison between the effect of EFZ treatment on cells in cell culture and cells from the CSF of patients treated with a combination of other antiretroviral drugs might be farfetched. Apart from the drugs being different, cells in cell culture are exposed to comparatively high drug concentrations, while cells in the CSF are exposed to very low drug concentrations due to the blood-brain barrier. This could explain why so few cells with a EFZ treatment signature are found among the Myeloid2 cells.</p>
<div id="k-3-hierarchical-clustering-1" class="section level3">
<h3>k = 3 hierarchical clustering</h3>
<pre class="r"><code>
# 3 heatmaps with all Scenic TFs
ht_list &lt;- map(seq.int(1:3), function(n) {
  patients &lt;- c (&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;) # 3 different patients
  # filter the dataset for only Myeloid2 cells and iteratively one of the patients
  df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                  orig.ident == patients[n])
  # select only the cells of the activity matrix which are myeloid2 and the correct patient
  mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df),]
  # heatmap
  ht &lt;- Heatmap(t(mtx), 
               column_title = paste0(&quot;patient: &quot;, patients[n]), 
               top_annotation = HeatmapAnnotation(signature = case_when(
                 rownames(mtx) %in% treat_cells ~ &quot;EFZ_treatment_signature&quot;,
                 #rownames(mtx) %in% uninf_efz_cells ~ &quot;Uninf_EFZ_signature&quot;,
                 #rownames(mtx) %in% uninf_cells ~ &quot;Uninf_signature&quot;,
                 TRUE ~ &quot;no_signature&quot;),
                 name = &quot;signature&quot;,
                 col = list(signature = c(&quot;EFZ_treatment_signature&quot; = &quot;olivedrab3&quot;,
                                          #&quot;Uninf_EFZ_signature&quot; = &quot;lightblue&quot;,
                                          #&quot;Uninf_signature&quot; = &quot;orange&quot;,
                                          &quot;no_signature&quot; = &quot;navy&quot;))),
               column_km = 3,
               #row_km = n, 
               show_column_names = FALSE,
               col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
               show_row_names = TRUE
               ) 
               #top_annotation = column_annotation) 
  list(name = patients[n], heatmap = ht)
})

ht_list[[1]]$heatmap + ht_list[[2]]$heatmap + ht_list[[3]]$heatmap </code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-50-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="group-by-treatment-condition" class="section level3">
<h3>Group by treatment condition</h3>
<pre class="r"><code># filter the dataset for only Myeloid2 cells 
df &lt;- hiv7@meta.data %&gt;% filter(cell_type == &quot;Myeloid2&quot;, 
                                orig.ident %in% c (&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;))
# select only the cells of the activity matrix which are myeloid2 and the correct patient
mtx &lt;- auc_mtx[rownames(auc_mtx) %in% rownames(df),]

# add signature column to dataframe
signature &lt;- df %&gt;%
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  mutate(signature = case_when(cell %in% treat_cells ~ &quot;EFZ_treatment_signature&quot;,
                                #cell %in% uninf_efz_cells ~&quot;Uninf_EFZ_signature&quot;,
                                #cell %in% uninf_cells ~ &quot;Uninf_signature&quot;,
                               TRUE ~ &quot;no_signature&quot;))


ht &lt;- draw(Heatmap(t(mtx), 
             column_title = &quot;All patients split according to gene signature scores&quot;, 
             top_annotation = HeatmapAnnotation(signature = case_when(
               rownames(mtx) %in% treat_cells ~ &quot;EFZ_treatment_signature&quot;,
               #rownames(mtx) %in% uninf_efz_cells ~ &quot;Uninf_EFZ_signature&quot;,
               #rownames(mtx) %in% uninf_cells ~ &quot;Uninf_signature&quot;,
               TRUE ~ &quot;no_signature&quot;),
               name = &quot;signature&quot;,
               col = list(signature = c(&quot;EFZ_treatment_signature&quot; = &quot;olivedrab3&quot;,
                                        #&quot;Uninf_EFZ_signature&quot; = &quot;lightblue&quot;,
                                        #&quot;Uninf_signature&quot; = &quot;orange&quot;,
                                        &quot;no_signature&quot; = &quot;navy&quot;))),       
             column_split = signature$signature,
             show_column_names = FALSE,
             col =colorRampPalette(rev(brewer.pal(n = 7, name = &quot;RdYlBu&quot;)))(100),
             show_row_names = TRUE
             ))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-51-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</div>
</div>
</div>
<div id="differential-tf-activity" class="section level1 tabset">
<h1 class="tabset">Differential TF activity</h1>
<p>After having identified a few cells with a high scores for the infection signature (Inf+EFZ), as well as cells with a high score for the EFZ treatment signatures, it would be interesting to know whether some TFs have different activity between the conditions. For this a Kruskal-Wallis Test was used, followed by a pairwise Wilcox Test.</p>
<div id="between-infection-conditions-1" class="section level2">
<h2>Between infection conditions</h2>
<p>Out of all 125 TFs, 44 have different activity between cells with a high score for the Inf+EFZ signature compared to the rest. The activities for those TFs which are also found to have a differential binding scores in C20 microglia are shown in the boxplots below. KLF4 and REST are the only two TFs more bound in latently infected C20 microglia. KLF4 is more active in Myeloid2 with a high score for the Inf+EFZ signature, but REST is less active. All other TFs are more bound in uninfected C20 microglia than in latently infected, but the TF activity is not always higher in uninfected Myeloid2 (no high score for Inf+EFZ signature).</p>
<pre class="r"><code>hivmy2_scenic &lt;- AddMetaData(hivmy2, 
                    metadata = auc_mtx, 
                    col.name = colnames(auc_mtx))

inf_sign_df &lt;- hivmy2_scenic@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
  mutate(signature = case_when(cell %in% inf_efz_cells ~ &quot;Inf_EFZ&quot;,
                                TRUE ~ &quot;no_sign&quot;))

# check all TFs 
p_values &lt;- map(seq.int(1:125), function(n){
  tf &lt;- colnames(auc_mtx)[n]
  p_values &lt;- unlist(kruskal.test(pull(inf_sign_df[tf]) ~ signature, inf_sign_df))[&quot;p.value&quot;]
})

# adjust for multiple testing with FDR
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)

# how many transcription factors are significantly different between the clusters?
sign &lt;- adj_p_values[adj_p_values &lt; 0.05]
length(sign)
[1] 44
diff_cells &lt;- colnames(auc_mtx)[adj_p_values &lt; .05]

# get only the TFs also found in footprinting

# read in footprinting resutls
tfs_ana &lt;- read.table(&quot;/media/ag-cherrmann/projects/06_HIV_Microglia/data/atacseq/data-2020-11-06/tobias/TOBIAS_snakemake/footprint_mglia2_GlassTF_17-03/TFBS/bindetect_results.txt&quot;, sep = &quot;\t&quot;, header = TRUE)

# filter TFs with significant p values between latent infection and uninfected
# I decided to use a threshold of p-value &lt; 1e-50, because due to the large number 
# of data, all p-values will be very high
top_tfs &lt;- tfs_ana %&gt;% filter(uninf_red_pvalue &lt; 1e-50)
down_tfs &lt;- top_tfs %&gt;% filter(uninf_red_change &lt; 0)
#down_tfs &lt;- top_tfs %&gt;% filter(uninf_red_change &lt; )

diff_tfs &lt;- diff_cells[diff_cells %in% top_tfs$name]

diff_cells[diff_cells %in% down_tfs$name]
[1] &quot;KLF4&quot; &quot;REST&quot;</code></pre>
<pre class="r"><code>plots &lt;- map(diff_tfs, function(tf){
  ggplot() +
    geom_violin(aes(x = inf_sign_df %&gt;% pull(&quot;signature&quot;), 
                     y = inf_sign_df %&gt;% pull(tf),
                     fill = inf_sign_df %&gt;% pull(&quot;signature&quot;))) +
    geom_boxplot(aes(x = inf_sign_df %&gt;% pull(&quot;signature&quot;), 
                     y = inf_sign_df %&gt;% pull(tf)),
                 alpha = 0) +
    stat_pvalue_manual(inf_sign_df %&gt;% 
                         pairwise_wilcox_test(
                           as.formula(paste0(tf, &quot; ~ ht_cluster&quot;))) %&gt;% 
                         add_xy_position()) +
    xlab(&quot;condition&quot;) +
    ylab(paste0(tf)) +
    guides(fill = guide_legend(title = &quot;condition&quot;))
  })

do.call(grid.arrange, c(plots, ncol = 3, nrow = 4))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-53-1.png" width="1440" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="between-treatment-conditions-1" class="section level2">
<h2>Between treatment conditions</h2>
<p>Are some TFs in Myeloid2 differentially active between the treatment conditions? There are no significant differences in TF activity between the cells with high scores for EFZ treatment signature compared to cells without the signature. Therefore, no posthoc analysis was performed.</p>
<pre class="r"><code>df &lt;- hivmy2_scenic@meta.data %&gt;% 
  rownames_to_column(&quot;cell&quot;) %&gt;% 
        # filter(cell %in% c(inf_efz_cells, uninf_efz_cells, uninf_cells)) %&gt;% 
  mutate(signature = case_when(cell %in% treat_cells ~ &quot;treatment_signature&quot;,
                                TRUE ~ &quot;no_signature&quot;))

# check all TFs 
p_values &lt;- map(seq.int(1:125), function(n){
  tf &lt;- colnames(auc_mtx)[n]
  p_values &lt;- unlist(kruskal.test(pull(df[tf]) ~ signature, df))[&quot;p.value&quot;]
})

# adjust for multiple testing with FDR
adj_p_values &lt;- p.adjust(as.numeric(unname(unlist(p_values))), method = &quot;fdr&quot;)

# how many transcription factors are significantly different between the clusters?
sign &lt;- adj_p_values[adj_p_values &lt; 0.05]</code></pre>
<hr />
</div>
<div id="gene-expression-of-inflammatory-genes" class="section level2">
<h2>Gene expression of inflammatory genes</h2>
<p><span class="citation">[@Ryan]</span> showed that two pathways are specifically activated in the Inf+EFZ condition, namely RhoGDI signaling and CD40 signaling. This effect was not seen in Uninf+EFZ, so it does not seem to be caused by EFZ alone, but rather a combination of infection and EFZ treatment <span class="citation">[@Ryan]</span>.</p>
<ul>
<li>RhoGDI signaling:
<ul>
<li>PP1R12A was upregulated</li>
<li>RND3, CD44, ACTG1 were downregulated</li>
</ul></li>
<li>CD40 signaling:
<ul>
<li>FOS was upregulated</li>
<li>NFKBIA, ICAM1, TFNAIP3 were downregulated</li>
</ul></li>
</ul>
<p>Here, we would like to see if cell with high scores for the Inf+EFZ signature show gene expression patterns that are in line with the findings by <span class="citation">[@Ryan]</span>. The gene expression for each gene is shown in the figure below. We would expect only PP1R12A and FOS to be more highly expressed in the cells with Inf+EFZ signature, while all other genes should be less highly expressed. This pattern in gene expression is, however, not observed.</p>
<pre class="r"><code># read in Seurat object containing Myeloid2 cells
hivmy2_scenic &lt;- AddMetaData(hivmy2_scenic, metadata = inf_sign_df$signature, col.name = &quot;signature&quot;)

# RhoGDI signaling in myeloid2
p1 &lt;- VlnPlot(hivmy2_scenic, features = c(&quot;RND3&quot;, &quot;CD44&quot;, &quot;ACTG1&quot;, &quot;PPP1R12A&quot;), 
              group.by = &quot;signature&quot;, ncol = 2)

# CD40 signaling in myeloid2
p2 &lt;- VlnPlot(hivmy2_scenic, features =c(&quot;NFKBIA&quot;, &quot;ICAM1&quot;, &quot;TNFAIP3&quot;, &quot;FOS&quot;), 
              group.by = &quot;signature&quot;, ncol = 2)
Warning: The following variables were found in both object metadata and the default assay: FOS
Returning metadata; if you want the feature, please use the assay&#39;s key (eg. rna_FOS)

# RhoGDI signaling in iMg
p3 &lt;- VlnPlot(microglia, features = c(&quot;RND3&quot;, &quot;CD44&quot;, &quot;ACTG1&quot;, &quot;PPP1R12A&quot;), 
        ncol = 2, pt.size = 0, group.by = &quot;orig.ident&quot;)
Warning: Could not find ACTG1 in the default search locations, found in RNA
assay instead
Warning: Could not find PPP1R12A in the default search locations, found in RNA
assay instead

# CD40 signaling in iMg
p4 &lt;- VlnPlot(microglia, features = c(&quot;NFKBIA&quot;, &quot;ICAM1&quot;, &quot;TNFAIP3&quot;, &quot;FOS&quot;), 
        ncol = 2, pt.size = 0, group.by = &quot;orig.ident&quot;)

fig &lt;- ggarrange(p1, p3, ncol = 2, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;Expression of four genes of the RhoGDI signaling pathway in Myeloid2 (left column) and iMg (right column)&quot;,
                                     size = 20 , face = &quot;bold&quot;))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-55-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
fig &lt;- ggarrange(p2, p4, ncol = 2, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;Expression of four genes of the CD40 signaling pathway in Myeloid2 (left column) and iMg (right column)&quot;,
                                     size = 20 , face = &quot;bold&quot;))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-55-2.png" width="1440" style="display: block; margin: auto;" /></p>
<p>Only FOS which encodes a TF is found in the TF activity matrix, so for FOS the TF acivity is shown as well. Judging from the figure below FOS seems to be more active in cells with high score for Inf+EFZ signature, but this difference is not statistically significant.</p>
<pre class="r"><code>inf_sign_df %&gt;% ggplot(aes(x = signature, y = FOS)) +
  geom_violin(aes(fill = signature, alpha = .6)) +
  geom_boxplot(alpha = 0) +
  stat_pvalue_manual(inf_sign_df %&gt;% 
                       pairwise_wilcox_test(FOS ~ signature) %&gt;% 
  add_xy_position())</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-56-1.png" width="672" style="display: block; margin: auto;" /></p>
<hr />
</div>
</div>
<div id="appendix" class="section level1">
<h1>Appendix</h1>
<div id="inflammatory-pathways" class="section level2">
<h2>Inflammatory Pathways</h2>
<p>As already mentioned above <span class="citation">[@Ryan]</span> showed that two pathways are specifically activated in the Inf+EFZ condition, namely RhoGDI signaling and CD40 signaling. This effect was not seen in Uninf+EFZ, so it does not seem to be caused by EFZ alone, but rather a combination of infection and EFZ treatment <span class="citation">[@Ryan]</span>.</p>
<ul>
<li>RhoGDI signaling:
<ul>
<li>PP1R12A was upregulated</li>
<li>RND3, CD44, ACTG1 were downregulated</li>
</ul></li>
<li>CD40 signaling:
<ul>
<li>FOS was upregulated</li>
<li>NFKBIA, ICAM1, TFNAIP3 were downregulated</li>
</ul></li>
</ul>
<p>To answer the question whether we could find similar patterns in the two Myeloid2 clusters with different TF activity, we had a look at the gene expression.</p>
<div id="myeloid2-cells" class="section level5">
<h5>Myeloid2 cells</h5>
<p>Two genes of the RhoGDI signaling pathway were found among the differentially expressed genes between Inf+EFZ and Uninf+EFZ. Both of them were downregulated in Inf+EFZ compared to Uninf+EFZ iMg as can be seen in the table below.</p>
<pre class="r"><code>inf_uninf_art_marker %&gt;% 
  rownames_to_column(&quot;gene&quot;) %&gt;%
  filter(gene %in% c(&quot;RND3&quot;, &quot;CD44&quot;, &quot;ACTG1&quot;, &quot;PPP1R12A&quot;)) %&gt;%
  kable(caption = &quot;Genes of the RhoGDI signaling pathway found among genes differentially expressed between Inf+EFZ and Uninf+EFZ&quot;)</code></pre>
<table>
<caption>Genes of the RhoGDI signaling pathway found among genes differentially expressed between Inf+EFZ and Uninf+EFZ</caption>
<thead>
<tr class="header">
<th align="left">gene</th>
<th align="right">p_val</th>
<th align="right">avg_log2FC</th>
<th align="right">pct.1</th>
<th align="right">pct.2</th>
<th align="right">p_val_adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">RND3</td>
<td align="right">0</td>
<td align="right">-1.6635458</td>
<td align="right">0.045</td>
<td align="right">0.386</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">CD44</td>
<td align="right">0</td>
<td align="right">-0.5883562</td>
<td align="right">0.396</td>
<td align="right">0.539</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>All four genes of the CD40 signaling were found among the differentially expressed genes between Inf+EFZ and Uninf+EFZ. FOS was upregulated, while NFKBIA, ICAM1 and TFNAIP3 were downregulated in Inf+EFZ compared to Uninf+EFZ as can be seen in the table below.</p>
<pre class="r"><code>inf_uninf_art_marker %&gt;% 
  rownames_to_column(var = &quot;gene&quot;) %&gt;%
  filter(gene %in% c(&quot;FOS&quot;, &quot;NFKBIA&quot;, &quot;ICAM1&quot;, &quot;TNFAIP3&quot;)) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">gene</th>
<th align="right">p_val</th>
<th align="right">avg_log2FC</th>
<th align="right">pct.1</th>
<th align="right">pct.2</th>
<th align="right">p_val_adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ICAM1</td>
<td align="right">0</td>
<td align="right">-1.3649862</td>
<td align="right">0.169</td>
<td align="right">0.496</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NFKBIA</td>
<td align="right">0</td>
<td align="right">-1.0940764</td>
<td align="right">0.527</td>
<td align="right">0.784</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">TNFAIP3</td>
<td align="right">0</td>
<td align="right">-1.3232813</td>
<td align="right">0.158</td>
<td align="right">0.465</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">FOS</td>
<td align="right">0</td>
<td align="right">0.5719556</td>
<td align="right">0.293</td>
<td align="right">0.139</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The changes in gene expression of both pathways are in line with the findings by <span class="citation">[@Ryan]</span>.</p>
<p>Additionally, we were interested whether this pattern in gene expression correlated with the two clusters identified in Myeloid2 which exhibit different TF activities. The figure below show the gene expression of the four genes of the respective pathways both in Myeloid2 cells (left column) and in iMg (right column).</p>
<p>FOS is the only gene which shows a high expression in Myeloid2 cluster c1. This supports our hypothesis that c1 might be a latently infected reactive microglia cell state. However then we would expect to see a similar pattern for the RhoGDI signaling, meaning PPP1R12A should be the only gene which is highly expressed in c1. This is not the case, but rather CD44 and ACTG1 also show higher expression in c1 compared to c2. Consequently, our hypothesis is not clearly supported by the expression patterns of these inflammatory genes.</p>
<pre class="r"><code># isolate microglia cells
microglia &lt;- subset(combined, cell_type == &quot;iMg&quot;)

# read in Seurat object containing Myeloid2 cells
hivmy2 &lt;- readRDS(&quot;/media/ag-cherrmann/kmikulik/HIV_microglia/data/hiv_myeloid2_subclusters&quot;)


p1 &lt;- VlnPlot(hivmy2, features = c(&quot;RND3&quot;, &quot;CD44&quot;, &quot;ACTG1&quot;, &quot;PPP1R12A&quot;), 
              group.by = &quot;ht_cluster&quot;, ncol = 2)

p2 &lt;- VlnPlot(hivmy2, features =c(&quot;NFKBIA&quot;, &quot;ICAM1&quot;, &quot;TNFAIP3&quot;, &quot;FOS&quot;), 
              group.by = &quot;ht_cluster&quot;, ncol = 2)

p3 &lt;- VlnPlot(microglia, features = c(&quot;RND3&quot;, &quot;CD44&quot;, &quot;ACTG1&quot;, &quot;PPP1R12A&quot;), 
        ncol = 2, pt.size = 0, group.by = &quot;orig.ident&quot;)
Warning: Could not find ACTG1 in the default search locations, found in RNA
assay instead
Warning: Could not find PPP1R12A in the default search locations, found in RNA
assay instead

p4 &lt;- VlnPlot(microglia, features = c(&quot;NFKBIA&quot;, &quot;ICAM1&quot;, &quot;TNFAIP3&quot;, &quot;FOS&quot;), 
        ncol = 2, pt.size = 0, group.by = &quot;orig.ident&quot;)

fig &lt;- ggarrange(p1, p3, ncol = 2, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;Expression of four genes of the RhoGDI signaling pathway in Myeloid2 (left column) and iMg (right column)&quot;,
                                     size = 20 , face = &quot;bold&quot;))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-59-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
fig &lt;- ggarrange(p2, p4, ncol = 2, nrow = 1)
annotate_figure(fig, top = text_grob(&quot;Expression of four genes of the CD40 signaling pathway in Myeloid2 (left column) and iMg (right column)&quot;,
                                     size = 20 , face = &quot;bold&quot;))</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-59-2.png" width="1440" style="display: block; margin: auto;" /></p>
<details>
<summary>
Same two pathways in Myeloid5 cells
</summary>
<p>Myeloid5 cells</p>
<pre class="r"><code>
# isolate the Myeloid5 cluster
hivmy5 &lt;- subset(hiv7, cell_type == &quot;Myeloid5&quot; &amp; orig.ident %in% c(&quot;HIV1_CSF&quot;, &quot;HIV2_CSF&quot;, &quot;HIV3_CSF&quot;))

# process Myeloid 5 Seurat object
hivmy5 &lt;- ScaleData(hivmy5, verbose = FALSE)
hivmy5 &lt;- NormalizeData(hivmy5, verbose = FALSE)
hivmy5 &lt;- ScaleData(hivmy5, verbose = FALSE)
hivmy5 &lt;- FindVariableFeatures(hivmy5, verbose = FALSE)
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : pseudoinverse used at -2.0668
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : neighborhood radius 0.49858
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : reciprocal condition number 3.7892e-16
Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
parametric, : There are other near singularities as well. 0.090619
hivmy5 &lt;- RunPCA(hivmy5, features = VariableFeatures(hivmy5), verbose = FALSE)
#ElbowPlot(hivmy5)
hivmy5 &lt;- RunTSNE(hivmy5, dims= 1:10, verbose = FALSE)</code></pre>
<pre class="r"><code>
p1 &lt;- VlnPlot(hivmy5, features = c(&quot;RND3&quot;, &quot;CD44&quot;, &quot;ACTG1&quot;, &quot;PPP1R12A&quot;), 
              group.by = &quot;orig.ident&quot;,ncol = 2)
Warning in SingleExIPlot(type = type, data = data[, x, drop = FALSE], idents =
idents, : All cells have the same value of RND3.

p2 &lt;- VlnPlot(hivmy5, features =c(&quot;NFKBIA&quot;, &quot;ICAM1&quot;, &quot;TNFAIP3&quot;, &quot;FOS&quot;), 
              group.by = &quot;orig.ident&quot;, ncol = 2)

p3 &lt;- VlnPlot(microglia, features = c(&quot;RND3&quot;, &quot;CD44&quot;, &quot;ACTG1&quot;, &quot;PPP1R12A&quot;), 
        ncol = 2, pt.size = 0, group.by = &quot;orig.ident&quot;)
Warning: Could not find ACTG1 in the default search locations, found in RNA
assay instead
Warning: Could not find PPP1R12A in the default search locations, found in RNA
assay instead

p4 &lt;- VlnPlot(microglia, features = c(&quot;NFKBIA&quot;, &quot;ICAM1&quot;, &quot;TNFAIP3&quot;, &quot;FOS&quot;), 
        ncol = 2, pt.size = 0, group.by = &quot;orig.ident&quot;)

ggarrange(p2, p4, p1, p3, ncol = 2, nrow = 2)</code></pre>
<p><img src="figure/Triculture_csf_integration.Rmd/unnamed-chunk-61-1.png" width="1440" style="display: block; margin: auto;" /></p>
</details>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()
R version 4.0.2 (2020-06-22)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /usr/lib64/libopenblasp-r0.3.3.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] parallel  grid      stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] readxl_1.3.1         multtest_2.46.0      Biobase_2.50.0      
 [4] BiocGenerics_0.36.1  metap_1.6            knitr_1.30          
 [7] rstatix_0.6.0        corrplot_0.92        gridExtra_2.3       
[10] ggpubr_0.4.0         circlize_0.4.13      ComplexHeatmap_2.9.4
[13] ggcorrplot_0.1.3     pheatmap_1.0.12      RColorBrewer_1.1-2  
[16] ggrepel_0.9.1        data.table_1.14.2    Matrix_1.3-4        
[19] edgeR_3.32.0         limma_3.46.0         SeuratObject_4.0.3  
[22] Seurat_4.0.5         forcats_0.5.0        stringr_1.4.0       
[25] dplyr_1.0.7          purrr_0.3.4          readr_1.4.0         
[28] tidyr_1.1.2          tibble_3.1.6         ggplot2_3.3.5       
[31] tidyverse_1.3.0      workflowr_1.6.2     

loaded via a namespace (and not attached):
  [1] utf8_1.2.2            reticulate_1.22       tidyselect_1.1.1     
  [4] htmlwidgets_1.5.4     Rtsne_0.15            munsell_0.5.0        
  [7] units_0.6-7           mutoss_0.1-12         codetools_0.2-18     
 [10] ica_1.0-2             future_1.23.0         miniUI_0.1.1.1       
 [13] withr_2.4.3           colorspace_2.0-2      highr_0.8            
 [16] rstudioapi_0.13       stats4_4.0.2          ROCR_1.0-11          
 [19] ggsignif_0.6.0        tensor_1.5            listenv_0.8.0        
 [22] labeling_0.4.2        Rdpack_2.1.2          git2r_0.27.1         
 [25] mnormt_2.0.2          polyclip_1.10-0       farver_2.1.0         
 [28] rprojroot_2.0.2       TH.data_1.0-10        parallelly_1.29.0    
 [31] vctrs_0.3.8           generics_0.1.1        xfun_0.29            
 [34] R6_2.5.1              doParallel_1.0.16     clue_0.3-60          
 [37] RVenn_1.1.0           locfit_1.5-9.4        spatstat.utils_2.2-0 
 [40] assertthat_0.2.1      promises_1.2.0.1      scales_1.1.1         
 [43] multcomp_1.4-15       gtable_0.3.0          globals_0.14.0       
 [46] goftest_1.2-3         sandwich_3.0-0        rlang_0.4.12         
 [49] GlobalOptions_0.1.2   splines_4.0.2         lazyeval_0.2.2       
 [52] spatstat.geom_2.3-0   broom_0.7.2           yaml_2.2.1           
 [55] reshape2_1.4.4        abind_1.4-5           modelr_0.1.8         
 [58] backports_1.2.0       httpuv_1.6.3          tools_4.0.2          
 [61] ellipsis_0.3.2        spatstat.core_2.3-1   ggridges_0.5.2       
 [64] TFisher_0.2.0         Rcpp_1.0.7            plyr_1.8.6           
 [67] classInt_0.4-3        rpart_4.1-15          deldir_1.0-6         
 [70] pbapply_1.5-0         GetoptLong_1.0.5      cowplot_1.1.1        
 [73] S4Vectors_0.28.1      zoo_1.8-9             haven_2.3.1          
 [76] cluster_2.1.0         fs_1.5.1              magrittr_2.0.1       
 [79] magick_2.5.2          scattermore_0.7       openxlsx_4.2.3       
 [82] lmtest_0.9-39         reprex_0.3.0          RANN_2.6.1           
 [85] tmvnsim_1.0-2         mvtnorm_1.1-1         whisker_0.4          
 [88] fitdistrplus_1.1-6    matrixStats_0.61.0    hms_1.1.1            
 [91] patchwork_1.1.1       mime_0.12             evaluate_0.14        
 [94] xtable_1.8-4          rio_0.5.16            IRanges_2.24.1       
 [97] shape_1.4.6           compiler_4.0.2        KernSmooth_2.23-18   
[100] crayon_1.4.2          htmltools_0.5.2       mgcv_1.8-33          
[103] later_1.3.0           ggVennDiagram_1.2.0   lubridate_1.7.9.2    
[106] DBI_1.1.1             dbplyr_2.0.0          MASS_7.3-53          
[109] sf_0.9-6              car_3.0-10            cli_3.1.0            
[112] rbibutils_2.2.4       igraph_1.2.9          pkgconfig_2.0.3      
[115] sn_2.0.1              numDeriv_2016.8-1.1   foreign_0.8-80       
[118] plotly_4.9.2.1        spatstat.sparse_2.0-0 xml2_1.3.2           
[121] foreach_1.5.1         rvest_0.3.6           digest_0.6.29        
[124] sctransform_0.3.2     RcppAnnoy_0.0.19      spatstat.data_2.1-0  
[127] rmarkdown_2.6         cellranger_1.1.0      leiden_0.3.5         
[130] uwot_0.1.10           curl_4.3.2            shiny_1.7.1          
[133] rjson_0.2.20          lifecycle_1.0.1       nlme_3.1-150         
[136] jsonlite_1.7.2        carData_3.0-4         viridisLite_0.4.0    
[139] fansi_0.5.0           pillar_1.6.4          lattice_0.20-41      
[142] plotrix_3.8-2         fastmap_1.1.0         httr_1.4.2           
[145] survival_3.2-7        glue_1.6.0            zip_2.1.1            
[148] png_0.1-7             iterators_1.0.13      class_7.3-17         
[151] stringi_1.7.6         mathjaxr_1.4-0        e1071_1.7-4          
[154] irlba_2.3.3           future.apply_1.8.1   </code></pre>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiQW5hbHlzaXMgb2YgVHJpY3VsdHVyZSBkYXRhc2V0IGFuZCBpbnRlZ3JhdGlvbiB3aXRoIENTRi9CbG9vZCBkYXRhc2V0IgphdXRob3I6ICJrbWlrdWxpayIKZGF0ZTogIjI4IDEyIDIwMjEiCm91dHB1dDogaHRtbF9kb2N1bWVudAotLS0KCjxzdHlsZT4KYm9keSB7CnRleHQtYWxpZ246IGp1c3RpZnl9Cjwvc3R5bGU+CgoKYGBge3Igc2V0dXB9CmtuaXRyOjpvcHRzX2NodW5rJHNldChlY2hvID0gVFJVRSwgY29sbGFwc2UgPSBUUlVFLCBtZXNzYWdlID0gRkFMU0UsCiAgICAgICAgICAgICAgICAgICAgICBjYWNoZSA9IFRSVUUsIGNhY2hlLmxhenkgPSBGQUxTRSwgYXV0b2RlcCA9IFRSVUUpCnNldC5zZWVkKDQyKSAjIFRPRE86IGNoZWNrIHdpdGggZGVmYXVsdCBzZWVkCmBgYAoKCgpgYGB7cn0KbGlicmFyeSh0aWR5dmVyc2UpCmxpYnJhcnkoU2V1cmF0KQpsaWJyYXJ5KGVkZ2VSKQpsaWJyYXJ5KE1hdHJpeCkKbGlicmFyeShkYXRhLnRhYmxlKQpsaWJyYXJ5KGdncmVwZWwpCiNsaWJyYXJ5KGhhcm1vbnkpCmxpYnJhcnkoUkNvbG9yQnJld2VyKQpsaWJyYXJ5KHBoZWF0bWFwKQpsaWJyYXJ5KGdnY29ycnBsb3QpCmxpYnJhcnkoQ29tcGxleEhlYXRtYXApCmxpYnJhcnkoY2lyY2xpemUpCmxpYnJhcnkoZ2dwdWJyKQpsaWJyYXJ5KGdyaWRFeHRyYSkKbGlicmFyeShjb3JycGxvdCkKbGlicmFyeShyc3RhdGl4KQpsaWJyYXJ5KGtuaXRyKQpsaWJyYXJ5KG1ldGFwKQpsaWJyYXJ5KG11bHR0ZXN0KQpsaWJyYXJ5KHJlYWR4bCkKYGBgCgojIFRyaWN1bHR1cmUgRGF0YXNldAoKVGhlIHRyaWN1bHR1cmUgZGF0YXNldCB1c2VkIGluIHRoZSBmb2xsb3dpbmcgYW5hbHlzaXMgd2FzIHB1Ymxpc2hlZCBieSBbQFJ5YW5dLiAKVGhleSB1c2VkIGEgVHJpY3VsdHVyZSBzeXN0ZW0gd2l0aCBpbmR1Y2VkIG5ldXJvbnMsIGluZHVjZWQgYXN0cm9jeXRlcyBhbmQgCmluZHVjZWQgbWljcm9nbGlhLgpJbmR1Y2VkIG1pY3JvZ2xpYSBleHByZXNzIG1hcmtlciBnZW5lcyBDWDNDUjEsIElCQTEsIFRNRU0xMTkgYW5kIFAyUlkxMi4KQ0NSNSB3aGljaCBpcyBhIGNvLXJlY2VwdG9yIG5lY2Vzc2FyeSBmb3IgSElWIGluZmVjdGlvbiBpcyBhbHNvIGV4cHJlc3NlZCBieSAKdGhlc2UgY2VsbHMsIGJ1dCB0aGV5IGxhY2sgZXhwcmVzc2lvbiBvZiBteWVsb2lkLXByb2dlbml0b3IgbWFya2VycyBbQFJ5YW5dLgoKaU1nIHdlcmUgaW5mZWN0ZWQgd2l0aCBISVYgZm9yIDE1IGRheXMsIHJlc3VsdGluZyBpbiA5NCUgb2YgY2VsbHMgaW5mZWN0ZWQgIAoocG9zaXRpdmUgZm9yIEhJViBjYXBzaWQgcHJvdGVpbiBwMjQgYW5kIGV4aGliaXRpbmcgbXVsdGludWNsZWF0aW9uKS4gU29tZSBjZWxscwp3ZXJlIHRyZWF0ZWQgd2l0aCB0aGUgYW50aXJldHJvdmlyYWwgdGhlcmFweSBFRlosIHdoaWNoIGJsb2NrcyBISVYgcmV2ZXJzZSB0cmFuc2NyaXB0YXNlLiBUaGlzIHdheSwgaXQgd2FzIHBvc3NpYmxlIHRvIHN0dWR5IG5vbi1wcm9kdWN0aXZlbHkgaW5mZWN0ZWQgY2VsbHMuIEVGWiByZWR1Y2VkIGluZmVjdGlvbiBieSB0d28gCnRoaXJkcyBbQFJ5YW5dLgoKSW4gdGhlIGluZmVjdGVkLCBidXQgbm90IHRyZWF0ZWQgaU1nIChJbmYpIGluZmxhbW1hdG9yeSBwYXRod2F5cyB3ZXJlIApzaWduaWZpY2FudGx5IHVwZXJlZ3VsYXRlZCBjb21wYXJlZCB0byB0aGUgdW5pbmZlY3RlZCBjb25kaXRpb24oVW5pbmYpLCBpbmNsdWRpbmcKSUwtOCwgTkZrQiBhbmQgRUlGMi4gClRoZXJlIHdhcyBkZWNyZWFzZWQgZXhwcmVzc2lvbiBvZiBwcm8taW1mbGFtbWF0b3J5IGdlbmVzIElMMWIsIElsOCBhbmQgVE5GYWxwaGEKaW4gdGhlIGluZmVjdGVkIGFuZCB0cmVhdGVkIChJbmYrRUZaKSB2cyBJbmYgY29uZGl0aW9uLiBUaGlzIHN1Z2dlc3RzIGEgcmVkdWNlZCBpbmZsYW1tYXRvcnkgcmVhY3Rpb24gW0BSeWFuXS4gTmV2ZXJ0aGVsZXNzLCB0aGVyZSB3ZXJlCnR3byBkaXN0aW5jdCBwYXRod2F5cyB3aGljaCB3ZXJlIHVwcmVndWxhdGVkIGluIApJbmYrRUZaIGlNZywgbmFtZWx5IFJob0dESSBzaWduYWxpbmcgYW5kIENENDAgc2lnbmFsaW5nIHBhdGh3YXkuIFRoaXMgd2lsbCBiZSAKZGlzY3Vzc2VkIGluIG1vcmUgZGV0YWlsIGxhdGVyIG9uIFtAUnlhbl0uCgpUaGVyZSB3YXMgIGEgY2hhbmdlIGluIHNpZ25hbGluZyBwYXRod2F5cyBjYXVzZWQgYnkgRUZaIHRyZWF0bWVudCBldmVuIGluIAp0aGUgdW5pbmZlY3RlZCBhbmQgdHJlYXRlZCAoVW5pbmYrRUZaKSB2ZXJzdXMgdGhlIHVuaW5mZWN0ZWQsIGJ1dCBub3QgdHJlYXRlZAooVW5pbmYpIGNvbmRpdGlvbi4gVGhlIEVGWiB0cmVhdG1lbnQgYWxvbmUgd2FzIHZlcnkgZGlmZmVyZW50IGZyb20gdGhlIEVGWiB0cmVhdG1lbnQgd2l0aCBpbmZlY3Rpb24gW0BSeWFuXS4gCgogCjxkZXRhaWxzPgo8c3VtbWFyeT4qKkZpbGVzIGFuZCBkYXRhIHN0cnVjdHVyZSoqPC9zdW1tYXJ5PgogIAoqKlJlYWQgaW4gRmlsZXM6KioKCkFiYnJldmlhdGlvbnM6IAoKKiBpYS8yID0gaW5mZWN0ZWQgd2l0aCBISVYgKyB0cmVhdGVkIHdpdGggQVJUCiogY2EgPSB1bmluZmVjdGVkICsgQVJUCiogY3RsID0gdW5pbmZlY3RlZAoqIGluZiA9IGluZmVjdGVkIAoKRmlsZSBzdHJ1Y3R1cmU6IAoKKiB0aGUgIi5tdHgiIGZpbGVzIGNvbnRhaW5zIGEgc3BhcnNlIG1hdHJpeCBvZiBjbGFzcyBkZ1RNYXRyaXgKKiB0aGUgImJhcmNvZGVzLnRzdiIgZmlsZXMgY29udGFpbiB0aGUgY2VsbCBiYXJjb2RlcwoqIHRoZSAiZmVhdHVyZXMudHN2IiBmaWxlcyBjb250YWluIHRoZSBmZWF0dXJlIG5hbWVzIGFzIHdlbGwgYXMgZW5zZW1ibGUgZ2VuZSBpZHMgCmFuZCAiZ2VuZSBleHByZXNzaW9uIiBzdHJpbmdzIGluIGEgdGhpcmQgY29sdW1uCgoKVGhlcmUgYXJlIGR1cGxpY2F0ZWQgZmVhdHVyZXMgaW4gdGhlIGRhdGEsIHByb2JhYmx5LCBiZWNhdXNlIHRoZXJlIGFyZSBtdWx0aXBsZSBlbnNlbWJsZSBnZW5lIElEcyBtYXBwaW5nIHRvIHRoZSBzYW1lIGdlbmUgc3ltYm9sLiBUaGVyZWZvcmUsIHRoZSBzYW1lIGdlbmUgCnN5bWJvbCBoYXMgbXVsdGlwbGUgZXhwcmVzc2lvbiB2YWx1ZXMuIEhvdyBkbyB5b3UgZGVhbCB3aXRoIHRoaXMgcHJvYmxlbT8KCiogWW91IGNvdWxkIG1ha2UgdGhlbSB1bmlxdWUgd2l0aCB0aGUgZnVuY3Rpb24gYG1ha2UudW5pcXVlKClgCiogWW91IGNvdWxkIHJlbW92ZSB0aGUgZHVwbGljYXRlZCBmZWF0dXJlcy4gKipUaGlzIGlzIHdoYXQgSSBkaWQqKgoKYGBgCnBhdGggPC0gIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL0dTRTE0MzY4Nl9SQVcvIiAjIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9kYXRhL0dTRTE0MzY4Nl9SQVcvIgphbGxfZmlsZXMgPC0gbGlzdC5maWxlcyhwYXRoKQoKYWxsX2NvbmRfbGlzdCA8LSBtYXAoc2VxLmludCgzLDcpLCBmdW5jdGlvbihuKXsKICBmaWxlIDwtIGFsbF9maWxlc1tncmVwbChwYXN0ZTAoIkdTTTQyNzI1OCIsIG4pLCBhbGxfZmlsZXMpXQogIG5hbWUgPC0gc3RyX2V4dHJhY3QoZmlsZVtbMV1dLCJjYXxjdGx8aWEyfGlhfGluZiIpCiAgYmFyY29kZXMgPC0gcmVhZC50YWJsZShwYXN0ZTAocGF0aCxmaWxlW1sxXV0pLCBzZXAgPSAiXHQiKSAKICBmZWF0dXJlcyA8LSByZWFkLnRhYmxlKHBhc3RlMChwYXRoLCBmaWxlW1syXV0pLCBzZXAgPSAiXHQiKQogIG1hdHJpeCA8LSByZWFkTU0ocGFzdGUwKHBhdGgsIGZpbGVbWzNdXSkpCiAgY29sbmFtZXMobWF0cml4KSA8LSBiYXJjb2RlcyRWMQogIHJvd25hbWVzKG1hdHJpeCkgPC0gZmVhdHVyZXMkVjIKICBtYXRyaXggPC0gbWF0cml4WyFkdXBsaWNhdGVkKHJvd25hbWVzKG1hdHJpeCkpLF0KICBzZXVyYXRfb2IgPC0gQ3JlYXRlU2V1cmF0T2JqZWN0KG1hdHJpeCwgcHJvamVjdCA9IG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NheSA9ICJSTkEiLCBtaW4uY2VsbHMgPSAxLCBtaW4uZmVhdHVyZXMgPSAxKQogIHNldXJhdF9vYltbInBlcmNlbnRfbXQiXV0gPC0gUGVyY2VudGFnZUZlYXR1cmVTZXQoc2V1cmF0X29iLCBwYXR0ZXJuID0gIl5NVC0iKQogIGxpc3QobmFtZSA9IG5hbWUsIGNvdW50ID0gbWF0cml4LCBzZXVyYXRfb2IgPSBzZXVyYXRfb2IpCn0pCgojc2F2ZVJEUyhhbGxfY29uZF9saXN0LCAiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL3NyYy9UcmljdWx0dXJlX2RhdGFzZXRfUnlhbl9wYXBlci9zZXVyYXRfbGlzdCIpCmBgYAoKLS0tCjwvZGV0YWlscz4KCiMgRGF0YSBwcm9jZXNzaW5nIHsudGFic2V0fQoKIyMgQmVmb3JlIFF1YWxpdHkgQ29udHJvbDoKCgpgYGB7ciwgZmlnLndpZHRoPTE1fQphbGxfY29uZF9saXN0IDwtIHJlYWRSRFMoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9zcmMvVHJpY3VsdHVyZV9kYXRhc2V0X1J5YW5fcGFwZXIvc2V1cmF0X2xpc3QiKQoKYmVmb3JlX3FjIDwtIG1lcmdlKGFsbF9jb25kX2xpc3RbWzFdXSRzZXVyYXRfb2IsCiAgICAgICAgICAgICAgICAgICAgYyhhbGxfY29uZF9saXN0W1syXV0kc2V1cmF0X29iLAogICAgICAgICAgICAgICAgICAgICAgYWxsX2NvbmRfbGlzdFtbM11dJHNldXJhdF9vYiwKICAgICAgICAgICAgICAgICAgICAgIGFsbF9jb25kX2xpc3RbWzRdXSRzZXVyYXRfb2IsCiAgICAgICAgICAgICAgICAgICAgICBhbGxfY29uZF9saXN0W1s1XV0kc2V1cmF0X29iKSwKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0ID0gInRyaWN1bHR1cmVfYWxsX2NvbmRpdGlvbnMiLAogICAgICAgICAgICAgICAgICAgIGFkZC5jZWxsLmlkcyA9IGMocGFzdGUwKGFsbF9jb25kX2xpc3RbWzFdXSRuYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3RlMChhbGxfY29uZF9saXN0W1syXV0kbmFtZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZTAoYWxsX2NvbmRfbGlzdFtbM11dJG5hbWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzdGUwKGFsbF9jb25kX2xpc3RbWzRdXSRuYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3RlMChhbGxfY29uZF9saXN0W1s1XV0kbmFtZSkpKQpgYGAKCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTd9CnF1YWxfbWV0cmljIDwtIGMoIm5GZWF0dXJlX1JOQSIsICJuQ291bnRfUk5BIiwgInBlcmNlbnRfbXQiKQoKcGxvdHMgPC0gbWFwKHF1YWxfbWV0cmljLCBmdW5jdGlvbihtZXRyaWMpewogIGdncGxvdCgpICsKICAgIGdlb21fdmlvbGluKGFlcyh4ID0gYmVmb3JlX3FjQG1ldGEuZGF0YSAlPiUgcHVsbCgib3JpZy5pZGVudCIpLAogICAgICAgICAgICAgICAgIHkgPSBiZWZvcmVfcWNAbWV0YS5kYXRhICU+JSBwdWxsKG1ldHJpYyksIAogICAgICAgICAgICAgICAgIGZpbGwgPSBiZWZvcmVfcWNAbWV0YS5kYXRhICU+JSBwdWxsKCJvcmlnLmlkZW50IikpLCAKICAgICAgICAgICAgICAgIGFscGhhID0gLjUpICsKICAgIGdlb21fYm94cGxvdChhZXMoeCA9IGJlZm9yZV9xY0BtZXRhLmRhdGEgJT4lIHB1bGwoIm9yaWcuaWRlbnQiKSwKICAgICAgICAgICAgICAgICAgICAgeSA9IGJlZm9yZV9xY0BtZXRhLmRhdGEgJT4lIHB1bGwobWV0cmljKSksCiAgICAgICAgICAgICAgICAgYWxwaGEgPSAwKSArCiAgICB4bGFiKCJzYW1wbGUgb3JpZ2luIikgKwogICAgeWxhYihwYXN0ZTAobWV0cmljKSkgKwogICAgTm9MZWdlbmQoKSAKfSkKCmRvLmNhbGwoZ3JpZC5hcnJhbmdlLCBjKHBsb3RzLCBuY29sID0gMywgbnJvdyA9IDEpKQpgYGAKCi0tLQoKIyMgQWZ0ZXIgcXVhbGl0eSBjb250cm9sCgpGb3IgZWFjaCBzYW1wbGUgc2VwYXJhdGVseQoKKiByZW1vdmUgZ2VuZXMgZXhwcmVzc2luZyBsZXNzIHRoYW4gMjAwIGdlbmVzIG9yIG1vcmUgdGhhbiA1MDAwCiogcmVtb3ZlIGNlbGxzIGV4cHJlc3NpbmcgbW9yZSB0aGFuIDIwJSBtaXRvY2hvbmRyaWFsIGdlbmVzCiogbWVyZ2UgU2V1cmF0IG9iamVjdHMgYWZ0ZXIgUXVhbGl0eSBDb250cm9sCgpgYGB7cn0KIyBhZGQgcGVyY2VudGFnZSBvZiBtaXRvY2hvbmRpcmFsIGdlbmVzIHRvIG1ldGFkYXRhCmFsbF9jb25kIDwtIG1hcChzZXEuaW50KDEsNSksIGZ1bmN0aW9uKG4pewogIHNldXJhdF9vYiA8LSBhbGxfY29uZF9saXN0W1tuXV0kc2V1cmF0X29iCiAgI3NldXJhdF9vYltbInBlcmNlbnRfbXQiXV0gPC0gUGVyY2VudGFnZUZlYXR1cmVTZXQoc2V1cmF0X29iLCBwYXR0ZXJuID0gIl5NVC0iKQogICNwbG90IDwtIFZsblBsb3Qoc2V1cmF0X29iLAogICAjICAgICAgICAgICAgICAgZmVhdHVyZXMgPSBjKCJuRmVhdHVyZV9STkEiLCAicGVyY2VudF9tdCIsICJuQ291bnRfUk5BIiksCiAgICAjICAgICAgICAgICAgICBuY29sID0gMykgKwogICAgI2xhYnModGl0bGUgPSBwYXN0ZTAoImNvbmRpdGlvbiAiLCBhbGxfY29uZF9saXN0W1tuXV0kbmFtZSkpCiAgc2V1cmF0X29iIDwtIHN1YnNldChzZXVyYXRfb2IsIG5GZWF0dXJlX1JOQSA+IDIwMCAmIG5GZWF0dXJlX1JOQSA8IDUwMDAgJiBwZXJjZW50X210IDwgMjApCiAgbGlzdChuYW1lID0gYWxsX2NvbmRfbGlzdFtbbl1dJG5hbWUsIHNldXJhdF9vYiA9IHNldXJhdF9vYikjLCBwbG90ID0gcGxvdCkKfSkKYGBgCgoKYGBge3IsIGZpZy53aWR0aD0xNX0KdHJpY3VsdHVyZSA8LSBtZXJnZShhbGxfY29uZFtbMV1dJHNldXJhdF9vYiwKICAgICAgICAgICAgICAgICAgICBjKGFsbF9jb25kW1syXV0kc2V1cmF0X29iLAogICAgICAgICAgICAgICAgICAgICAgYWxsX2NvbmRbWzNdXSRzZXVyYXRfb2IsCiAgICAgICAgICAgICAgICAgICAgICBhbGxfY29uZFtbNF1dJHNldXJhdF9vYiwKICAgICAgICAgICAgICAgICAgICAgIGFsbF9jb25kW1s1XV0kc2V1cmF0X29iKSwKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0ID0gInRyaWN1bHR1cmVfYWxsX2NvbmRpdGlvbnMiLAogICAgICAgICAgICAgICAgICAgIGFkZC5jZWxsLmlkcyA9IGMocGFzdGUwKGFsbF9jb25kW1sxXV0kbmFtZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZTAoYWxsX2NvbmRbWzJdXSRuYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3RlMChhbGxfY29uZFtbM11dJG5hbWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzdGUwKGFsbF9jb25kW1s0XV0kbmFtZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZTAoYWxsX2NvbmRbWzVdXSRuYW1lKSkpCmBgYAoKCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9N30KcXVhbF9tZXRyaWMgPC0gYygibkZlYXR1cmVfUk5BIiwgIm5Db3VudF9STkEiLCAicGVyY2VudF9tdCIpCgpwbG90cyA8LSBtYXAocXVhbF9tZXRyaWMsIGZ1bmN0aW9uKG1ldHJpYyl7CiAgZ2dwbG90KCkgKwogICAgZ2VvbV92aW9saW4oYWVzKHggPSB0cmljdWx0dXJlQG1ldGEuZGF0YSAlPiUgcHVsbCgib3JpZy5pZGVudCIpLAogICAgICAgICAgICAgICAgIHkgPSB0cmljdWx0dXJlQG1ldGEuZGF0YSAlPiUgcHVsbChtZXRyaWMpLCAKICAgICAgICAgICAgICAgICBmaWxsID0gdHJpY3VsdHVyZUBtZXRhLmRhdGEgJT4lIHB1bGwoIm9yaWcuaWRlbnQiKSksIAogICAgICAgICAgICAgICAgYWxwaGEgPSAuNSkgKwogICAgZ2VvbV9ib3hwbG90KGFlcyh4ID0gdHJpY3VsdHVyZUBtZXRhLmRhdGEgJT4lIHB1bGwoIm9yaWcuaWRlbnQiKSwKICAgICAgICAgICAgICAgICAgICAgeSA9IHRyaWN1bHR1cmVAbWV0YS5kYXRhICU+JSBwdWxsKG1ldHJpYykpLAogICAgICAgICAgICAgICAgIGFscGhhID0gMCkgKwogICAgeGxhYigic2FtcGxlIG9yaWdpbiIpICsKICAgIHlsYWIocGFzdGUwKG1ldHJpYykpICsKICAgIE5vTGVnZW5kKCkgCn0pCgpkby5jYWxsKGdyaWQuYXJyYW5nZSwgYyhwbG90cywgbmNvbCA9IDMsIG5yb3cgPSAxKSkKYGBgCgotLS0KCiMjIE5vcm1hbGl6YXRpb24sIFNjYWxpbmcsIEZpbmQgVmFyaWFibGUgRmVhdHVyZXMKCiogbG9nIG5vcm1hbGl6YXRpb24KKiBzY2FsZSBkYXRhIHNvIHRoYXQgd2UgaGF2ZSBtZWFuID0gMCBhbmQgdmFyaWFuY2UgPSAxCiogRmluZCB0aGUgMjAwMCBtb3N0IGhpZ2hseSB2YXJpYWJsZSBmZWF0dXJlcwoKYGBgCnRyaWN1bHR1cmUgPC0gTm9ybWFsaXplRGF0YSh0cmljdWx0dXJlLCB2ZXJib3NlID0gRkFMU0UpCnRyaWN1bHR1cmUgPC0gU2NhbGVEYXRhKHRyaWN1bHR1cmUsIHZlcmJvc2UgPSBGQUxTRSkKdHJpY3VsdHVyZSA8LSBGaW5kVmFyaWFibGVGZWF0dXJlcyh0cmljdWx0dXJlLCB2ZXJib3NlID0gRkFMU0UpCmBgYAotLS0KCiMjIERpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbgoKKiBjb21wdXRlIFBDQQoqIHVzZSBlbGJvdyBwbG90IHRvIGRldGVybWluZSBkaW1lbnNpb25zIHRoYXQgY29udHJpYnV0ZSB0byB2YXJpYWJpbGl0eQoqIGZpbmQgdGhlIGstbmVhcmVzdCBuZWlnaGJvcnMKKiBmaW5kIENsdXN0ZXJzIGJhc2VkIG9uIEtOTi1ncmFwaAoqIGNhbGN1bGF0ZSBUU05FIGVtYmVkZGluZwoKYGBgCnRyaWN1bHR1cmUgPC0gUnVuUENBKHRyaWN1bHR1cmUsIGZlYXR1cmVzID0gVmFyaWFibGVGZWF0dXJlcyh0cmljdWx0dXJlKSwgdmVyYm9zZSA9IEZBTFNFKQpFbGJvd1Bsb3QodHJpY3VsdHVyZSkKCnRyaWN1bHR1cmUgPC0gRmluZE5laWdoYm9ycyh0cmljdWx0dXJlLCB2ZXJib3NlID0gRkFMU0UpCnRyaWN1bHR1cmUgPC0gRmluZENsdXN0ZXJzKHRyaWN1bHR1cmUsIHZlcmJvc2UgPSBGQUxTRSkKCnRyaWN1bHR1cmUgPC0gUnVuVFNORSh0cmljdWx0dXJlLCBkaW1zID0gMToxMCwgdmVyYm9zZSA9IEZBTFNFKQpgYGAKCmBgYHtyfQp0cmljdWx0dXJlIDwtIHJlYWRSRFMoInNldXJhdF9vYmplY3RzL3RyaWN1bHR1cmVfc2V1cmF0X29iamVjdCIpCgojdHJpY3VsdHVyZSA8LSByZWFkUkRTKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvc3JjL1RyaWN1bHR1cmVfZGF0YXNldF9SeWFuX3BhcGVyL3RyaWN1bHR1cmVfc2V1cmF0X29iamVjdCIpCgpEaW1QbG90KHRyaWN1bHR1cmUsIHJlZHVjdGlvbiA9ICJ0c25lIiwgcHQuc2l6ZSA9IC4wMSxsYWJlbCA9IFRSVUUsCiAgICAgICAgZ3JvdXAuYnkgPSAic2V1cmF0X2NsdXN0ZXJzIikKYGBgCgotLS0KCiMjIENlbGwgdHlwZSBhbm5vdGF0aW9uCgpGb3IgYW5ub3RhdGluZyB0aGUgZGlmZmVyZW50IGNsdXN0ZXJzIHRoZSBzYW1lIG1hcmtlcnMgYXMgaW4gW0BSeWFuXSB3ZXJlIHVzZWQ6CgoqICpNaWNyb2dsaWE6KiBBSUYxLCBTUEkxLCBDRDQKKiAqQXN0cm9jeXRlczoqIFNPWDksIFRIQlMxCiogKk5ldXJvbnM6KiBTWU4xLCBNQVAyCgpgYGB7ciwgZmlnLndpZGh0ID0gMTUsIGZpZy5oZWlnaHQ9MTJ9CiNtYXJrZXJzIDwtIEZpbmRBbGxNYXJrZXJzKHRyaWN1bHR1cmUpCiN0cmljdWx0dXJlIDwtIHJlYWRSRFMoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9zcmMvVHJpY3VsdHVyZV9kYXRhc2V0X1J5YW5fcGFwZXIvdHJpY3VsdHVyZV9zZXVyYXRfb2JqZWN0IikKbWFya2VycyA8LSByZWFkLnRhYmxlKCJkYXRhX2ZpbGVzL21hcmtlcl9nZW5lc190cmljdWx0dXJlX2RhdGFzZXQiKQojbWFya2VycyA8LSByZWFkLnRhYmxlKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9tYXJrZXJfZ2VuZXNfdHJpY3VsdHVyZV9kYXRhc2V0IikKCnRvcF8yIDwtIG1hcmtlcnMgJT4lIGdyb3VwX2J5KCJzZXVyYXRfY2x1c3RlciIpICU+JSB0b3BfbihuID0gMiwgd3QgPSBhdmdfbG9nMkZDKQoKbWFya2VyX2dlbmVzIDwtIGMoIkFJRjEiLCAiU1BJMSIsICJDRDQiLCAiTUFQMiIsICJTWU4xIiwgIlRIQlMxIiwgIlNPWDkiKQpwMSA8LSBGZWF0dXJlUGxvdCh0cmljdWx0dXJlLCBmZWF0dXJlcyA9ICJBSUYxIikKcDIgPC0gRmVhdHVyZVBsb3QodHJpY3VsdHVyZSwgZmVhdHVyZXMgPSAiU1BJMSIpCnAzIDwtIEZlYXR1cmVQbG90KHRyaWN1bHR1cmUsIGZlYXR1cmVzID0gIkNENCIpCnA0IDwtIEZlYXR1cmVQbG90KHRyaWN1bHR1cmUsIGZlYXR1cmVzID0gIk1BUDIiKQpwNSA8LSBGZWF0dXJlUGxvdCh0cmljdWx0dXJlLCBmZWF0dXJlcyA9ICJTWU4xIikKcDYgPC0gRmVhdHVyZVBsb3QodHJpY3VsdHVyZSwgZmVhdHVyZXMgPSAiVEhCUzEiKQpwNyA8LSBGZWF0dXJlUGxvdCh0cmljdWx0dXJlLCBmZWF0dXJlcyA9ICJTT1g5IikKCmdnYXJyYW5nZShwMSxwMixwMyxwNCxwNSxwNixwNywgbmNvbCA9IDIsIG5yb3cgPTQgKQoKYGBgCgoKCjxkZXRhaWxzPgo8c3VtbWFyeT4qKkRldGFpbHMgb24gY2VsbCB0eXBlIGFubm90YXRpb24qKjwvc3VtbWFyeT4KCioqR2VuZSBleHByZXNzaW9uKioKCkRpZmZlcmVudCBjbHVzdGVycyB3ZXJlIGFubm90YXRlZCBhY2NvcmRpbmcgdG8gdGhlIGdlbmUgZXhwcmVzc2lvbiBvZiAKbWFya2VyIGdlbmVzIG1lbnRpb25lZCBhYm92ZS4KCmBgYHtyLCBmaWcud2lkdGg9MTV9CgpWbG5QbG90KHRyaWN1bHR1cmUsIGZlYXR1cmVzID0gYygiQ0Q0IiwgIlNQSTEiLCAiQUlGMSIpLCBncm91cC5ieSA9ICJzZXVyYXRfY2x1c3RlcnMiKSMsIGdyb3VwLmJ5ID0gc2V1cmF0X2NsdXN0ZXIpClZsblBsb3QodHJpY3VsdHVyZSwgZmVhdHVyZXMgPSBjKCJNQVAyIiwgIlNZTjEiKSwgZ3JvdXAuYnkgPSAic2V1cmF0X2NsdXN0ZXJzIikKVmxuUGxvdCh0cmljdWx0dXJlLCBmZWF0dXJlcyA9IGMoIlRIQlMxIiwgIlNPWDkiKSwgZ3JvdXAuYnkgPSAic2V1cmF0X2NsdXN0ZXJzIikKYGBgCgpgYGB7cn0KIyA0LCA5LCAxMSwgMTggPSBNaWNyb2dsaWEKIyAwLCAxLCAyLCAzLDgsIDEwLCAxMywgMTUsIDE4LCAxOSA9IE5ldXJvbnMgCiMgNiwgNywgMTIsIDE0LCAxNiA9IEFzdHJvY3l0ZXMKIyA1LCAxNyBhcmUgdW5kZXNnaW5hdGVkCmNlbGxfdHlwZXMgPC0gKHRyaWN1bHR1cmVAbWV0YS5kYXRhICU+JSAKICBtdXRhdGUoY2VsbF90eXBlID0gY2FzZV93aGVuKAogICAgc2V1cmF0X2NsdXN0ZXJzICVpbiUgYyg0LDksMTEpIH4gImlNZyIsIAogICAgc2V1cmF0X2NsdXN0ZXJzICVpbiUgYyg2LDcsMTIsMTQsMTYpIH4gImlBc3QiLCAKICAgIHNldXJhdF9jbHVzdGVycyAlaW4lIGMoMCwxLDIsMyw4LDEwLDEzLDE1LDE4LDE5KSB+ICJpTmV1cm9ucyIsCiAgICBUUlVFICB+ICJVbmRlc2lnbmF0ZWQiKSkpW1siY2VsbF90eXBlIl1dCiAgCnRyaWN1bHR1cmUgPC0gQWRkTWV0YURhdGEodHJpY3VsdHVyZSwgY2VsbF90eXBlcywgY29sLm5hbWUgPSAiY2VsbF90eXBlIikKCmBgYAoKLS0tCjwvZGV0YWlscz4KCi0tLQoKIyBFeHBsb3JpbmcgdGhlIGRhdGFzZXQKCiMjIyBSZW1vdmUgdW5kZXNpZ25hdGVkIGNlbGxzCgpUaGVyZSBpcyBvbmUgZ3JvdXAgb2YgY2VsbHMgd2hlcmUgaXQgaXMgbm90IGNsZWFyIHdoaWNoIGNlbGwgc3RhdGUgdGhleSAKcmVwcmVzZW50IChVbmRlc2lnbmF0ZWQpLCB3ZSB3aWxsIGV4Y2x1ZGUgdGhlbSBmcm9tIGZ1cnRoZXIgYW5hbHlzaXMgYXMgW0BSeWFuXSAKZGlkLgoKCmBgYHtyfQpwMSA8LSBEaW1QbG90KHRyaWN1bHR1cmUsIHJlZHVjdGlvbiA9ICJ0c25lIiwgcHQuc2l6ZSA9IC4wMSwgbGFiZWwgPSBUUlVFLAogICAgICAgIGdyb3VwLmJ5ID0gImNlbGxfdHlwZSIpICsKICBsYWJzKHRpdGxlID0gImNlbGwgdHlwZXMiKQpgYGAKCgpgYGB7cn0KdHJpY3VsdHVyZV9jbGVhbiA8LSBzdWJzZXQodHJpY3VsdHVyZSwgY2VsbF90eXBlICVpbiUgYygiaU1nIiwgImlOZXVyb25zIiwgImlBc3QiKSkgCmBgYAoKYGBge3J9CnAyIDwtIERpbVBsb3QodHJpY3VsdHVyZV9jbGVhbiwgcmVkdWN0aW9uID0gInRzbmUiLCBwdC5zaXplID0gLjAxLCBsYWJlbCA9IFRSVUUsCiAgICAgICAgZ3JvdXAuYnkgPSAiY2VsbF90eXBlIikgKyAKICBsYWJzKHRpdGxlID0gImNlbGwgdHlwZXMiKQpgYGAKCmBgYHtyLCBmaWcud2lkdGg9MTV9CnAxK3AyCmBgYAoKCjxkZXRhaWxzPgo8c3VtbWFyeT4qKkhlYXRtYXAgb2YgdG9wIDIwIG1hcmtlciBnZW5lcyBmb3IgZWFjaCBjZWxsIHR5cGUqKjwvc3VtbWFyeT4KCgpUb3AyMCBtYXJrZXIgZ2VuZXMgZm9yIGVhY2ggY2VsbCBjZWxsIHR5cGU6IAogCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MjV9CklkZW50cyh0cmljdWx0dXJlX2NsZWFuKSA8LSAiY2VsbF90eXBlIgp0b3BfbiA8LSBtYXJrZXJzICU+JSBncm91cF9ieSAoY2x1c3RlcikgJT4lIHRvcF9uKG4gPSAyMCwgd3QgPSBhdmdfbG9nMkZDKQpEb0hlYXRtYXAodHJpY3VsdHVyZV9jbGVhbiwgZmVhdHVyZXMgPSB0b3BfbiRnZW5lKQpgYGAKCgotLS0KPC9kZXRhaWxzPgoKCjxkZXRhaWxzPgo8c3VtbWFyeT4qKk51bWJlciBvZiBjZWxscyBwZXIgY29uZGl0aW9uIGFuZCBjZWxsIHR5cGUqKjwvc3VtbWFyeT4KCgpIb3cgbWFueSBjZWxscyBvZiBlYWNoIGNlbGwgdHlwZSBhbmQgY29uZGl0aW9uIGFyZSBwcmVzZW50IGluIHRoZSBkYXRhc2V0PwoKYGBge3IsIHJlc3VsdHMgPSAiYXNpcyJ9CnRyaWN1bHR1cmVfY2xlYW5AbWV0YS5kYXRhICU+JSBncm91cF9ieShjZWxsX3R5cGUsIG9yaWcuaWRlbnQpICU+JSAKICBzdW1tYXJpemUobiA9IG4oKSkgJT4lIAogIG11dGF0ZShvcmlnLmlkZW50ID0gY2FzZV93aGVuKAogICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCAlaW4lIGMoImlhIiwgImlhMiIpIH4gIkluZitFRloiLCAKICAgICAgICAgICAgICAgICAgICAgIG9yaWcuaWRlbnQgPT0gImNhIiB+ICJVbmluZiIsCiAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ID09ICJjdGwiIH4gIlVuaW5mK0VGWiIsCiAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ID09ICJpbmYiIH4gIkluZiIpKSAlPiUgCiAgcGl2b3Rfd2lkZXIobmFtZXNfZnJvbSA9IG9yaWcuaWRlbnQsIHZhbHVlc19mcm9tID0gbikgJT4lIAogIGthYmxlKGNhcHRpb24gPSAiTnVtYmVyIG9mIGNlbGxzIHBlciBjb25kaXRpb24gYW5kIGNlbGwgdHlwZSIpICMgdG8gbWFrZSB0YWJsZSBsb29rIG5pY2UgaW4gUm1hcmtkb3duCiAgCmBgYAoKCi0tLQo8L2RldGFpbHM+CgoKIyMjIEluZmVjdGlvbiBhbmQgdHJlYXRtZW50IGNvbmRpdGlvbnMKCkludGVyZXN0aW5nbHksIHRoZSBpbmZlY3RlZCBjZWxscyB0cmVhdGVkIHdpdGggRUZaIChJbmYrRUZaKSBjbGVhcmx5IHNlcGFyYXRlIApmcm9tIHRoZSBpbmZlY3RlZCwgYnV0IHVudHJlYXRlZCBjZWxscyAoSW5mKSBhbmQgdGhlIHVuaW5mZWN0ZWQgY2VsbHMKKFVuaW5mLCBVbmluZitFRlopIGluIHRoZSBtaWNyb2dsaWEgY2x1c3RlciBhcyBjYW4gYmUgc2VlbiBpbiB0aGUgZmlndXJlIGJlbG93LgoKCmBgYHtyfQojIHJlbmFtZSBvcmlnaW4gb2YgaWRlbnQgZm9yIGVhc2llciBpbnRlcnByZXRhdGlvbgpvcmlnaW5fdmVjdG9yIDwtICh0cmljdWx0dXJlX2NsZWFuQG1ldGEuZGF0YSAlPiUgCiAgICAgICAgICAgICAgICAgICAgbXV0YXRlKG9yaWcuaWRlbnQgPSBjYXNlX3doZW4oCiAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ICVpbiUgYygiaWEiLCAiaWEyIikgfiAiSW5mK0VGWiIsIAogICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSAiY2EiIH4gIlVuaW5mIiwKICAgICAgICAgICAgICAgICAgICAgIG9yaWcuaWRlbnQgPT0gImN0bCIgfiAiVW5pbmYrRUZaIiwKICAgICAgICAgICAgICAgICAgICAgIG9yaWcuaWRlbnQgPT0gImluZiIgfiAiSW5mIikpKVtbIm9yaWcuaWRlbnQiXV0KCnRyaWN1bHR1cmVfY2xlYW4gPC0gQWRkTWV0YURhdGEodHJpY3VsdHVyZV9jbGVhbiwgb3JpZ2luX3ZlY3RvciwgY29sLm5hbWUgPSAib3JpZy5pZGVudCIpCmBgYAoKYGBge3IsIGZpZy53aWR0aD0xNX0KcDEgPC0gRGltUGxvdCh0cmljdWx0dXJlX2NsZWFuLCByZWR1Y3Rpb24gPSAidHNuZSIsIHB0LnNpemUgPSAuMDEsIGxhYmVsID0gVFJVRSwKICAgICAgICBncm91cC5ieSA9ICJjZWxsX3R5cGUiKSArIAogIGxhYnModGl0bGUgPSAiY2VsbCB0eXBlcyIpCnAyIDwtIERpbVBsb3QodHJpY3VsdHVyZV9jbGVhbiwgcmVkdWN0aW9uID0gInRzbmUiLCAKICAgICAgICAgICAgICBncm91cC5ieSA9ICJvcmlnLmlkZW50IiwgcHQuc2l6ZSA9IC4wMSwgKSArIAogIGxhYnModGl0bGUgPSAiSW5mZWN0aW9uICYgdHJlYXRtZW50IGNvbmRpdGlvbiIpCgpwMSArIHAyCmBgYAoKCjxkZXRhaWxzPgo8c3VtbWFyeT4qKkluZmxhbW1hdG9yeSBnZW5lIGV4cHJlc3Npb24gaW4gaU1nKio8L3N1bW1hcnk+CgpUaGUgbGFyZ2VzdCBjaGFuZ2UgaW4gZ2VuZSBleHByZXNzaW9uIHJlbGF0ZWQgdG8gaW5mbGFtbWF0aW9uIHdhcyBmb3VuZCBpbiBpTWcKYW1vbmcgdGhlIDMgY2VsbCB0eXBlcyBbQFJ5YW5dLiBTaG93biBhcmUgb25seSBpbmZsYW1tYXRvcnkgZ2VuZXMuIAoKYGBge3IsIGZpZy5oZWlnaHQgPSAxMn0KaW5mbGFtbV9nZW5lcyA8LSBjKCJUTkYiLCAiQUNTTDEiLCAiTUdTVDMiLCAiQjJNIiwgIklGTkdSMiIsICJHUklOQSIsICJUTFIyIiwgCiAgICAgICAgICAgICAgICAgICAiU09EMiIsICJHTFVMIiwgIkNGTEFSIiwgIkNUTk5CMSIsICJDWENMOCIsICJDQ0w0IiwgIklMMUIiLAogICAgICAgICAgICAgICAgICAgIkFURjQiLCAiQ1hDTDgiLCAiQ0NMNCIsICJDQ0wyIiwgIklMMUIiLCAiQVRGNCIsICJDWENMMSIsIAogICAgICAgICAgICAgICAgICAgIk5GS0IxIiwgIlRBTksiLCAiQVBPRSIsICJUUkVNMiIsICJMWTk2IiwgIlNSQyIsICJOQ0YxIiwgCiAgICAgICAgICAgICAgICAgICAiSENLIiwgIkxZTiIsICJWQVNQIiwgIkMzIiwgIkM1IiwgIlJBUDFCIiwgIlJBUDJCIiwgIk1BRiIsCiAgICAgICAgICAgICAgICAgICAiSlVORCIsICJTUVNUTTEiLCAiRlRIMSIsICJSSE9RIiwgIkNEMzYiLCAiRk9TIiwgIk5GS0JJQSIsCiAgICAgICAgICAgICAgICAgICAiSUNBTTEiLCAiVE5GQUlQMyIsICJMWVoiLCAiUFBQMVIxMkEiLCAiUk5EMyIsICJDWUJBIiwgIklSRjgiLAogICAgICAgICAgICAgICAgICAgIlNMQzI1QTYiKQoKRG9IZWF0bWFwKHRyaWN1bHR1cmVfY2xlYW4sIGZlYXR1cmVzID0gaW5mbGFtbV9nZW5lcykKYGBgCgotLS0KPC9kZXRhaWxzPgoKPGRldGFpbHM+CjxzdW1tYXJ5PioqRGlmZmVyZW5jZXMgb2YgaW5mbGFtbWF0b3J5IGdlbmUgZXhwcmVzc2lvbiBiZXR3ZWVuIGNvbmRpdGlvbnMqKjwvc3VtbWFyeT4KCgpUaGUgZ2VuZSBleHByZXNzaW9uIG9mIGluZmxhbW1hdG9yeSBnZW5lcyBpbiBtaWNyb2dsaWEgd2FzIG5vdCB2ZXJ5IGRpZmZlcmVudApiZXR3ZWVuIHRoZSBjb25kaXRpb25zLiBUaGUgSW5mK0VGWiBjZWxscyBzaG93IGEgc2xpZ2h0bHkgZGlmZmVyZW50IHBhdHRlcm4gb2YKZ2VuZSBleHByZXNzaW9uLgoKYGBge3IsIGZpZy5oZWlnaHQ9MTJ9CkRvSGVhdG1hcChzdWJzZXQodHJpY3VsdHVyZV9jbGVhbiwgY2VsbF90eXBlID09ICJpTWciKSwgCiAgICAgICAgICBmZWF0dXJlcyA9IGluZmxhbW1fZ2VuZXMsIGdyb3VwLmJ5ID0gIm9yaWcuaWRlbnQiKQpgYGAKCgotLS0KPC9kZXRhaWxzPgoKCiMgSW50ZWdyYXRpb24gVHJpY3VsdHVyZSAmIENTRi9CbG9vZCAKClRoZSBISVYgQmxvb2QgJiBDU0YgZGF0YXNldCBbQEZhcmhhZGlhbl0KdXNlZCBpbiB0aGUgcHJldmlvdXMgYW5hbHlzaXMgd2FzIGludGVncmF0ZWQgd2l0aCB0aGUgdHJpY3VsdHVyZSBkYXRhc2V0IFtAUnlhbl0uCgpJbnRlZ3JhdGlvbiBvZiB0aGUgdHdvIGRhdGFzZXRzIGlzIGJhc2VkIG9uIHRoZSBTZXVyYXQgcGFja2FnZSBbQFN0dWFydF0uCkl0IGZpcnN0IGlkZW50aWZpZXMgCmFuY2hvcnMgYmV0d2VlbiBkYXRhc2V0cywgY2FsY3VsYXRlcyBzY29yZXMgZm9yIGFsbCBhbmNob3JzIGFuZCAKdGhlbiBjYWxjdWxhdGVzIGFuIGludGVncmF0ZWQgZXhwcmVzc2lvbiBtYXRyaXggd2hpY2ggY2FuIGJlIHVzZWQgZm9yIGRvd25zdHJlYW0KYW5hbHlzaXMuCgoKMS4gSWRlbnRpZnkgZmVhdHVyZXMgd2hpY2ggYXJlIHZhcmlhYmxlIGFjcm9zcyBkYXRhc2V0cwoyLiBJZGVudGlmeSBhbmNob3JzIGJldHdlZW4gdGhlIHR3byBkYXRhc2V0cyBhbmQgY3JlYXRlIGFuIGludGVncmF0ZWQgZGF0YSBhc3NheQozLiBSdW4gYSBzaW5nbGUgaW50ZWdyYXRlZCBhbmFseXNpcyBvbiBhbGwgY2VsbHMKCgo8ZGV0YWlscz4KPHN1bW1hcnk+KipEZXRhaWxzIG9uIGludGVncmF0aW9uKio8L3N1bW1hcnk+CgpGb3IgbW9yZSBkZXRhaWxzIHNlZTogW0BTdHVhcnRdIGFuZCBEaXNjdXNzaW9uCgoxLiBJZGVudGlmeSBmZWF0dXJlcyB3aGljaCBhcmUgdmFyaWFibGUgYWNyb3NzIGRhdGFzZXRzCjIuIElkZW50aWZ5IGFuY2hvcnMgYmV0d2VlbiB0aGUgdHdvIGRhdGFzZXRzIGFuZCBjcmVhdGUgYW4gaW50ZWdyYXRlZCBkYXRhIGFzc2F5CjMuIFJ1biBhIHNpbmdsZSBpbnRlZ3JhdGVkIGFuYWx5c2lzIG9uIGFsbCBjZWxscwoKYGBgCmhpdjcgPC0gcmVhZFJEUygiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL3NyYy9SZXByb2R1Y2VfRmFyaGFkaWFuX1BhcGVyL1NldXJhdF9vYmplY3RzL3RvdGFsXzdfc2FtcGxlc19sYWJlbF90cmFuc2Zlci5yZHMiKQpoaXY3IDwtIE5vcm1hbGl6ZURhdGEoaGl2NywgdmVyYm9zZSA9IEZBTFNFKQpoaXY3IDwtIEZpbmRWYXJpYWJsZUZlYXR1cmVzKGhpdjcsIHZlcmJvc2UgPSBGQUxTRSkKCiMgYWRkIGJvdGggZGF0YXNldHMgdG8gYSBsaXRzCmRhdGFfbGlzdCA8LSBsaXN0KGhpdiA9IGhpdjcsIHRyaWN1bHR1cmUgPSB0cmljdWx0dXJlX2NsZWFuKQoKIyBzZWxlY3QgZmVhdHVyZXMgdGhhdCBhcmUgcmVwZWF0ZWRseSB2YXJpYWJsZSBhY3Jvc3MgZGF0YXNldHMgZm9yIGludGVncmF0aW9uCmZlYXR1cmVzIDwtIFNlbGVjdEludGVncmF0aW9uRmVhdHVyZXMob2JqZWN0Lmxpc3QgPSBkYXRhX2xpc3QsIHZlcmJvc2UgPSBGQUxTRSkKCiMgaWRlbnRpZnkgaW50ZWdyYXRpb24gYW5jaG9ycyBhbmQgcGVyZm9ybSBpbnRlZ3JhdGlvbgphbmNob3JzIDwtIEZpbmRJbnRlZ3JhdGlvbkFuY2hvcnMob2JqZWN0Lmxpc3QgPSBkYXRhX2xpc3QsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yLmZlYXR1cmVzID0gZmVhdHVyZXMsIHZlcmJvc2UgPSBGQUxTRSkgCmNvbWJpbmVkIDwtIEludGVncmF0ZURhdGEoYW5jaG9yc2V0ID0gYW5jaG9ycywgdmVyYm9zZSA9IEZBTFNFKQoKIyBydW4gYW5hbHlzaXMgb24gaW50ZWdyYXRlZCBkYXRhc2V0CmNvbWJpbmVkIDwtIFNjYWxlRGF0YShjb21iaW5lZCwgdmVyYm9zZSA9IEZBTFNFKQpjb21iaW5lZCA8LSBSdW5QQ0EoY29tYmluZWQsIHZlcmJvc2UgPSBGQUxTRSkKI0VsYm93UGxvdChjb21iaW5lZCkKY29tYmluZWQgPC0gUnVuVFNORShjb21iaW5lZCwgcmVkdWN0aW9uID0gInBjYSIsIGRpbXMgPSAxOjEwLCB2ZXJib3NlID0gRkFMU0UpCmNvbWJpbmVkIDwtIEZpbmROZWlnaGJvcnMoY29tYmluZWQsIHJlZHVjdGlvbiA9ICJwY2EiLCBkaW1zID0gMToxMCwgdmVyYm9zZSA9IEZBTFNFKQpjb21iaW5lZCA8LSBGaW5kQ2x1c3RlcnMoY29tYmluZWQsIHJlc29sdXRpb24gPSAuMywgdmVyYm9zZSA9IEZBTFNFKQoKIyBhZGQgYW5ub3RhdGlvbnMgZnJvbSB3aGljaCBkYXRhc2V0IHRoZSBzYW1wbGUgY2FtZSBmcm9tCmRhdGFzZXRfdmVjdG9yIDwtIChjb21iaW5lZEBtZXRhLmRhdGEgJT4lIG11dGF0ZShkYXRhc2V0ID0gaWZlbHNlKG9yaWcuaWRlbnQgJWluJQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYygiSElWMV9DU0YiLCAiSElWMl9DU0YiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiSElWM19DU0YiLCAiSElWMV9CbGQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkhJVjJfQmxkIiwgIlVuaW5mZWN0ZWQxX0NTRiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJVbmluZmVjdGVkMl9DU0YiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3NmIiwgInRyaWN1bHR1cmUiKSkpW1siZGF0YXNldCJdXQoKY29tYmluZWQgPC0gQWRkTWV0YURhdGEoY29tYmluZWQsIGRhdGFzZXRfdmVjdG9yLCBjb2wubmFtZSA9ICJkYXRhc2V0IikKCiMgYWRkIGluZm9ybWF0aW9uIG9uIHRoZSBjZWxsIGdyb3VwcyBpbiB0aGUgY29tYmluZWQgZGF0YXNldHMKY29tYmluZWRfY2x1c3RlcnMgPC0gKGNvbWJpbmVkQG1ldGEuZGF0YSAlPiUgCiAgbXV0YXRlKGNvbWJpbmVkX2NsdXN0ZXJzID0gaWZlbHNlKHNldXJhdF9jbHVzdGVycyAlaW4lIGMoMiwxMCksICJNaWNyb2dsaWEiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmZWxzZShzZXVyYXRfY2x1c3RlcnMgJWluJSBjKDMsOSksICJpQXN0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZlbHNlKHNldXJhdF9jbHVzdGVycyAlaW4lIGMoMCwxLDcsMTEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaU5ldXJvbnMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZlbHNlKHNldXJhdF9jbHVzdGVycyAlaW4lIGMoOCw1LDYpLCAiSW1tdW5lIENlbGxzIiwgIlVuZGVzaWduYXRlZCIpKSkpKSlbWyJjb21iaW5lZF9jbHVzdGVycyJdXQogIApjb21iaW5lZCA8LSBBZGRNZXRhRGF0YShjb21iaW5lZCwgY29tYmluZWRfY2x1c3RlcnMsIGNvbC5uYW1lID0gImNvbWJpbmVkX2NsdXN0ZXJzIikKCiNzYXZlUkRTKGNvbWJpbmVkLCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvc3JjL1RyaWN1bHR1cmVfZGF0YXNldF9SeWFuX3BhcGVyL3RyaWN1bHR1cmVfaGl2X2NvbWJpbmVkX3NldXJhdF9vYmplY3QiKQoKYGBgCgotLS0KPC9kZXRhaWxzPgoKIyMgSW50ZWdyYXRlZCBjbHVzdGVycwoKV2hlbiBpbnRlZ3JhdGluZyB0aGUgQ1NGIGRhdGFzZXQgYW5kIHRoZSBUcmljdWx0dXJlIGRhdGFzZXQgdGhlIGlNZyBjZWxscyAKY2x1c3RlciB0b2dldGhlciB3aXRoIHRoZSBNeWVsb2lkIGNlbGxzIGZyb20gdGhlIENTRiBhbmQgQmxvb2Qgc2FtcGxlcyBmcm9tIAp0aGUgSElWIGluZmVjdGVkL3VuaW5mZWN0ZWQgcGF0aWVudHMgKHNlZSBmaWd1cmUgYmVsb3cpLiBUaGlzIGlzIGFzIGV4cGVjdGVkLApzaW5jZSB0aGV5IGFyZSBib3RoCm15ZWxvaWQtbGluZWFnZSBjZWxscy4gSG93ZXZlciwgaXQgYWxzbyBtYWtlcyBpdCBtb3JlIGRpZmZpY3VsdCB0byBkcmF3IGNvbmNsdXNpb25zCm9uIHdoaWNoIG9mIHRoZSBmaXZlIE15ZWxvaWQgY2x1c3RlcnMgaXMgdGhlIG1vc3QgbWljcm9nbGlhLWxpa2UuIFRoZXJlZm9yZSwgd2UgCmhhZCBhIGNsb3NlciBsb29rIGF0IHRoaXMgbXllbG9pZC1saW5lYWdlIGNsdXN0ZXIgY29uc2lzdGluZyBvZiBpTWcgZnJvbQp0cmljdWx0dXJlIGFuZCBNeWVsb2lkIGNlbGxzIGZyb20gQ1NGIGFuZCBCbG9vZCBzYW1wbGVzLgoKCiMjIyMgVmlzdWFsaXphdGlvbiBvZiB0aGUgaW50ZWdyYXRlZCBkYXRhc2V0CgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTE1fQpjb21iaW5lZCA9IHJlYWRSRFMoInNldXJhdF9vYmplY3RzL3RyaWN1bHR1cmVfaGl2X2NvbWJpbmVkX3NldXJhdF9vYmplY3RfMiIpCgpwMSA8LSBEaW1QbG90KGNvbWJpbmVkLCByZWR1Y3Rpb24gPSAidHNuZSIsIGdyb3VwLmJ5ICA9ICJkYXRhc2V0IiwKICAgICAgICAgICAgICBsYWJlbCA9IFRSVUUpICsgTm9MZWdlbmQoKSArCiAgbGFicyh0aXRsZSA9ICJEYXRhc2V0IikKcDIgPC0gRGltUGxvdChjb21iaW5lZCwgcmVkdWN0aW9uID0gInRzbmUiLCBncm91cC5ieSA9ICJjZWxsX3R5cGUiLAogICAgICAgICAgICAgIGxhYmVsID0gVFJVRSwgcmVwZWwgPSBUUlVFKSArIE5vTGVnZW5kKCkgKwogIGxhYnModGl0bGUgPSAiQ2VsbCB0eXBlcyIpCnAzIDwtIERpbVBsb3QoY29tYmluZWQsIHJlZHVjdGlvbiA9ICJ0c25lIiwgZ3JvdXAuYnkgPSAiY2VsbF90eXBlIiwKICAgICAgICAgICAgICBzcGxpdC5ieSA9ICJkYXRhc2V0IiwgbGFiZWwgPSBUUlVFLCByZXBlbCA9IFRSVUUpICsgTm9MZWdlbmQoKSArCiAgbGFicyh0aXRsZSA9ICJDZWxsIHR5cGVzIHNwbGl0IGludG8gZGF0YXNldHMiKQpwNCA8LSBEaW1QbG90KGNvbWJpbmVkLCByZWR1Y3Rpb24gPSAidHNuZSIsIGdyb3VwLmJ5ID0gInNldXJhdF9jbHVzdGVycyIsCiAgICAgICAgICAgICAgbGFiZWwgPSBUUlVFKSArIE5vTGVnZW5kKCkgKwogIGxhYnModGl0bGUgPSAiQ2x1c3RlcnMiKQoKYTEgPC0gRGltUGxvdChjb21iaW5lZCwgcmVkdWN0aW9uID0gInRzbmUiLCBzcGxpdC5ieSA9ICJkYXRhc2V0IiwgCiAgICAgICAgZ3JvdXAuYnkgPSAic2V1cmF0X2NsdXN0ZXJzIiwgbGFiZWwgPSBUUlVFLCByZXBlbCA9VFJVRSkgKwogIE5vTGVnZW5kKCkgKwogIGxhYnModGl0bGUgPSAiQ2x1c3RlcnMgc3BsaXQgaW50byBkYXRhc2V0cyIpCgphMiA8LSBEaW1QbG90KGNvbWJpbmVkLCByZWR1Y3Rpb24gPSAidHNuZSIsIHNwbGl0LmJ5ID0gImRhdGFzZXQiLCAKICAgICAgICAgICAgICBncm91cC5ieSA9ICJvcmlnLmlkZW50IikgKwogIGxhYnModGl0bGUgPSAiU2FtcGxlIG9yaWdpbiBzcGxpdCBpbnRvIGRhdGFzZXRzIikKCmdnYXJyYW5nZShwMSwgcDIsIHAzLHA0LCBhMSwgYTIsIG5jb2wgPSAyLCBucm93ID0gMykKCmBgYAoKCiMjIE15ZWxvaWQgbGluZWFnZSBjbHVzdGVyCgojIyMjIFZpc3VhbGl6YXRpb24gb2YgTXllbG9pZCBsaW5lYWdlIGNsdXN0ZXIgKGlNZywgTXllbG9pZDEvMi8zLzQvNSkKClRoZSBwbG90IGJlbG93IHZpc3VhbGl6ZXMgdGhhdCBpTWcgYW5kIENTRi9CbG9vZCBNeWVsb2lkIGNlbGxzIGNsdXN0ZXIgdG9nZXRoZXIsCmluZGVwZW5kZW50IG9mIHRoZWlyIGluZmVjdGlvbiBzdGF0dXMuCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTd9CnN1YnNldF9tb25vY3l0ZXMgPC0gc3Vic2V0KGNvbWJpbmVkLCBjZWxsX3R5cGUgJWluJSBjKCJNeWVsb2lkMSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTXllbG9pZDIiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk15ZWxvaWQzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJNeWVsb2lkNCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTXllbG9pZDUiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlNZyIpKQoKcDEgPC0gRGltUGxvdChzdWJzZXRfbW9ub2N5dGVzLCBncm91cC5ieSA9ICJjZWxsX3R5cGUiKSArCiAgbGFicyh0aXRsZSA9ICJDZWxsIHR5cGUiKQpwMiA8LSBEaW1QbG90KHN1YnNldF9tb25vY3l0ZXMsIGdyb3VwLmJ5ID0gIm9yaWcuaWRlbnQiKSArCiAgbGFicyh0aXRsZSA9ICJTYW1wbGUgb3JpZ2luIikKcDMgPC0gRGltUGxvdChzdWJzZXRfbW9ub2N5dGVzLCBncm91cC5ieSA9ICJzZXVyYXRfY2x1c3RlcnMiKSArCiAgbGFicyh0aXRsZSA9ICJDbHVzdGVyIikKZmlnIDwtIGdnYXJyYW5nZShwMSwgcDIsIHAzLCBuY29sID0gMywgbnJvdyA9IDEpCmFubm90YXRlX2ZpZ3VyZShmaWcsIHRvcCA9IHRleHRfZ3JvYigiTXllbG9pZC1saW5lYWdlIGNlbGxzIiwgc2l6ZSA9IDIwKSkKYGBgCgojIyMjIFZpc3VhbGl6YXRpb24gb2YgaW5mZWN0ZWQgKyBFRlogaU1nICYgaW5mZWN0ZWQgTXllbG9pZDEvMi8zLzQvNQoKQXMgZXhwZWN0ZWQgdGhlIENTRi9CbG9vZCBNeWVsb2lkIGNlbGxzIGZyb20gaW5mZWN0ZWQgcGF0aWVudHMgY2x1c3RlciB0b2dldGhlciAKd2l0aCBpbmZlY3RlZCArIEVGWiBpTWcgYW5kIG1haW5seSBjb250cmlidXRlIHRvIHRoZSBzYW1lIHN1YmNsdXN0ZXIsIGFzIGNhbiAKYmUgc2VlbiBpbiB0aGUgcGxvdCBiZWxvdywgd2hpY2ggc2hvd3Mgb25seSBpbmZlY3RlZCBDU0YvQmxvb2QgTXllbG9pZCBjZWxscyBhbmQgdGhlIAppbmZlY3RlZCArIEVGWiBpTWcuIE15ZWxvaWQ0IGlzIGFuIGV4Y2VwdGlvbiBhbmQgYmVsb25ncyB0byBhIGRpZmZlcmVudCBzdWJjbHVzdGVyLgoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD03fQoKc3Vic2V0X2luZmVjdGVkIDwtIHN1YnNldChjb21iaW5lZCwgb3JpZy5pZGVudCAlaW4lIGMoIkhJVjFfQ1NGIiwgIkhJVjJfQ1NGIiwgIkhJVjNfQ1NGIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkhJVjFfQmxkIiwgIkhJVjJfQmxkIiwiSW5mK0VGWiIpICYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxfdHlwZSAlaW4lIGMoIk15ZWxvaWQxIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJNeWVsb2lkMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTXllbG9pZDMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk15ZWxvaWQ0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJNeWVsb2lkNSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaU1nIikpCgoKcDEgPC0gRGltUGxvdChzdWJzZXRfaW5mZWN0ZWQsIGdyb3VwLmJ5ID0gImNlbGxfdHlwZSIpICsKICBsYWJzKHRpdGxlID0gIkNlbGwgVHlwZSIpCnAyIDwtIERpbVBsb3Qoc3Vic2V0X2luZmVjdGVkLCBncm91cC5ieSA9ICJvcmlnLmlkZW50IikgKwogIGxhYnModGl0bGUgPSAiU2FtcGxlIG9yaWdpbiIpCnAzIDwtIERpbVBsb3Qoc3Vic2V0X2luZmVjdGVkLCBncm91cC5ieSA9ICJzZXVyYXRfY2x1c3RlcnMiKSArCiAgbGFicyh0aXRsZSA9ICJDbHVzdGVycyIpCmZpZyA8LSBnZ2FycmFuZ2UocDEsIHAyLCBwMywgbmNvbCA9IDMsIG5yb3cgPSAxKQphbm5vdGF0ZV9maWd1cmUoZmlnLCB0b3AgPSB0ZXh0X2dyb2IoIkluZmVjdGVkIENTRi9CbG9vZCBNeWVsb2lkIGNlbGxzICYgSW5mK0VGWiBpTWciKSkKYGBgCgoKCiMjIyMgQ2VsbCB0eXBlcyBhbmQgY29uZGl0aW9ucyBwYXJ0aWFsbHkgc2VwYXJhdGUgYWNjb3JkaW5nIHRvIHRoZSB0d28gaU1nIGNsdXN0ZXJzCgpUaGUgbXllbG9pZC1saW5lYWdlIGNsdXN0ZXIgc2VwYXJhdGVkIGludG8gdHdvIGRpc3RpbmN0IHN1YmNsdXN0ZXJzLiAKSW50ZXJlc3RpbmdseSwgdGhlIGluZmVjdGVkICsgRUZaIGlNZyBzZXBhcmF0ZWQgY2xlYXJseSBmcm9tIHRoZSBpbmZlY3RlZCBpTWcuIApUaGUgc2VwYXJhdGlvbiB3YXMgbm90IHNvIGNsZWFyIGZvciB0aGUgdW5pbmZlY3RlZCArLy0gRUZaIGNlbGxzLCB3aGljaCAKY29udHJpYnV0ZWQgdG8gYm90aCBzdWJjbHVzdGVycy4gQW5vdGhlciBvYnNlcnZhdGlvbnMgaXMgdGhhdCB0aGUgaW5mZWN0ZWQgTXllbG9pZDEvMi8zLzUgY2VsbHMgYmVsb25nIHRvIHRoZSBzYW1lIHN1YmNsdXN0ZXIgYXMgdGhlIGluZmVjdGVkICsgRUZaIGlNZy4gQ29udmVyc2VseSwgdGhlIE15ZWxvaWQ0IGNlbGxzIGNsdXN0ZXIgd2l0aCB0aGUgaW5mZWN0ZWQgaU1nLiBTaW5jZSB0aGUgaW5mZWN0ZWQgQ1NGL0Jsb29kIE15ZWxvaWQgY2VsbHMgb3JpZ2luYXRlIGZyb20gSElWIGluZmVjdGVkIGFuZCB0cmVhdGVkIHBhdGllbnRzIHdlIHdvdWxkIGV4cGVjdCB0aGVtIHRvIGNsdXN0ZXIgdG9nZWh0ZXIgd2l0aCB0aGUgaW5mZWN0ZWQgKyBFRlogaU1nLiBIb3dldmVyLCB0aGVyZSAKbWlnaHQgYWxzbyBiZSBpbmZlY3RlZCBDU0YvQmxvb2QgTXllbG9pZCBjZWxscyB3aGljaCBhcmUgbm90IGFmZmVjdGVkIGJ5IHRoZSB0cmVhdG1lbnQuIFRoZSBNeWVsb2lkNCBjZWxscyB3aGljaCBhcmUgZnJvbSBCbG9vZCBzYW1wbGVzIG1pZ2h0IGNvbnNpdHV0ZSBhbiAKaW5mZWN0ZWQgY2VsbCBwb3B1bGF0aW9uIHVuYWZmZWN0ZWQgYnkgdGhlIEFSVCB0cmVhdG1lbnQuIAoKCgpgYGB7cixmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MTB9CgpEaW1QbG90KHN1YnNldF9tb25vY3l0ZXMsIGdyb3VwLmJ5ID0gInNldXJhdF9jbHVzdGVycyIsIAogICAgICAgIHNwbGl0LmJ5ID0gIm9yaWcuaWRlbnQiLCBuY29sID0gNCkgKwogIGxhYnModGl0bGUgPSAiQ29udHJpYnV0aW9uIG9mIGRpZmZlcmVudCBzYW1wbGVzIHRvIGRpZmZlcmVudCBzdWJjbHVzdGVycyIpCkRpbVBsb3Qoc3Vic2V0X21vbm9jeXRlcywgZ3JvdXAuYnkgPSAic2V1cmF0X2NsdXN0ZXJzIiwgCiAgICAgICAgc3BsaXQuYnkgPSAiY2VsbF90eXBlIiwgbmNvbCA9IDMpICsKICBsYWJzKHRpdGxlID0gIkNvbnRyaWJ1dGlvbiBvZiBkaWZmZXJlbnQgY2VsbCB0eXBlcyB0byBkaWZmZXJlbnQgc3ViY2x1c3RlcnMiKQpgYGAKCgojIyBEZS1ub3ZlIGNsdXN0ZXJpbmcgCgpOZXh0LCBkZS1ub3ZvIGNsdXN0ZXJpbmcgb2YgdGhlIG15ZWxvaWQtbGluZWFnZSBjbHVzdGVyIG9mIHRoZSBpbnRlZ3JhdGVkIGRhdGFzZXQgd2FzCnBlcmZvcm1lZC4gSXNvbGF0aW5nIHRoZSBpTWcgYW5kIGFsbCBNeWVsb2lkIGNlbGwgY2x1c3RlcnMgZnJvbSB0aGUgaW50ZWdyYXRlZCAgZGF0YXNldCBhbmQgbm9ybWFsaXppbmcsIHNjYWxpbmcgYW5kIHJlLWNsdXN0ZXJpbmcgdGhlc2UgaXNvbGF0ZWQgY2VsbHMgbWlnaHQgICAKZ2l2ZSB1cyBhZGRpdGlvbmFsIGluc2lnaHRzLiAKCgoKPGRldGFpbHM+CjxzdW1tYXJ5PkRldGFpbHMgb24gZGUtbm92byBjbHVzdGVyaW5nPC9zdW1tYXJ5PgoKCmBgYAoKbWljcm9nbGlhIDwtIHN1YnNldChjb21iaW5lZCwgY2VsbF90eXBlICVpbiUgYygiaU1nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk15ZWxvaWQxIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk15ZWxvaWQyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk15ZWxvaWQzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk15ZWxvaWQ0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk15ZWxvaWQ1IikpCm1pY3JvZ2xpYV9yZWNsdXN0ZXIgPC0gU0NUcmFuc2Zvcm0obWljcm9nbGlhLCB2ZXJib3NlID0gRkFMU0UpCm1pY3JvZ2xpYV9yZWNsdXN0ZXIgPC0gU2NhbGVEYXRhKG1pY3JvZ2xpYV9yZWNsdXN0ZXIsIHZlcmJvc2UgPSBGQUxTRSkKbWljcm9nbGlhX3JlY2x1c3RlciA8LSBSdW5QQ0EobWljcm9nbGlhX3JlY2x1c3RlciwgdmVyYm9zZSA9IEZBTFNFKQpFbGJvd1Bsb3QobWljcm9nbGlhX3JlY2x1c3RlcikKbWljcm9nbGlhX3JlY2x1c3RlciA8LSBSdW5UU05FKG1pY3JvZ2xpYV9yZWNsdXN0ZXIsIHJlZHVjdGlvbiA9ICJwY2EiLCBkaW1zID0gMToxMCkKbWljcm9nbGlhX3JlY2x1c3RlciA8LSBGaW5kTmVpZ2hib3JzKG1pY3JvZ2xpYV9yZWNsdXN0ZXIpCm1pY3JvZ2xpYV9yZWNsdXN0ZXIgPC0gRmluZENsdXN0ZXJzKG1pY3JvZ2xpYV9yZWNsdXN0ZXIsIHJlc29sdXRpb24gPSAwLjUpCmBgYAoKLS0tCjwvZGV0YWlscz4gCgoKSXQgaXMgbm8gc3VycHJpc2UgdGhhdCBjZWxscyBmcm9tIHRoZSB0cmljdWx0dXJlIGRhdGFzZXQgc2VwYXJhdGUgZnJvbSB0aGUgCkNTRi9CbG9vZC1kZXJpdmVkIGNlbGxzIHdoaWNoIGNhbiBiZSBzZWVuIGluIHRoZSBwbG90IGJlbG93LiBXaGVuIHJlY2x1c3RlcmluZyB0aGUgbXllbG9pZCBsaW5lYWdlIGRlcml2ZWQgY2VsbHMsZml2ZSBzdWJjbHVzdGVycyBmb3IgdGhlIGlNZyBhbmQgdGhyZWUgc3ViY2x1c3RlcnMgZm9yIHRoZSBmaXZlIENTRi9CbG9vZCBNeWVsb2lkIGNsdXN0ZXJzIGFyZSBvYnRhaW5lZC4gSXQgY2FuIGFsc28gYmUgb2JzZXJ2ZWQgdGhhdAp0aGUgTXllbG9pZDIgYW5kIE15ZWxvaWQ1IHNlcGFyYXRlIGZyb20gTXllbG9pZDEvMi8zIHdoaWNoIGlzIGV4cGVjdGVkLCBzaW5jZSBNeWVsb2lkMi81IG9yaWdpbmF0ZSBmcm9tIENTRiBzYW1wbGVzIGFuZCBNeWVsb2lkMS8zLzQgb3JpZ2luYXRlIGZyb20gYmxvb2Qgc2FtcGxlcy4KCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MTJ9Cm1pY3JvZ2xpYV9yZWNsdXN0ZXIgPC0gcmVhZFJEUygiL21lZGlhL2FnLWNoZXJybWFubi9rbWlrdWxpay9ISVZfbWljcm9nbGlhL3NyYy9UcmljdWx0dXJlX2RhdGFzZXRfUnlhbl9wYXBlci9taWNyb2dsaWFfbXllbG9pZF9zZXVyYXRfb2JqZWN0X3JlY2x1c3RlcmluZyIpCmExIDwtIERpbVBsb3QobWljcm9nbGlhX3JlY2x1c3RlciwgcmVkdWN0aW9uID0gInRzbmUiLAogICAgICAgICAgICAgIGdyb3VwLmJ5ID0gInNldXJhdF9jbHVzdGVycyIsIHB0LnNpemUgPSAuNCkgKwogIGxhYnModGl0bGUgPSAiQ2x1c3RlcmluZyIpCmEyIDwtIERpbVBsb3QobWljcm9nbGlhX3JlY2x1c3RlciwgcmVkdWN0aW9uID0idHNuZSIsIAogICAgICAgICAgICAgIGdyb3VwLmJ5ID0gImNlbGxfdHlwZSIsIHB0LnNpemUgPSAuNCkgKwogIGxhYnModGl0bGUgPSAiQ2VsbCB0eXBlIikKYTMgPC0gRGltUGxvdChtaWNyb2dsaWFfcmVjbHVzdGVyLCByZWR1Y3Rpb24gPSJ0c25lIiwKICAgICAgICAgICAgICBncm91cC5ieSA9ICJkYXRhc2V0IiwgcHQuc2l6ZSA9IC40KSArCiAgICBsYWJzKHRpdGxlID0gIkRhdGFzZXQiKQphNCA8LSBEaW1QbG90KG1pY3JvZ2xpYV9yZWNsdXN0ZXIsIHJlZHVjdGlvbiA9ICJ0c25lIiwKICAgICAgICAgICAgICBncm91cC5ieSA9ICJvcmlnLmlkZW50IiwgcHQuc2l6ZSA9IC40KSArCiAgbGFicyh0aXRsZSA9ICJTYW1wbGUgb3JpZ2luIikKCmZpZyA8LSBnZ2FycmFuZ2UoYTEsIGEyLCBhMywgYTQsIG5jb2wgPSAyLCBucm93ID0gMikKYW5ub3RhdGVfZmlndXJlKGZpZywgCiAgICAgICAgICAgICAgICB0b3AgPSB0ZXh0X2dyb2IoIkRlLW5vdm8gY2x1c3RlcmluZyBvZiBteWVsb2lkLWxpbmVhZ2UgY2x1c3RlcnMiLCAKICAgICAgICAgICAgICAgY29sb3IgPSAiYmxhY2siLCBmYWNlID0gImJvbGQiLCBzaXplID0gMjApKQpgYGAKCgpJbnRlcmVzdGluZ2x5LCBib3RoIHRoZSBNeWVsb2lkNSBjZWxscyBhbmQgdGhlIE15ZWxvaWQyIGNlbGxzIGFyZSBzcGxpdCBiZXR3ZWVuIAp0aGUgY2x1c3RlciBzaXggKGJsdWUpIGFuZCBzZXZlbiAocHVycGxlKSBpbiB0aGUgZmlndXJlIGJlbG93LiBJbiB0aGUgZm9sbG93aW5nCndlIHdpbGwgaGF2ZSBhIGNsb3NlciBsb29rIGF0IHRoaXMgc2VncmVnYXRpb24uIFdoZW4gcGVyZm9ybWluZyBHUk4gaW5mZXJlbmNlIAp3aXRoIFNjZW5pYyB3ZSBhbHNvIGlkZW50aWZpZWQgdHdvIHBvdGVudGlhbGx5IGJpb2xvZ2ljYWxseSByZWxldmFudCBzdWJjbHVzdGVycyBvZgp0aGUgTXllbG9pZDIgY2VsbHMuIEl0IGNvdWxkIGJlIHRoYXQgdGhlc2UgaW5kZXBlbmRlbnRseSBmb3VuZCBjbHVzdGVycyBjb3JyZWxhdGUuIAoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD0xMH0KYTUgPC0gRGltUGxvdChtaWNyb2dsaWFfcmVjbHVzdGVyLCByZWR1Y3Rpb24gPSJ0c25lIiwgCiAgICAgICAgICAgICAgc3BsaXQuYnkgPSAiY2VsbF90eXBlIiwgcHQuc2l6ZSA9IC40LCBuY29sPTMpICsKICBsYWJzKHRpdGxlID0gIkNvbnRyaWJ1dGlvbiBvZiBkaWZmZXJlbnQgY2VsbCB0eXBlcyB0byBkaWZmZXJlbnQgbXllbG9pZCBjbHVzdGVycyIpCmE1CmBgYAoKSXQgbG9va3MgbGlrZSB0aGUgdHdvIGNsdXN0ZXJzIGlkZW50aWZpZWQgdGhpcyB3YXkgY29ycmVzcG9uZCB0byBkaWZmZXJlbnQKc2FtcGxlIG9yaWdpbnMuIENTRiBjZWxscyBmcm9tIHBhdGllbnQxIChISVYxX0NTRikgYW5kIHBhdGllbnQyIChISVYyX0NTRikKYmVsb25nIHRvIGNsdXN0ZXIgc2l4LCB3aGlsZSBDU0YgY2VsbHMgZnJvbSBwYXRpZW50MyAoSElWM19DU0YpIGFuZCB0aGUgdHdvIAp1bmluZmVjdGVkIHBhdGllbnRzIChVbmluZmVjdGVkMV9DU0YsIFVuaW5mZWN0ZWQyX0NTRikgYmVsb25nIHRvIApjbHVzdGVyIHNldmVuLiBUaGUgc2VwYXJhdGlvbiBvZiBwYXRpZW50MyAoSElWM19DU0YpIGZyb20gcGF0aWVudDEgKEhJVjFfQ1NGKSAKYW5kIHBhdGllbnQyIChISVYyX0NTRikgbWlnaHQgY29ycmVzcG9uZCB0byBhIGJhdGNoIGVmZmVjdCwgb3IgaXQgbWlnaHQgYmUgYSAKYmlvbG9naWNhbCBlZmZlY3QsIGZvciBleGFtcGxlLCB0aGUgaW5mZWN0aW9uIG1pZ2h0IGhhdmUgYWZmZWN0ZWQgdGhlIGNlbGxzIGRpZmZlcmVudGx5LgoKCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9N30KI2ExIDwtIERpbVBsb3Qoc3Vic2V0KG1pY3JvZ2xpYV9yZWNsdXN0ZXIsIGNlbGxfdHlwZSA9PSAiaU1nIiksIHJlZHVjdGlvbiA9ICJ0c25lIiwKICAgICAgICAgICAjICAgZ3JvdXAuYnkgPSAib3JpZy5pZGVudCIsIHB0LnNpemUgPSAuNCkKYTIgPC0gRGltUGxvdChzdWJzZXQobWljcm9nbGlhX3JlY2x1c3RlciwgY2VsbF90eXBlICE9ICJpTWciKSwgcmVkdWN0aW9uID0gInRzbmUiLAogICAgICAgICAgICAgIGdyb3VwLmJ5ID0gIm9yaWcuaWRlbnQiLCBwdC5zaXplID0gLjQpICsKICBsYWJzKHRpdGxlID0gIlNhbXBsZSBvcmlnaW4iKQojYTMgPC0gRGltUGxvdChzdWJzZXQobWljcm9nbGlhX3JlY2x1c3RlciwgY2VsbF90eXBlID09ICJpTWciKSwgcmVkdWN0aW9uID0gInRzbmUiLAogICAgICAgICAgICAgICNncm91cC5ieSA9ICJzZXVyYXRfY2x1c3RlcnMiLCBwdC5zaXplID0gLjQpCmE0IDwtIERpbVBsb3Qoc3Vic2V0KG1pY3JvZ2xpYV9yZWNsdXN0ZXIsIGNlbGxfdHlwZSAhPSAiaU1nIiksIHJlZHVjdGlvbiA9ICJ0c25lIiwKICAgICAgICAgICAgICBncm91cC5ieSA9ICJzZXVyYXRfY2x1c3RlcnMiLCBwdC5zaXplID0gLjQpICsKICBsYWJzKHRpdGxlID0gIkNsdXN0ZXIiKQpmaWcgPC0gZ2dhcnJhbmdlKGEyLCBhNCwgbmNvbCA9IDIsIG5yb3cgPSAxKQphbm5vdGF0ZV9maWd1cmUoZmlnLCB0b3AgPSB0ZXh0X2dyb2IoIkNTRi9CbG9vZCBNeWVsb2lkIGNlbGxzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWNlID0gImJvbGQiLCBzaXplID0gMjApKQpgYGAKClNpbmNlIHRoZSBzZWdyZWdhdGlvbiBpbnRvIHR3byBjbHVzdGVycyBzZWVtcyB0byBiZSByZWxhdGVkIHRvIHRoZSBzYW1wbGUgb3JpZ2luCnJhdGhlciB0aGFuIHRvIHRoZSBpbmZlY3Rpb24gc3RhdHVzLCB3ZSB3b3VsZCBub3QgZXhwZWN0IHRoZSBjbHVzdGVycyB0byBvdmVybGFwCndpdGggdGhlIGNsdXN0ZXJzIGlkZW50aWZpZWQgYWZ0ZXIgR1JOIGluZmVyZW5jZSB3aXRoIFNDRU5JQy4gSW4gdGhlIGZpZ3VyZSAKYmVsb3cgaXQgY2FuIGJlIHNlZW4gdGhhdCB0aGUgY2x1c3RlcnMgZG8gbm90IG92ZXJsYXAgKG9ubHkgdGhlIE15ZWxvaWQyIGNlbGxzIGZyb20gaW5mZWN0ZWQgQ1NGIHNhbXBsZXMgKEhJVjFfQ1NGLCBISVYyX0NTRiwgSElWM19DU0YpIGFyZSBzaG93bikuIEZvciB0aGlzIHJlYXNvbiB0aGUgcmVjbHVzdGVyaW5nIGRpZCBub3QgbGVhZCB0byBhbnkgdXNlZnVsIGluc2lnaHRzIGFuZCB3aWxsIApub3QgYmUgYW5hbHl6ZWQgZnVydGhlci4gCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWdoLmhlaWdodCA9IDV9CiMgcmVhZCBpbiBNeWVsb2lkMiBjZWxscwpoaXZteTIgPC0gcmVhZFJEUygiZGF0YV9maWxlcy9oaXZfbXllbG9pZDJfc3ViY2x1c3RlcnMiKQoKbXkyIDwtIHN1YnNldChtaWNyb2dsaWFfcmVjbHVzdGVyLCBjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiAmIAogICAgICAgICAgICAgICAgb3JpZy5pZGVudCAlaW4lIGMoIkhJVjFfQ1NGIiwgIkhJVjJfQ1NGIiwgIkhJVjNfQ1NGIikpCgpteTIgPC0gQWRkTWV0YURhdGEobXkyLCBoaXZteTJAbWV0YS5kYXRhWyJodF9jbHVzdGVyIl0sIAogICAgICAgICAgICAgICAgICAgY29sLm5hbWUgPSAiVEZfYWN0aXZpdHlfY2x1c3RlcnMiKQpwMSA8LSBEaW1QbG90KG15MiwgZ3JvdXAuYnkgPSAic2V1cmF0X2NsdXN0ZXJzIikgKwogIGxhYnModGl0bGU9IkNsdXN0ZXJzIikKcDIgPC0gRGltUGxvdChteTIsIGdyb3VwLmJ5ID0gIlRGX2FjdGl2aXR5X2NsdXN0ZXJzIikgKwogIGxhYnModGl0bGUgPSAiVEYgYWN0aXZpdHkiKQpwMyA8LSBEaW1QbG90KG15MiwgZ3JvdXAuYnkgPSAib3JpZy5pZGVudCIpICsKICBsYWJzKHRpdGxlID0gIlNhbXBsZSBvcmlnaW4iKQpmaWd1cmUgPC0gZ2dhcnJhbmdlKHAxLCBwMiwgcDMsIG5jb2wgPSAzLCBucm93ID0gMSkKYW5ub3RhdGVfZmlndXJlKGZpZ3VyZSwgCiAgICAgICAgICAgICAgICB0b3AgPSB0ZXh0X2dyb2IoIkNvbXBhcmlzb24gd2l0aCBjbHVzdGVycyBvZiBkaWZmZXJlbnQgVEYgYWNpdGl2dHkiLCAKICAgICAgICAgICAgICAgY29sb3IgPSAiYmxhY2siLCBmYWNlID0gImJvbGQiLCBzaXplID0gMjApKQojbXkyNSA8LSBzdWJzZXQobWljcm9nbGlhLCBzZXVyYXRfY2x1c3RlcnMgJWluJSBjKDYsNykgJmNlbGxfdHlwZSAlaW4lIGMoIk15ZWxvaWQyIiwgIk15ZWxvaWQ1IikpCgpgYGAKCgojIERpZmZlcmVudGlhbCBnZW5lIGV4cHJlc3Npb24KCiMjIyBCZXR3ZWVuIGluZmVjdGlvbiBjb25kaXRpb25zCgpJbiB0aGUgZm9sbG93aW5nIEkgd2lsbCBjb21wYXJlIGdlbmUgZXhwcmVzc2lvbiBiZXR3ZWVuIGluZmVjdGVkIGNlbGxzIGFuZCAKdW5pbmZlY3RlZCBjZWxscywgYm90aCB0cmVhdGVkIHdpdGggRUZaIGFuZCBub3QgdHJlYXRlZC4gSSB3aWxsIHVzZSB0aGUgdW5pbmZlY3RlZCBjZWxscyBhcyBhIApiYXNlbGluZSB0byBmaW5kIGdlbmVzIHdoaWNoIGFyZSB1cHJlZ3VsYXRlZCBvciBkb3ducmVndWxhdGVkIGluIGluZmVjdGVkIGNlbGxzCmNvbXBhcmVkIHRvIHVuaW5mZWN0ZWQgY2VsbHMuIFNpbmNlIHdlIGhhdmUgYm90aCBjZWxscyB0cmVhdGVkIHdpdGggRUZaIGFuZCAKY2VsbHMgbm90IHRyZWF0ZWQgd2l0aCBFRlosIHdlIGNhbiBkZWZpbmUgYSBzaWduYXR1cmUgZm9yIGJvdGggdHJlYXRtZW50IApjb25kaXRpb25zIHNlcGFyYXRlbHkgYW5kIHRoZW4gc2VlIGlmIHRoZXJlIGlzIGFuIG92ZXJsYXAgYmV0d2VlbiB0aGUgZ2VuZSAKc2lnbmF0dXJlcyBvZiBpbmZlY3RlZCBjZWxscyArLy0gRUZaLiBGaW5kaW5nIGdlbmVzIHdoaWNoIG92ZXJsYXAgaW5kZXBlbmRlbnRseSAKb2YgdHJlYW10ZW50IGNvbmRpdGlvbiBpbmNyZWFzZXMgdGhlIGNvbmZpZGVuY2UgaW4gdGhlIHJlc3VsdHMKCjxkZXRhaWxzPgo8c3VtbWFyeT4qKkxpc3QgaWYgdG9wIHVwLSBvciBkb3ducmVndWxhdGVkIGdlbmVzIGluIEluZitFRlogdnMgVW5pbmYrRUZaKio8L3N1bW1hcnk+CgpgYGB7ciwgcmVzdWx0cyA9ICJhc2lzIn0KIyBpc29sYXRlIGlNZyBjZWxscwptaWNyb2dsaWEgPC0gc3Vic2V0KGNvbWJpbmVkLCBjZWxsX3R5cGUgPT0gImlNZyIpCgojIG9ubHkgaU1nIGNlbGxzIHRvIGlkZW50aWZ5IHBvdGVudGlhbCBzaWduYXR1cmVzIGJldHdlZW4gaW5mZWN0ZWQgdnMgdW5pbmZlY3RlZApJZGVudHMobWljcm9nbGlhKSA9ICAib3JpZy5pZGVudCIKCiMgZmluZCBtYXJrZXIgZ2VuZXMgYmV0d2VlbiBVbmluZitFRlogYW5kIEluZitFRloKaW5mX3VuaW5mX2FydF9tYXJrZXIgPC0gRmluZE1hcmtlcnMobWljcm9nbGlhLCBpZGVudC4xID0gIkluZitFRloiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQuMiA9ICJVbmluZitFRloiLCB2ZXJib3NlID0gRkFMU0UpCiN1cHJlZ3VsYXRlZCBnZW5lcwp1cF9pbmZfYXJ0IDwtIGluZl91bmluZl9hcnRfbWFya2VyICU+JSAKICBhcnJhbmdlKGRlc2MoYXZnX2xvZzJGQykpICU+JQogIGhlYWQoMjApICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImdlbmUiKQp1cF9pbmZfYXJ0ICAlPiUgaGVhZCAlPiUgIGthYmxlKGNhcHRpb24gPSAiR2VuZXMgdXByZWd1bGF0ZWQgaW4gSW5mK0VGWiB2cy4gVW5pbmYrRUZaIikKYGBgCgpgYGB7cn0KIyBkb3ducmVndWxhdGVkIGdlbmVzCmRvd25faW5mX2FydCA8LSBpbmZfdW5pbmZfYXJ0X21hcmtlciAlPiUgCiAgYXJyYW5nZShhdmdfbG9nMkZDKSAlPiUgCiAgaGVhZCgyMCkgJT4lCiAgcm93bmFtZXNfdG9fY29sdW1uKCJnZW5lIikKZG93bl9pbmZfYXJ0ICU+JSBoZWFkICU+JSBrYWJsZShjYXB0aW9uID0gIkdlbmVzIGRvd25yZWd1bGF0ZWQgaW4gSW5mK0VGWiB2cy4gVW5pbmYrRUZaIikKYGBgCgotLS0KPC9kZXRhaWxzPgoKYGBge3J9CiMgZmluZCBtYXJrZXIgZ2VuZXMgYmV0d2VlbiBJbmYgYW5kIFVuaW5mCmluZl91bmluZl9tYXJrZXIgPC0gRmluZE1hcmtlcnMobWljcm9nbGlhLCBpZGVudC4xID0gIkluZiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50LjIgPSAiVW5pbmYiLCB2ZXJib3NlID0gRkFMU0UpCgojIHVwcmVndWxhdGVkIGluIEluZiB2cyBVbmluZiwgbm8gdHJlYXRtZW50CnVwX2luZl9ubyA8LSBpbmZfdW5pbmZfbWFya2VyICU+JSAKICBhcnJhbmdlKGRlc2MoYXZnX2xvZzJGQykpICU+JQogIGhlYWQoMjApICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImdlbmUiKQojdXBfaW5mX25vICAlPiUga2FibGUoKQoKCmRvd25faW5mX25vIDwtIGluZl91bmluZl9tYXJrZXIgJT4lIAogIGFycmFuZ2UoYXZnX2xvZzJGQykgJT4lIAogIGhlYWQoMjApICU+JQogIHJvd25hbWVzX3RvX2NvbHVtbigiZ2VuZSIpCiNkb3duX2luZl9ubyU+JSBrYWJsZSgpCmBgYAoKT25seSAzJSBvZiBnZW5lcyB3aGljaCBhcmUgdXByZWd1bGF0ZWQgYW5kIG9ubHkgMTQlIG9mIGdlbmVzIHdoaWNoIGFyZSAKZG93bnJlZ3VsYXRlZCBpbiBpbmZlY3RlZCB2cy4gdW5pbmZlY3RlZCBjZWxscyAKb3ZlcmxhcCBiZXR3ZWVuIHRoZSB0cmVhdG1lbnQgY29uZGl0aW9ucy4gVGhpcyBtZWFucywgdGhhdCB0aGUgZ2VuZSBleHByZXNzaW9uIHJlc3BvbnNlIGRlZmluaW5nIAp0aGUgaW5mZWN0aW9uIG1pZ2h0IGRpZmZlciBiZXR3ZWVuIGNlbGxzIHdpdGggYW5kIHdpdGhvdXQgdHJlYXRtZW50LiBUaGlzCnJlZmxlY3RzIHRoZSBmaW5kaW5ncyBvZiBbQFJ5YW5dIHRoYXQgdGhlIEVGWiB0cmVhdG1lbnQgbGVhZHMgdG8gYSBkaXN0aW5jdAppbW11bmUgcmVzcG9uc2Ugb2YgaU1nIGFuZCBkaXN0aW5jdCBhY3RpdmF0aW9uIG9mIHR3byBpbmZsYW1tYXRvcnkgcGF0aHdheXMsIApSaG9HREkgYW5kIENENDAgcGF0aHdheXMgYXMgd2lsbCBiZSBkZXNjcmliZWQgbGF0ZXIgb24uIFNpbmNlIHRoZXJlIGlzIGhhcmRseSBhbnkKb3ZlcmxhcCB3ZSB3aWxsIHVzZSB0aGUgZ2VuZXMgdXByZWd1bGF0ZWQgaW4gSW5mK0VGWiBjb21wYXJlZCB0byBVbmluZitFRloKaW4gdGhlIGZvbGxvd2luZyBhbmFseXNpcyBzdGVwcywgYmVjYXVzZSB0aGV5IHByb2JhYmx5IHJlc2VtYmxlIHRoZSBDU0YvQmxvb2QgCnNhbXBsZXMsIHdoaWNoIG9yaWdpbmF0ZSBmcm9tIHBhdGllbnRzIHRyZWF0ZWQgd2l0aCBBUlQsIGJlc3QuCgpgYGB7cn0KdXBfaW5mIDwtIGludGVyc2VjdCh1cF9pbmZfYXJ0JGdlbmUsIHVwX2luZl9ubyRnZW5lKQpkb3duX2luZiA8LSBpbnRlcnNlY3QoZG93bl9pbmZfYXJ0JGdlbmUsIGRvd25faW5mX25vJGdlbmUpCnByaW50KGModXBfaW5mLCBkb3duX2luZikpCmBgYAoKYGBge3IsIGZpZy53aWR0aD0xNX0KcDEgPC0gZ2dWZW5uRGlhZ3JhbTo6Z2dWZW5uRGlhZ3JhbShsaXN0KHVwX2luZl9hcnQkZ2VuZSwgdXBfaW5mX25vJGdlbmUpLAogICAgICAgICAgICAgIGxhYmVsX2FscGhhID0gMCwKICAgICAgICAgICAgICBjYXRlZ29yeS5uYW1lcz0gYygiSW5mK0VGWiIsICJJbmYiKSwKICAgICAgICAgICAgICAjc2V0LnNpemUgPSAyMCwKICAgICAgICAgICAgICBsYWJlbCA9ICJwZXJjZW50IiwKICAgICAgICAgICAgICBsYWJlbF9zaXplID0gNikgKwogICBzY2FsZV9maWxsX2Rpc3RpbGxlcihwYWxldHRlID0gIlJkQnUiKSArCiAgbGFicyh0aXRsZSA9ICJHZW5lcyB1cHJlZ3VsYXRlZCBpbiBpbmZlY3RlZCBjZWxscyIpCgpwMiA8LSBnZ1Zlbm5EaWFncmFtOjpnZ1Zlbm5EaWFncmFtKGxpc3QoZG93bl9pbmZfYXJ0JGdlbmUsIGRvd25faW5mX25vJGdlbmUpLAogICAgICAgICAgICAgIGxhYmVsX2FscGhhID0gMCwKICAgICAgICAgICAgICBjYXRlZ29yeS5uYW1lcz0gYygiSW5mK0VGWiIsICJJbmYiKSwKICAgICAgICAgICAgICAjc2V0LnNpemUgPSAyMCwKICAgICAgICAgICAgICBsYWJlbCA9ICJwZXJjZW50IiwKICAgICAgICAgICAgICBsYWJlbF9zaXplID0gNikgKwogIHNjYWxlX2ZpbGxfZGlzdGlsbGVyKHBhbGV0dGUgPSAiUmRCdSIpICsKICBsYWJzKHRpdGxlID0gIkdlbmVzIGRvd25yZWd1bGF0ZWQgaW4gaW5mZWN0ZWQgY2VsbHMiKQoKZ2dhcnJhbmdlKHAxLCBwMiwgbmNvbCA9IDIpCmBgYAoKPGRldGFpbHM+CjxzdW1tYXJ5PioqVm9sY2FubyBQbG90IG9mIEluZmVjdGlvbiAoKyBFRlopIHNpZ25hdHVyZSoqPC9zdW1tYXJ5PgoKSW50ZXJlc3RpbmdseSwgdGhlIGdlbmVzIGRvd25yZWd1bGF0ZCBpbiBJbmYrRUZaIHZzLiBVbmluZmVjdGVkIGNlbGxzIHNob3cKYSBoaWdoZXIgYXZlcmFnZSBsb2cgZm9sZCBjaGFuZ2Ugd2l0aCBoaWdoZXIgc2lnbmlmaWNhbmNlIChwLXZhbHVlcykuIAoKYGBge3IsIGZpZy5oZWlnaHQ9OCwgZmlnLndpZHRoPTEyfQppbmZfdW5pbmZfYXJ0X21hcmtlciAlPiUgCiAgcm93bmFtZXNfdG9fY29sdW1uKCJnZW5lIikgJT4lCiAgZmlsdGVyKGdlbmUgJWluJSBjKHVwX2luZl9hcnQkZ2VuZSwgZG93bl9pbmZfYXJ0JGdlbmUpKSAlPiUgCiAgIyBhZGQgYSBjb2x1bW4gY29udGFpbmluZyBpbmZvcm1hdGlvbiBpbiB3aGljaCBjb25kaXRpb24gdGhlIGNvcnJlc3BvbmRpbmcgVEYgCiAgIyBpcyB1cHJlZ3VsYXRlZAogIG11dGF0ZShjb25kaXRpb24gPSBjYXNlX3doZW4oZ2VuZSAlaW4lIHVwX2luZl9hcnQkZ2VuZSB+ICJ1cHJlZ3VsYXRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lICVpbiUgZG93bl9pbmZfYXJ0JGdlbmUgfiAiZG93bnJlZ3VsYXRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFIH4gIk5BIikpICU+JQogICMgYWRkIGEgY29sdW1uIGNvbmFpbmluZyB0aGUgbGFiZWxzIGZvciB0aGUgcGxvdAogICMgSSBvbmx5IHdhbnQgdG8gbGFiZWwgY2VsbHMgd2hpY2ggYXJlIGFsc28gZm91bmQgYnkgU2NlbmljCiAgbXV0YXRlKGxhYmVsID0gaWZlbHNlKGdlbmUgJWluJSBjKHVwX2luZl9hcnQkZ2VuZSwgZG93bl9pbmZfYXJ0JGdlbmUpLCBnZW5lLCBOQSkpICU+JSAKICBnZ3Bsb3QoYWVzKHggPSBhdmdfbG9nMkZDLAogICAgICAgICAgICAgeSA9IC1sb2cxMChwX3ZhbF9hZGopLAogICAgICAgICAgICAgY29sID0gY29uZGl0aW9uLCAKICAgICAgICAgICAgIGxhYmVsID0gbGFiZWwpKSArCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX2hsaW5lKHlpbnRlcmNlcHQgPSAtbG9nMTAoMWUtNTApLCBjb2wgPSAicmVkIikgKwogIGdlb21fdGV4dChudWRnZV94ID0gLjA1LCBudWRnZV95ID0gMikgKwogIGxhYnModGl0bGUgPSAiR2VuZXMgd2hpY2ggYXJlIHVwLSBvciBkb3ducmVndWxhdGVkIGluIEluZitFRlogdnMgVW5pbmYrRUZaIikKCmBgYAoKLS0tCjwvZGV0YWlscz4KCiMjIyBCZXR3ZWVuIHRyZWF0bWVudCBjb25kaXRpb25zCgpDb21wYXJpbmcgdW5pbmZlY3RlZCArIEVGWiB3aXRoIHVuaW5mZWN0ZWQgYW5kIGluZmVjdGVkICsgRUZaIHdpdGggaW5mZWN0ZWQKaU1nIGl0IG1pZ2h0IGJlIHBvc3NpYmxlIHRvIGlkZW50aWZ5IGdlbmVzIHdoaWNoIGFyZSBkaWZmZXJlbnQgYWZ0ZXIgdHJlYXRtZW50IApvZiBjZWxscyB3aXRoIEVGWi4gRmluZGluZyBvdmVybGFwcGluZyBnZW5lcyBiZXR3ZWVuIHRoZSB0d28gaW5mZWN0aW9uIHN0YXRlcyBpbmNyZWFzZXMgdGhlIGNvbmZpZGVuY2UgaW4gdGhlIHJlc3VsdHMsIGJlY2F1c2UgdGhlIGlkZW50aWZpZWQgZ2VuZXMgYXJlIGFzc29jaWF0ZWQgd2l0aCB0cmVhdG1lbnQgaW5kZXBlbmRlbnRseSBvZiBpbmZlY3Rpb24gc3RhdHVzLgoKVGhlIGRpYWdyYW0gYmVsb3cgc2hvd3MsIHRoYXQgMzYlIG9mIGdlbmVzIGFyZSB1cHJlZ3VsYXRlZCBib3RoIGluIGluZmVjdGVkIGFuZAppbmZlY3RlZCArIEVGWiBpTWcgY29tcGFyZWQgdG8gdW5pbmZlY3RlZCBhbmQgdW5pbmZlY3RlZCArIEVGWiBpTWcuIFRoZXNlIGdlbmVzIGFyZSBwcm9iYWJseSBhc3NvY2lhdGVkIHdpdGggdGhlIEVGWiB0cmVhdG1lbnQuIFRoZSBzYW1lIGlzIHRydWUgZm9yIDQ0JSBvZiB0aGUgZG93bnJlZ3VsYXRlZCBnZW5lcy4gVGhlIGRydWcgYWZmZWN0cyB0aGUgaU1nIGFuZCBjaGFuZ2VzIHRoZWlyIGdlbmUgZXhwcmVzc2lvbi4gVGhpcyBzaWduYXR1cmUgbWlnaHQgYmUgdXNlZCB0byBpZGVudGlmeSBNeWVsb2lkMiBDU0YgY2VsbHMgd2hpY2ggYXJlIGFmZmVjdGVkIGJ5IHRoZSB0cmVhdG1lbnQuIFNpbmNlIEFSVCBkcnVncyBhcmUgZm91bmQgYXQgbG93ZXIgY29uY2VudHJhdGlvbnMgaW4gQ1NGIHRoYW4gaW4gYmxvb2QsIHByb2JhYmx5IG9ubHkgYSBzdWJncm91cCBvZiBNeWVsb2lkMiBhcmUgYWZmZWN0ZWQgYnkgdGhlIEFSVCBkcnVncy4gSXQgd291bGQKYmUgaW50ZXJlc3RpbmcgdG8ga25vdyB3aGljaCBhcmUgYWZmZWN0ZWQgYnkgdHJlYXRtZW50IGFuZCB3aGljaCBhcmUgbm90LiBIb3dldmVyLCB0aGlzIGNvbXBhcmlzb24gbWlnaHQgYmUgZmFyZmV0Y2hlZCwgc2luY2UgdGhlIHBhdGllbnRzIGZyb20gd2hpY2ggdGhlIENTRiBzYW1wbGVzIApoYXZlIGJlZW4gZGVyaXZlZCBoYXZlIG5vdCBiZWVuIHRyZWF0ZWQgd2l0aCBFRlosIGJ1dCB3aXRoIGEgY29tYmluYXRpb24gb2YgCm90aGVyIEFSVCBkcnVncyB3aGljaCBwcm9iYWJseSBoYXZlIGEgc2xpZ2h0bHkgZGlmZmVyZW50IGVmZmVjdCBvbiBjZWxscy4gCgpgYGB7cn0KdHJlYXRtZW50X21hcmtlcl91bmluZiA8LSBGaW5kTWFya2VycyhtaWNyb2dsaWEsIGlkZW50LjEgPSAiVW5pbmYrRUZaIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQuMiA9ICJVbmluZiIsIHZlcmJvc2UgPSBGQUxTRSkKCiMgZmluZCBtYXJrZXIgZ2VuZXMgYmV0d2VlbiBJbmYrRUZaIGFuZCBJbmYKdHJlYXRtZW50X21hcmtlcl9pbmYgPC0gRmluZE1hcmtlcnMobWljcm9nbGlhLCBpZGVudC4xID0gIkluZitFRloiLCBpZGVudC4yID0gIkluZiIpCgojIG92ZXJsYXAgYmV0d2VlbiB1cHJlZ3VsYXRlZCBnZW5lcwp0cmVhdG1lbnRfdXAgPC0gaW50ZXJzZWN0KCh0cmVhdG1lbnRfbWFya2VyX2luZiAlPiUgCiAgICAgICAgICAgICByb3duYW1lc190b19jb2x1bW4oImdlbmUiKSAlPiUgCiAgICAgICAgICAgICBmaWx0ZXIoYXZnX2xvZzJGQyA+IDApKSRnZW5lLCAKICAgICAgICAgICAodHJlYXRtZW50X21hcmtlcl91bmluZiAlPiUgCiAgICAgICAgICAgICByb3duYW1lc190b19jb2x1bW4oImdlbmUiKSAlPiUgCiAgICAgICAgICAgICBmaWx0ZXIoYXZnX2xvZzJGQyA+IDApKSRnZW5lKQoKdHJlYXRtZW50X2Rvd24gPC0gaW50ZXJzZWN0KCh0cmVhdG1lbnRfbWFya2VyX2luZiAlPiUgCiAgICAgICAgICAgICByb3duYW1lc190b19jb2x1bW4oImdlbmUiKSAlPiUgCiAgICAgICAgICAgICBmaWx0ZXIoYXZnX2xvZzJGQyA8IDApKSRnZW5lLCAKICAgICAgICAgICAodHJlYXRtZW50X21hcmtlcl91bmluZiAlPiUgCiAgICAgICAgICAgICByb3duYW1lc190b19jb2x1bW4oImdlbmUiKSAlPiUgCiAgICAgICAgICAgICBmaWx0ZXIoYXZnX2xvZzJGQyA8IDApKSRnZW5lKQp0cmVhdG1lbnRfbWFya2VyIDwtIGModHJlYXRtZW50X3VwLCB0cmVhdG1lbnRfZG93bikKYGBgCgpgYGB7ciwgZmlnLndpZHRoPTE1fQpwMSA8LSBnZ1Zlbm5EaWFncmFtOjpnZ1Zlbm5EaWFncmFtKGxpc3QoKHRyZWF0bWVudF9tYXJrZXJfaW5mICU+JSAKICAgICAgICAgICAgIHJvd25hbWVzX3RvX2NvbHVtbigiZ2VuZSIpICU+JSAKICAgICAgICAgICAgIGZpbHRlcihhdmdfbG9nMkZDID4gMCkpJGdlbmUsIAogICAgICAgICAgICAgKHRyZWF0bWVudF9tYXJrZXJfdW5pbmYgJT4lIAogICAgICAgICAgICAgcm93bmFtZXNfdG9fY29sdW1uKCJnZW5lIikgJT4lIAogICAgICAgICAgICAgZmlsdGVyKGF2Z19sb2cyRkMgPiAwKSkkZ2VuZSksCiAgICAgICAgICAgICAgbGFiZWxfYWxwaGEgPSAwLAogICAgICAgICAgICAgIGNhdGVnb3J5Lm5hbWVzPSBjKCJJbmYrRUZaIiwgIlVuaW5mK0VGWiIpLAogICAgICAgICAgICAgICNzZXQuc2l6ZSA9IDIwLAogICAgICAgICAgICAgIGxhYmVsID0gInBlcmNlbnQiLAogICAgICAgICAgICAgIGxhYmVsX3NpemUgPSA2KSArCiAgIHNjYWxlX2ZpbGxfZGlzdGlsbGVyKHBhbGV0dGUgPSAiUmRCdSIpICsKICBsYWJzKHRpdGxlID0gIkdlbmVzIHVwcmVndWxhdGVkIGluIGNlbGxzIHRyZWF0ZWQgd2l0aCBFRloiKQoKcDIgPC0gZ2dWZW5uRGlhZ3JhbTo6Z2dWZW5uRGlhZ3JhbShsaXN0KCh0cmVhdG1lbnRfbWFya2VyX2luZiAlPiUgCiAgICAgICAgICAgICByb3duYW1lc190b19jb2x1bW4oImdlbmUiKSAlPiUgCiAgICAgICAgICAgICBmaWx0ZXIoYXZnX2xvZzJGQyA8IDApKSRnZW5lLCAKICAgICAgICAgICAgICh0cmVhdG1lbnRfbWFya2VyX3VuaW5mICU+JSAKICAgICAgICAgICAgIHJvd25hbWVzX3RvX2NvbHVtbigiZ2VuZSIpICU+JSAKICAgICAgICAgICAgIGZpbHRlcihhdmdfbG9nMkZDIDwgMCkpJGdlbmUpLAogICAgICAgICAgICAgIGxhYmVsX2FscGhhID0gMCwKICAgICAgICAgICAgICBjYXRlZ29yeS5uYW1lcz0gYygiSW5mK0VGWiIsICJVbmluZitFRloiKSwKICAgICAgICAgICAgICAjc2V0LnNpemUgPSAyMCwKICAgICAgICAgICAgICBsYWJlbCA9ICJwZXJjZW50IiwKICAgICAgICAgICAgICBsYWJlbF9zaXplID0gNiwKICAgICAgICAgICAgICBzZXRfY29sb3IgPSBjKCJyZWQiLCAiYmx1ZSIpKSArCiAgc2NhbGVfZmlsbF9kaXN0aWxsZXIocGFsZXR0ZSA9ICJSZEJ1IikgKwogIGxhYnModGl0bGUgPSAiR2VuZXMgZG93bnJlZ3VsYXRlZCBpbiBjZWxscyB0cmVhdGVkIHdpdGggRUZaIikKCmdnYXJyYW5nZShwMSwgcDIsIG5jb2wgPSAyKQpgYGAKCgo8ZGV0YWlscz4KPHN1bW1hcnk+KipWb2xjYW5vIFBsb3Qgb2YgVHJlYXRtZW50IHNpZ25hdHVyZSoqPC9zdW1tYXJ5PgoKYGBge3IsZmlnLmhlaWdodD04LCBmaWcud2lkdGg9MTJ9CnRyZWF0bWVudF9tYXJrZXJfdW5pbmYgJT4lIAogIHJvd25hbWVzX3RvX2NvbHVtbigiZ2VuZSIpICU+JQogIGZpbHRlcihnZW5lICVpbiUgdHJlYXRtZW50X21hcmtlcikgJT4lIAogICMgYWRkIGEgY29sdW1uIGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gaW4gd2hpY2ggY29uZGl0aW9uIHRoZSBjb3JyZXNwb25kaW5nIFRGIAogICMgaXMgdXByZWd1bGF0ZWQKICBtdXRhdGUoY29uZGl0aW9uID0gY2FzZV93aGVuKGdlbmUgJWluJSB0cmVhdG1lbnRfdXAgfiAidXByZWd1bGF0ZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZSAlaW4lIHRyZWF0bWVudF9kb3duIH4gImRvd25yZWd1bGF0ZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFJVRSB+ICJOQSIpKSAlPiUKICAjIGFkZCBhIGNvbHVtbiBjb25haW5pbmcgdGhlIGxhYmVscyBmb3IgdGhlIHBsb3QKICAjIEkgb25seSB3YW50IHRvIGxhYmVsIGNlbGxzIHdoaWNoIGFyZSBhbHNvIGZvdW5kIGJ5IFNjZW5pYwogICNtdXRhdGUobGFiZWwgPSBpZmVsc2UoZ2VuZSAlaW4lIGModXBfaW5mJGdlbmUsIGRvd25faW5mJGdlbmUpLCBnZW5lLCBOQSkpICU+JSAKICBnZ3Bsb3QoYWVzKHggPSBhdmdfbG9nMkZDLAogICAgICAgICAgICAgeSA9IC1sb2cxMChwX3ZhbF9hZGopLAogICAgICAgICAgICAgY29sID0gY29uZGl0aW9uLCAKICAgICAgICAgICAgIGxhYmVsID0gZ2VuZSkpICsKICBnZW9tX3BvaW50KCkgKwogIGdlb21faGxpbmUoeWludGVyY2VwdCA9IC1sb2cxMCgxZS0xMCksIGNvbCA9ICJyZWQiKSArCiAgZ2VvbV90ZXh0KG51ZGdlX3ggPSAuMDUsIG51ZGdlX3kgPSAyKSArCiAgbGFicyh0aXRsZSA9ICJUb3AgMjAgR2VuZXMgd2hpY2ggYXJlIHVwL2Rvd25yZWd1bGF0ZWQgaW4gdHJlYXRtZW50IHZzLiBubyB0cmVhdG1lbnQsIFVuaW5mIGNlbGxzIikKYGBgCgotLS0KPC9kZXRhaWxzPgoKIyBJbmZlY3Rpb24gJiB0cmVhdG1lbnQgZ2VuZSBzaWduYXR1cmUKCgpDaGVja2luZyB0aGUgZGlmZmVyZW50aWFsbHkgZXhwcmVzc2VkIGdlbmVzIGFuZCB0cnlpbmcgdG8gaWRlbnRpZnkgYW4gaW5mZWN0aW9uIHNpZ25hdHVyZSB0aHJvdWdoIGxpdGVyYXR1cmUgc2VhcmNoIHR1cm5lZCBvdXQgdG8gYmUgdmVyeSBkaWZmaWN1bHQuIFRoZXJlZm9yZSwgCmEgZGlmZmVyZW50IGFwcHJvYWNoIHdhcyB1c2VkLiBUaGUgdG9wIHR3ZW50eSB1cC0gYW5kIGRvd25yZWd1bGF0ZWQgZ2VuZXMgaW4gCkluZitFRlogdnMgVW5pbmYrRUZaIHdlcmUgY29tcHV0ZWQuIFVzaW5nIHRoZXNlIGdlbmVzIGFzIGFuICJpbmZlY3Rpb24gc2lnbmF0dXJlIiAKaXQgd2lsbCBiZSBpbnZlc3RpZ2F0ZWQgd2hldGhlciBzb21lIG9mIHRoZSBNeWVsb2lkMiBjZWxscyBmcm9tIHRoZSBDU0Ygc2FtcGxlcyAKc2hvdyBhIHNpbWlsYXIgc2lnbmF0dXJlLgogIAoKYGBge3J9CiMgc2VsZWN0IG9ubHkgZ2VuZXMgd2hpY2ggYXJlIGFsc28gZm91bmQgaW4gdGhlIHNjLVJOQXNlcSBkYXRhc2V0CnVwX2luZl9maWx0IDwtIHVwX2luZl9hcnQkZ2VuZVt1cF9pbmZfYXJ0JGdlbmUgJWluJSByb3duYW1lcyhoaXZteTJAYXNzYXlzJFJOQUBjb3VudHMpXQpkb3duX2luZl9maWx0IDwtIGRvd25faW5mX2FydCRnZW5lW2Rvd25faW5mX2FydCRnZW5lICVpbiUgcm93bmFtZXMoaGl2bXkyQGFzc2F5cyRSTkFAY291bnRzKV0KYGBgCgoKIyMgR2VuZSBzaWduYXR1cmUgc2NvcmluZyBpbiBNeWVsb2lkMiBjZWxscwoKVXNpbmcgdGhlIHNpZ25hdHVyZSBnZW5lcyBmcm9tIGRpZmZlcmVudGlhbCBnZW5lIGV4cHJlc3Npb24gYW5hbHlzaXMgYmV0d2VlbgpJbmYrRUZaIGFuZCBVbmluZitFRlogd2UgY2FuIGNvbXB1dGUgYSBzY29yZSBvZiBhY3Rpdml0eSBvZiB0aGVzZSBnZW5lIHNldHMgaW4gCnRoZSBNeWVsb2lkMiBjbHVzdGVyIG9mIENTRiBzYW1wbGVzLiBXZSBjYW4gcGxvdCB0aGVzZSBzY29yZXMgaW4gYSB0LVNORSAKcmVwcmVzZW50YXRpb24sIGJ1dCB3ZSBjYW4gYWxzbyBnZXQgdGhlIHNjb3JlcyBmcm9tIHRoZSBtZXRhZGF0YSBhbmQgdXNlIHRoZW0gCmZvciBvdGhlciB2aXN1YWxpemF0aW9ucy4gSWYgdGhlIEluZitFRlogc2lnbmF0dXJlIGNhbiBiZSBmb3VuZCBpbiBzb21lIG9mIHRoZSBNeWVsb2lkMiBjZWxscyBmcm9tIHRoZSBDU0Ygc2FtcGxlcyB0aGlzIG1pZ2h0IHByb3ZpZGUgYWRkaXRpb25hbCBpbnNpZ2h0cyAKYWJvdXQgdGhlIGluZmVjdGlvbiBzdGF0dXMgb2YgdGhlc2UgbWljcm9nbGlhLWxpa2UgY2VsbHMuCgojIyMjIFNjb3JlcyBvZiBnZW5lIHNpZ25hdHVyZSB1cHJlZ3VsYXRlZCBpbiBJbmYrRUZaIGlNZyBpbiBNeWVsb2lkMiBjZWxscwoKSW4gdGhlIHBsb3QgYmVsb3cgdGhlcmUgYXJlIHNvbWUgY2VsbHMgdmlzaWJsZSB3aGljaCBoYXZlIGEgaGlnaCBzY29yZSBmb3IgdGhlIHNpZ25hdHVyZSBjb21wb3NlZCBvZiBnZW5lcyB1cHJlZ3VsYXRlZCBpbiBJbmYrRUZaIGlNZyBUbyBiZSBwcmVjaXNlLAo2MyUgcGVyY2VudCBvZiB0aGUgTXllbG9pZDIgY2VsbHMgaGF2ZSBhIHBvc2l0aXZlIHNjb3JlICg5MiBvdXQgb2YgMTQ1IGNlbGxzKS4KVGhlc2UgaGlnaCBzY29yaW5nIGNlbGxzIGRvLCBob3dldmVyLCBub3QgY29ycmVzcG9uZCB0byB0aGUgdHdvIGNsdXN0ZXJzIChjMSwgYzIpIG9idGFpbmVkIGZyb20gYW5hbHlzaXMgb2YgVEYgYWN0aXZpdHkgKFNDRU5JQykuCgoKYGBge3IsIGZpZy53aWR0aD0xNX0KdXBfc2lnbiA8LSBBZGRNb2R1bGVTY29yZShoaXZteTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gbGlzdCh1cF9pbmZfZmlsdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJ1cHJlZ3VsYXRlZCIpCgpwMSA8LSBGZWF0dXJlUGxvdChzdWJzZXQodXBfc2lnbiwgaHRfY2x1c3RlciA9PSAiYzEiKSwKICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgPSAidXByZWd1bGF0ZWQxIiwgcHQuc2l6ZSA9IDEpICsKICBzY2FsZV9jb2xvdXJfZ3JhZGllbnRuKGNvbG91cnMgPSByZXYoYnJld2VyLnBhbChuID0gMTEsIG5hbWUgPSAiUmRCdSIpKSkgKwogIGxhYnModGl0bGUgPSAiTXllbG9pZDIgQ2x1c3RlciBjMSIpCgpwMiA8LSBGZWF0dXJlUGxvdChzdWJzZXQodXBfc2lnbiwgaHRfY2x1c3RlciA9PSAiYzIiKSwKICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgPSAidXByZWd1bGF0ZWQxIiwgcHQuc2l6ZSA9IDEpICsKICBzY2FsZV9jb2xvdXJfZ3JhZGllbnRuKGNvbG91cnMgPSByZXYoYnJld2VyLnBhbChuID0gMTEsIG5hbWUgPSAiUmRCdSIpKSkgKwogIGxhYnModGl0bGUgPSAiTXllbG9pZDIgQ2x1c3RlciBjMiIpCgpmaWd1cmUgPC0gZ2dhcnJhbmdlKHAxLCBwMiwgbmNvbCA9IDIpCmFubm90YXRlX2ZpZ3VyZShmaWd1cmUsIHRvcCA9IHRleHRfZ3JvYigiU2lnbmF0dXJlIHNjb3JlIG9mIGdlbmVzIHVwcmVndWxhdGVkIGluIEluZitFRlogaU1nIGFwcGxpZWQgdG8gQ1NGIE15ZWxvaWQyIGNlbGxzIiwgCiAgICAgICAgICAgICAgIGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIiwgc2l6ZSA9IDIwKSkKCmBgYAoKCjxkZXRhaWxzPgo8c3VtbWFyeT4qKkV4YWN0IHNjb3JlcyBmb3IgZWFjaCBjZWxsKio8L3N1bW1hcnk+CgpgYGB7ciwgcmVzdWx0cyA9ICJhc2lzIn0KIyBkaXZpZGUgdGhlIG51bWJlciBvZiByb3dzKGNlbGxzKSB3aXRoIHBvc2l0aXZlIGNjb3JlcyBieSB0aGUgbnVtYmVyIG9mIHRvdGFsIAojIHJvd3MoY2VsbHMpIHRvIGdldCB0aGUgcGVyY2VudGFnZSBvZiBjZWxscyB3aXRoIHBvc2l0aXZlIHNjb3Jlcy4KcGVyY2VudGFnZV9pbmYgPC0gZGltKHVwX3NpZ25AbWV0YS5kYXRhICU+JSBmaWx0ZXIodXByZWd1bGF0ZWQxID4gMCkpWzFdIC8gCiAgZGltKHVwX3NpZ25AbWV0YS5kYXRhWyJ1cHJlZ3VsYXRlZDEiXSlbMV0KCiMgc2hvdyB0aGUgcG9zaXRpdmUgc2NvcmVzLgp1cF9zaWduQG1ldGEuZGF0YVsidXByZWd1bGF0ZWQxIl0gJT4lIAogIGZpbHRlcih1cHJlZ3VsYXRlZDEgPiAwKSAlPiUgCiAgcmVuYW1lKCJTY29yZSIgPSAidXByZWd1bGF0ZWQxIikgJT4lIGhlYWQgJT4lIAogIGthYmxlKGNhcHRpb24gPSAidXByZWd1bGF0ZWQgc2NvcmVzIikKYGBgCgotLS0KPC9kZXRhaWxzPgoKIyMjIyBTY29yZXMgb2YgZ2VuZSBzaWduYXR1cmUgZG93bnJlZ3VsYXRlZCBpbiBJbmYrRUZaIGlNZyBpbiBNeWVsb2lkMiBjZWxscwoKQXMgY2FuIGJlIHNlZW4gaW4gdGhlIHBsb3QgYmVsb3cgdGhlcmUgYXJlIHNvbWUgY2VsbHMgd2l0aCBhIG5lYWdhdGl2ZSBzY29yZSBmb3IgCnRoZSBnZW5lIHNpZ25hdHVyZS4gVG8gYmUgcHJlY2lzZSwgNTglIG9mIG9mIGFsbCBjZWxscyAoODUgb3V0IG9mIDE0NikgaGF2ZSBhIApuZWdhdGl2ZSBzY29yZS4gTmV4dCwgaXQgd291bGQgYmUgaW50ZXJlc3RpbmcgdG8ga25vdyBpZiBzb21lIG9mIHRoaXMgY2VsbHMgYXJlIHRoZSBzYW1lIGFzIHRob3NlIHdpdGggYSBoaWdoIHNjb3JlIGZvciB0aGUgdXByZWd1bGF0ZWQgZ2VuZXMuIElkZW50aWZ5aW5nIGNlbGxzIGluIHdoaWNoIGJvdGggdGhlIHVwcmVndWxhdGVkIGdlbmUKc2lnbmF0dXJlIGFuZCB0aGUgZG93bnJlZ3VsYXRlZCBnZW5lIHNpZ25hdHVyZSBoYXZlIGEgcG9zaXRpdmUgb3IgbmVnYXRpdmUgc2NvcmUKcmVzcGVjdGl2ZWx5IGluY3JlYXNlcyB0aGUgY29uZmlkZW5jZSBpbiB0aGUgcmVzdWx0cy4gNTEgY2VsbHMgaGF2ZSBib3RoIGEgCnBvc2l0aXZlIHNjb3JlIGZvciB0aGUgdXByZWd1bGF0ZWQgZ2VuZXMgYW5kIGEgbmVnYXRpdmUgc2NvcmUgZm9yIHRoZQpkb3ducmVndWxhdGVkIGdlbmVzLiBDZWxscyBleGhpYml0aW5nIHRoaXMgc3BlY2lmaWMgcGF0dGVybiBvZiBnZW5lIGV4cHJlc3Npb24gCmFyZSBsaWtlbHkgaW5mZWN0ZWQgY2VsbHMuIFNpbmNlIHRoZSBpbmZlY3Rpb24gc3RhdHVzIG9mIHRoZSBjZWxscyBpbiB0aGUgQ1NGIApzYW1wbGUgaXMgdW5rbm93biB0aGlzIHByb3ZpZGVzIHZhbHVhYmxlIG5ldyBpbnNpZ2h0cy4KCmBgYHtyLCBmaWcud2lkdGg9MTV9Cgpkb3duX3NpZ24gPC0gQWRkTW9kdWxlU2NvcmUoaGl2bXkyLAogICAgICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlcyA9IGxpc3QoZG93bl9pbmZfZmlsdCksIG5hbWUgPSAiZG93bnJlZ3VsYXRlZCIpCgpwMSA8LSBGZWF0dXJlUGxvdChzdWJzZXQoZG93bl9zaWduLCBodF9jbHVzdGVyID09ICJjMSIpLAogICAgICAgICAgICAgICAgICBmZWF0dXJlcyA9ICJkb3ducmVndWxhdGVkMSIsIHB0LnNpemUgPSAxKSArCiAgc2NhbGVfY29sb3VyX2dyYWRpZW50bihjb2xvdXJzID0gcmV2KGJyZXdlci5wYWwobiA9IDExLCBuYW1lID0gIlJkQnUiKSkpICsKICBsYWJzKHRpdGxlID0gIk15ZWxvaWQyIENsdXN0ZXIgYzEiKQoKcDIgPC0gRmVhdHVyZVBsb3Qoc3Vic2V0KGRvd25fc2lnbiwgaHRfY2x1c3RlciA9PSAiYzIiKSwKICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgPSAiZG93bnJlZ3VsYXRlZDEiLCBwdC5zaXplID0gMSkgKwogIHNjYWxlX2NvbG91cl9ncmFkaWVudG4oY29sb3VycyA9IHJldihicmV3ZXIucGFsKG4gPSAxMSwgbmFtZSA9ICJSZEJ1IikpKSArCiAgbGFicyh0aXRsZSA9ICJNeWVsb2lkMiBDbHVzdGVyIGMyIikKCmZpZ3VyZSA8LSBnZ2FycmFuZ2UocDEsIHAyLCBuY29sID0gMikKYW5ub3RhdGVfZmlndXJlKGZpZ3VyZSwgdG9wID0gdGV4dF9ncm9iKCJTaWduYXR1cmUgc2NvcmUgb2YgZ2VuZXMgZG93bnJlZ3VsYXRlZCBpbiBJbmYrRUZaIGlNZyBhcHBsaWVkIHRvIENTRiBNeWVsb2lkMiBjZWxscyIsIAogICAgICAgICAgICAgICBjb2xvciA9ICJibGFjayIsIGZhY2UgPSAiYm9sZCIsIHNpemUgPSAyMCkpCgpgYGAKCmBgYHtyfQojIGRpdmlkZSB0aGUgbnVtYmVyIG9mIHJvd3MoY2VsbHMpIHdpdGggbmVnYXRpdmUgc2NvcmVzIGJ5IHRoZSBudW1iZXIgb2YgdG90YWwgCiMgcm93cyhjZWxscykgdG8gZ2V0IHRoZSBwZXJjZW50YWdlIG9mIGNlbGxzIHdpdGggbmVnYXRpdmUgc2NvcmVzLgpwZXJjZW50YWdlX2luZiA8LSBkaW0oZG93bl9zaWduQG1ldGEuZGF0YSAlPiUgZmlsdGVyKGRvd25yZWd1bGF0ZWQxIDwgMCkpWzFdIC8gCiAgZGltKGRvd25fc2lnbkBtZXRhLmRhdGFbImRvd25yZWd1bGF0ZWQxIl0pWzFdCgojIGV4dHJhY3QgbGlzdCBvZiBjZWxscyB3aXRoIHBvc2l0aXZlL25lZ2F0aXZlIHNjb3JlcyBhbmQgZmluZCB0aGUgb3ZlcmxhcApjZWxsc19kb3duIDwtIHJvd25hbWVzKGRvd25fc2lnbkBtZXRhLmRhdGEgJT4lIGZpbHRlcihkb3ducmVndWxhdGVkMSA8IDApKQpjZWxsc191cCA8LSByb3duYW1lcyh1cF9zaWduQG1ldGEuZGF0YSAlPiUgZmlsdGVyKHVwcmVndWxhdGVkMSA+IDApKQppbmZfZWZ6X2NlbGxzIDwtIGludGVyc2VjdChjZWxsc191cCwgY2VsbHNfZG93bikKYGBgCgoKPGRldGFpbHM+CjxzdW1tYXJ5PioqRGVmaW5pbmcgYSBzaWduYXR1cmUgY29tcG9zZWQgb2YgZG93bnJlZ3VsYXRlZCBnZW5lcyoqPC9zdW1tYXJ5PgoKRGVmaW5pbmcgYSBnZW5lIHNpZ25hdHVyZSBjb21wb3NlZCBvZiBib3RoIHVwLSBhbmQgZG93bnJlZ3VsYXRlZCBnZW5lcyB0dXJuZWQgCm91dCB0byBiZSBtb3JlIGRpZmZpY3VsdCB0aGFuIGV4cGVjdGVkLiBUaGUgaWRlYSB3YXMgdG8gc2VwYXJhdGVseSBpbnZlc3RpZ2F0ZSAKdXByZWd1bGF0ZWQgdmVyc3VzIGRvd25yZWd1bGF0ZWQgZ2VuZXMuIEFib3ZlIHRoZSB1cHJlZ3VsYXRlZCBhbmQgZG93bnJlZ3VsYXRlZApnZW5lIHNpZ25hdHVyZSBzY29yZXMgaW4gTXllbG9pZDIgY2VsbHMgd2VyZSBzaG93bi4gCgpXZSB3aWxsIG5vdyBoYXZlIGEgY2xvc2VyIGxvb2sgYXQgdGhlIHByb2JsZW1zIHRoYXQgYXJpc2Ugd2hlbiBpbnZlc3RpZ2F0aW5nCmRvd25yZWd1bGF0ZWQgZ2VuZXMuIEFzc3VtaW5nIHRoYXQgb3VyIE15ZWxvaWQyIGNlbGxzIGFyZSBjb21wb3NlZCBvZiB0d28gCmRpc3RpbmN0IHBvcHVsYXRpb25zLCBvbmUgaW5mZWN0ZWQgYW5kIG9uZSB1bmluZmVjdGVkLCB3ZSB3b3VsZCBleHBlY3QgYSAKYmltb2RhbCBkaXN0cmlidXRpb24gb2YgZ2VuZSBleHByZXNzaW9uIGZvciBnZW5lcyB1cHJlZ3VsYXRlZCBpbiB0aGUgaW5mZWN0ZWQKY29uZGl0aW9uLiBUaGVyZSBzaG91bGQgYmUgb25lIHBlYWsgd2l0aCBiYXNlIGxldmVsIGdlbmUgZXhwcmVzc2lvbiBjb3JyZXNwb25kaW5nCnRvIHVuaW5mZWN0ZWQgY2VsbHMgYW5kIGEgc2Vjb25kIHBlYWsgd2l0aCBoaWdoZXIgbGV2ZWxzIG9mIGdlbmUgZXhwcmVzc2lvbiAKY29ycmVzcG9uZGluZyB0byBpbmZlY3RlZCBjZWxscy4gCgpJbiB0aGUgaGlzdG9ncmFtcyBiZWxvdyB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBzdW0gb2YgbG9nLW5vcm1hbGl6ZWQgZmVhdHVyZSBjb3VudHMgb2YgZ2VuZXMgdXByZWd1bGF0ZWQgb3IgZG93bnJlZ3VsYXRlZCAgcmVzcGVjdGl2ZWx5IGNhbiBiZSBzZWVuLiBGb3IgdGhlCnVwcmVndWxhdGVkIGdlbmVzIChncmVlbikgYSBiaW1vZGFsIGRpc3RyaWJ1dGlvbiBpcyBub3QgZXZpZGVudCBmcm9tIAp0aGUgaGlzdG9ncmFtIGJlbG93LiBObyBjbGVhciBjb25jbHVzaW9ucyBjYW4gYmUgZHJhd24sIHNpbmNlIHRoZSBudW1iZXIgb2YKY2VsbHMgaXMgcHJvYmFibHkgdG9vIGxvdy4KCkZvciB0aGUgZG93bnJlZ3VsYXRlZCBnZW5lcyAocmVkKSB0aGVyZSBzZWVtIHRvIGJlIGEgbGFyZ2UgbnVtYmVyIG9mIGNlbGxzIHdoaWNoIGRvIApub3QgZXhwcmVzcyB0aGVzZSBnZW5lcyBhdCBhbGwuIFRoaXMgZ3JvdXAgb2YgY2VsbHMgY291bGQgaW5jbHVkZSBpbmZlY3RlZCBjZWxscywKaG93ZXZlciB0aGlzIGlzIGEgZGFuZ2Vyb3VzIGFzc3VtcHRpb24sIHNpbmNlIGluIGdlbmVyYWwgdGhlcmUgbWlnaHQgYmUgY2VsbHMKd2l0aCBsb3cgb3Igbm9uZSBleHByZXNzaW9uIG9mIHRoZXNlIGdlbmVzLiBUaGVyZSBpcyBubyB3YXkgdG8ga25vdyBpZiB0aGVzZSAKY2VsbHMgYXJlIGFjdHVhbGx5IGluZmVjdGVkIGNlbGxzLgoKYGBge3J9CiNub3JtYWxpemUgY291bnRzIG9mIHVwcmVndWxhdGVkIGdlbmVzCmNvdW50c191cCA8LSAoaGl2bXkyQGFzc2F5cyRSTkFAZGF0YSkKY291bnRzX3VwIDwtIHQodChjb3VudHNfdXApKSAvIGNvbFN1bXMoY291bnRzX3VwKQpjb3VudHNfdXAgPC0gbG9nMXAoY291bnRzX3VwKQpjb3VudHNfdXAgPC0gY291bnRzX3VwW3VwX2luZl9maWx0LCBdCgojIGNvbXB1dGUgYXZlcmFnZSBleHByZXNzaW9uIG9mIHRoZSAyMCBzaWduYXR1cmUgZ2VuZXMKcDEgPC0gYXMuZGF0YS5mcmFtZShyb3dTdW1zKHQoY291bnRzX3VwKSkpICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgcmVuYW1lKCJjb3VudCIgPSAicm93U3Vtcyh0KGNvdW50c191cCkpIikgJT4lIAogIGFycmFuZ2UoZGVzYyhjb3VudCkpICU+JSAKICBnZ3Bsb3QoYWVzKHggID0gY291bnQpKSArCiAgZ2VvbV9oaXN0b2dyYW0oYmlucyA9IDcwLCBjb2xvciA9ICJvbGl2ZWRyYWI0IiwgZmlsbCA9ICJvbGl2ZWRyYWI0IikgKwogIHhsYWIoIm5vcm1hbGl6ZWQgZmVhdHVyZSBjb3VudHMiKSArCiAgeWxhYigibnVtYmVyIG9mIGNlbGxzIikgKwogIHlsaW0oMCwxMDApICsKICBsYWJzKHRpdGxlID0gIlN1bSBvZiBmZWF0dXJlIGNvdW50cyBvZiBnZW5lcyB1cHJlZ3VsYXRlZCBpbiBJbmYrRUZaIHZzLiBVbmluZitFRloiKQoKI25vcm1hbGl6ZSBjb3VudHMgb2YgZG93bnJlZ3VsYXRlZCBnZW5lcwpjb3VudHNfZG93biA8LSAoaGl2bXkyQGFzc2F5cyRSTkFAZGF0YSkKY291bnRzX2Rvd24gPC0gdCh0KGNvdW50c19kb3duKSkgLyBjb2xTdW1zKGNvdW50c19kb3duKQpjb3VudHNfZG93biA8LSBsb2cxcChjb3VudHNfZG93bikKY291bnRzX2Rvd24gPC0gY291bnRzX2Rvd25bZG93bl9pbmZfZmlsdCwgXQoKIyBjb21wdXRlIGF2ZXJhZ2UgZXhwcmVzc2lvbiBvZiB0aGUgMjAgc2lnbmF0dXJlIGdlbmVzCnAyIDwtIGFzLmRhdGEuZnJhbWUocm93U3Vtcyh0KGNvdW50c19kb3duKSkpICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgcmVuYW1lKCJjb3VudCIgPSAicm93U3Vtcyh0KGNvdW50c19kb3duKSkiKSAlPiUgCiAgYXJyYW5nZShkZXNjKGNvdW50KSkgJT4lIAogIGdncGxvdChhZXMoeCAgPSBjb3VudCkpICsKICBnZW9tX2hpc3RvZ3JhbShiaW5zID0gNzAsIGNvbG9yID0gInJlZDQiLCBmaWxsID0gInJlZDQiKSArCiAgeGxhYigibm9ybWFsaXplZCBmZWF0dXJlIGNvdW50cyIpICsKICB5bGFiKCJudW1iZXIgb2YgY2VsbHMiKSArCiAgbGFicyh0aXRsZSA9ICJTdW0gb2YgZmVhdHVyZSBjb3VudCBvZiBnZW5lcyBkb3ducmVndWxhdGVkIGluIEluZitFRlogdnMuIFVuaW5mK0VGWiIpCmBgYAoKYGBge3IsIGZpZy53aWR0aD0xNX0KcDEgKyBwMgpgYGAKCi0tLQoKPC9kZXRhaWxzPgoKCiMjIyMgU2NvcmVzIG9mIGdlbmUgc2lnbmF0dXJlIHVwLSBvciBkb3ducmVndWxhdGVkIGluIGNlbGxzIHRyZWF0ZWQgd2l0aCBFRlogaW5kZXBlbmRlbnRseSBvZiBpbmZlY3Rpb24gY29uZGl0aW9uLgoKT2YgdGhlIE15ZWxvaWQyIGNlbGxzIDcwJSAoMTAzIG91dCBvZiAxNDYgY2VsbHMpIGhhdmUgYSBzY29yZSBhYm92ZSAwLjIgZm9yIHRoZSB1cHJlZ3VsYXRlZCBnZW5lIHNpZ25hdHVyZS4gT25seSAyNiUgb2YgY2VsbHMgaGF2ZSBhIG5lZ2F0aXZlIHNjb3JlIChiZWxvdyAwKSAKZm9yIHRoZSBkb3ducmVndWxhdGVkIGdlbmUgc2lnbmF0dXJlLiBBZ2FpbiwgdG8gaW5jcmVhc2UgdGhlIGNvbmZpZGVuY2UgaW4gdGhlCnJlc3VsdHMsIHRoZSBvdmVybGFwIGJldHdlZW4gdGhlIGNlbGxzIHdpdGggdXAvZG93bnJlZ3VsYXRlZCBnZW5lIHNpZ25hdHVyZXMKd2FzIGlkZW50aWZpZWQuIE9ubHkgMTUgY2VsbHMgaGF2ZSBib3RoIGEgcG9zaXRpdmUgYW5kIG5lZ2F0aXZlIHNjb3JlIGZvciB0aGUKdXAtIGFuZCBkb3ducmVndWxhdGVkIHNpZ25hdHVyZSByZXNwZWN0aXZlbHkuCgpgYGB7ciwgZmlnLndpZHRoPTE1fQp1cF90cmVhdCA8LSBBZGRNb2R1bGVTY29yZShoaXZteTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gbGlzdCh0cmVhdG1lbnRfdXApLAogICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gInVwcmVndWxhdGVkIikKCnAxIDwtIEZlYXR1cmVQbG90KHN1YnNldCh1cF90cmVhdCwgaHRfY2x1c3RlciA9PSAiYzEiKSwKICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgPSAidXByZWd1bGF0ZWQxIiwgcHQuc2l6ZSA9IDEpICsKICBzY2FsZV9jb2xvdXJfZ3JhZGllbnRuKGNvbG91cnMgPSByZXYoYnJld2VyLnBhbChuID0gMTEsIG5hbWUgPSAiUmRCdSIpKSkgKwogIGxhYnModGl0bGUgPSAiTXllbG9pZDIgQ2x1c3RlciBjMSIpCgpwMiA8LSBGZWF0dXJlUGxvdChzdWJzZXQodXBfdHJlYXQsIGh0X2NsdXN0ZXIgPT0gImMyIiksCiAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gInVwcmVndWxhdGVkMSIsIHB0LnNpemUgPSAxKSArCiAgc2NhbGVfY29sb3VyX2dyYWRpZW50bihjb2xvdXJzID0gcmV2KGJyZXdlci5wYWwobiA9IDExLCBuYW1lID0gIlJkQnUiKSkpICsKICBsYWJzKHRpdGxlID0gIk15ZWxvaWQyIENsdXN0ZXIgYzIiKQoKZmlndXJlIDwtIGdnYXJyYW5nZShwMSwgcDIsIG5jb2wgPSAyKQphbm5vdGF0ZV9maWd1cmUoZmlndXJlLCB0b3AgPSB0ZXh0X2dyb2IoIlNpZ25hdHVyZSBzY29yZSBvZiBnZW5lcyB1cHJlZ3VsYXRlZCBpbiBFRlogdHJlYXRtZW50IiwgCiAgICAgICAgICAgICAgIGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIiwgc2l6ZSA9IDIwKSkKCmBgYAoKCmBgYHtyLCBmaWcud2lkdGg9MTV9CmRvd25fdHJlYXQgPC0gQWRkTW9kdWxlU2NvcmUoaGl2bXkyLAogICAgICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlcyA9IGxpc3QodHJlYXRtZW50X2Rvd24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gImRvd25yZWd1bGF0ZWQiKQoKcDEgPC0gRmVhdHVyZVBsb3Qoc3Vic2V0KGRvd25fdHJlYXQsIGh0X2NsdXN0ZXIgPT0gImMxIiksCiAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gImRvd25yZWd1bGF0ZWQxIiwgcHQuc2l6ZSA9IDEpICsKICBzY2FsZV9jb2xvdXJfZ3JhZGllbnRuKGNvbG91cnMgPSByZXYoYnJld2VyLnBhbChuID0gMTEsIG5hbWUgPSAiUmRCdSIpKSkgKwogIGxhYnModGl0bGUgPSAiTXllbG9pZDIgQ2x1c3RlciBjMSIpCgpwMiA8LSBGZWF0dXJlUGxvdChzdWJzZXQoZG93bl90cmVhdCwgaHRfY2x1c3RlciA9PSAiYzIiKSwKICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgPSAiZG93bnJlZ3VsYXRlZDEiLCBwdC5zaXplID0gMSkgKwogIHNjYWxlX2NvbG91cl9ncmFkaWVudG4oY29sb3VycyA9IHJldihicmV3ZXIucGFsKG4gPSAxMSwgbmFtZSA9ICJSZEJ1IikpKSArCiAgbGFicyh0aXRsZSA9ICJNeWVsb2lkMiBDbHVzdGVyIGMyIikKCmZpZ3VyZSA8LSBnZ2FycmFuZ2UocDEsIHAyLCBuY29sID0gMikKYW5ub3RhdGVfZmlndXJlKGZpZ3VyZSwgdG9wID0gdGV4dF9ncm9iKCJTaWduYXR1cmUgc2NvcmUgb2YgZ2VuZXMgZG93bnJlZ3VsYXRlZCBpbiBFRlogdHJlYXRtZW50IiwgCiAgICAgICAgICAgICAgIGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIiwgc2l6ZSA9IDIwKSkKCmBgYAoKYGBge3J9CnBlcmNlbnRhZ2VfdXAgPC0gZGltKHVwX3RyZWF0QG1ldGEuZGF0YSAlPiUgZmlsdGVyKHVwcmVndWxhdGVkMSA+IDAuMikpWzFdIC8KICBkaW0odXBfdHJlYXRAbWV0YS5kYXRhKVsxXQoKcGVyY2VudGFnZV9kb3duIDwtIGRpbShkb3duX3RyZWF0QG1ldGEuZGF0YSAlPiUgZmlsdGVyKGRvd25yZWd1bGF0ZWQxIDwgMCkpWzFdIC8KICBkaW0oZG93bl90cmVhdEBtZXRhLmRhdGEpWzFdCgpjZWxsc19kb3duIDwtIHJvd25hbWVzKGRvd25fdHJlYXRAbWV0YS5kYXRhICU+JSBmaWx0ZXIoZG93bnJlZ3VsYXRlZDEgPCAwKSkKY2VsbHNfdXAgPC0gcm93bmFtZXModXBfdHJlYXRAbWV0YS5kYXRhICU+JSBmaWx0ZXIodXByZWd1bGF0ZWQxID4gMC4yKSkKdHJlYXRfY2VsbHMgPC0gaW50ZXJzZWN0KGNlbGxzX2Rvd24sIGNlbGxzX3VwKQpgYGAKCiMjIE92ZXJsYXkgSW5mK0VGWiBzaWduYXR1cmUgd2l0aCB0aGUgVEYgYWN0aXZpdHkgaGVhdG1hcCBvZiBNeWVsb2lkMiBjZWxscyB7LnRhYnNldH0KClRoZXJlIGFyZSBhIHNvbWUgY2VsbHMgd2hpY2ggZXhwcmVzcyB0aGUgSW5mK0VGWiBzaWduYXR1cmUgYW5kIHRoZXkgYXJlIGhpZ2hsaWdodGVkCndpdGggYW4gb3JhbmdlIGNvbG91ciBpbiB0aGUgaGVhdG1hcCBiZWxvdy4gSG93ZXZlciwgdGhleSBhcmUgc3ByZWFkCmFjcm9zcyBhbGwgY2x1c3RlcnMgYW5kIHBhdGllbnRzLiBUaGUgZmlyc3Qgb2YgdGhyZWUgY2x1c3RlcnMgaW4gZWFjaCBwYXRpZW50IHdhcwpoeXBvdGhlc2l6ZWQgdG8gYmUgYSBsYXRlbnRseSBpbmZlY3RlZCBncm91cCBvZiBjZWxscy4gSW4gdGhlIGhlYXRtYXAgYmVsb3cgdGhlIApjZWxscyB3aXRoIGFuIEluZitFRlogc2lnbmF0dXJlIGRvIG5vdCBzZWVtIHRvIGFjY3VtdWxhdGUgaW4gdGhlIGZpcnN0IGNsdXN0ZXIgb2YgCmVhY2ggcGF0aWVudCwgYnV0IHJhdGhlciBhcmUgbW9yZSBmcmVxdWVudCBpbiB0aGUgb3RoZXIgdHdvIGNsdXN0ZXJzLgoKIyMjIGsgPSAzIGhpZXJhcmNoaWNhbCBjbHVzdGVyaW5nCgpgYGAje3J9CiMgY2FsY3VsYXRlIHNjb3JlcyBmb3IgZ2VuZXMgdXByZWd1YWx0ZWQgaW4gSW5mK0VGWiBpTWcKdXBfc2lnbiA8LSBBZGRNb2R1bGVTY29yZShoaXZteTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gdXBfaW5mX2ZpbHQpCgojIGV4dHJhY3QgdGhlIE15ZWxvaWQyIGNlbGxzIHdoaWNoIGhhdmUgYSBwb3NpdGl2ZSBzY29yZSBmb3IgdGhlIEluZitFRlogc2lnbmF0dXJlCmluZl9lZnpfY2VsbHMgPC0gcm93bmFtZXModXBfc2lnbkBtZXRhLmRhdGEgJT4lIGZpbHRlcihDbHVzdGVyMSA+IDApKQojdW5pbmZfZWZ6X2NlbGxzIDwtIHJvd25hbWVzKGhpdm15Ml91bmluZl9lZnpfc2lnbkBtZXRhLmRhdGEgJT4lIGZpbHRlcihDbHVzdGVyMSA+IDApKQojdW5pbmZfY2VsbHMgPC0gcm93bmFtZXMoaGl2bXkyX3VuaW5mX3NpZ25AbWV0YS5kYXRhICU+JSBmaWx0ZXIoQ2x1c3RlcjEgPiAwKSkKYGBgCgoKYGBge3IsZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTIwfQojIHJlYWQgaW4gU2V1cmF0IG9iamVjdCBjb250aWFuaW5nIGFsbHMgc2FtcGxlcyBhbmQgY29uZGl0aW9ucwpoaXY3IDwtIHJlYWRSRFMoIi9tZWRpYS9hZy1jaGVycm1hbm4va21pa3VsaWsvSElWX21pY3JvZ2xpYS9zcmMvUmVwcm9kdWNlX0ZhcmhhZGlhbl9QYXBlci9TZXVyYXRfb2JqZWN0cy90b3RhbF83X3NhbXBsZXNfbGFiZWxfdHJhbnNmZXIucmRzIikKIyBpbXBvcnQgVEYgYWN0aXZpdHkgbWF0cml4IG9mICBNeWVsb2lkMiBjZWxscwphdWNfbXR4IDwtIHJlYWQudGFibGUoImRhdGFfZmlsZXMvYXVjZWxsX21hdHJpeF8xMGtfaHZnLnRzdiIsIHNlcCA9ICJcdCIpCgoKIyAzIGhlYXRtYXBzIHdpdGggYWxsIFNjZW5pYyBURnMKaHRfbGlzdCA8LSBtYXAoc2VxLmludCgxOjMpLCBmdW5jdGlvbihuKSB7CiAgcGF0aWVudHMgPC0gYyAoIkhJVjFfQ1NGIiwgIkhJVjJfQ1NGIiwgIkhJVjNfQ1NGIikgIyAzIGRpZmZlcmVudCBwYXRpZW50cwogICMgZmlsdGVyIHRoZSBkYXRhc2V0IGZvciBvbmx5IE15ZWxvaWQyIGNlbGxzIGFuZCBpdGVyYXRpdmVseSBvbmUgb2YgdGhlIHBhdGllbnRzCiAgZGYgPC0gaGl2N0BtZXRhLmRhdGEgJT4lIGZpbHRlcihjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ID09IHBhdGllbnRzW25dKQogICMgc2VsZWN0IG9ubHkgdGhlIGNlbGxzIG9mIHRoZSBhY3Rpdml0eSBtYXRyaXggd2hpY2ggYXJlIG15ZWxvaWQyIGFuZCB0aGUgY29ycmVjdCBwYXRpZW50CiAgbXR4IDwtIGF1Y19tdHhbcm93bmFtZXMoYXVjX210eCkgJWluJSByb3duYW1lcyhkZiksXQogICMgaGVhdG1hcAogIGh0IDwtIEhlYXRtYXAodChtdHgpLCAKICAgICAgICAgICAgICAgY29sdW1uX3RpdGxlID0gcGFzdGUwKCJwYXRpZW50OiAiLCBwYXRpZW50c1tuXSksIAogICAgICAgICAgICAgICB0b3BfYW5ub3RhdGlvbiA9IEhlYXRtYXBBbm5vdGF0aW9uKHNpZ25hdHVyZSA9IGNhc2Vfd2hlbigKICAgICAgICAgICAgICAgICByb3duYW1lcyhtdHgpICVpbiUgaW5mX2Vmel9jZWxscyB+ICJJbmZfRUZaX3NpZ25hdHVyZSIsCiAgICAgICAgICAgICAgICAgI3Jvd25hbWVzKG10eCkgJWluJSB1bmluZl9lZnpfY2VsbHMgfiAiVW5pbmZfRUZaX3NpZ25hdHVyZSIsCiAgICAgICAgICAgICAgICAgI3Jvd25hbWVzKG10eCkgJWluJSB1bmluZl9jZWxscyB+ICJVbmluZl9zaWduYXR1cmUiLAogICAgICAgICAgICAgICAgIFRSVUUgfiAibm9fc2lnbmF0dXJlIiksCiAgICAgICAgICAgICAgICAgbmFtZSA9ICJzaWduYXR1cmUiLAogICAgICAgICAgICAgICAgIGNvbCA9IGxpc3Qoc2lnbmF0dXJlID0gYygiSW5mX0VGWl9zaWduYXR1cmUiID0gIm9yYW5nZTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIlVuaW5mX0VGWl9zaWduYXR1cmUiID0gImxpZ2h0Ymx1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMiVW5pbmZfc2lnbmF0dXJlIiA9ICJvcmFuZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm9fc2lnbmF0dXJlIiA9ICJuYXZ5IikpKSwKICAgICAgICAgICAgICAgY29sdW1uX2ttID0gMywKICAgICAgICAgICAgICAgI3Jvd19rbSA9IG4sIAogICAgICAgICAgICAgICBzaG93X2NvbHVtbl9uYW1lcyA9IEZBTFNFLAogICAgICAgICAgICAgICBjb2wgPWNvbG9yUmFtcFBhbGV0dGUocmV2KGJyZXdlci5wYWwobiA9IDcsIG5hbWUgPSAiUmRZbEJ1IikpKSgxMDApLAogICAgICAgICAgICAgICBzaG93X3Jvd19uYW1lcyA9IFRSVUUKICAgICAgICAgICAgICAgKSAKICAgICAgICAgICAgICAgI3RvcF9hbm5vdGF0aW9uID0gY29sdW1uX2Fubm90YXRpb24pIAogIGxpc3QobmFtZSA9IHBhdGllbnRzW25dLCBoZWF0bWFwID0gaHQpCn0pCgpodF9saXN0W1sxXV0kaGVhdG1hcCArIGh0X2xpc3RbWzJdXSRoZWF0bWFwICsgaHRfbGlzdFtbM11dJGhlYXRtYXAgCmBgYAoKLS0tCgojIyMgZ3JvdXAgYWNjb3JkaW5nIHRvIGluZmVjdGlvbiBjb25kaXRpb24KCldoZW4geW91IGdyb3VwIHRoZSBjZWxscyBhY2NvcmRpbmcgdG8gdGhlaXIgZGlmZmVyZW50IGdlbmUgc2lnbmF0dXJlcyBhcyBpbiB0aGUgCmhlYXRtYXAgYmVsb3csIHlvdSBkbyBub3Qgc2VlIGEgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSB0d28gZ3JvdXBzLiBUZXN0aW5nCmZvciBURnMgd2l0aCBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiB0aGUgdHdvIGdyb3VwcyBtaWdodCBwcm92aWRlIG1vcmUgCmluc2lnaHRzLiAKCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9MjB9CiMgZmlsdGVyIHRoZSBkYXRhc2V0IGZvciBvbmx5IE15ZWxvaWQyIGNlbGxzIApkZiA8LSBoaXY3QG1ldGEuZGF0YSAlPiUgZmlsdGVyKGNlbGxfdHlwZSA9PSAiTXllbG9pZDIiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50ICVpbiUgYyAoIkhJVjFfQ1NGIiwgIkhJVjJfQ1NGIiwgIkhJVjNfQ1NGIikpCiMgc2VsZWN0IG9ubHkgdGhlIGNlbGxzIG9mIHRoZSBhY3Rpdml0eSBtYXRyaXggd2hpY2ggYXJlIG15ZWxvaWQyIGFuZCB0aGUgY29ycmVjdCBwYXRpZW50Cm10eCA8LSBhdWNfbXR4W3Jvd25hbWVzKGF1Y19tdHgpICVpbiUgcm93bmFtZXMoZGYpLF0KCiMgYWRkIHNpZ25hdHVyZSBjb2x1bW4gdG8gZGF0YWZyYW1lCnNpZ25hdHVyZSA8LSBkZiAlPiUKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgbXV0YXRlKHNpZ25hdHVyZSA9IGNhc2Vfd2hlbihjZWxsICVpbiUgaW5mX2Vmel9jZWxscyB+ICJJbmZfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjY2VsbCAlaW4lIHVuaW5mX2Vmel9jZWxscyB+IlVuaW5mX0VGWl9zaWduYXR1cmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNjZWxsICVpbiUgdW5pbmZfY2VsbHMgfiAiVW5pbmZfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRSVUUgfiAibm9fc2lnbmF0dXJlIikpCgoKaHQgPC0gZHJhdyhIZWF0bWFwKHQobXR4KSwgCiAgICAgICAgICAgICBjb2x1bW5fdGl0bGUgPSAiQWxsIHBhdGllbnRzIHNwbGl0IGFjY29yZGluZyB0byBnZW5lIHNpZ25hdHVyZSBzY29yZXMiLCAKICAgICAgICAgICAgIHRvcF9hbm5vdGF0aW9uID0gSGVhdG1hcEFubm90YXRpb24oc2lnbmF0dXJlID0gY2FzZV93aGVuKAogICAgICAgICAgICAgICByb3duYW1lcyhtdHgpICVpbiUgaW5mX2Vmel9jZWxscyB+ICJJbmZfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgI3Jvd25hbWVzKG10eCkgJWluJSB1bmluZl9lZnpfY2VsbHMgfiAiVW5pbmZfRUZaX3NpZ25hdHVyZSIsCiAgICAgICAgICAgICAgICNyb3duYW1lcyhtdHgpICVpbiUgdW5pbmZfY2VsbHMgfiAiVW5pbmZfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgVFJVRSB+ICJub19zaWduYXR1cmUiKSwKICAgICAgICAgICAgICAgbmFtZSA9ICJzaWduYXR1cmUiLAogICAgICAgICAgICAgICBjb2wgPSBsaXN0KHNpZ25hdHVyZSA9IGMoIkluZl9zaWduYXR1cmUiID0gIm9yYW5nZTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyJVbmluZl9FRlpfc2lnbmF0dXJlIiA9ICJsaWdodGJsdWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyJVbmluZl9zaWduYXR1cmUiID0gIm9yYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm9fc2lnbmF0dXJlIiA9ICJuYXZ5IikpKSwgICAgICAgCiAgICAgICAgICAgICBjb2x1bW5fc3BsaXQgPSBzaWduYXR1cmUkc2lnbmF0dXJlLAogICAgICAgICAgICAgc2hvd19jb2x1bW5fbmFtZXMgPSBGQUxTRSwKICAgICAgICAgICAgIGNvbCA9Y29sb3JSYW1wUGFsZXR0ZShyZXYoYnJld2VyLnBhbChuID0gNywgbmFtZSA9ICJSZFlsQnUiKSkpKDEwMCksCiAgICAgICAgICAgICBzaG93X3Jvd19uYW1lcyA9IFRSVUUKICAgICAgICAgICAgICkpCmBgYAoKLS0tCgoKIyMgT3ZlcmxheSBFRlogdHJlYXRtZW50IHNpZ25hdHVyZSB3aXRoIHRoZSBURiBhY3Rpdml0eSBoZWF0bWFwIG9mIE15ZWxvaWQyIGNlbGxzIHsudGFic2V0fQoKVGhlcmUgYXJlIHZlcnkgZmV3IGNlbGxzIHdpdGggYm90aCBhIHBvc2l0aXZlIGFuZCBuZWdhdGl2ZSBzY29yZSBmb3IgdXAtIGFuZApkb3ducmVndWxhdGVkIHNpZ25hdHVyZXMgcmVzcGVjdGl2ZWx5LiBUaGlzIG1pZ2h0IGJlLCBiZWNhdXNlIHRoZSBjb21wYXJpc29uIApiZXR3ZWVuIHRoZSBlZmZlY3Qgb2YgRUZaIHRyZWF0bWVudCBvbiBjZWxscyBpbiBjZWxsIGN1bHR1cmUgYW5kIGNlbGxzIGZyb20gdGhlIApDU0Ygb2YgcGF0aWVudHMgdHJlYXRlZCB3aXRoIGEgY29tYmluYXRpb24gb2Ygb3RoZXIgYW50aXJldHJvdmlyYWwgZHJ1Z3MgbWlnaHQgCmJlIGZhcmZldGNoZWQuIEFwYXJ0IGZyb20gdGhlIGRydWdzIGJlaW5nIGRpZmZlcmVudCwgY2VsbHMgaW4gY2VsbCBjdWx0dXJlIGFyZSAKZXhwb3NlZCB0byBjb21wYXJhdGl2ZWx5IGhpZ2ggZHJ1ZyBjb25jZW50cmF0aW9ucywgd2hpbGUgY2VsbHMgaW4gdGhlIENTRiBhcmUKZXhwb3NlZCB0byB2ZXJ5IGxvdyBkcnVnIGNvbmNlbnRyYXRpb25zIGR1ZSB0byB0aGUgYmxvb2QtYnJhaW4gYmFycmllci4gVGhpcyAKY291bGQgZXhwbGFpbiB3aHkgc28gZmV3IGNlbGxzIHdpdGggYSBFRlogdHJlYXRtZW50IHNpZ25hdHVyZSBhcmUgZm91bmQgYW1vbmcgdGhlIApNeWVsb2lkMiBjZWxscy4gCgojIyMgayA9IDMgaGllcmFyY2hpY2FsIGNsdXN0ZXJpbmcKCmBgYHtyLGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD0yMH0KCiMgMyBoZWF0bWFwcyB3aXRoIGFsbCBTY2VuaWMgVEZzCmh0X2xpc3QgPC0gbWFwKHNlcS5pbnQoMTozKSwgZnVuY3Rpb24obikgewogIHBhdGllbnRzIDwtIGMgKCJISVYxX0NTRiIsICJISVYyX0NTRiIsICJISVYzX0NTRiIpICMgMyBkaWZmZXJlbnQgcGF0aWVudHMKICAjIGZpbHRlciB0aGUgZGF0YXNldCBmb3Igb25seSBNeWVsb2lkMiBjZWxscyBhbmQgaXRlcmF0aXZlbHkgb25lIG9mIHRoZSBwYXRpZW50cwogIGRmIDwtIGhpdjdAbWV0YS5kYXRhICU+JSBmaWx0ZXIoY2VsbF90eXBlID09ICJNeWVsb2lkMiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCA9PSBwYXRpZW50c1tuXSkKICAjIHNlbGVjdCBvbmx5IHRoZSBjZWxscyBvZiB0aGUgYWN0aXZpdHkgbWF0cml4IHdoaWNoIGFyZSBteWVsb2lkMiBhbmQgdGhlIGNvcnJlY3QgcGF0aWVudAogIG10eCA8LSBhdWNfbXR4W3Jvd25hbWVzKGF1Y19tdHgpICVpbiUgcm93bmFtZXMoZGYpLF0KICAjIGhlYXRtYXAKICBodCA8LSBIZWF0bWFwKHQobXR4KSwgCiAgICAgICAgICAgICAgIGNvbHVtbl90aXRsZSA9IHBhc3RlMCgicGF0aWVudDogIiwgcGF0aWVudHNbbl0pLCAKICAgICAgICAgICAgICAgdG9wX2Fubm90YXRpb24gPSBIZWF0bWFwQW5ub3RhdGlvbihzaWduYXR1cmUgPSBjYXNlX3doZW4oCiAgICAgICAgICAgICAgICAgcm93bmFtZXMobXR4KSAlaW4lIHRyZWF0X2NlbGxzIH4gIkVGWl90cmVhdG1lbnRfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgICAjcm93bmFtZXMobXR4KSAlaW4lIHVuaW5mX2Vmel9jZWxscyB+ICJVbmluZl9FRlpfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgICAjcm93bmFtZXMobXR4KSAlaW4lIHVuaW5mX2NlbGxzIH4gIlVuaW5mX3NpZ25hdHVyZSIsCiAgICAgICAgICAgICAgICAgVFJVRSB+ICJub19zaWduYXR1cmUiKSwKICAgICAgICAgICAgICAgICBuYW1lID0gInNpZ25hdHVyZSIsCiAgICAgICAgICAgICAgICAgY29sID0gbGlzdChzaWduYXR1cmUgPSBjKCJFRlpfdHJlYXRtZW50X3NpZ25hdHVyZSIgPSAib2xpdmVkcmFiMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMiVW5pbmZfRUZaX3NpZ25hdHVyZSIgPSAibGlnaHRibHVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyJVbmluZl9zaWduYXR1cmUiID0gIm9yYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJub19zaWduYXR1cmUiID0gIm5hdnkiKSkpLAogICAgICAgICAgICAgICBjb2x1bW5fa20gPSAzLAogICAgICAgICAgICAgICAjcm93X2ttID0gbiwgCiAgICAgICAgICAgICAgIHNob3dfY29sdW1uX25hbWVzID0gRkFMU0UsCiAgICAgICAgICAgICAgIGNvbCA9Y29sb3JSYW1wUGFsZXR0ZShyZXYoYnJld2VyLnBhbChuID0gNywgbmFtZSA9ICJSZFlsQnUiKSkpKDEwMCksCiAgICAgICAgICAgICAgIHNob3dfcm93X25hbWVzID0gVFJVRQogICAgICAgICAgICAgICApIAogICAgICAgICAgICAgICAjdG9wX2Fubm90YXRpb24gPSBjb2x1bW5fYW5ub3RhdGlvbikgCiAgbGlzdChuYW1lID0gcGF0aWVudHNbbl0sIGhlYXRtYXAgPSBodCkKfSkKCmh0X2xpc3RbWzFdXSRoZWF0bWFwICsgaHRfbGlzdFtbMl1dJGhlYXRtYXAgKyBodF9saXN0W1szXV0kaGVhdG1hcCAKYGBgCgotLS0KCiMjIyBHcm91cCBieSB0cmVhdG1lbnQgY29uZGl0aW9uCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTIwfQojIGZpbHRlciB0aGUgZGF0YXNldCBmb3Igb25seSBNeWVsb2lkMiBjZWxscyAKZGYgPC0gaGl2N0BtZXRhLmRhdGEgJT4lIGZpbHRlcihjZWxsX3R5cGUgPT0gIk15ZWxvaWQyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCAlaW4lIGMgKCJISVYxX0NTRiIsICJISVYyX0NTRiIsICJISVYzX0NTRiIpKQojIHNlbGVjdCBvbmx5IHRoZSBjZWxscyBvZiB0aGUgYWN0aXZpdHkgbWF0cml4IHdoaWNoIGFyZSBteWVsb2lkMiBhbmQgdGhlIGNvcnJlY3QgcGF0aWVudAptdHggPC0gYXVjX210eFtyb3duYW1lcyhhdWNfbXR4KSAlaW4lIHJvd25hbWVzKGRmKSxdCgojIGFkZCBzaWduYXR1cmUgY29sdW1uIHRvIGRhdGFmcmFtZQpzaWduYXR1cmUgPC0gZGYgJT4lCiAgcm93bmFtZXNfdG9fY29sdW1uKCJjZWxsIikgJT4lIAogIG11dGF0ZShzaWduYXR1cmUgPSBjYXNlX3doZW4oY2VsbCAlaW4lIHRyZWF0X2NlbGxzIH4gIkVGWl90cmVhdG1lbnRfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjY2VsbCAlaW4lIHVuaW5mX2Vmel9jZWxscyB+IlVuaW5mX0VGWl9zaWduYXR1cmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNjZWxsICVpbiUgdW5pbmZfY2VsbHMgfiAiVW5pbmZfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRSVUUgfiAibm9fc2lnbmF0dXJlIikpCgoKaHQgPC0gZHJhdyhIZWF0bWFwKHQobXR4KSwgCiAgICAgICAgICAgICBjb2x1bW5fdGl0bGUgPSAiQWxsIHBhdGllbnRzIHNwbGl0IGFjY29yZGluZyB0byBnZW5lIHNpZ25hdHVyZSBzY29yZXMiLCAKICAgICAgICAgICAgIHRvcF9hbm5vdGF0aW9uID0gSGVhdG1hcEFubm90YXRpb24oc2lnbmF0dXJlID0gY2FzZV93aGVuKAogICAgICAgICAgICAgICByb3duYW1lcyhtdHgpICVpbiUgdHJlYXRfY2VsbHMgfiAiRUZaX3RyZWF0bWVudF9zaWduYXR1cmUiLAogICAgICAgICAgICAgICAjcm93bmFtZXMobXR4KSAlaW4lIHVuaW5mX2Vmel9jZWxscyB+ICJVbmluZl9FRlpfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgI3Jvd25hbWVzKG10eCkgJWluJSB1bmluZl9jZWxscyB+ICJVbmluZl9zaWduYXR1cmUiLAogICAgICAgICAgICAgICBUUlVFIH4gIm5vX3NpZ25hdHVyZSIpLAogICAgICAgICAgICAgICBuYW1lID0gInNpZ25hdHVyZSIsCiAgICAgICAgICAgICAgIGNvbCA9IGxpc3Qoc2lnbmF0dXJlID0gYygiRUZaX3RyZWF0bWVudF9zaWduYXR1cmUiID0gIm9saXZlZHJhYjMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyJVbmluZl9FRlpfc2lnbmF0dXJlIiA9ICJsaWdodGJsdWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyJVbmluZl9zaWduYXR1cmUiID0gIm9yYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm9fc2lnbmF0dXJlIiA9ICJuYXZ5IikpKSwgICAgICAgCiAgICAgICAgICAgICBjb2x1bW5fc3BsaXQgPSBzaWduYXR1cmUkc2lnbmF0dXJlLAogICAgICAgICAgICAgc2hvd19jb2x1bW5fbmFtZXMgPSBGQUxTRSwKICAgICAgICAgICAgIGNvbCA9Y29sb3JSYW1wUGFsZXR0ZShyZXYoYnJld2VyLnBhbChuID0gNywgbmFtZSA9ICJSZFlsQnUiKSkpKDEwMCksCiAgICAgICAgICAgICBzaG93X3Jvd19uYW1lcyA9IFRSVUUKICAgICAgICAgICAgICkpCmBgYAoKLS0tCgojIERpZmZlcmVudGlhbCBURiBhY3Rpdml0eSB7LnRhYnNldH0KCkFmdGVyIGhhdmluZyBpZGVudGlmaWVkIGEgZmV3IGNlbGxzIHdpdGggYSBoaWdoIHNjb3JlcyBmb3IgdGhlIGluZmVjdGlvbiBzaWduYXR1cmUKKEluZitFRlopLCBhcyB3ZWxsIGFzIGNlbGxzIHdpdGggYSBoaWdoIHNjb3JlIGZvciB0aGUgRUZaIHRyZWF0bWVudCBzaWduYXR1cmVzLAppdCB3b3VsZCBiZSBpbnRlcmVzdGluZyB0byBrbm93IHdoZXRoZXIgc29tZSBURnMgaGF2ZSBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2Vlbgp0aGUgY29uZGl0aW9ucy4gRm9yIHRoaXMgYSBLcnVza2FsLVdhbGxpcyBUZXN0IHdhcyB1c2VkLCBmb2xsb3dlZCBieSBhCnBhaXJ3aXNlIFdpbGNveCBUZXN0LiAKCiMjIEJldHdlZW4gaW5mZWN0aW9uIGNvbmRpdGlvbnMKCk91dCBvZiBhbGwgMTI1IFRGcywgNDQgaGF2ZSBkaWZmZXJlbnQgYWN0aXZpdHkgYmV0d2VlbiBjZWxscyB3aXRoIGEgaGlnaCBzY29yZSBmb3IgCnRoZSBJbmYrRUZaIHNpZ25hdHVyZSBjb21wYXJlZCB0byB0aGUgcmVzdC4gVGhlIGFjdGl2aXRpZXMgZm9yIHRob3NlIFRGcyB3aGljaAphcmUgYWxzbyBmb3VuZCB0byBoYXZlIGEgZGlmZmVyZW50aWFsIGJpbmRpbmcgc2NvcmVzIGluIEMyMCBtaWNyb2dsaWEgYXJlIApzaG93biBpbiB0aGUgYm94cGxvdHMgYmVsb3cuIEtMRjQgYW5kIFJFU1QgYXJlIHRoZSBvbmx5IHR3byBURnMgbW9yZSBib3VuZCBpbgpsYXRlbnRseSBpbmZlY3RlZCBDMjAgbWljcm9nbGlhLiBLTEY0IGlzIG1vcmUgYWN0aXZlIGluIE15ZWxvaWQyIHdpdGggYSBoaWdoCnNjb3JlIGZvciB0aGUgSW5mK0VGWiBzaWduYXR1cmUsIGJ1dCBSRVNUIGlzIGxlc3MgYWN0aXZlLiBBbGwgb3RoZXIgVEZzIGFyZSBtb3JlIApib3VuZCBpbiB1bmluZmVjdGVkIEMyMCBtaWNyb2dsaWEgdGhhbiBpbiBsYXRlbnRseSBpbmZlY3RlZCwgYnV0IHRoZSBURiBhY3Rpdml0eQppcyBub3QgYWx3YXlzIGhpZ2hlciBpbiB1bmluZmVjdGVkIE15ZWxvaWQyIChubyBoaWdoIHNjb3JlIGZvciBJbmYrRUZaIHNpZ25hdHVyZSkuCgpgYGB7cn0KaGl2bXkyX3NjZW5pYyA8LSBBZGRNZXRhRGF0YShoaXZteTIsIAogICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhID0gYXVjX210eCwgCiAgICAgICAgICAgICAgICAgICAgY29sLm5hbWUgPSBjb2xuYW1lcyhhdWNfbXR4KSkKCmluZl9zaWduX2RmIDwtIGhpdm15Ml9zY2VuaWNAbWV0YS5kYXRhICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgbXV0YXRlKHNpZ25hdHVyZSA9IGNhc2Vfd2hlbihjZWxsICVpbiUgaW5mX2Vmel9jZWxscyB+ICJJbmZfRUZaIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFIH4gIm5vX3NpZ24iKSkKCiMgY2hlY2sgYWxsIFRGcyAKcF92YWx1ZXMgPC0gbWFwKHNlcS5pbnQoMToxMjUpLCBmdW5jdGlvbihuKXsKICB0ZiA8LSBjb2xuYW1lcyhhdWNfbXR4KVtuXQogIHBfdmFsdWVzIDwtIHVubGlzdChrcnVza2FsLnRlc3QocHVsbChpbmZfc2lnbl9kZlt0Zl0pIH4gc2lnbmF0dXJlLCBpbmZfc2lnbl9kZikpWyJwLnZhbHVlIl0KfSkKCiMgYWRqdXN0IGZvciBtdWx0aXBsZSB0ZXN0aW5nIHdpdGggRkRSCmFkal9wX3ZhbHVlcyA8LSBwLmFkanVzdChhcy5udW1lcmljKHVubmFtZSh1bmxpc3QocF92YWx1ZXMpKSksIG1ldGhvZCA9ICJmZHIiKQoKIyBob3cgbWFueSB0cmFuc2NyaXB0aW9uIGZhY3RvcnMgYXJlIHNpZ25pZmljYW50bHkgZGlmZmVyZW50IGJldHdlZW4gdGhlIGNsdXN0ZXJzPwpzaWduIDwtIGFkal9wX3ZhbHVlc1thZGpfcF92YWx1ZXMgPCAwLjA1XQpsZW5ndGgoc2lnbikKZGlmZl9jZWxscyA8LSBjb2xuYW1lcyhhdWNfbXR4KVthZGpfcF92YWx1ZXMgPCAuMDVdCgojIGdldCBvbmx5IHRoZSBURnMgYWxzbyBmb3VuZCBpbiBmb290cHJpbnRpbmcKCiMgcmVhZCBpbiBmb290cHJpbnRpbmcgcmVzdXRscwp0ZnNfYW5hIDwtIHJlYWQudGFibGUoIi9tZWRpYS9hZy1jaGVycm1hbm4vcHJvamVjdHMvMDZfSElWX01pY3JvZ2xpYS9kYXRhL2F0YWNzZXEvZGF0YS0yMDIwLTExLTA2L3RvYmlhcy9UT0JJQVNfc25ha2VtYWtlL2Zvb3RwcmludF9tZ2xpYTJfR2xhc3NURl8xNy0wMy9URkJTL2JpbmRldGVjdF9yZXN1bHRzLnR4dCIsIHNlcCA9ICJcdCIsIGhlYWRlciA9IFRSVUUpCgojIGZpbHRlciBURnMgd2l0aCBzaWduaWZpY2FudCBwIHZhbHVlcyBiZXR3ZWVuIGxhdGVudCBpbmZlY3Rpb24gYW5kIHVuaW5mZWN0ZWQKIyBJIGRlY2lkZWQgdG8gdXNlIGEgdGhyZXNob2xkIG9mIHAtdmFsdWUgPCAxZS01MCwgYmVjYXVzZSBkdWUgdG8gdGhlIGxhcmdlIG51bWJlciAKIyBvZiBkYXRhLCBhbGwgcC12YWx1ZXMgd2lsbCBiZSB2ZXJ5IGhpZ2gKdG9wX3RmcyA8LSB0ZnNfYW5hICU+JSBmaWx0ZXIodW5pbmZfcmVkX3B2YWx1ZSA8IDFlLTUwKQpkb3duX3RmcyA8LSB0b3BfdGZzICU+JSBmaWx0ZXIodW5pbmZfcmVkX2NoYW5nZSA8IDApCiNkb3duX3RmcyA8LSB0b3BfdGZzICU+JSBmaWx0ZXIodW5pbmZfcmVkX2NoYW5nZSA8ICkKCmRpZmZfdGZzIDwtIGRpZmZfY2VsbHNbZGlmZl9jZWxscyAlaW4lIHRvcF90ZnMkbmFtZV0KCmRpZmZfY2VsbHNbZGlmZl9jZWxscyAlaW4lIGRvd25fdGZzJG5hbWVdCmBgYAoKCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTEyfQpwbG90cyA8LSBtYXAoZGlmZl90ZnMsIGZ1bmN0aW9uKHRmKXsKICBnZ3Bsb3QoKSArCiAgICBnZW9tX3Zpb2xpbihhZXMoeCA9IGluZl9zaWduX2RmICU+JSBwdWxsKCJzaWduYXR1cmUiKSwgCiAgICAgICAgICAgICAgICAgICAgIHkgPSBpbmZfc2lnbl9kZiAlPiUgcHVsbCh0ZiksCiAgICAgICAgICAgICAgICAgICAgIGZpbGwgPSBpbmZfc2lnbl9kZiAlPiUgcHVsbCgic2lnbmF0dXJlIikpKSArCiAgICBnZW9tX2JveHBsb3QoYWVzKHggPSBpbmZfc2lnbl9kZiAlPiUgcHVsbCgic2lnbmF0dXJlIiksIAogICAgICAgICAgICAgICAgICAgICB5ID0gaW5mX3NpZ25fZGYgJT4lIHB1bGwodGYpKSwKICAgICAgICAgICAgICAgICBhbHBoYSA9IDApICsKICAgIHN0YXRfcHZhbHVlX21hbnVhbChpbmZfc2lnbl9kZiAlPiUgCiAgICAgICAgICAgICAgICAgICAgICAgICBwYWlyd2lzZV93aWxjb3hfdGVzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMuZm9ybXVsYShwYXN0ZTAodGYsICIgfiBodF9jbHVzdGVyIikpKSAlPiUgCiAgICAgICAgICAgICAgICAgICAgICAgICBhZGRfeHlfcG9zaXRpb24oKSkgKwogICAgeGxhYigiY29uZGl0aW9uIikgKwogICAgeWxhYihwYXN0ZTAodGYpKSArCiAgICBndWlkZXMoZmlsbCA9IGd1aWRlX2xlZ2VuZCh0aXRsZSA9ICJjb25kaXRpb24iKSkKICB9KQoKZG8uY2FsbChncmlkLmFycmFuZ2UsIGMocGxvdHMsIG5jb2wgPSAzLCBucm93ID0gNCkpCmBgYAoKLS0tCgojIyBCZXR3ZWVuIHRyZWF0bWVudCBjb25kaXRpb25zCgpBcmUgc29tZSBURnMgaW4gTXllbG9pZDIgZGlmZmVyZW50aWFsbHkgYWN0aXZlIGJldHdlZW4gdGhlIHRyZWF0bWVudCBjb25kaXRpb25zPwpUaGVyZSBhcmUgbm8gc2lnbmlmaWNhbnQgZGlmZmVyZW5jZXMgaW4gVEYgYWN0aXZpdHkgYmV0d2VlbiB0aGUgY2VsbHMgd2l0aCAKaGlnaCBzY29yZXMgZm9yIEVGWiB0cmVhdG1lbnQgc2lnbmF0dXJlIGNvbXBhcmVkIHRvIGNlbGxzIHdpdGhvdXQgdGhlIHNpZ25hdHVyZS4KVGhlcmVmb3JlLCBubyBwb3N0aG9jIGFuYWx5c2lzIHdhcyBwZXJmb3JtZWQuCgoKYGBge3J9CmRmIDwtIGhpdm15Ml9zY2VuaWNAbWV0YS5kYXRhICU+JSAKICByb3duYW1lc190b19jb2x1bW4oImNlbGwiKSAlPiUgCiAgICAgICAgIyBmaWx0ZXIoY2VsbCAlaW4lIGMoaW5mX2Vmel9jZWxscywgdW5pbmZfZWZ6X2NlbGxzLCB1bmluZl9jZWxscykpICU+JSAKICBtdXRhdGUoc2lnbmF0dXJlID0gY2FzZV93aGVuKGNlbGwgJWluJSB0cmVhdF9jZWxscyB+ICJ0cmVhdG1lbnRfc2lnbmF0dXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFIH4gIm5vX3NpZ25hdHVyZSIpKQoKIyBjaGVjayBhbGwgVEZzIApwX3ZhbHVlcyA8LSBtYXAoc2VxLmludCgxOjEyNSksIGZ1bmN0aW9uKG4pewogIHRmIDwtIGNvbG5hbWVzKGF1Y19tdHgpW25dCiAgcF92YWx1ZXMgPC0gdW5saXN0KGtydXNrYWwudGVzdChwdWxsKGRmW3RmXSkgfiBzaWduYXR1cmUsIGRmKSlbInAudmFsdWUiXQp9KQoKIyBhZGp1c3QgZm9yIG11bHRpcGxlIHRlc3Rpbmcgd2l0aCBGRFIKYWRqX3BfdmFsdWVzIDwtIHAuYWRqdXN0KGFzLm51bWVyaWModW5uYW1lKHVubGlzdChwX3ZhbHVlcykpKSwgbWV0aG9kID0gImZkciIpCgojIGhvdyBtYW55IHRyYW5zY3JpcHRpb24gZmFjdG9ycyBhcmUgc2lnbmlmaWNhbnRseSBkaWZmZXJlbnQgYmV0d2VlbiB0aGUgY2x1c3RlcnM/CnNpZ24gPC0gYWRqX3BfdmFsdWVzW2Fkal9wX3ZhbHVlcyA8IDAuMDVdCmBgYAoKLS0tCgojIyBHZW5lIGV4cHJlc3Npb24gb2YgaW5mbGFtbWF0b3J5IGdlbmVzIAoKW0BSeWFuXSBzaG93ZWQgdGhhdCB0d28gcGF0aHdheXMgYXJlIHNwZWNpZmljYWxseSBhY3RpdmF0ZWQgaW4gdGhlIEluZitFRlogCmNvbmRpdGlvbiwgbmFtZWx5IFJob0dESSBzaWduYWxpbmcgYW5kIENENDAgc2lnbmFsaW5nLiBUaGlzIGVmZmVjdCB3YXMgbm90IHNlZW4gCmluIFVuaW5mK0VGWiwgc28gaXQgZG9lcyBub3Qgc2VlbSB0byBiZSBjYXVzZWQgYnkgRUZaIGFsb25lLCAKYnV0IHJhdGhlciBhIGNvbWJpbmF0aW9uIG9mIGluZmVjdGlvbiBhbmQgRUZaIHRyZWF0bWVudCBbQFJ5YW5dLgoKKiBSaG9HREkgc2lnbmFsaW5nOgogICsgUFAxUjEyQSB3YXMgdXByZWd1bGF0ZWQgCiAgKyBSTkQzLCBDRDQ0LCBBQ1RHMSB3ZXJlIGRvd25yZWd1bGF0ZWQKKiBDRDQwIHNpZ25hbGluZzoKICArIEZPUyB3YXMgdXByZWd1bGF0ZWQKICArIE5GS0JJQSwgSUNBTTEsIFRGTkFJUDMgd2VyZSBkb3ducmVndWxhdGVkIAogIApIZXJlLCB3ZSB3b3VsZCBsaWtlIHRvIHNlZSBpZiBjZWxsIHdpdGggaGlnaCBzY29yZXMgZm9yIHRoZSBJbmYrRUZaIHNpZ25hdHVyZQpzaG93IGdlbmUgZXhwcmVzc2lvbiBwYXR0ZXJucyB0aGF0IGFyZSBpbiBsaW5lIHdpdGggdGhlIGZpbmRpbmdzIGJ5IFtAUnlhbl0uIApUaGUgZ2VuZSBleHByZXNzaW9uIGZvciBlYWNoIGdlbmUgaXMgc2hvd24gaW4gdGhlIGZpZ3VyZSBiZWxvdy4KV2Ugd291bGQgZXhwZWN0IG9ubHkgUFAxUjEyQSBhbmQgRk9TIHRvIGJlIG1vcmUgaGlnaGx5IGV4cHJlc3NlZCBpbiB0aGUgY2VsbHMKd2l0aCBJbmYrRUZaIHNpZ25hdHVyZSwgd2hpbGUgYWxsIG90aGVyIGdlbmVzIHNob3VsZCBiZSBsZXNzIGhpZ2hseSBleHByZXNzZWQuClRoaXMgcGF0dGVybiBpbiBnZW5lIGV4cHJlc3Npb24gaXMsIGhvd2V2ZXIsIG5vdCBvYnNlcnZlZC4gCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTh9CiMgcmVhZCBpbiBTZXVyYXQgb2JqZWN0IGNvbnRhaW5pbmcgTXllbG9pZDIgY2VsbHMKaGl2bXkyX3NjZW5pYyA8LSBBZGRNZXRhRGF0YShoaXZteTJfc2NlbmljLCBtZXRhZGF0YSA9IGluZl9zaWduX2RmJHNpZ25hdHVyZSwgY29sLm5hbWUgPSAic2lnbmF0dXJlIikKCiMgUmhvR0RJIHNpZ25hbGluZyBpbiBteWVsb2lkMgpwMSA8LSBWbG5QbG90KGhpdm15Ml9zY2VuaWMsIGZlYXR1cmVzID0gYygiUk5EMyIsICJDRDQ0IiwgIkFDVEcxIiwgIlBQUDFSMTJBIiksIAogICAgICAgICAgICAgIGdyb3VwLmJ5ID0gInNpZ25hdHVyZSIsIG5jb2wgPSAyKQoKIyBDRDQwIHNpZ25hbGluZyBpbiBteWVsb2lkMgpwMiA8LSBWbG5QbG90KGhpdm15Ml9zY2VuaWMsIGZlYXR1cmVzID1jKCJORktCSUEiLCAiSUNBTTEiLCAiVE5GQUlQMyIsICJGT1MiKSwgCiAgICAgICAgICAgICAgZ3JvdXAuYnkgPSAic2lnbmF0dXJlIiwgbmNvbCA9IDIpCgojIFJob0dESSBzaWduYWxpbmcgaW4gaU1nCnAzIDwtIFZsblBsb3QobWljcm9nbGlhLCBmZWF0dXJlcyA9IGMoIlJORDMiLCAiQ0Q0NCIsICJBQ1RHMSIsICJQUFAxUjEyQSIpLCAKICAgICAgICBuY29sID0gMiwgcHQuc2l6ZSA9IDAsIGdyb3VwLmJ5ID0gIm9yaWcuaWRlbnQiKQoKIyBDRDQwIHNpZ25hbGluZyBpbiBpTWcKcDQgPC0gVmxuUGxvdChtaWNyb2dsaWEsIGZlYXR1cmVzID0gYygiTkZLQklBIiwgIklDQU0xIiwgIlRORkFJUDMiLCAiRk9TIiksIAogICAgICAgIG5jb2wgPSAyLCBwdC5zaXplID0gMCwgZ3JvdXAuYnkgPSAib3JpZy5pZGVudCIpCgpmaWcgPC0gZ2dhcnJhbmdlKHAxLCBwMywgbmNvbCA9IDIsIG5yb3cgPSAxKQphbm5vdGF0ZV9maWd1cmUoZmlnLCB0b3AgPSB0ZXh0X2dyb2IoIkV4cHJlc3Npb24gb2YgZm91ciBnZW5lcyBvZiB0aGUgUmhvR0RJIHNpZ25hbGluZyBwYXRod2F5IGluIE15ZWxvaWQyIChsZWZ0IGNvbHVtbikgYW5kIGlNZyAocmlnaHQgY29sdW1uKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplID0gMjAgLCBmYWNlID0gImJvbGQiKSkKCmZpZyA8LSBnZ2FycmFuZ2UocDIsIHA0LCBuY29sID0gMiwgbnJvdyA9IDEpCmFubm90YXRlX2ZpZ3VyZShmaWcsIHRvcCA9IHRleHRfZ3JvYigiRXhwcmVzc2lvbiBvZiBmb3VyIGdlbmVzIG9mIHRoZSBDRDQwIHNpZ25hbGluZyBwYXRod2F5IGluIE15ZWxvaWQyIChsZWZ0IGNvbHVtbikgYW5kIGlNZyAocmlnaHQgY29sdW1uKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplID0gMjAgLCBmYWNlID0gImJvbGQiKSkKCmBgYAoKT25seSBGT1Mgd2hpY2ggZW5jb2RlcyBhIFRGIGlzIGZvdW5kIGluIHRoZSBURiBhY3Rpdml0eSBtYXRyaXgsIHNvIGZvciBGT1MgCnRoZSBURiBhY2l2aXR5IGlzIHNob3duIGFzIHdlbGwuIEp1ZGdpbmcgZnJvbSB0aGUgZmlndXJlIGJlbG93IEZPUyBzZWVtcyB0byBiZSAKbW9yZSBhY3RpdmUgaW4gY2VsbHMgd2l0aCBoaWdoIHNjb3JlIGZvciBJbmYrRUZaIHNpZ25hdHVyZSwgYnV0IHRoaXMgZGlmZmVyZW5jZQppcyBub3Qgc3RhdGlzdGljYWxseSBzaWduaWZpY2FudC4KCmBgYHtyfQppbmZfc2lnbl9kZiAlPiUgZ2dwbG90KGFlcyh4ID0gc2lnbmF0dXJlLCB5ID0gRk9TKSkgKwogIGdlb21fdmlvbGluKGFlcyhmaWxsID0gc2lnbmF0dXJlLCBhbHBoYSA9IC42KSkgKwogIGdlb21fYm94cGxvdChhbHBoYSA9IDApICsKICBzdGF0X3B2YWx1ZV9tYW51YWwoaW5mX3NpZ25fZGYgJT4lIAogICAgICAgICAgICAgICAgICAgICAgIHBhaXJ3aXNlX3dpbGNveF90ZXN0KEZPUyB+IHNpZ25hdHVyZSkgJT4lIAogIGFkZF94eV9wb3NpdGlvbigpKQoKYGBgCgotLS0KCiMgQXBwZW5kaXgKCiMjIEluZmxhbW1hdG9yeSBQYXRod2F5cwoKQXMgYWxyZWFkeSBtZW50aW9uZWQgYWJvdmUgW0BSeWFuXSBzaG93ZWQgdGhhdCB0d28gcGF0aHdheXMgYXJlIHNwZWNpZmljYWxseSBhY3RpdmF0ZWQgaW4gdGhlIEluZitFRlogCmNvbmRpdGlvbiwgbmFtZWx5IFJob0dESSBzaWduYWxpbmcgYW5kIENENDAgc2lnbmFsaW5nLiBUaGlzIGVmZmVjdCB3YXMgbm90IHNlZW4gCmluIFVuaW5mK0VGWiwgc28gaXQgZG9lcyBub3Qgc2VlbSB0byBiZSBjYXVzZWQgYnkgRUZaIGFsb25lLCAKYnV0IHJhdGhlciBhIGNvbWJpbmF0aW9uIG9mIGluZmVjdGlvbiBhbmQgRUZaIHRyZWF0bWVudCBbQFJ5YW5dLgoKKiBSaG9HREkgc2lnbmFsaW5nOgogICsgUFAxUjEyQSB3YXMgdXByZWd1bGF0ZWQgCiAgKyBSTkQzLCBDRDQ0LCBBQ1RHMSB3ZXJlIGRvd25yZWd1bGF0ZWQKKiBDRDQwIHNpZ25hbGluZzoKICArIEZPUyB3YXMgdXByZWd1bGF0ZWQKICArIE5GS0JJQSwgSUNBTTEsIFRGTkFJUDMgd2VyZSBkb3ducmVndWxhdGVkIAogIApUbyBhbnN3ZXIgdGhlIHF1ZXN0aW9uIHdoZXRoZXIgd2UgY291bGQgZmluZCBzaW1pbGFyIHBhdHRlcm5zIGluIHRoZSB0d28gTXllbG9pZDIgY2x1c3RlcnMKd2l0aCBkaWZmZXJlbnQgVEYgYWN0aXZpdHksIHdlIGhhZCBhIGxvb2sgYXQgdGhlIGdlbmUgZXhwcmVzc2lvbi4KCiMjIyMjIE15ZWxvaWQyIGNlbGxzIAoKVHdvIGdlbmVzIG9mIHRoZSBSaG9HREkgc2lnbmFsaW5nIHBhdGh3YXkgd2VyZSBmb3VuZCBhbW9uZyB0aGUgZGlmZmVyZW50aWFsbHkKZXhwcmVzc2VkIGdlbmVzIGJldHdlZW4gSW5mK0VGWiBhbmQgVW5pbmYrRUZaLiBCb3RoIG9mIHRoZW0gd2VyZSBkb3ducmVndWxhdGVkCmluIEluZitFRlogY29tcGFyZWQgdG8gVW5pbmYrRUZaIGlNZyBhcyBjYW4gYmUgc2VlbiBpbiB0aGUgdGFibGUgYmVsb3cuCgpgYGB7ciwgcmVzdWx0cyA9ICJhc2lzIn0KaW5mX3VuaW5mX2FydF9tYXJrZXIgJT4lIAogIHJvd25hbWVzX3RvX2NvbHVtbigiZ2VuZSIpICU+JQogIGZpbHRlcihnZW5lICVpbiUgYygiUk5EMyIsICJDRDQ0IiwgIkFDVEcxIiwgIlBQUDFSMTJBIikpICU+JQogIGthYmxlKGNhcHRpb24gPSAiR2VuZXMgb2YgdGhlIFJob0dESSBzaWduYWxpbmcgcGF0aHdheSBmb3VuZCBhbW9uZyBnZW5lcyBkaWZmZXJlbnRpYWxseSBleHByZXNzZWQgYmV0d2VlbiBJbmYrRUZaIGFuZCBVbmluZitFRloiKQpgYGAKCkFsbCBmb3VyIGdlbmVzIG9mIHRoZSBDRDQwIHNpZ25hbGluZyB3ZXJlIGZvdW5kIGFtb25nIHRoZSBkaWZmZXJlbnRpYWxseSBleHByZXNzZWQKZ2VuZXMgYmV0d2VlbiBJbmYrRUZaIGFuZCBVbmluZitFRlouIEZPUyB3YXMgdXByZWd1bGF0ZWQsIHdoaWxlIE5GS0JJQSwgSUNBTTEgYW5kIApURk5BSVAzIHdlcmUgZG93bnJlZ3VsYXRlZCBpbiBJbmYrRUZaIGNvbXBhcmVkIHRvIFVuaW5mK0VGWiBhcyBjYW4gYmUgc2VlbiBpbiB0aGUKdGFibGUgYmVsb3cuIAoKYGBge3IsIHJlc3VsdHMgPSAiYXNpcyJ9CmluZl91bmluZl9hcnRfbWFya2VyICU+JSAKICByb3duYW1lc190b19jb2x1bW4odmFyID0gImdlbmUiKSAlPiUKICBmaWx0ZXIoZ2VuZSAlaW4lIGMoIkZPUyIsICJORktCSUEiLCAiSUNBTTEiLCAiVE5GQUlQMyIpKSAlPiUga2FibGUoKQoKYGBgCgoKVGhlIGNoYW5nZXMgaW4gZ2VuZSBleHByZXNzaW9uIG9mIGJvdGggcGF0aHdheXMgYXJlIGluIGxpbmUgd2l0aCB0aGUgZmluZGluZ3MgCmJ5IFtAUnlhbl0uIAoKQWRkaXRpb25hbGx5LCB3ZSB3ZXJlIGludGVyZXN0ZWQgd2hldGhlciB0aGlzIHBhdHRlcm4gaW4gZ2VuZSBleHByZXNzaW9uIApjb3JyZWxhdGVkIHdpdGggdGhlIHR3byBjbHVzdGVycyBpZGVudGlmaWVkIGluIE15ZWxvaWQyIHdoaWNoIGV4aGliaXQgZGlmZmVyZW50ClRGIGFjdGl2aXRpZXMuIFRoZSBmaWd1cmUgYmVsb3cgc2hvdyB0aGUgZ2VuZSBleHByZXNzaW9uIG9mIHRoZSBmb3VyIGdlbmVzIG9mIAp0aGUgcmVzcGVjdGl2ZSBwYXRod2F5cyBib3RoIGluIE15ZWxvaWQyIGNlbGxzIChsZWZ0IGNvbHVtbikgYW5kIGluIGlNZyAocmlnaHQgCmNvbHVtbikuCgpGT1MgaXMgdGhlIG9ubHkgZ2VuZSB3aGljaCBzaG93cyBhIGhpZ2ggZXhwcmVzc2lvbiBpbiBNeWVsb2lkMiBjbHVzdGVyIGMxLiAKVGhpcyBzdXBwb3J0cyBvdXIgaHlwb3RoZXNpcyB0aGF0IGMxIG1pZ2h0IGJlIGEgbGF0ZW50bHkgaW5mZWN0ZWQgcmVhY3RpdmUgbWljcm9nbGlhIApjZWxsIHN0YXRlLiBIb3dldmVyIHRoZW4gd2Ugd291bGQgZXhwZWN0IHRvIHNlZSBhIHNpbWlsYXIgcGF0dGVybiBmb3IgdGhlIFJob0dESQpzaWduYWxpbmcsIG1lYW5pbmcgUFBQMVIxMkEgc2hvdWxkIGJlIHRoZSBvbmx5IGdlbmUgd2hpY2ggaXMKaGlnaGx5IGV4cHJlc3NlZCBpbiBjMS4gVGhpcyBpcyBub3QgdGhlIGNhc2UsIGJ1dCByYXRoZXIgQ0Q0NCBhbmQgQUNURzEgYWxzbyAKc2hvdyBoaWdoZXIgZXhwcmVzc2lvbiBpbiBjMSBjb21wYXJlZCB0byBjMi4gQ29uc2VxdWVudGx5LCBvdXIgaHlwb3RoZXNpcyBpcyBub3QgCmNsZWFybHkgc3VwcG9ydGVkIGJ5IHRoZSBleHByZXNzaW9uIHBhdHRlcm5zIG9mIHRoZXNlIGluZmxhbW1hdG9yeSBnZW5lcy4KCmBgYHtyLCBmaWcud2lkdGg9MTUsIGZpZy5oZWlnaHQ9Nn0KIyBpc29sYXRlIG1pY3JvZ2xpYSBjZWxscwptaWNyb2dsaWEgPC0gc3Vic2V0KGNvbWJpbmVkLCBjZWxsX3R5cGUgPT0gImlNZyIpCgojIHJlYWQgaW4gU2V1cmF0IG9iamVjdCBjb250YWluaW5nIE15ZWxvaWQyIGNlbGxzCmhpdm15MiA8LSByZWFkUkRTKCIvbWVkaWEvYWctY2hlcnJtYW5uL2ttaWt1bGlrL0hJVl9taWNyb2dsaWEvZGF0YS9oaXZfbXllbG9pZDJfc3ViY2x1c3RlcnMiKQoKCnAxIDwtIFZsblBsb3QoaGl2bXkyLCBmZWF0dXJlcyA9IGMoIlJORDMiLCAiQ0Q0NCIsICJBQ1RHMSIsICJQUFAxUjEyQSIpLCAKICAgICAgICAgICAgICBncm91cC5ieSA9ICJodF9jbHVzdGVyIiwgbmNvbCA9IDIpCgpwMiA8LSBWbG5QbG90KGhpdm15MiwgZmVhdHVyZXMgPWMoIk5GS0JJQSIsICJJQ0FNMSIsICJUTkZBSVAzIiwgIkZPUyIpLCAKICAgICAgICAgICAgICBncm91cC5ieSA9ICJodF9jbHVzdGVyIiwgbmNvbCA9IDIpCgpwMyA8LSBWbG5QbG90KG1pY3JvZ2xpYSwgZmVhdHVyZXMgPSBjKCJSTkQzIiwgIkNENDQiLCAiQUNURzEiLCAiUFBQMVIxMkEiKSwgCiAgICAgICAgbmNvbCA9IDIsIHB0LnNpemUgPSAwLCBncm91cC5ieSA9ICJvcmlnLmlkZW50IikKCnA0IDwtIFZsblBsb3QobWljcm9nbGlhLCBmZWF0dXJlcyA9IGMoIk5GS0JJQSIsICJJQ0FNMSIsICJUTkZBSVAzIiwgIkZPUyIpLCAKICAgICAgICBuY29sID0gMiwgcHQuc2l6ZSA9IDAsIGdyb3VwLmJ5ID0gIm9yaWcuaWRlbnQiKQoKZmlnIDwtIGdnYXJyYW5nZShwMSwgcDMsIG5jb2wgPSAyLCBucm93ID0gMSkKYW5ub3RhdGVfZmlndXJlKGZpZywgdG9wID0gdGV4dF9ncm9iKCJFeHByZXNzaW9uIG9mIGZvdXIgZ2VuZXMgb2YgdGhlIFJob0dESSBzaWduYWxpbmcgcGF0aHdheSBpbiBNeWVsb2lkMiAobGVmdCBjb2x1bW4pIGFuZCBpTWcgKHJpZ2h0IGNvbHVtbikiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IDIwICwgZmFjZSA9ICJib2xkIikpCgpmaWcgPC0gZ2dhcnJhbmdlKHAyLCBwNCwgbmNvbCA9IDIsIG5yb3cgPSAxKQphbm5vdGF0ZV9maWd1cmUoZmlnLCB0b3AgPSB0ZXh0X2dyb2IoIkV4cHJlc3Npb24gb2YgZm91ciBnZW5lcyBvZiB0aGUgQ0Q0MCBzaWduYWxpbmcgcGF0aHdheSBpbiBNeWVsb2lkMiAobGVmdCBjb2x1bW4pIGFuZCBpTWcgKHJpZ2h0IGNvbHVtbikiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IDIwICwgZmFjZSA9ICJib2xkIikpCmBgYAoKCjxkZXRhaWxzPgo8c3VtbWFyeT5TYW1lIHR3byBwYXRod2F5cyBpbiBNeWVsb2lkNSBjZWxsczwvc3VtbWFyeT4KCk15ZWxvaWQ1IGNlbGxzCgoKYGBge3IsIGZpZy53aWR0aD0xNSwgZmlnLmhlaWdodD0xMn0KCiMgaXNvbGF0ZSB0aGUgTXllbG9pZDUgY2x1c3RlcgpoaXZteTUgPC0gc3Vic2V0KGhpdjcsIGNlbGxfdHlwZSA9PSAiTXllbG9pZDUiICYgb3JpZy5pZGVudCAlaW4lIGMoIkhJVjFfQ1NGIiwgIkhJVjJfQ1NGIiwgIkhJVjNfQ1NGIikpCgojIHByb2Nlc3MgTXllbG9pZCA1IFNldXJhdCBvYmplY3QKaGl2bXk1IDwtIFNjYWxlRGF0YShoaXZteTUsIHZlcmJvc2UgPSBGQUxTRSkKaGl2bXk1IDwtIE5vcm1hbGl6ZURhdGEoaGl2bXk1LCB2ZXJib3NlID0gRkFMU0UpCmhpdm15NSA8LSBTY2FsZURhdGEoaGl2bXk1LCB2ZXJib3NlID0gRkFMU0UpCmhpdm15NSA8LSBGaW5kVmFyaWFibGVGZWF0dXJlcyhoaXZteTUsIHZlcmJvc2UgPSBGQUxTRSkKaGl2bXk1IDwtIFJ1blBDQShoaXZteTUsIGZlYXR1cmVzID0gVmFyaWFibGVGZWF0dXJlcyhoaXZteTUpLCB2ZXJib3NlID0gRkFMU0UpCiNFbGJvd1Bsb3QoaGl2bXk1KQpoaXZteTUgPC0gUnVuVFNORShoaXZteTUsIGRpbXM9IDE6MTAsIHZlcmJvc2UgPSBGQUxTRSkKYGBgCgpgYGB7ciwgZmlnLndpZHRoPTE1LCBmaWcuaGVpZ2h0PTEyfQoKcDEgPC0gVmxuUGxvdChoaXZteTUsIGZlYXR1cmVzID0gYygiUk5EMyIsICJDRDQ0IiwgIkFDVEcxIiwgIlBQUDFSMTJBIiksIAogICAgICAgICAgICAgIGdyb3VwLmJ5ID0gIm9yaWcuaWRlbnQiLG5jb2wgPSAyKQoKcDIgPC0gVmxuUGxvdChoaXZteTUsIGZlYXR1cmVzID1jKCJORktCSUEiLCAiSUNBTTEiLCAiVE5GQUlQMyIsICJGT1MiKSwgCiAgICAgICAgICAgICAgZ3JvdXAuYnkgPSAib3JpZy5pZGVudCIsIG5jb2wgPSAyKQoKcDMgPC0gVmxuUGxvdChtaWNyb2dsaWEsIGZlYXR1cmVzID0gYygiUk5EMyIsICJDRDQ0IiwgIkFDVEcxIiwgIlBQUDFSMTJBIiksIAogICAgICAgIG5jb2wgPSAyLCBwdC5zaXplID0gMCwgZ3JvdXAuYnkgPSAib3JpZy5pZGVudCIpCgpwNCA8LSBWbG5QbG90KG1pY3JvZ2xpYSwgZmVhdHVyZXMgPSBjKCJORktCSUEiLCAiSUNBTTEiLCAiVE5GQUlQMyIsICJGT1MiKSwgCiAgICAgICAgbmNvbCA9IDIsIHB0LnNpemUgPSAwLCBncm91cC5ieSA9ICJvcmlnLmlkZW50IikKCmdnYXJyYW5nZShwMiwgcDQsIHAxLCBwMywgbmNvbCA9IDIsIG5yb3cgPSAyKQpgYGAKCjwvZGV0YWlscz4KCiMgUmVmZXJlbmNlcwoKCg==</div>

<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("Triculture_csf_integration.Rmd");
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
